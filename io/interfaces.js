"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const adapters_1 = require("./adapters");
exports.ITERATOR_DONE = Object.freeze({ done: true, value: void (0) });
/**
 * @ignore
 */
class ArrowJSON {
    constructor(_json) {
        this._json = _json;
    }
    get schema() { return this._json['schema']; }
    get batches() { return (this._json['batches'] || []); }
    get dictionaries() { return (this._json['dictionaries'] || []); }
}
exports.ArrowJSON = ArrowJSON;
Object.defineProperty(ArrowJSON.prototype, 'schema', { get() { return this._json['schema']; } });
Object.defineProperty(ArrowJSON.prototype, 'batches', { get() { return (this._json['batches'] || []); } });
Object.defineProperty(ArrowJSON.prototype, 'dictionaries', { get() { return (this._json['dictionaries'] || []); } });
class ReadableInterop {
    tee() {
        return this._getReadableDOMStream().tee();
    }
    pipe(writable, options) {
        return this._getReadableNodeStream().pipe(writable, options);
    }
    pipeTo(writable, options) { return this._getReadableDOMStream().pipeTo(writable, options); }
    pipeThrough(duplex, options) {
        return this._getReadableDOMStream().pipeThrough(duplex, options);
    }
    _getReadableDOMStream() {
        return this._readableDOMStream || (this._readableDOMStream = this.toReadableDOMStream());
    }
    _getReadableNodeStream() {
        return this._readableNodeStream || (this._readableNodeStream = this.toReadableNodeStream());
    }
}
exports.ReadableInterop = ReadableInterop;
/**
 * @ignore
 */
class AsyncQueue extends ReadableInterop {
    constructor() {
        super();
        this.values = [];
        this.resolvers = [];
        this._closedPromise = new Promise((r) => this._closedPromiseResolve = r);
    }
    get closed() { return this._closedPromise; }
    cancel(reason) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () { yield this.return(reason); });
    }
    write(value) {
        if (this._ensureOpen()) {
            this.resolvers.length <= 0
                ? (this.values.push(value))
                : (this.resolvers.shift().resolve({ done: false, value }));
        }
    }
    abort(value) {
        if (this._closedPromiseResolve) {
            this.resolvers.length <= 0
                ? (this._error = { error: value })
                : (this.resolvers.shift().reject({ done: true, value }));
        }
    }
    close() {
        if (this._closedPromiseResolve) {
            const { resolvers } = this;
            while (resolvers.length > 0) {
                resolvers.shift().resolve(exports.ITERATOR_DONE);
            }
            this._closedPromiseResolve();
            this._closedPromiseResolve = undefined;
        }
    }
    [Symbol.asyncIterator]() { return this; }
    toReadableDOMStream(options) {
        return adapters_1.default.toReadableDOMStream(this, options);
    }
    toReadableNodeStream(options) {
        return adapters_1.default.toReadableNodeStream(this, options);
    }
    throw(_) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () { yield this.abort(_); return exports.ITERATOR_DONE; });
    }
    return(_) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () { yield this.close(); return exports.ITERATOR_DONE; });
    }
    read(size) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () { return (yield this.next(size, 'read')).value; });
    }
    peek(size) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () { return (yield this.next(size, 'peek')).value; });
    }
    next(..._args) {
        if (this.values.length > 0) {
            return Promise.resolve({ done: false, value: this.values.shift() });
        }
        else if (this._error) {
            return Promise.reject({ done: true, value: this._error.error });
        }
        else if (!this._closedPromiseResolve) {
            return Promise.resolve(exports.ITERATOR_DONE);
        }
        else {
            return new Promise((resolve, reject) => {
                this.resolvers.push({ resolve, reject });
            });
        }
    }
    _ensureOpen() {
        if (this._closedPromiseResolve) {
            return true;
        }
        throw new Error(`${this.constructor.name} is closed`);
    }
}
exports.AsyncQueue = AsyncQueue;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LENBQUMsV0FBVyxDQUFDLElBQUksWUFBWSxDQUFDLENBQUM7SUFDMUQsQ0FBQztDQUNKO0FBekVELGdDQXlFQyIsImZpbGUiOiJpby9pbnRlcmZhY2VzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCBzdHJlYW1BZGFwdGVycyBmcm9tICcuL2FkYXB0ZXJzJztcblxuZXhwb3J0IGNvbnN0IElURVJBVE9SX0RPTkU6IGFueSA9IE9iamVjdC5mcmVlemUoeyBkb25lOiB0cnVlLCB2YWx1ZTogdm9pZCAoMCkgfSk7XG5cbmV4cG9ydCB0eXBlIEZpbGVIYW5kbGUgPSBpbXBvcnQoJ2ZzJykucHJvbWlzZXMuRmlsZUhhbmRsZTtcbmV4cG9ydCB0eXBlIEFycm93SlNPTkxpa2UgPSB7IHNjaGVtYTogYW55OyBiYXRjaGVzPzogYW55W107IGRpY3Rpb25hcmllcz86IGFueVtdOyB9O1xuZXhwb3J0IHR5cGUgUmVhZGFibGVET01TdHJlYW1PcHRpb25zID0geyB0eXBlOiAnYnl0ZXMnIHwgdW5kZWZpbmVkLCBhdXRvQWxsb2NhdGVDaHVua1NpemU/OiBudW1iZXIgfTtcblxuLyoqXG4gKiBAaWdub3JlXG4gKi9cbmV4cG9ydCBjbGFzcyBBcnJvd0pTT04ge1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgX2pzb246IEFycm93SlNPTkxpa2UpIHt9XG4gICAgcHVibGljIGdldCBzY2hlbWEoKTogYW55IHsgcmV0dXJuIHRoaXMuX2pzb25bJ3NjaGVtYSddOyB9XG4gICAgcHVibGljIGdldCBiYXRjaGVzKCk6IGFueVtdIHsgcmV0dXJuICh0aGlzLl9qc29uWydiYXRjaGVzJ10gfHwgW10pIGFzIGFueVtdOyB9XG4gICAgcHVibGljIGdldCBkaWN0aW9uYXJpZXMoKTogYW55W10geyByZXR1cm4gKHRoaXMuX2pzb25bJ2RpY3Rpb25hcmllcyddIHx8IFtdKSBhcyBhbnlbXTsgfVxufVxuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyb3dKU09OLnByb3RvdHlwZSwgJ3NjaGVtYScsIHsgZ2V0KCkgeyByZXR1cm4gdGhpcy5fanNvblsnc2NoZW1hJ107IH19KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJvd0pTT04ucHJvdG90eXBlLCAnYmF0Y2hlcycsIHsgZ2V0KCkgeyByZXR1cm4gKHRoaXMuX2pzb25bJ2JhdGNoZXMnXSB8fCBbXSkgYXMgYW55W107IH19KTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShBcnJvd0pTT04ucHJvdG90eXBlLCAnZGljdGlvbmFyaWVzJywgeyBnZXQoKSB7IHJldHVybiAodGhpcy5fanNvblsnZGljdGlvbmFyaWVzJ10gfHwgW10pIGFzIGFueVtdOyB9fSk7XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFJlYWRhYmxlPFQ+IHtcblxuICAgIHJlYWRvbmx5IGNsb3NlZDogUHJvbWlzZTx2b2lkPjtcbiAgICBjYW5jZWwocmVhc29uPzogYW55KTogUHJvbWlzZTx2b2lkPjtcblxuICAgIHJlYWQoc2l6ZT86IG51bWJlciB8IG51bGwpOiBQcm9taXNlPFQgfCBudWxsPjtcbiAgICBwZWVrKHNpemU/OiBudW1iZXIgfCBudWxsKTogUHJvbWlzZTxUIHwgbnVsbD47XG4gICAgdGhyb3codmFsdWU/OiBhbnkpOiBQcm9taXNlPEl0ZXJhdG9yUmVzdWx0PGFueT4+O1xuICAgIHJldHVybih2YWx1ZT86IGFueSk6IFByb21pc2U8SXRlcmF0b3JSZXN1bHQ8YW55Pj47XG4gICAgbmV4dChzaXplPzogbnVtYmVyIHwgbnVsbCk6IFByb21pc2U8SXRlcmF0b3JSZXN1bHQ8VD4+O1xufVxuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBXcml0YWJsZTxUPiB7XG4gICAgcmVhZG9ubHkgY2xvc2VkOiBQcm9taXNlPHZvaWQ+O1xuICAgIGNsb3NlKCk6IHZvaWQ7XG4gICAgd3JpdGUoY2h1bms6IFQpOiB2b2lkO1xuICAgIGFib3J0KHJlYXNvbj86IGFueSk6IHZvaWQ7XG59XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFJlYWRhYmxlV3JpdGFibGU8VFJlYWRhYmxlLCBUV3JpdGFibGU+IGV4dGVuZHMgUmVhZGFibGU8VFJlYWRhYmxlPiwgV3JpdGFibGU8VFdyaXRhYmxlPiB7XG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpOiBBc3luY0l0ZXJhYmxlSXRlcmF0b3I8VFJlYWRhYmxlPjtcbiAgICB0b1JlYWRhYmxlRE9NU3RyZWFtKG9wdGlvbnM/OiBSZWFkYWJsZURPTVN0cmVhbU9wdGlvbnMpOiBSZWFkYWJsZVN0cmVhbTxUUmVhZGFibGU+O1xuICAgIHRvUmVhZGFibGVOb2RlU3RyZWFtKG9wdGlvbnM/OiBpbXBvcnQoJ3N0cmVhbScpLlJlYWRhYmxlT3B0aW9ucyk6IGltcG9ydCgnc3RyZWFtJykuUmVhZGFibGU7XG59XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBSZWFkYWJsZUludGVyb3A8VD4ge1xuXG4gICAgcHVibGljIGFic3RyYWN0IHRvUmVhZGFibGVET01TdHJlYW0ob3B0aW9ucz86IFJlYWRhYmxlRE9NU3RyZWFtT3B0aW9ucyk6IFJlYWRhYmxlU3RyZWFtPFQ+O1xuICAgIHB1YmxpYyBhYnN0cmFjdCB0b1JlYWRhYmxlTm9kZVN0cmVhbShvcHRpb25zPzogaW1wb3J0KCdzdHJlYW0nKS5SZWFkYWJsZU9wdGlvbnMpOiBpbXBvcnQoJ3N0cmVhbScpLlJlYWRhYmxlO1xuXG4gICAgcHVibGljIHRlZSgpOiBbUmVhZGFibGVTdHJlYW08VD4sIFJlYWRhYmxlU3RyZWFtPFQ+XSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9nZXRSZWFkYWJsZURPTVN0cmVhbSgpLnRlZSgpO1xuICAgIH1cbiAgICBwdWJsaWMgcGlwZTxSIGV4dGVuZHMgTm9kZUpTLldyaXRhYmxlU3RyZWFtPih3cml0YWJsZTogUiwgb3B0aW9ucz86IHsgZW5kPzogYm9vbGVhbjsgfSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZ2V0UmVhZGFibGVOb2RlU3RyZWFtKCkucGlwZSh3cml0YWJsZSwgb3B0aW9ucyk7XG4gICAgfVxuICAgIHB1YmxpYyBwaXBlVG8od3JpdGFibGU6IFdyaXRhYmxlU3RyZWFtPFQ+LCBvcHRpb25zPzogUGlwZU9wdGlvbnMpIHsgcmV0dXJuIHRoaXMuX2dldFJlYWRhYmxlRE9NU3RyZWFtKCkucGlwZVRvKHdyaXRhYmxlLCBvcHRpb25zKTsgfVxuICAgIHB1YmxpYyBwaXBlVGhyb3VnaDxSIGV4dGVuZHMgUmVhZGFibGVTdHJlYW08YW55Pj4oZHVwbGV4OiB7IHdyaXRhYmxlOiBXcml0YWJsZVN0cmVhbTxUPiwgcmVhZGFibGU6IFIgfSwgb3B0aW9ucz86IFBpcGVPcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9nZXRSZWFkYWJsZURPTVN0cmVhbSgpLnBpcGVUaHJvdWdoKGR1cGxleCwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfcmVhZGFibGVET01TdHJlYW0/OiBSZWFkYWJsZVN0cmVhbTxUPjtcbiAgICBwcml2YXRlIF9nZXRSZWFkYWJsZURPTVN0cmVhbSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlYWRhYmxlRE9NU3RyZWFtIHx8ICh0aGlzLl9yZWFkYWJsZURPTVN0cmVhbSA9IHRoaXMudG9SZWFkYWJsZURPTVN0cmVhbSgpKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9yZWFkYWJsZU5vZGVTdHJlYW0/OiBpbXBvcnQoJ3N0cmVhbScpLlJlYWRhYmxlO1xuICAgIHByaXZhdGUgX2dldFJlYWRhYmxlTm9kZVN0cmVhbSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlYWRhYmxlTm9kZVN0cmVhbSB8fCAodGhpcy5fcmVhZGFibGVOb2RlU3RyZWFtID0gdGhpcy50b1JlYWRhYmxlTm9kZVN0cmVhbSgpKTtcbiAgICB9XG59XG5cbnR5cGUgUmVzb2x1dGlvbjxUPiA9IHsgcmVzb2x2ZTogKHZhbHVlPzogVCB8IFByb21pc2VMaWtlPFQ+KSA9PiB2b2lkOyByZWplY3Q6IChyZWFzb24/OiBhbnkpID0+IHZvaWQ7IH07XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgY2xhc3MgQXN5bmNRdWV1ZTxUUmVhZGFibGUgPSBVaW50OEFycmF5LCBUV3JpdGFibGUgPSBUUmVhZGFibGU+IGV4dGVuZHMgUmVhZGFibGVJbnRlcm9wPFRSZWFkYWJsZT5cbiAgICBpbXBsZW1lbnRzIEFzeW5jSXRlcmFibGVJdGVyYXRvcjxUUmVhZGFibGU+LCBSZWFkYWJsZVdyaXRhYmxlPFRSZWFkYWJsZSwgVFdyaXRhYmxlPiB7XG5cbiAgICBwcm90ZWN0ZWQgdmFsdWVzOiBUV3JpdGFibGVbXSA9IFtdO1xuICAgIHByb3RlY3RlZCBfZXJyb3I/OiB7IGVycm9yOiBhbnk7IH07XG4gICAgcHJvdGVjdGVkIF9jbG9zZWRQcm9taXNlOiBQcm9taXNlPHZvaWQ+O1xuICAgIHByb3RlY3RlZCBfY2xvc2VkUHJvbWlzZVJlc29sdmU/OiAodmFsdWU/OiBhbnkpID0+IHZvaWQ7XG4gICAgcHJvdGVjdGVkIHJlc29sdmVyczogUmVzb2x1dGlvbjxJdGVyYXRvclJlc3VsdDxUUmVhZGFibGU+PltdID0gW107XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fY2xvc2VkUHJvbWlzZSA9IG5ldyBQcm9taXNlKChyKSA9PiB0aGlzLl9jbG9zZWRQcm9taXNlUmVzb2x2ZSA9IHIpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgY2xvc2VkKCk6IFByb21pc2U8dm9pZD4geyByZXR1cm4gdGhpcy5fY2xvc2VkUHJvbWlzZTsgfVxuICAgIHB1YmxpYyBhc3luYyBjYW5jZWwocmVhc29uPzogYW55KSB7IGF3YWl0IHRoaXMucmV0dXJuKHJlYXNvbik7IH1cbiAgICBwdWJsaWMgd3JpdGUodmFsdWU6IFRXcml0YWJsZSkge1xuICAgICAgICBpZiAodGhpcy5fZW5zdXJlT3BlbigpKSB7XG4gICAgICAgICAgICB0aGlzLnJlc29sdmVycy5sZW5ndGggPD0gMFxuICAgICAgICAgICAgICAgID8gKHRoaXMudmFsdWVzLnB1c2godmFsdWUpKVxuICAgICAgICAgICAgICAgIDogKHRoaXMucmVzb2x2ZXJzLnNoaWZ0KCkhLnJlc29sdmUoeyBkb25lOiBmYWxzZSwgdmFsdWUgfSBhcyBhbnkpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwdWJsaWMgYWJvcnQodmFsdWU/OiBhbnkpIHtcbiAgICAgICAgaWYgKHRoaXMuX2Nsb3NlZFByb21pc2VSZXNvbHZlKSB7XG4gICAgICAgICAgICB0aGlzLnJlc29sdmVycy5sZW5ndGggPD0gMFxuICAgICAgICAgICAgICAgID8gKHRoaXMuX2Vycm9yID0geyBlcnJvcjogdmFsdWUgfSlcbiAgICAgICAgICAgICAgICA6ICh0aGlzLnJlc29sdmVycy5zaGlmdCgpIS5yZWplY3QoeyBkb25lOiB0cnVlLCB2YWx1ZSB9KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcHVibGljIGNsb3NlKCkge1xuICAgICAgICBpZiAodGhpcy5fY2xvc2VkUHJvbWlzZVJlc29sdmUpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZXJzIH0gPSB0aGlzO1xuICAgICAgICAgICAgd2hpbGUgKHJlc29sdmVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZXJzLnNoaWZ0KCkhLnJlc29sdmUoSVRFUkFUT1JfRE9ORSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9jbG9zZWRQcm9taXNlUmVzb2x2ZSgpO1xuICAgICAgICAgICAgdGhpcy5fY2xvc2VkUHJvbWlzZVJlc29sdmUgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIHsgcmV0dXJuIHRoaXM7IH1cbiAgICBwdWJsaWMgdG9SZWFkYWJsZURPTVN0cmVhbShvcHRpb25zPzogUmVhZGFibGVET01TdHJlYW1PcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBzdHJlYW1BZGFwdGVycy50b1JlYWRhYmxlRE9NU3RyZWFtKHRoaXMsIG9wdGlvbnMpO1xuICAgIH1cbiAgICBwdWJsaWMgdG9SZWFkYWJsZU5vZGVTdHJlYW0ob3B0aW9ucz86IGltcG9ydCgnc3RyZWFtJykuUmVhZGFibGVPcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBzdHJlYW1BZGFwdGVycy50b1JlYWRhYmxlTm9kZVN0cmVhbSh0aGlzLCBvcHRpb25zKTtcbiAgICB9XG4gICAgcHVibGljIGFzeW5jIHRocm93KF8/OiBhbnkpIHsgYXdhaXQgdGhpcy5hYm9ydChfKTsgcmV0dXJuIElURVJBVE9SX0RPTkU7IH1cbiAgICBwdWJsaWMgYXN5bmMgcmV0dXJuKF8/OiBhbnkpIHsgYXdhaXQgdGhpcy5jbG9zZSgpOyByZXR1cm4gSVRFUkFUT1JfRE9ORTsgfVxuXG4gICAgcHVibGljIGFzeW5jIHJlYWQoc2l6ZT86IG51bWJlciB8IG51bGwpOiBQcm9taXNlPFRSZWFkYWJsZSB8IG51bGw+IHsgcmV0dXJuIChhd2FpdCB0aGlzLm5leHQoc2l6ZSwgJ3JlYWQnKSkudmFsdWU7IH1cbiAgICBwdWJsaWMgYXN5bmMgcGVlayhzaXplPzogbnVtYmVyIHwgbnVsbCk6IFByb21pc2U8VFJlYWRhYmxlIHwgbnVsbD4geyByZXR1cm4gKGF3YWl0IHRoaXMubmV4dChzaXplLCAncGVlaycpKS52YWx1ZTsgfVxuICAgIHB1YmxpYyBuZXh0KC4uLl9hcmdzOiBhbnlbXSk6IFByb21pc2U8SXRlcmF0b3JSZXN1bHQ8VFJlYWRhYmxlPj4ge1xuICAgICAgICBpZiAodGhpcy52YWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7IGRvbmU6IGZhbHNlLCB2YWx1ZTogdGhpcy52YWx1ZXMuc2hpZnQoKSEgfSBhcyBhbnkpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2Vycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoeyBkb25lOiB0cnVlLCB2YWx1ZTogdGhpcy5fZXJyb3IuZXJyb3IgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX2Nsb3NlZFByb21pc2VSZXNvbHZlKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKElURVJBVE9SX0RPTkUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPEl0ZXJhdG9yUmVzdWx0PFRSZWFkYWJsZT4+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc29sdmVycy5wdXNoKHsgcmVzb2x2ZSwgcmVqZWN0IH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX2Vuc3VyZU9wZW4oKSB7XG4gICAgICAgIGlmICh0aGlzLl9jbG9zZWRQcm9taXNlUmVzb2x2ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3RoaXMuY29uc3RydWN0b3IubmFtZX0gaXMgY2xvc2VkYCk7XG4gICAgfVxufVxuIl19
