// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import { Field } from '../schema';
import { DataType } from '../type';
import { valueToString } from '../util/pretty';
/** @ignore */ const columnDescriptor = { enumerable: true, configurable: false, get: () => { } };
/** @ignore */ const lengthDescriptor = { writable: false, enumerable: false, configurable: false, value: -1 };
/** @ignore */ const rowIndexDescriptor = { writable: false, enumerable: false, configurable: true, value: null };
/** @ignore */ const rowParentDescriptor = { writable: false, enumerable: false, configurable: false, value: null };
/** @ignore */ const row = { parent: rowParentDescriptor, rowIndex: rowIndexDescriptor };
/** @ignore */
export class Row {
    constructor(fields, fieldsAreEnumerable) {
        lengthDescriptor.value = fields.length;
        Object.defineProperty(this, 'length', lengthDescriptor);
        fields.forEach((field, columnIndex) => {
            columnDescriptor.get = this._bindGetter(columnIndex);
            // set configurable to true to ensure Object.defineProperty
            // doesn't throw in the case of duplicate column names
            columnDescriptor.configurable = true;
            columnDescriptor.enumerable = fieldsAreEnumerable;
            Object.defineProperty(this, field.name, columnDescriptor);
            columnDescriptor.configurable = false;
            columnDescriptor.enumerable = !fieldsAreEnumerable;
            Object.defineProperty(this, columnIndex, columnDescriptor);
            columnDescriptor.get = null;
        });
    }
    /** @nocollapse */
    static new(schemaOrFields, fieldsAreEnumerable = false) {
        let schema, fields;
        if (Array.isArray(schemaOrFields)) {
            fields = schemaOrFields;
        }
        else {
            schema = schemaOrFields;
            fieldsAreEnumerable = true;
            fields = Object.keys(schema).map((x) => new Field(x, schema[x]));
        }
        return new Row(fields, fieldsAreEnumerable);
    }
    *[Symbol.iterator]() {
        for (let i = -1, n = this.length; ++i < n;) {
            yield this[i];
        }
    }
    _bindGetter(colIndex) {
        return function () {
            let child = this.parent.getChildAt(colIndex);
            return child ? child.get(this.rowIndex) : null;
        };
    }
    get(key) { return this[key]; }
    bind(parent, rowIndex) {
        rowIndexDescriptor.value = rowIndex;
        rowParentDescriptor.value = parent;
        const bound = Object.create(this, row);
        rowIndexDescriptor.value = null;
        rowParentDescriptor.value = null;
        return bound;
    }
    toJSON() {
        return DataType.isStruct(this.parent.type) ? [...this] :
            Object.getOwnPropertyNames(this).reduce((props, prop) => {
                return (props[prop] = this[prop]) && props || props;
            }, {});
    }
    toString() {
        return DataType.isStruct(this.parent.type) ?
            [...this].map((x) => valueToString(x)).join(', ') :
            Object.getOwnPropertyNames(this).reduce((props, prop) => {
                return (props[prop] = valueToString(this[prop])) && props || props;
            }, {});
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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Q0FBQyxDQUFDO0lBQ2YsQ0FBQztDQUNKIiwiZmlsZSI6InZlY3Rvci9yb3cuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4vLyBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbi8vIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4vLyByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4vLyB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4vLyBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Vcbi8vIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbi8vIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4vLyBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuLy8gS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4vLyBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4vLyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgRmllbGQgfSBmcm9tICcuLi9zY2hlbWEnO1xuaW1wb3J0IHsgTWFwVmVjdG9yIH0gZnJvbSAnLi4vdmVjdG9yL21hcCc7XG5pbXBvcnQgeyBEYXRhVHlwZSwgUm93TGlrZSB9IGZyb20gJy4uL3R5cGUnO1xuaW1wb3J0IHsgdmFsdWVUb1N0cmluZyB9IGZyb20gJy4uL3V0aWwvcHJldHR5JztcbmltcG9ydCB7IFN0cnVjdFZlY3RvciB9IGZyb20gJy4uL3ZlY3Rvci9zdHJ1Y3QnO1xuXG4vKiogQGlnbm9yZSAqLyBjb25zdCBjb2x1bW5EZXNjcmlwdG9yID0geyBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IGZhbHNlLCBnZXQ6ICgpID0+IHt9IH07XG4vKiogQGlnbm9yZSAqLyBjb25zdCBsZW5ndGhEZXNjcmlwdG9yID0geyB3cml0YWJsZTogZmFsc2UsIGVudW1lcmFibGU6IGZhbHNlLCBjb25maWd1cmFibGU6IGZhbHNlLCB2YWx1ZTogLTEgfTtcbi8qKiBAaWdub3JlICovIGNvbnN0IHJvd0luZGV4RGVzY3JpcHRvciA9IHsgd3JpdGFibGU6IGZhbHNlLCBlbnVtZXJhYmxlOiBmYWxzZSwgY29uZmlndXJhYmxlOiB0cnVlLCB2YWx1ZTogbnVsbCBhcyBhbnkgfTtcbi8qKiBAaWdub3JlICovIGNvbnN0IHJvd1BhcmVudERlc2NyaXB0b3IgPSB7IHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogZmFsc2UsIGNvbmZpZ3VyYWJsZTogZmFsc2UsIHZhbHVlOiBudWxsIGFzIGFueSB9O1xuLyoqIEBpZ25vcmUgKi8gY29uc3Qgcm93ID0geyBwYXJlbnQ6IHJvd1BhcmVudERlc2NyaXB0b3IsIHJvd0luZGV4OiByb3dJbmRleERlc2NyaXB0b3IgfTtcblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBjbGFzcyBSb3c8VCBleHRlbmRzIHsgW2tleTogc3RyaW5nXTogRGF0YVR5cGUgfT4gaW1wbGVtZW50cyBJdGVyYWJsZTxUW2tleW9mIFRdWydUVmFsdWUnXT4ge1xuICAgIFtrZXk6IHN0cmluZ106IFRba2V5b2YgVF1bJ1RWYWx1ZSddO1xuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgbmV3PFQgZXh0ZW5kcyB7IFtrZXk6IHN0cmluZ106IERhdGFUeXBlIH0+KHNjaGVtYU9yRmllbGRzOiBUIHwgRmllbGRbXSwgZmllbGRzQXJlRW51bWVyYWJsZSA9IGZhbHNlKTogUm93TGlrZTxUPiAmIFJvdzxUPiB7XG4gICAgICAgIGxldCBzY2hlbWE6IFQsIGZpZWxkczogRmllbGRbXTtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2NoZW1hT3JGaWVsZHMpKSB7XG4gICAgICAgICAgICBmaWVsZHMgPSBzY2hlbWFPckZpZWxkcztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNjaGVtYSA9IHNjaGVtYU9yRmllbGRzO1xuICAgICAgICAgICAgZmllbGRzQXJlRW51bWVyYWJsZSA9IHRydWU7XG4gICAgICAgICAgICBmaWVsZHMgPSBPYmplY3Qua2V5cyhzY2hlbWEpLm1hcCgoeCkgPT4gbmV3IEZpZWxkKHgsIHNjaGVtYVt4XSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUm93PFQ+KGZpZWxkcywgZmllbGRzQXJlRW51bWVyYWJsZSkgYXMgUm93TGlrZTxUPiAmIFJvdzxUPjtcbiAgICB9XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHByaXZhdGUgcGFyZW50OiBUUGFyZW50O1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBwcml2YXRlIHJvd0luZGV4OiBudW1iZXI7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHB1YmxpYyByZWFkb25seSBsZW5ndGg6IG51bWJlcjtcbiAgICBwcml2YXRlIGNvbnN0cnVjdG9yKGZpZWxkczogRmllbGRbXSwgZmllbGRzQXJlRW51bWVyYWJsZTogYm9vbGVhbikge1xuICAgICAgICBsZW5ndGhEZXNjcmlwdG9yLnZhbHVlID0gZmllbGRzLmxlbmd0aDtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdsZW5ndGgnLCBsZW5ndGhEZXNjcmlwdG9yKTtcbiAgICAgICAgZmllbGRzLmZvckVhY2goKGZpZWxkLCBjb2x1bW5JbmRleCkgPT4ge1xuICAgICAgICAgICAgY29sdW1uRGVzY3JpcHRvci5nZXQgPSB0aGlzLl9iaW5kR2V0dGVyKGNvbHVtbkluZGV4KTtcbiAgICAgICAgICAgIC8vIHNldCBjb25maWd1cmFibGUgdG8gdHJ1ZSB0byBlbnN1cmUgT2JqZWN0LmRlZmluZVByb3BlcnR5XG4gICAgICAgICAgICAvLyBkb2Vzbid0IHRocm93IGluIHRoZSBjYXNlIG9mIGR1cGxpY2F0ZSBjb2x1bW4gbmFtZXNcbiAgICAgICAgICAgIGNvbHVtbkRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtcbiAgICAgICAgICAgIGNvbHVtbkRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGZpZWxkc0FyZUVudW1lcmFibGU7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgZmllbGQubmFtZSwgY29sdW1uRGVzY3JpcHRvcik7XG4gICAgICAgICAgICBjb2x1bW5EZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgY29sdW1uRGVzY3JpcHRvci5lbnVtZXJhYmxlID0gIWZpZWxkc0FyZUVudW1lcmFibGU7XG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgY29sdW1uSW5kZXgsIGNvbHVtbkRlc2NyaXB0b3IpO1xuICAgICAgICAgICAgY29sdW1uRGVzY3JpcHRvci5nZXQgPSBudWxsIGFzIGFueTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgICpbU3ltYm9sLml0ZXJhdG9yXSh0aGlzOiBSb3dMaWtlPFQ+KSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAtMSwgbiA9IHRoaXMubGVuZ3RoOyArK2kgPCBuOykge1xuICAgICAgICAgICAgeWllbGQgdGhpc1tpXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIF9iaW5kR2V0dGVyKGNvbEluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh0aGlzOiBSb3c8VD4pIHtcbiAgICAgICAgICAgIGxldCBjaGlsZCA9IHRoaXMucGFyZW50LmdldENoaWxkQXQoY29sSW5kZXgpO1xuICAgICAgICAgICAgcmV0dXJuIGNoaWxkID8gY2hpbGQuZ2V0KHRoaXMucm93SW5kZXgpIDogbnVsbDtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcHVibGljIGdldDxLIGV4dGVuZHMga2V5b2YgVD4oa2V5OiBLKSB7IHJldHVybiAodGhpcyBhcyBhbnkpW2tleV0gYXMgVFtLXVsnVFZhbHVlJ107IH1cbiAgICBwdWJsaWMgYmluZDxUUGFyZW50IGV4dGVuZHMgTWFwVmVjdG9yPFQ+IHwgU3RydWN0VmVjdG9yPFQ+PihwYXJlbnQ6IFRQYXJlbnQsIHJvd0luZGV4OiBudW1iZXIpIHtcbiAgICAgICAgcm93SW5kZXhEZXNjcmlwdG9yLnZhbHVlID0gcm93SW5kZXg7XG4gICAgICAgIHJvd1BhcmVudERlc2NyaXB0b3IudmFsdWUgPSBwYXJlbnQ7XG4gICAgICAgIGNvbnN0IGJvdW5kID0gT2JqZWN0LmNyZWF0ZSh0aGlzLCByb3cpO1xuICAgICAgICByb3dJbmRleERlc2NyaXB0b3IudmFsdWUgPSBudWxsO1xuICAgICAgICByb3dQYXJlbnREZXNjcmlwdG9yLnZhbHVlID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIGJvdW5kIGFzIFJvd0xpa2U8VD47XG4gICAgfVxuICAgIHB1YmxpYyB0b0pTT04oKTogYW55IHtcbiAgICAgICAgcmV0dXJuIERhdGFUeXBlLmlzU3RydWN0KHRoaXMucGFyZW50LnR5cGUpID8gWy4uLnRoaXNdIDpcbiAgICAgICAgICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpLnJlZHVjZSgocHJvcHM6IGFueSwgcHJvcDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChwcm9wc1twcm9wXSA9ICh0aGlzIGFzIGFueSlbcHJvcF0pICYmIHByb3BzIHx8IHByb3BzO1xuICAgICAgICAgICAgfSwge30pO1xuICAgIH1cbiAgICBwdWJsaWMgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBEYXRhVHlwZS5pc1N0cnVjdCh0aGlzLnBhcmVudC50eXBlKSA/XG4gICAgICAgICAgICBbLi4udGhpc10ubWFwKCh4KSA9PiB2YWx1ZVRvU3RyaW5nKHgpKS5qb2luKCcsICcpIDpcbiAgICAgICAgICAgIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpLnJlZHVjZSgocHJvcHM6IGFueSwgcHJvcDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChwcm9wc1twcm9wXSA9IHZhbHVlVG9TdHJpbmcoKHRoaXMgYXMgYW55KVtwcm9wXSkpICYmIHByb3BzIHx8IHByb3BzO1xuICAgICAgICAgICAgfSwge30pO1xuICAgIH1cbn1cbiJdfQ==
