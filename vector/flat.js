"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const bit_1 = require("../util/bit");
class FlatView {
    constructor(data) {
        this.length = data.length;
        this.values = data.values;
    }
    clone(data) {
        return new this.constructor(data);
    }
    isValid() {
        return true;
    }
    get(index) {
        return this.values[index];
    }
    set(index, value) {
        return this.values[index] = value;
    }
    toArray() {
        return this.values;
    }
    [Symbol.iterator]() {
        return this.values[Symbol.iterator]();
    }
}
exports.FlatView = FlatView;
class NullView {
    constructor(data) {
        this.length = data.length;
    }
    clone(data) {
        return new this.constructor(data);
    }
    isValid() {
        return true;
    }
    set() { }
    get() { return null; }
    toArray() {
        return [...this];
    }
    *[Symbol.iterator]() {
        for (let index = -1, length = this.length; ++index < length;) {
            yield null;
        }
    }
}
exports.NullView = NullView;
class BoolView extends FlatView {
    constructor(data) {
        super(data);
        this.offset = data.offset;
    }
    toArray() { return [...this]; }
    get(index) {
        const boolBitIndex = this.offset + index;
        return bit_1.getBool(null, index, this.values[boolBitIndex >> 3], boolBitIndex % 8);
    }
    set(index, value) {
        bit_1.setBool(this.values, this.offset + index, value);
    }
    [Symbol.iterator]() {
        return bit_1.iterateBits(this.values, this.offset, this.length, this.values, bit_1.getBool);
    }
}
exports.BoolView = BoolView;
class ValidityView {
    constructor(data, view) {
        this.view = view;
        this.length = data.length;
        this.offset = data.offset;
        this.nullBitmap = data.nullBitmap;
    }
    clone(data) {
        return new ValidityView(data, this.view.clone(data));
    }
    toArray() {
        return [...this];
    }
    isValid(index) {
        const nullBitIndex = this.offset + index;
        return bit_1.getBool(null, index, this.nullBitmap[nullBitIndex >> 3], nullBitIndex % 8);
    }
    get(index) {
        const nullBitIndex = this.offset + index;
        return this.getNullable(this.view, index, this.nullBitmap[nullBitIndex >> 3], nullBitIndex % 8);
    }
    set(index, value) {
        if (bit_1.setBool(this.nullBitmap, this.offset + index, value != null)) {
            this.view.set(index, value);
        }
    }
    [Symbol.iterator]() {
        return bit_1.iterateBits(this.nullBitmap, this.offset, this.length, this.view, this.getNullable);
    }
    getNullable(view, index, byte, bit) {
        return bit_1.getBool(view, index, byte, bit) ? view.get(index) : null;
    }
}
exports.ValidityView = ValidityView;
class PrimitiveView extends FlatView {
    constructor(data, size) {
        super(data);
        this.size = size || 1;
        this.ArrayType = data.type.ArrayType;
    }
    clone(data) {
        return new this.constructor(data, this.size);
    }
    getValue(values, index, size) {
        return values[index * size];
    }
    setValue(values, index, size, value) {
        values[index * size] = value;
    }
    get(index) {
        return this.getValue(this.values, index, this.size);
    }
    set(index, value) {
        return this.setValue(this.values, index, this.size, value);
    }
    toArray() {
        return this.size === 1 ? this.values : new this.ArrayType(this);
    }
    *[Symbol.iterator]() {
        const get = this.getValue;
        const { size, values, length } = this;
        for (let index = -1; ++index < length;) {
            yield get(values, index, size);
        }
    }
}
exports.PrimitiveView = PrimitiveView;
class FixedSizeView extends PrimitiveView {
    toArray() {
        return this.values;
    }
    getValue(values, index, size) {
        return values.subarray(index * size, index * size + size);
    }
    setValue(values, index, size, value) {
        values.set(value.subarray(0, size), index * size);
    }
}
exports.FixedSizeView = FixedSizeView;
class Float16View extends PrimitiveView {
    toArray() { return new Float32Array(this); }
    getValue(values, index, size) {
        return (values[index * size] - 32767) / 32767;
    }
    setValue(values, index, size, value) {
        values[index * size] = (value * 32767) + 32767;
    }
}
exports.Float16View = Float16View;
class DateDayView extends PrimitiveView {
    toArray() { return [...this]; }
    getValue(values, index, size) {
        return epochDaysToDate(values, index * size);
    }
    setValue(values, index, size, value) {
        values[index * size] = value.valueOf() / 86400000;
    }
}
exports.DateDayView = DateDayView;
class DateMillisecondView extends FixedSizeView {
    toArray() { return [...this]; }
    getValue(values, index, size) {
        return epochMillisecondsLongToDate(values, index * size);
    }
    setValue(values, index, size, value) {
        const epochMs = value.valueOf();
        values[index * size] = (epochMs % 4294967296) | 0;
        values[index * size + size] = (epochMs / 4294967296) | 0;
    }
}
exports.DateMillisecondView = DateMillisecondView;
class IntervalYearMonthView extends PrimitiveView {
    toArray() { return [...this]; }
    getValue(values, index, size) {
        const interval = values[index * size];
        return new Int32Array([interval / 12, /* years */ interval % 12 /* months */]);
    }
    setValue(values, index, size, value) {
        values[index * size] = (value[0] * 12) + (value[1] % 12);
    }
}
exports.IntervalYearMonthView = IntervalYearMonthView;
class IntervalYearView extends PrimitiveView {
    toArray() { return [...this]; }
    getValue(values, index, size) {
        return values[index * size] / 12;
    }
    setValue(values, index, size, value) {
        values[index * size] = (value * 12) + (values[index * size] % 12);
    }
}
exports.IntervalYearView = IntervalYearView;
class IntervalMonthView extends PrimitiveView {
    toArray() { return [...this]; }
    getValue(values, index, size) {
        return values[index * size] % 12;
    }
    setValue(values, index, size, value) {
        values[index * size] = (values[index * size] * 12) + (value % 12);
    }
}
exports.IntervalMonthView = IntervalMonthView;
function epochSecondsToMs(data, index) { return 1000 * data[index]; }
exports.epochSecondsToMs = epochSecondsToMs;
function epochDaysToMs(data, index) { return 86400000 * data[index]; }
exports.epochDaysToMs = epochDaysToMs;
function epochMillisecondsLongToMs(data, index) { return 4294967296 * (data[index + 1]) + data[index]; }
exports.epochMillisecondsLongToMs = epochMillisecondsLongToMs;
function epochMicrosecondsLongToMs(data, index) { return 4294967296 * (data[index + 1] / 1000) + (data[index] / 1000); }
exports.epochMicrosecondsLongToMs = epochMicrosecondsLongToMs;
function epochNanosecondsLongToMs(data, index) { return 4294967296 * (data[index + 1] / 1000000) + (data[index] / 1000000); }
exports.epochNanosecondsLongToMs = epochNanosecondsLongToMs;
function epochMillisecondsToDate(epochMs) { return new Date(epochMs); }
exports.epochMillisecondsToDate = epochMillisecondsToDate;
function epochDaysToDate(data, index) { return epochMillisecondsToDate(epochDaysToMs(data, index)); }
exports.epochDaysToDate = epochDaysToDate;
function epochSecondsToDate(data, index) { return epochMillisecondsToDate(epochSecondsToMs(data, index)); }
exports.epochSecondsToDate = epochSecondsToDate;
function epochNanosecondsLongToDate(data, index) { return epochMillisecondsToDate(epochNanosecondsLongToMs(data, index)); }
exports.epochNanosecondsLongToDate = epochNanosecondsLongToDate;
function epochMillisecondsLongToDate(data, index) { return epochMillisecondsToDate(epochMillisecondsLongToMs(data, index)); }
exports.epochMillisecondsLongToDate = epochMillisecondsLongToDate;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUMsQ0FBQztBQUF4SixrRUFBd0oiLCJmaWxlIjoidmVjdG9yL2ZsYXQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4vLyBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbi8vIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4vLyByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4vLyB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4vLyBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Vcbi8vIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbi8vIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4vLyBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuLy8gS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4vLyBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4vLyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgRGF0YSB9IGZyb20gJy4uL2RhdGEnO1xuaW1wb3J0IHsgVmlldyB9IGZyb20gJy4uL3ZlY3Rvcic7XG5pbXBvcnQgeyBnZXRCb29sLCBzZXRCb29sLCBpdGVyYXRlQml0cyB9IGZyb20gJy4uL3V0aWwvYml0JztcbmltcG9ydCB7IEJvb2wsIEZsb2F0MTYsIERhdGVfLCBJbnRlcnZhbCwgTnVsbCwgSW50MzIgfSBmcm9tICcuLi90eXBlJztcbmltcG9ydCB7IERhdGFUeXBlLCBGbGF0VHlwZSwgUHJpbWl0aXZlVHlwZSwgSXRlcmFibGVBcnJheUxpa2UgfSBmcm9tICcuLi90eXBlJztcblxuZXhwb3J0IGNsYXNzIEZsYXRWaWV3PFQgZXh0ZW5kcyBGbGF0VHlwZT4gaW1wbGVtZW50cyBWaWV3PFQ+IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHVibGljIGxlbmd0aDogbnVtYmVyO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBwdWJsaWMgdmFsdWVzOiBUWydUQXJyYXknXTtcbiAgICBjb25zdHJ1Y3RvcihkYXRhOiBEYXRhPFQ+KSB7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gZGF0YS5sZW5ndGg7XG4gICAgICAgIHRoaXMudmFsdWVzID0gZGF0YS52YWx1ZXM7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZShkYXRhOiBEYXRhPFQ+KTogdGhpcyB7XG4gICAgICAgIHJldHVybiBuZXcgKDxhbnk+IHRoaXMuY29uc3RydWN0b3IpKGRhdGEpIGFzIHRoaXM7XG4gICAgfVxuICAgIHB1YmxpYyBpc1ZhbGlkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcHVibGljIGdldChpbmRleDogbnVtYmVyKTogVFsnVFZhbHVlJ10ge1xuICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXNbaW5kZXhdO1xuICAgIH1cbiAgICBwdWJsaWMgc2V0KGluZGV4OiBudW1iZXIsIHZhbHVlOiBUWydUVmFsdWUnXSk6IHZvaWQge1xuICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXNbaW5kZXhdID0gdmFsdWU7XG4gICAgfVxuICAgIHB1YmxpYyB0b0FycmF5KCk6IEl0ZXJhYmxlQXJyYXlMaWtlPFRbJ1RWYWx1ZSddPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlcztcbiAgICB9XG4gICAgcHVibGljIFtTeW1ib2wuaXRlcmF0b3JdKCk6IEl0ZXJhYmxlSXRlcmF0b3I8VFsnVFZhbHVlJ10+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVzW1N5bWJvbC5pdGVyYXRvcl0oKSBhcyBJdGVyYWJsZUl0ZXJhdG9yPFRbJ1RWYWx1ZSddPjtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBOdWxsVmlldyBpbXBsZW1lbnRzIFZpZXc8TnVsbD4ge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBwdWJsaWMgbGVuZ3RoOiBudW1iZXI7XG4gICAgY29uc3RydWN0b3IoZGF0YTogRGF0YTxOdWxsPikge1xuICAgICAgICB0aGlzLmxlbmd0aCA9IGRhdGEubGVuZ3RoO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmUoZGF0YTogRGF0YTxOdWxsPik6IHRoaXMge1xuICAgICAgICByZXR1cm4gbmV3ICg8YW55PiB0aGlzLmNvbnN0cnVjdG9yKShkYXRhKSBhcyB0aGlzO1xuICAgIH1cbiAgICBwdWJsaWMgaXNWYWxpZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHB1YmxpYyBzZXQoKTogdm9pZCB7fVxuICAgIHB1YmxpYyBnZXQoKSB7IHJldHVybiBudWxsOyB9XG4gICAgcHVibGljIHRvQXJyYXkoKTogSXRlcmFibGVBcnJheUxpa2U8bnVsbD4ge1xuICAgICAgICByZXR1cm4gWy4uLnRoaXNdO1xuICAgIH1cbiAgICBwdWJsaWMgKltTeW1ib2wuaXRlcmF0b3JdKCk6IEl0ZXJhYmxlSXRlcmF0b3I8bnVsbD4ge1xuICAgICAgICBmb3IgKGxldCBpbmRleCA9IC0xLCBsZW5ndGggPSB0aGlzLmxlbmd0aDsgKytpbmRleCA8IGxlbmd0aDspIHtcbiAgICAgICAgICAgIHlpZWxkIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBCb29sVmlldyBleHRlbmRzIEZsYXRWaWV3PEJvb2w+IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHJvdGVjdGVkIG9mZnNldDogbnVtYmVyO1xuICAgIGNvbnN0cnVjdG9yKGRhdGE6IERhdGE8Qm9vbD4pIHtcbiAgICAgICAgc3VwZXIoZGF0YSk7XG4gICAgICAgIHRoaXMub2Zmc2V0ID0gZGF0YS5vZmZzZXQ7XG4gICAgfVxuICAgIHB1YmxpYyB0b0FycmF5KCkgeyByZXR1cm4gWy4uLnRoaXNdOyB9XG4gICAgcHVibGljIGdldChpbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IGJvb2xCaXRJbmRleCA9IHRoaXMub2Zmc2V0ICsgaW5kZXg7XG4gICAgICAgIHJldHVybiBnZXRCb29sKG51bGwsIGluZGV4LCB0aGlzLnZhbHVlc1tib29sQml0SW5kZXggPj4gM10sIGJvb2xCaXRJbmRleCAlIDgpO1xuICAgIH1cbiAgICBwdWJsaWMgc2V0KGluZGV4OiBudW1iZXIsIHZhbHVlOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIHNldEJvb2wodGhpcy52YWx1ZXMsIHRoaXMub2Zmc2V0ICsgaW5kZXgsIHZhbHVlKTtcbiAgICB9XG4gICAgcHVibGljIFtTeW1ib2wuaXRlcmF0b3JdKCk6IEl0ZXJhYmxlSXRlcmF0b3I8Ym9vbGVhbj4ge1xuICAgICAgICByZXR1cm4gaXRlcmF0ZUJpdHM8Ym9vbGVhbj4odGhpcy52YWx1ZXMsIHRoaXMub2Zmc2V0LCB0aGlzLmxlbmd0aCwgdGhpcy52YWx1ZXMsIGdldEJvb2wpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFZhbGlkaXR5VmlldzxUIGV4dGVuZHMgRGF0YVR5cGU+IGltcGxlbWVudHMgVmlldzxUPiB7XG4gICAgcHJvdGVjdGVkIHZpZXc6IFZpZXc8VD47XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHByb3RlY3RlZCBsZW5ndGg6IG51bWJlcjtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHJvdGVjdGVkIG9mZnNldDogbnVtYmVyO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBwcm90ZWN0ZWQgbnVsbEJpdG1hcDogVWludDhBcnJheTtcbiAgICBjb25zdHJ1Y3RvcihkYXRhOiBEYXRhPFQ+LCB2aWV3OiBWaWV3PFQ+KSB7XG4gICAgICAgIHRoaXMudmlldyA9IHZpZXc7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gZGF0YS5sZW5ndGg7XG4gICAgICAgIHRoaXMub2Zmc2V0ID0gZGF0YS5vZmZzZXQ7XG4gICAgICAgIHRoaXMubnVsbEJpdG1hcCA9IGRhdGEubnVsbEJpdG1hcCE7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZShkYXRhOiBEYXRhPFQ+KTogdGhpcyB7XG4gICAgICAgIHJldHVybiBuZXcgVmFsaWRpdHlWaWV3KGRhdGEsIHRoaXMudmlldy5jbG9uZShkYXRhKSkgYXMgdGhpcztcbiAgICB9XG4gICAgcHVibGljIHRvQXJyYXkoKTogSXRlcmFibGVBcnJheUxpa2U8VFsnVFZhbHVlJ10gfCBudWxsPiB7XG4gICAgICAgIHJldHVybiBbLi4udGhpc107XG4gICAgfVxuICAgIHB1YmxpYyBpc1ZhbGlkKGluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgbnVsbEJpdEluZGV4ID0gdGhpcy5vZmZzZXQgKyBpbmRleDtcbiAgICAgICAgcmV0dXJuIGdldEJvb2wobnVsbCwgaW5kZXgsIHRoaXMubnVsbEJpdG1hcFtudWxsQml0SW5kZXggPj4gM10sIG51bGxCaXRJbmRleCAlIDgpO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0KGluZGV4OiBudW1iZXIpOiBUWydUVmFsdWUnXSB8IG51bGwge1xuICAgICAgICBjb25zdCBudWxsQml0SW5kZXggPSB0aGlzLm9mZnNldCArIGluZGV4O1xuICAgICAgICByZXR1cm4gdGhpcy5nZXROdWxsYWJsZSh0aGlzLnZpZXcsIGluZGV4LCB0aGlzLm51bGxCaXRtYXBbbnVsbEJpdEluZGV4ID4+IDNdLCBudWxsQml0SW5kZXggJSA4KTtcbiAgICB9XG4gICAgcHVibGljIHNldChpbmRleDogbnVtYmVyLCB2YWx1ZTogVFsnVFZhbHVlJ10gfCBudWxsKTogdm9pZCB7XG4gICAgICAgIGlmIChzZXRCb29sKHRoaXMubnVsbEJpdG1hcCwgdGhpcy5vZmZzZXQgKyBpbmRleCwgdmFsdWUgIT0gbnVsbCkpIHtcbiAgICAgICAgICAgIHRoaXMudmlldy5zZXQoaW5kZXgsIHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwdWJsaWMgW1N5bWJvbC5pdGVyYXRvcl0oKTogSXRlcmFibGVJdGVyYXRvcjxUWydUVmFsdWUnXSB8IG51bGw+IHtcbiAgICAgICAgcmV0dXJuIGl0ZXJhdGVCaXRzPFRbJ1RWYWx1ZSddIHwgbnVsbD4odGhpcy5udWxsQml0bWFwLCB0aGlzLm9mZnNldCwgdGhpcy5sZW5ndGgsIHRoaXMudmlldywgdGhpcy5nZXROdWxsYWJsZSk7XG4gICAgfVxuICAgIHByb3RlY3RlZCBnZXROdWxsYWJsZSh2aWV3OiBWaWV3PFQ+LCBpbmRleDogbnVtYmVyLCBieXRlOiBudW1iZXIsIGJpdDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiBnZXRCb29sKHZpZXcsIGluZGV4LCBieXRlLCBiaXQpID8gdmlldy5nZXQoaW5kZXgpIDogbnVsbDtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBQcmltaXRpdmVWaWV3PFQgZXh0ZW5kcyBQcmltaXRpdmVUeXBlPiBleHRlbmRzIEZsYXRWaWV3PFQ+IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHVibGljIHNpemU6IG51bWJlcjtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHVibGljIEFycmF5VHlwZTogVFsnQXJyYXlUeXBlJ107XG4gICAgY29uc3RydWN0b3IoZGF0YTogRGF0YTxUPiwgc2l6ZT86IG51bWJlcikge1xuICAgICAgICBzdXBlcihkYXRhKTtcbiAgICAgICAgdGhpcy5zaXplID0gc2l6ZSB8fCAxO1xuICAgICAgICB0aGlzLkFycmF5VHlwZSA9IGRhdGEudHlwZS5BcnJheVR5cGU7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZShkYXRhOiBEYXRhPFQ+KTogdGhpcyB7XG4gICAgICAgIHJldHVybiBuZXcgKDxhbnk+IHRoaXMuY29uc3RydWN0b3IpKGRhdGEsIHRoaXMuc2l6ZSkgYXMgdGhpcztcbiAgICB9XG4gICAgcHJvdGVjdGVkIGdldFZhbHVlKHZhbHVlczogVFsnVEFycmF5J10sIGluZGV4OiBudW1iZXIsIHNpemU6IG51bWJlcik6IFRbJ1RWYWx1ZSddIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlc1tpbmRleCAqIHNpemVdO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2V0VmFsdWUodmFsdWVzOiBUWydUQXJyYXknXSwgaW5kZXg6IG51bWJlciwgc2l6ZTogbnVtYmVyLCB2YWx1ZTogVFsnVFZhbHVlJ10pOiB2b2lkIHtcbiAgICAgICAgdmFsdWVzW2luZGV4ICogc2l6ZV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgcHVibGljIGdldChpbmRleDogbnVtYmVyKTogVFsnVFZhbHVlJ10ge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZSh0aGlzLnZhbHVlcywgaW5kZXgsIHRoaXMuc2l6ZSk7XG4gICAgfVxuICAgIHB1YmxpYyBzZXQoaW5kZXg6IG51bWJlciwgdmFsdWU6IFRbJ1RWYWx1ZSddKTogdm9pZCB7XG4gICAgICAgIHJldHVybiB0aGlzLnNldFZhbHVlKHRoaXMudmFsdWVzLCBpbmRleCwgdGhpcy5zaXplLCB2YWx1ZSk7XG4gICAgfVxuICAgIHB1YmxpYyB0b0FycmF5KCk6IEl0ZXJhYmxlQXJyYXlMaWtlPFRbJ1RWYWx1ZSddPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnNpemUgPT09IDEgPyB0aGlzLnZhbHVlcyA6IG5ldyB0aGlzLkFycmF5VHlwZSh0aGlzKTtcbiAgICB9XG4gICAgcHVibGljICpbU3ltYm9sLml0ZXJhdG9yXSgpOiBJdGVyYWJsZUl0ZXJhdG9yPFRbJ1RWYWx1ZSddPiB7XG4gICAgICAgIGNvbnN0IGdldCA9IHRoaXMuZ2V0VmFsdWU7XG4gICAgICAgIGNvbnN0IHsgc2l6ZSwgdmFsdWVzLCBsZW5ndGggfSA9IHRoaXM7XG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gLTE7ICsraW5kZXggPCBsZW5ndGg7KSB7XG4gICAgICAgICAgICB5aWVsZCBnZXQodmFsdWVzLCBpbmRleCwgc2l6ZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBGaXhlZFNpemVWaWV3PFQgZXh0ZW5kcyBQcmltaXRpdmVUeXBlPiBleHRlbmRzIFByaW1pdGl2ZVZpZXc8VD4ge1xuICAgIHB1YmxpYyB0b0FycmF5KCk6IEl0ZXJhYmxlQXJyYXlMaWtlPFRbJ1RWYWx1ZSddPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlcztcbiAgICB9XG4gICAgcHJvdGVjdGVkIGdldFZhbHVlKHZhbHVlczogVFsnVEFycmF5J10sIGluZGV4OiBudW1iZXIsIHNpemU6IG51bWJlcik6IFRbJ1RWYWx1ZSddIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlcy5zdWJhcnJheShpbmRleCAqIHNpemUsIGluZGV4ICogc2l6ZSArIHNpemUpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2V0VmFsdWUodmFsdWVzOiBUWydUQXJyYXknXSwgaW5kZXg6IG51bWJlciwgc2l6ZTogbnVtYmVyLCB2YWx1ZTogVFsnVFZhbHVlJ10pOiB2b2lkIHtcbiAgICAgICAgdmFsdWVzLnNldCgodmFsdWUgYXMgVFsnVEFycmF5J10pLnN1YmFycmF5KDAsIHNpemUpLCBpbmRleCAqIHNpemUpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEZsb2F0MTZWaWV3IGV4dGVuZHMgUHJpbWl0aXZlVmlldzxGbG9hdDE2PiB7XG4gICAgcHVibGljIHRvQXJyYXkoKSB7IHJldHVybiBuZXcgRmxvYXQzMkFycmF5KHRoaXMpOyB9XG4gICAgcHJvdGVjdGVkIGdldFZhbHVlKHZhbHVlczogVWludDE2QXJyYXksIGluZGV4OiBudW1iZXIsIHNpemU6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIHJldHVybiAodmFsdWVzW2luZGV4ICogc2l6ZV0gLSAzMjc2NykgLyAzMjc2NztcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNldFZhbHVlKHZhbHVlczogVWludDE2QXJyYXksIGluZGV4OiBudW1iZXIsIHNpemU6IG51bWJlciwgdmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB2YWx1ZXNbaW5kZXggKiBzaXplXSA9ICh2YWx1ZSAqIDMyNzY3KSArIDMyNzY3O1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIERhdGVEYXlWaWV3IGV4dGVuZHMgUHJpbWl0aXZlVmlldzxEYXRlXz4ge1xuICAgIHB1YmxpYyB0b0FycmF5KCkgeyByZXR1cm4gWy4uLnRoaXNdOyB9XG4gICAgcHJvdGVjdGVkIGdldFZhbHVlKHZhbHVlczogSW50MzJBcnJheSwgaW5kZXg6IG51bWJlciwgc2l6ZTogbnVtYmVyKTogRGF0ZSB7XG4gICAgICAgIHJldHVybiBlcG9jaERheXNUb0RhdGUodmFsdWVzLCBpbmRleCAqIHNpemUpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2V0VmFsdWUodmFsdWVzOiBJbnQzMkFycmF5LCBpbmRleDogbnVtYmVyLCBzaXplOiBudW1iZXIsIHZhbHVlOiBEYXRlKTogdm9pZCB7XG4gICAgICAgIHZhbHVlc1tpbmRleCAqIHNpemVdID0gdmFsdWUudmFsdWVPZigpIC8gODY0MDAwMDA7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGF0ZU1pbGxpc2Vjb25kVmlldyBleHRlbmRzIEZpeGVkU2l6ZVZpZXc8RGF0ZV8+IHtcbiAgICBwdWJsaWMgdG9BcnJheSgpIHsgcmV0dXJuIFsuLi50aGlzXTsgfVxuICAgIHByb3RlY3RlZCBnZXRWYWx1ZSh2YWx1ZXM6IEludDMyQXJyYXksIGluZGV4OiBudW1iZXIsIHNpemU6IG51bWJlcik6IERhdGUge1xuICAgICAgICByZXR1cm4gZXBvY2hNaWxsaXNlY29uZHNMb25nVG9EYXRlKHZhbHVlcywgaW5kZXggKiBzaXplKTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNldFZhbHVlKHZhbHVlczogSW50MzJBcnJheSwgaW5kZXg6IG51bWJlciwgc2l6ZTogbnVtYmVyLCB2YWx1ZTogRGF0ZSk6IHZvaWQge1xuICAgICAgICBjb25zdCBlcG9jaE1zID0gdmFsdWUudmFsdWVPZigpO1xuICAgICAgICB2YWx1ZXNbaW5kZXggKiBzaXplXSA9IChlcG9jaE1zICUgNDI5NDk2NzI5NikgfCAwO1xuICAgICAgICB2YWx1ZXNbaW5kZXggKiBzaXplICsgc2l6ZV0gPSAoZXBvY2hNcyAvIDQyOTQ5NjcyOTYpIHwgMDtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBJbnRlcnZhbFllYXJNb250aFZpZXcgZXh0ZW5kcyBQcmltaXRpdmVWaWV3PEludGVydmFsPiB7XG4gICAgcHVibGljIHRvQXJyYXkoKSB7IHJldHVybiBbLi4udGhpc107IH1cbiAgICBwcm90ZWN0ZWQgZ2V0VmFsdWUodmFsdWVzOiBJbnQzMkFycmF5LCBpbmRleDogbnVtYmVyLCBzaXplOiBudW1iZXIpOiBJbnQzMkFycmF5IHtcbiAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSB2YWx1ZXNbaW5kZXggKiBzaXplXTtcbiAgICAgICAgcmV0dXJuIG5ldyBJbnQzMkFycmF5KFtpbnRlcnZhbCAvIDEyLCAvKiB5ZWFycyAqLyBpbnRlcnZhbCAlIDEyICAvKiBtb250aHMgKi9dKTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNldFZhbHVlKHZhbHVlczogSW50MzJBcnJheSwgaW5kZXg6IG51bWJlciwgc2l6ZTogbnVtYmVyLCB2YWx1ZTogSW50MzJBcnJheSk6IHZvaWQge1xuICAgICAgICB2YWx1ZXNbaW5kZXggKiBzaXplXSA9ICh2YWx1ZVswXSAqIDEyKSArICh2YWx1ZVsxXSAlIDEyKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBJbnRlcnZhbFllYXJWaWV3IGV4dGVuZHMgUHJpbWl0aXZlVmlldzxJbnQzMj4ge1xuICAgIHB1YmxpYyB0b0FycmF5KCkgeyByZXR1cm4gWy4uLnRoaXNdOyB9XG4gICAgcHJvdGVjdGVkIGdldFZhbHVlKHZhbHVlczogSW50MzJBcnJheSwgaW5kZXg6IG51bWJlciwgc2l6ZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlc1tpbmRleCAqIHNpemVdIC8gMTI7XG4gICAgfVxuICAgIHByb3RlY3RlZCBzZXRWYWx1ZSh2YWx1ZXM6IEludDMyQXJyYXksIGluZGV4OiBudW1iZXIsIHNpemU6IG51bWJlciwgdmFsdWU6IG51bWJlcik6IHZvaWQge1xuICAgICAgICB2YWx1ZXNbaW5kZXggKiBzaXplXSA9ICh2YWx1ZSAqIDEyKSArICh2YWx1ZXNbaW5kZXggKiBzaXplXSAlIDEyKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBJbnRlcnZhbE1vbnRoVmlldyBleHRlbmRzIFByaW1pdGl2ZVZpZXc8SW50MzI+IHtcbiAgICBwdWJsaWMgdG9BcnJheSgpIHsgcmV0dXJuIFsuLi50aGlzXTsgfVxuICAgIHByb3RlY3RlZCBnZXRWYWx1ZSh2YWx1ZXM6IEludDMyQXJyYXksIGluZGV4OiBudW1iZXIsIHNpemU6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB2YWx1ZXNbaW5kZXggKiBzaXplXSAlIDEyO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2V0VmFsdWUodmFsdWVzOiBJbnQzMkFycmF5LCBpbmRleDogbnVtYmVyLCBzaXplOiBudW1iZXIsIHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgdmFsdWVzW2luZGV4ICogc2l6ZV0gPSAodmFsdWVzW2luZGV4ICogc2l6ZV0gKiAxMikgKyAodmFsdWUgJSAxMik7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZXBvY2hTZWNvbmRzVG9NcyhkYXRhOiBJbnQzMkFycmF5LCBpbmRleDogbnVtYmVyKSB7IHJldHVybiAxMDAwICogZGF0YVtpbmRleF07IH1cbmV4cG9ydCBmdW5jdGlvbiBlcG9jaERheXNUb01zKGRhdGE6IEludDMyQXJyYXksIGluZGV4OiBudW1iZXIpIHsgcmV0dXJuIDg2NDAwMDAwICogZGF0YVtpbmRleF07IH1cbmV4cG9ydCBmdW5jdGlvbiBlcG9jaE1pbGxpc2Vjb25kc0xvbmdUb01zKGRhdGE6IEludDMyQXJyYXksIGluZGV4OiBudW1iZXIpIHsgcmV0dXJuIDQyOTQ5NjcyOTYgKiAoZGF0YVtpbmRleCArIDFdKSArIGRhdGFbaW5kZXhdOyB9XG5leHBvcnQgZnVuY3Rpb24gZXBvY2hNaWNyb3NlY29uZHNMb25nVG9NcyhkYXRhOiBJbnQzMkFycmF5LCBpbmRleDogbnVtYmVyKSB7IHJldHVybiA0Mjk0OTY3Mjk2ICogKGRhdGFbaW5kZXggKyAxXSAvIDEwMDApICsgKGRhdGFbaW5kZXhdIC8gMTAwMCk7IH1cbmV4cG9ydCBmdW5jdGlvbiBlcG9jaE5hbm9zZWNvbmRzTG9uZ1RvTXMoZGF0YTogSW50MzJBcnJheSwgaW5kZXg6IG51bWJlcikgeyByZXR1cm4gNDI5NDk2NzI5NiAqIChkYXRhW2luZGV4ICsgMV0gLyAxMDAwMDAwKSArIChkYXRhW2luZGV4XSAvIDEwMDAwMDApOyB9XG5cbmV4cG9ydCBmdW5jdGlvbiBlcG9jaE1pbGxpc2Vjb25kc1RvRGF0ZShlcG9jaE1zOiBudW1iZXIpIHsgcmV0dXJuIG5ldyBEYXRlKGVwb2NoTXMpOyB9XG5leHBvcnQgZnVuY3Rpb24gZXBvY2hEYXlzVG9EYXRlKGRhdGE6IEludDMyQXJyYXksIGluZGV4OiBudW1iZXIpIHsgcmV0dXJuIGVwb2NoTWlsbGlzZWNvbmRzVG9EYXRlKGVwb2NoRGF5c1RvTXMoZGF0YSwgaW5kZXgpKTsgfVxuZXhwb3J0IGZ1bmN0aW9uIGVwb2NoU2Vjb25kc1RvRGF0ZShkYXRhOiBJbnQzMkFycmF5LCBpbmRleDogbnVtYmVyKSB7IHJldHVybiBlcG9jaE1pbGxpc2Vjb25kc1RvRGF0ZShlcG9jaFNlY29uZHNUb01zKGRhdGEsIGluZGV4KSk7IH1cbmV4cG9ydCBmdW5jdGlvbiBlcG9jaE5hbm9zZWNvbmRzTG9uZ1RvRGF0ZShkYXRhOiBJbnQzMkFycmF5LCBpbmRleDogbnVtYmVyKSB7IHJldHVybiBlcG9jaE1pbGxpc2Vjb25kc1RvRGF0ZShlcG9jaE5hbm9zZWNvbmRzTG9uZ1RvTXMoZGF0YSwgaW5kZXgpKTsgfVxuZXhwb3J0IGZ1bmN0aW9uIGVwb2NoTWlsbGlzZWNvbmRzTG9uZ1RvRGF0ZShkYXRhOiBJbnQzMkFycmF5LCBpbmRleDogbnVtYmVyKSB7IHJldHVybiBlcG9jaE1pbGxpc2Vjb25kc1RvRGF0ZShlcG9jaE1pbGxpc2Vjb25kc0xvbmdUb01zKGRhdGEsIGluZGV4KSk7IH1cbiJdfQ==
