"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const vector_1 = require("../vector");
const chunked_1 = require("./chunked");
const vector_2 = require("../util/vector");
class BaseVector extends vector_1.Vector {
    constructor(data, children, stride) {
        super();
        this._stride = 1;
        this._numChildren = 0;
        this._children = children;
        this._numChildren = data.childData.length;
        this._bindDataAccessors(this._data = data);
        this._stride = Math.floor(Math.max(stride || 1, 1));
    }
    get data() { return this._data; }
    get stride() { return this._stride; }
    get numChildren() { return this._numChildren; }
    get type() { return this._data.type; }
    get typeId() { return this._data.typeId; }
    get length() { return this._data.length; }
    get offset() { return this._data.offset; }
    get nullCount() { return this._data.nullCount; }
    get VectorName() { return this.constructor.name; }
    get ArrayType() { return this._data.ArrayType; }
    get values() { return this._data.values; }
    get typeIds() { return this._data.typeIds; }
    get nullBitmap() { return this._data.nullBitmap; }
    get valueOffsets() { return this._data.valueOffsets; }
    get [Symbol.toStringTag]() { return `${this.VectorName}<${this.type[Symbol.toStringTag]}>`; }
    clone(data, children = this._children, stride = this._stride) {
        return vector_1.Vector.new(data, children, stride);
    }
    concat(...others) {
        return chunked_1.Chunked.concat(this, ...others);
    }
    slice(begin, end) {
        // Adjust args similar to Array.prototype.slice. Normalize begin/end to
        // clamp between 0 and length, and wrap around on negative indices, e.g.
        // slice(-1, 5) or slice(5, -1)
        return vector_2.clampRange(this, begin, end, this._sliceInternal);
    }
    isValid(index) {
        if (this.nullCount > 0) {
            const idx = this.offset + index;
            const val = this.nullBitmap[idx >> 3];
            const mask = (val & (1 << (idx % 8)));
            return mask !== 0;
        }
        return true;
    }
    getChildAt(index) {
        return index < 0 || index >= this.numChildren ? null : ((this._children || (this._children = []))[index] ||
            (this._children[index] = vector_1.Vector.new(this._data.childData[index])));
    }
    // @ts-ignore
    toJSON() { return [...this]; }
    _sliceInternal(self, offset, length) {
        const stride = self.stride;
        return self.clone(self.data.slice(offset * stride, (length - offset) * stride));
    }
    // @ts-ignore
    _bindDataAccessors(data) {
        // Implementation in src/vectors/index.ts due to circular dependency/packaging shenanigans
    }
}
exports.BaseVector = BaseVector;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEdBQUcsZUFBTSxDQUFDLEdBQUcsQ0FBSSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQVksQ0FBQyxDQUFDLENBQ3JFLENBQUM7SUFDbkIsQ0FBQztJQUVELGFBQWE7SUFDTixNQUFNLEtBQVUsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRWhDLGNBQWMsQ0FBQyxJQUFVLEVBQUUsTUFBYyxFQUFFLE1BQWM7UUFDL0QsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUMzQixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sRUFBRSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ3BGLENBQUM7SUFFRCxhQUFhO0lBQ0gsa0JBQWtCLENBQUMsSUFBYTtRQUN0QywwRkFBMEY7SUFDOUYsQ0FBQztDQUNKO0FBakZELGdDQWlGQyIsImZpbGUiOiJ2ZWN0b3IvYmFzZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBEYXRhIH0gZnJvbSAnLi4vZGF0YSc7XG5pbXBvcnQgeyBWZWN0b3IgfSBmcm9tICcuLi92ZWN0b3InO1xuaW1wb3J0IHsgRGF0YVR5cGUgfSBmcm9tICcuLi90eXBlJztcbmltcG9ydCB7IENodW5rZWQgfSBmcm9tICcuL2NodW5rZWQnO1xuaW1wb3J0IHsgY2xhbXBSYW5nZSB9IGZyb20gJy4uL3V0aWwvdmVjdG9yJztcbmltcG9ydCB7IFZlY3RvciBhcyBWVHlwZSB9IGZyb20gJy4uL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgQ2xvbmFibGUsIFNsaWNlYWJsZSwgQXBwbGljYXRpdmUgfSBmcm9tICcuLi92ZWN0b3InO1xuXG5leHBvcnQgaW50ZXJmYWNlIEJhc2VWZWN0b3I8VCBleHRlbmRzIERhdGFUeXBlID0gYW55PiBleHRlbmRzIENsb25hYmxlPFZUeXBlPFQ+PiwgU2xpY2VhYmxlPFZUeXBlPFQ+PiwgQXBwbGljYXRpdmU8VCwgQ2h1bmtlZDxUPj4ge1xuICAgIHNsaWNlKGJlZ2luPzogbnVtYmVyLCBlbmQ/OiBudW1iZXIpOiBWVHlwZTxUPjtcbiAgICBjb25jYXQoLi4ub3RoZXJzOiBWZWN0b3I8VD5bXSk6IENodW5rZWQ8VD47XG4gICAgY2xvbmU8UiBleHRlbmRzIERhdGFUeXBlID0gVD4oZGF0YTogRGF0YTxSPiwgY2hpbGRyZW4/OiBWZWN0b3I8Uj5bXSwgc3RyaWRlPzogbnVtYmVyKTogVlR5cGU8Uj47XG59XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBCYXNlVmVjdG9yPFQgZXh0ZW5kcyBEYXRhVHlwZSA9IGFueT4gZXh0ZW5kcyBWZWN0b3I8VD5cbiAgICBpbXBsZW1lbnRzIENsb25hYmxlPFZUeXBlPFQ+PiwgU2xpY2VhYmxlPFZUeXBlPFQ+PiwgQXBwbGljYXRpdmU8VCwgQ2h1bmtlZDxUPj4ge1xuXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHByb3RlY3RlZCBfZGF0YTogRGF0YTxUPjtcbiAgICBwcm90ZWN0ZWQgX3N0cmlkZTogbnVtYmVyID0gMTtcbiAgICBwcm90ZWN0ZWQgX251bUNoaWxkcmVuOiBudW1iZXIgPSAwO1xuICAgIHByb3RlY3RlZCBfY2hpbGRyZW4/OiBWZWN0b3JbXTtcblxuICAgIGNvbnN0cnVjdG9yKGRhdGE6IERhdGE8VD4sIGNoaWxkcmVuPzogVmVjdG9yW10sIHN0cmlkZT86IG51bWJlcikge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLl9jaGlsZHJlbiA9IGNoaWxkcmVuO1xuICAgICAgICB0aGlzLl9udW1DaGlsZHJlbiA9IGRhdGEuY2hpbGREYXRhLmxlbmd0aDtcbiAgICAgICAgdGhpcy5fYmluZERhdGFBY2Nlc3NvcnModGhpcy5fZGF0YSA9IGRhdGEpO1xuICAgICAgICB0aGlzLl9zdHJpZGUgPSBNYXRoLmZsb29yKE1hdGgubWF4KHN0cmlkZSB8fCAxLCAxKSk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBkYXRhKCkgeyByZXR1cm4gdGhpcy5fZGF0YTsgfVxuICAgIHB1YmxpYyBnZXQgc3RyaWRlKCkgeyByZXR1cm4gdGhpcy5fc3RyaWRlOyB9XG4gICAgcHVibGljIGdldCBudW1DaGlsZHJlbigpIHsgcmV0dXJuIHRoaXMuX251bUNoaWxkcmVuOyB9XG5cbiAgICBwdWJsaWMgZ2V0IHR5cGUoKSB7IHJldHVybiB0aGlzLl9kYXRhLnR5cGU7IH1cbiAgICBwdWJsaWMgZ2V0IHR5cGVJZCgpIHsgcmV0dXJuIHRoaXMuX2RhdGEudHlwZUlkIGFzIFRbJ1RUeXBlJ107IH1cbiAgICBwdWJsaWMgZ2V0IGxlbmd0aCgpIHsgcmV0dXJuIHRoaXMuX2RhdGEubGVuZ3RoOyB9XG4gICAgcHVibGljIGdldCBvZmZzZXQoKSB7IHJldHVybiB0aGlzLl9kYXRhLm9mZnNldDsgfVxuICAgIHB1YmxpYyBnZXQgbnVsbENvdW50KCkgeyByZXR1cm4gdGhpcy5fZGF0YS5udWxsQ291bnQ7IH1cbiAgICBwdWJsaWMgZ2V0IFZlY3Rvck5hbWUoKSB7IHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLm5hbWU7IH1cblxuICAgIHB1YmxpYyBnZXQgQXJyYXlUeXBlKCk6IFRbJ0FycmF5VHlwZSddIHsgcmV0dXJuIHRoaXMuX2RhdGEuQXJyYXlUeXBlOyB9XG5cbiAgICBwdWJsaWMgZ2V0IHZhbHVlcygpIHsgcmV0dXJuIHRoaXMuX2RhdGEudmFsdWVzOyB9XG4gICAgcHVibGljIGdldCB0eXBlSWRzKCkgeyByZXR1cm4gdGhpcy5fZGF0YS50eXBlSWRzOyB9XG4gICAgcHVibGljIGdldCBudWxsQml0bWFwKCkgeyByZXR1cm4gdGhpcy5fZGF0YS5udWxsQml0bWFwOyB9XG4gICAgcHVibGljIGdldCB2YWx1ZU9mZnNldHMoKSB7IHJldHVybiB0aGlzLl9kYXRhLnZhbHVlT2Zmc2V0czsgfVxuXG4gICAgcHVibGljIGdldCBbU3ltYm9sLnRvU3RyaW5nVGFnXSgpIHsgcmV0dXJuIGAke3RoaXMuVmVjdG9yTmFtZX08JHt0aGlzLnR5cGVbU3ltYm9sLnRvU3RyaW5nVGFnXX0+YDsgfVxuXG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBEYXRhVHlwZSA9IFQ+KGRhdGE6IERhdGE8Uj4sIGNoaWxkcmVuID0gdGhpcy5fY2hpbGRyZW4sIHN0cmlkZSA9IHRoaXMuX3N0cmlkZSkge1xuICAgICAgICByZXR1cm4gVmVjdG9yLm5ldzxSPihkYXRhLCBjaGlsZHJlbiwgc3RyaWRlKSBhcyBhbnk7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbmNhdCguLi5vdGhlcnM6IFZlY3RvcjxUPltdKSB7XG4gICAgICAgIHJldHVybiBDaHVua2VkLmNvbmNhdDxUPih0aGlzLCAuLi5vdGhlcnMpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzbGljZShiZWdpbj86IG51bWJlciwgZW5kPzogbnVtYmVyKSB7XG4gICAgICAgIC8vIEFkanVzdCBhcmdzIHNpbWlsYXIgdG8gQXJyYXkucHJvdG90eXBlLnNsaWNlLiBOb3JtYWxpemUgYmVnaW4vZW5kIHRvXG4gICAgICAgIC8vIGNsYW1wIGJldHdlZW4gMCBhbmQgbGVuZ3RoLCBhbmQgd3JhcCBhcm91bmQgb24gbmVnYXRpdmUgaW5kaWNlcywgZS5nLlxuICAgICAgICAvLyBzbGljZSgtMSwgNSkgb3Igc2xpY2UoNSwgLTEpXG4gICAgICAgIHJldHVybiBjbGFtcFJhbmdlKHRoaXMsIGJlZ2luLCBlbmQsIHRoaXMuX3NsaWNlSW50ZXJuYWwpO1xuICAgIH1cblxuICAgIHB1YmxpYyBpc1ZhbGlkKGluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKHRoaXMubnVsbENvdW50ID4gMCkge1xuICAgICAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5vZmZzZXQgKyBpbmRleDtcbiAgICAgICAgICAgIGNvbnN0IHZhbCA9IHRoaXMubnVsbEJpdG1hcFtpZHggPj4gM107XG4gICAgICAgICAgICBjb25zdCBtYXNrID0gKHZhbCAmICgxIDw8IChpZHggJSA4KSkpO1xuICAgICAgICAgICAgcmV0dXJuIG1hc2sgIT09IDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcHVibGljIGdldENoaWxkQXQ8UiBleHRlbmRzIERhdGFUeXBlID0gYW55PihpbmRleDogbnVtYmVyKTogVmVjdG9yPFI+IHwgbnVsbCB7XG4gICAgICAgIHJldHVybiBpbmRleCA8IDAgfHwgaW5kZXggPj0gdGhpcy5udW1DaGlsZHJlbiA/IG51bGwgOiAoXG4gICAgICAgICAgICAodGhpcy5fY2hpbGRyZW4gfHwgKHRoaXMuX2NoaWxkcmVuID0gW10pKVtpbmRleF0gfHxcbiAgICAgICAgICAgICh0aGlzLl9jaGlsZHJlbltpbmRleF0gPSBWZWN0b3IubmV3PFI+KHRoaXMuX2RhdGEuY2hpbGREYXRhW2luZGV4XSBhcyBEYXRhPFI+KSlcbiAgICAgICAgKSBhcyBWZWN0b3I8Uj47XG4gICAgfVxuXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHB1YmxpYyB0b0pTT04oKTogYW55IHsgcmV0dXJuIFsuLi50aGlzXTsgfVxuXG4gICAgcHJvdGVjdGVkIF9zbGljZUludGVybmFsKHNlbGY6IHRoaXMsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICBjb25zdCBzdHJpZGUgPSBzZWxmLnN0cmlkZTtcbiAgICAgICAgcmV0dXJuIHNlbGYuY2xvbmUoc2VsZi5kYXRhLnNsaWNlKG9mZnNldCAqIHN0cmlkZSwgKGxlbmd0aCAtIG9mZnNldCkgKiBzdHJpZGUpKTtcbiAgICB9XG5cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHJvdGVjdGVkIF9iaW5kRGF0YUFjY2Vzc29ycyhkYXRhOiBEYXRhPFQ+KSB7XG4gICAgICAgIC8vIEltcGxlbWVudGF0aW9uIGluIHNyYy92ZWN0b3JzL2luZGV4LnRzIGR1ZSB0byBjaXJjdWxhciBkZXBlbmRlbmN5L3BhY2thZ2luZyBzaGVuYW5pZ2Fuc1xuICAgIH1cbn1cbiJdfQ==
