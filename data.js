"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const bit_1 = require("./util/bit");
const bit_2 = require("./util/bit");
const enum_1 = require("./enum");
const buffer_1 = require("./util/buffer");
/** @ignore */ exports.kUnknownNullCount = -1;
/** @ignore */
class Data {
    constructor(type, offset, length, nullCount, buffers, childData) {
        this.type = type;
        this.offset = Math.floor(Math.max(offset || 0, 0));
        this.length = Math.floor(Math.max(length || 0, 0));
        this._nullCount = Math.floor(Math.max(nullCount || 0, -1));
        this.childData = (childData || []).map((x) => x instanceof Data ? x : x.data);
        let buffer;
        if (buffers instanceof Data) {
            this.stride = buffers.stride;
            this.values = buffers.values;
            this.typeIds = buffers.typeIds;
            this.nullBitmap = buffers.nullBitmap;
            this.valueOffsets = buffers.valueOffsets;
        }
        else {
            if (buffers) {
                (buffer = buffers[0]) && (this.valueOffsets = buffer);
                (buffer = buffers[1]) && (this.values = buffer);
                (buffer = buffers[2]) && (this.nullBitmap = buffer);
                (buffer = buffers[3]) && (this.typeIds = buffer);
            }
            const t = type;
            switch (type.typeId) {
                case enum_1.Type.Decimal:
                    this.stride = 4;
                    break;
                case enum_1.Type.Timestamp:
                    this.stride = 2;
                    break;
                case enum_1.Type.Date:
                    this.stride = 1 + t.unit;
                    break;
                case enum_1.Type.Interval:
                    this.stride = 1 + t.unit;
                    break;
                case enum_1.Type.Int:
                    this.stride = 1 + +(t.bitWidth > 32);
                    break;
                case enum_1.Type.Time:
                    this.stride = 1 + +(t.bitWidth > 32);
                    break;
                case enum_1.Type.FixedSizeList:
                    this.stride = t.listSize;
                    break;
                case enum_1.Type.FixedSizeBinary:
                    this.stride = t.byteWidth;
                    break;
                default: this.stride = 1;
            }
        }
    }
    get ArrayType() { return this.type.ArrayType; }
    get typeId() { return this.type.typeId; }
    get buffers() {
        return [this.valueOffsets, this.values, this.nullBitmap, this.typeIds];
    }
    get nullCount() {
        let nullCount = this._nullCount;
        let nullBitmap;
        if (nullCount <= exports.kUnknownNullCount && (nullBitmap = this.nullBitmap)) {
            this._nullCount = nullCount = this.length - bit_2.popcnt_bit_range(nullBitmap, this.offset, this.offset + this.length);
        }
        return nullCount;
    }
    clone(type, offset = this.offset, length = this.length, nullCount = this._nullCount, buffers = this, childData = this.childData) {
        return new Data(type, offset, length, nullCount, buffers, childData);
    }
    slice(offset, length) {
        // +true === 1, +false === 0, so this means
        // we keep nullCount at 0 if it's already 0,
        // otherwise set to the invalidated flag -1
        const { stride, typeId, childData } = this;
        const nullCount = +(this._nullCount === 0) - 1;
        const childStride = typeId === 16 /* FixedSizeList */ ? stride : 1;
        const buffers = this._sliceBuffers(offset, length, stride, typeId);
        return this.clone(this.type, this.offset + offset, length, nullCount, buffers, 
        // Don't slice children if we have value offsets (the variable-width types)
        (!childData.length || this.valueOffsets) ? childData : this._sliceChildren(childData, childStride * offset, childStride * length));
    }
    _changeLengthAndBackfillNullBitmap(newLength) {
        const { length, nullCount } = this;
        // start initialized with 0s (nulls), then fill from 0 to length with 1s (not null)
        const bitmap = new Uint8Array(((newLength + 63) & ~63) >> 3).fill(255, 0, length >> 3);
        // set all the bits in the last byte (up to bit `length - length % 8`) to 1 (not null)
        bitmap[length >> 3] = (1 << (length - (length & ~7))) - 1;
        // if we have a nullBitmap, truncate + slice and set it over the pre-filled 1s
        if (nullCount > 0) {
            bitmap.set(bit_1.truncateBitmap(this.offset, length, this.nullBitmap), 0);
        }
        const buffers = this.buffers;
        buffers[enum_1.VectorType.VALIDITY] = bitmap;
        return this.clone(this.type, 0, newLength, nullCount + (newLength - length), buffers);
    }
    _sliceBuffers(offset, length, stride, typeId) {
        let arr, { buffers } = this;
        // If typeIds exist, slice the typeIds buffer
        (arr = buffers[enum_1.VectorType.TYPE]) && (buffers[enum_1.VectorType.TYPE] = arr.subarray(offset, offset + length));
        // If offsets exist, only slice the offsets buffer
        (arr = buffers[enum_1.VectorType.OFFSET]) && (buffers[enum_1.VectorType.OFFSET] = arr.subarray(offset, offset + length + 1)) ||
            // Otherwise if no offsets, slice the data buffer. Don't slice the data vector for Booleans, since the offset goes by bits not bytes
            (arr = buffers[enum_1.VectorType.DATA]) && (buffers[enum_1.VectorType.DATA] = typeId === 6 ? arr : arr.subarray(stride * offset, stride * (offset + length)));
        return buffers;
    }
    _sliceChildren(childData, offset, length) {
        return childData.map((child) => child.slice(offset, length));
    }
    //
    // Convenience methods for creating Data instances for each of the Arrow Vector types
    //
    /** @nocollapse */
    static Null(type, offset, length, nullCount, nullBitmap, _data) {
        return new Data(type, offset, length, nullCount, [undefined, undefined, buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static Int(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static Dictionary(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.indices.ArrayType, data), buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static Float(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static Bool(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static Decimal(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static Date(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static Time(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static Timestamp(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static Interval(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static FixedSizeBinary(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static Binary(type, offset, length, nullCount, nullBitmap, valueOffsets, data) {
        return new Data(type, offset, length, nullCount, [buffer_1.toInt32Array(valueOffsets), buffer_1.toUint8Array(data), buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static Utf8(type, offset, length, nullCount, nullBitmap, valueOffsets, data) {
        return new Data(type, offset, length, nullCount, [buffer_1.toInt32Array(valueOffsets), buffer_1.toUint8Array(data), buffer_1.toUint8Array(nullBitmap)]);
    }
    /** @nocollapse */
    static List(type, offset, length, nullCount, nullBitmap, valueOffsets, child) {
        return new Data(type, offset, length, nullCount, [buffer_1.toInt32Array(valueOffsets), undefined, buffer_1.toUint8Array(nullBitmap)], [child]);
    }
    /** @nocollapse */
    static FixedSizeList(type, offset, length, nullCount, nullBitmap, child) {
        return new Data(type, offset, length, nullCount, [undefined, undefined, buffer_1.toUint8Array(nullBitmap)], [child]);
    }
    /** @nocollapse */
    static Struct(type, offset, length, nullCount, nullBitmap, children) {
        return new Data(type, offset, length, nullCount, [undefined, undefined, buffer_1.toUint8Array(nullBitmap)], children);
    }
    /** @nocollapse */
    static Map(type, offset, length, nullCount, nullBitmap, children) {
        return new Data(type, offset, length, nullCount, [undefined, undefined, buffer_1.toUint8Array(nullBitmap)], children);
    }
    /** @nocollapse */
    static Union(type, offset, length, nullCount, nullBitmap, typeIds, valueOffsetsOrChildren, children) {
        const buffers = [
            undefined, undefined,
            buffer_1.toUint8Array(nullBitmap),
            buffer_1.toArrayBufferView(type.ArrayType, typeIds)
        ];
        if (type.mode === enum_1.UnionMode.Sparse) {
            return new Data(type, offset, length, nullCount, buffers, valueOffsetsOrChildren);
        }
        buffers[enum_1.VectorType.OFFSET] = buffer_1.toInt32Array(valueOffsetsOrChildren);
        return new Data(type, offset, length, nullCount, buffers, children);
    }
}
exports.Data = Data;
(Data.prototype.childData = Object.freeze([]));

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFPLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDeEUsQ0FBQztDQUNKO0FBdk1ELG9CQXVNQztBQUVELENBQUUsSUFBSSxDQUFDLFNBQWlCLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJkYXRhLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IFZlY3RvciB9IGZyb20gJy4vdmVjdG9yJztcbmltcG9ydCB7IHRydW5jYXRlQml0bWFwIH0gZnJvbSAnLi91dGlsL2JpdCc7XG5pbXBvcnQgeyBwb3BjbnRfYml0X3JhbmdlIH0gZnJvbSAnLi91dGlsL2JpdCc7XG5pbXBvcnQgeyBEYXRhVHlwZSwgU3BhcnNlVW5pb24sIERlbnNlVW5pb24gfSBmcm9tICcuL3R5cGUnO1xuaW1wb3J0IHsgVmVjdG9yVHlwZSBhcyBCdWZmZXJUeXBlLCBVbmlvbk1vZGUsIFR5cGUgfSBmcm9tICcuL2VudW0nO1xuaW1wb3J0IHsgdG9BcnJheUJ1ZmZlclZpZXcsIHRvVWludDhBcnJheSwgdG9JbnQzMkFycmF5IH0gZnJvbSAnLi91dGlsL2J1ZmZlcic7XG5pbXBvcnQge1xuICAgIERpY3Rpb25hcnksXG4gICAgTnVsbCwgSW50LCBGbG9hdCxcbiAgICBCaW5hcnksIEJvb2wsIFV0ZjgsIERlY2ltYWwsXG4gICAgRGF0ZV8sIFRpbWUsIFRpbWVzdGFtcCwgSW50ZXJ2YWwsXG4gICAgTGlzdCwgU3RydWN0LCBVbmlvbiwgRml4ZWRTaXplQmluYXJ5LCBGaXhlZFNpemVMaXN0LCBNYXBfLFxufSBmcm9tICcuL3R5cGUnO1xuXG4vLyBXaGVuIHNsaWNpbmcsIHdlIGRvIG5vdCBrbm93IHRoZSBudWxsIGNvdW50IG9mIHRoZSBzbGljZWQgcmFuZ2Ugd2l0aG91dFxuLy8gZG9pbmcgc29tZSBjb21wdXRhdGlvbi4gVG8gYXZvaWQgZG9pbmcgdGhpcyBlYWdlcmx5LCB3ZSBzZXQgdGhlIG51bGwgY291bnRcbi8vIHRvIC0xIChhbnkgbmVnYXRpdmUgbnVtYmVyIHdpbGwgZG8pLiBXaGVuIFZlY3Rvci5udWxsQ291bnQgaXMgY2FsbGVkIHRoZVxuLy8gZmlyc3QgdGltZSwgdGhlIG51bGwgY291bnQgd2lsbCBiZSBjb21wdXRlZC4gU2VlIEFSUk9XLTMzXG4vKiogQGlnbm9yZSAqLyBleHBvcnQgdHlwZSBrVW5rbm93bk51bGxDb3VudCA9IC0xO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IGtVbmtub3duTnVsbENvdW50ID0gLTE7XG5cbi8qKiBAaWdub3JlICovIGV4cG9ydCB0eXBlIE51bGxCdWZmZXIgPSBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZDtcbi8qKiBAaWdub3JlICovIGV4cG9ydCB0eXBlIFR5cGVJZHNCdWZmZXIgPSBJbnQ4QXJyYXkgIHwgQXJyYXlMaWtlPG51bWJlcj4gfCBJdGVyYWJsZTxudW1iZXI+O1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IHR5cGUgVmFsdWVPZmZzZXRzQnVmZmVyID0gSW50MzJBcnJheSAgfCBBcnJheUxpa2U8bnVtYmVyPiB8IEl0ZXJhYmxlPG51bWJlcj47XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgdHlwZSBEYXRhQnVmZmVyPFQgZXh0ZW5kcyBEYXRhVHlwZT4gPSBUWydUQXJyYXknXSB8IEFycmF5TGlrZTxudW1iZXI+IHwgSXRlcmFibGU8bnVtYmVyPjtcblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBpbnRlcmZhY2UgQnVmZmVyczxUIGV4dGVuZHMgRGF0YVR5cGU+IHtcbiAgICAgIFtCdWZmZXJUeXBlLk9GRlNFVF06IEludDMyQXJyYXk7XG4gICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiBUWydUQXJyYXknXTtcbiAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IFVpbnQ4QXJyYXk7XG4gICAgICAgIFtCdWZmZXJUeXBlLlRZUEVdOiBUWydUQXJyYXknXTtcbn1cblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBpbnRlcmZhY2UgRGF0YTxUIGV4dGVuZHMgRGF0YVR5cGUgPSBEYXRhVHlwZT4ge1xuICAgIHJlYWRvbmx5IFRUeXBlOiBUWydUVHlwZSddO1xuICAgIHJlYWRvbmx5IFRBcnJheTogVFsnVEFycmF5J107XG4gICAgcmVhZG9ubHkgVFZhbHVlOiBUWydUVmFsdWUnXTtcbn1cblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBjbGFzcyBEYXRhPFQgZXh0ZW5kcyBEYXRhVHlwZSA9IERhdGFUeXBlPiB7XG5cbiAgICBwdWJsaWMgcmVhZG9ubHkgdHlwZTogVDtcbiAgICBwdWJsaWMgcmVhZG9ubHkgbGVuZ3RoOiBudW1iZXI7XG4gICAgcHVibGljIHJlYWRvbmx5IG9mZnNldDogbnVtYmVyO1xuICAgIHB1YmxpYyByZWFkb25seSBzdHJpZGU6IG51bWJlcjtcbiAgICBwdWJsaWMgcmVhZG9ubHkgY2hpbGREYXRhOiBEYXRhW107XG4gICAgcHVibGljIHJlYWRvbmx5IHZhbHVlczogQnVmZmVyczxUPltCdWZmZXJUeXBlLkRBVEFdO1xuICAgIHB1YmxpYyByZWFkb25seSB0eXBlSWRzOiBCdWZmZXJzPFQ+W0J1ZmZlclR5cGUuVFlQRV07XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHB1YmxpYyByZWFkb25seSBudWxsQml0bWFwOiBCdWZmZXJzPFQ+W0J1ZmZlclR5cGUuVkFMSURJVFldO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBwdWJsaWMgcmVhZG9ubHkgdmFsdWVPZmZzZXRzOiBCdWZmZXJzPFQ+W0J1ZmZlclR5cGUuT0ZGU0VUXTtcblxuICAgIHB1YmxpYyBnZXQgQXJyYXlUeXBlKCkgeyByZXR1cm4gdGhpcy50eXBlLkFycmF5VHlwZTsgfVxuICAgIHB1YmxpYyBnZXQgdHlwZUlkKCk6IFRbJ1RUeXBlJ10geyByZXR1cm4gdGhpcy50eXBlLnR5cGVJZDsgfVxuICAgIHB1YmxpYyBnZXQgYnVmZmVycygpIHtcbiAgICAgICAgcmV0dXJuIFt0aGlzLnZhbHVlT2Zmc2V0cywgdGhpcy52YWx1ZXMsIHRoaXMubnVsbEJpdG1hcCwgdGhpcy50eXBlSWRzXSBhcyBCdWZmZXJzPFQ+O1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfbnVsbENvdW50OiBudW1iZXIgfCBrVW5rbm93bk51bGxDb3VudDtcblxuICAgIHB1YmxpYyBnZXQgbnVsbENvdW50KCkge1xuICAgICAgICBsZXQgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50O1xuICAgICAgICBsZXQgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKG51bGxDb3VudCA8PSBrVW5rbm93bk51bGxDb3VudCAmJiAobnVsbEJpdG1hcCA9IHRoaXMubnVsbEJpdG1hcCkpIHtcbiAgICAgICAgICAgIHRoaXMuX251bGxDb3VudCA9IG51bGxDb3VudCA9IHRoaXMubGVuZ3RoIC0gcG9wY250X2JpdF9yYW5nZShudWxsQml0bWFwLCB0aGlzLm9mZnNldCwgdGhpcy5vZmZzZXQgKyB0aGlzLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGxDb3VudDtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlciwgYnVmZmVycz86IFBhcnRpYWw8QnVmZmVyczxUPj4gfCBEYXRhPFQ+LCBjaGlsZERhdGE/OiAoRGF0YSB8IFZlY3RvcilbXSkge1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLm9mZnNldCA9IE1hdGguZmxvb3IoTWF0aC5tYXgob2Zmc2V0IHx8IDAsIDApKTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSBNYXRoLmZsb29yKE1hdGgubWF4KGxlbmd0aCB8fCAwLCAwKSk7XG4gICAgICAgIHRoaXMuX251bGxDb3VudCA9IE1hdGguZmxvb3IoTWF0aC5tYXgobnVsbENvdW50IHx8IDAsIC0xKSk7XG4gICAgICAgIHRoaXMuY2hpbGREYXRhID0gKGNoaWxkRGF0YSB8fCBbXSkubWFwKCh4KSA9PiB4IGluc3RhbmNlb2YgRGF0YSA/IHggOiB4LmRhdGEpIGFzIERhdGFbXTtcbiAgICAgICAgbGV0IGJ1ZmZlcjogQnVmZmVyczxUPltrZXlvZiBCdWZmZXJzPFQ+XTtcbiAgICAgICAgaWYgKGJ1ZmZlcnMgaW5zdGFuY2VvZiBEYXRhKSB7XG4gICAgICAgICAgICB0aGlzLnN0cmlkZSA9IGJ1ZmZlcnMuc3RyaWRlO1xuICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBidWZmZXJzLnZhbHVlcztcbiAgICAgICAgICAgIHRoaXMudHlwZUlkcyA9IGJ1ZmZlcnMudHlwZUlkcztcbiAgICAgICAgICAgIHRoaXMubnVsbEJpdG1hcCA9IGJ1ZmZlcnMubnVsbEJpdG1hcDtcbiAgICAgICAgICAgIHRoaXMudmFsdWVPZmZzZXRzID0gYnVmZmVycy52YWx1ZU9mZnNldHM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoYnVmZmVycykge1xuICAgICAgICAgICAgICAgIChidWZmZXIgPSAoYnVmZmVycyBhcyBCdWZmZXJzPFQ+KVswXSkgJiYgKHRoaXMudmFsdWVPZmZzZXRzID0gYnVmZmVyKTtcbiAgICAgICAgICAgICAgICAoYnVmZmVyID0gKGJ1ZmZlcnMgYXMgQnVmZmVyczxUPilbMV0pICYmICh0aGlzLnZhbHVlcyA9IGJ1ZmZlcik7XG4gICAgICAgICAgICAgICAgKGJ1ZmZlciA9IChidWZmZXJzIGFzIEJ1ZmZlcnM8VD4pWzJdKSAmJiAodGhpcy5udWxsQml0bWFwID0gYnVmZmVyKTtcbiAgICAgICAgICAgICAgICAoYnVmZmVyID0gKGJ1ZmZlcnMgYXMgQnVmZmVyczxUPilbM10pICYmICh0aGlzLnR5cGVJZHMgPSBidWZmZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdDogYW55ID0gdHlwZTtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZS50eXBlSWQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFR5cGUuRGVjaW1hbDogdGhpcy5zdHJpZGUgPSA0OyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFR5cGUuVGltZXN0YW1wOiB0aGlzLnN0cmlkZSA9IDI7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVHlwZS5EYXRlOiB0aGlzLnN0cmlkZSA9IDEgKyAodCBhcyBEYXRlXykudW5pdDsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBUeXBlLkludGVydmFsOiB0aGlzLnN0cmlkZSA9IDEgKyAodCBhcyBJbnRlcnZhbCkudW5pdDsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBUeXBlLkludDogdGhpcy5zdHJpZGUgPSAxICsgKygodCBhcyBJbnQpLmJpdFdpZHRoID4gMzIpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFR5cGUuVGltZTogdGhpcy5zdHJpZGUgPSAxICsgKygodCBhcyBUaW1lKS5iaXRXaWR0aCA+IDMyKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBUeXBlLkZpeGVkU2l6ZUxpc3Q6IHRoaXMuc3RyaWRlID0gKHQgYXMgRml4ZWRTaXplTGlzdCkubGlzdFNpemU7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVHlwZS5GaXhlZFNpemVCaW5hcnk6IHRoaXMuc3RyaWRlID0gKHQgYXMgRml4ZWRTaXplQmluYXJ5KS5ieXRlV2lkdGg7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMuc3RyaWRlID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgRGF0YVR5cGU+KHR5cGU6IFIsIG9mZnNldCA9IHRoaXMub2Zmc2V0LCBsZW5ndGggPSB0aGlzLmxlbmd0aCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50LCBidWZmZXJzOiBCdWZmZXJzPFI+ID0gPGFueT4gdGhpcywgY2hpbGREYXRhOiAoRGF0YSB8IFZlY3RvcilbXSA9IHRoaXMuY2hpbGREYXRhKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBidWZmZXJzLCBjaGlsZERhdGEpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzbGljZShvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpOiBEYXRhPFQ+IHtcbiAgICAgICAgLy8gK3RydWUgPT09IDEsICtmYWxzZSA9PT0gMCwgc28gdGhpcyBtZWFuc1xuICAgICAgICAvLyB3ZSBrZWVwIG51bGxDb3VudCBhdCAwIGlmIGl0J3MgYWxyZWFkeSAwLFxuICAgICAgICAvLyBvdGhlcndpc2Ugc2V0IHRvIHRoZSBpbnZhbGlkYXRlZCBmbGFnIC0xXG4gICAgICAgIGNvbnN0IHsgc3RyaWRlLCB0eXBlSWQsIGNoaWxkRGF0YSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgbnVsbENvdW50ID0gKyh0aGlzLl9udWxsQ291bnQgPT09IDApIC0gMTtcbiAgICAgICAgY29uc3QgY2hpbGRTdHJpZGUgPSB0eXBlSWQgPT09IDE2IC8qIEZpeGVkU2l6ZUxpc3QgKi8gPyBzdHJpZGUgOiAxO1xuICAgICAgICBjb25zdCBidWZmZXJzID0gdGhpcy5fc2xpY2VCdWZmZXJzKG9mZnNldCwgbGVuZ3RoLCBzdHJpZGUsIHR5cGVJZCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lPFQ+KHRoaXMudHlwZSwgdGhpcy5vZmZzZXQgKyBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBidWZmZXJzLFxuICAgICAgICAgICAgLy8gRG9uJ3Qgc2xpY2UgY2hpbGRyZW4gaWYgd2UgaGF2ZSB2YWx1ZSBvZmZzZXRzICh0aGUgdmFyaWFibGUtd2lkdGggdHlwZXMpXG4gICAgICAgICAgICAoIWNoaWxkRGF0YS5sZW5ndGggfHwgdGhpcy52YWx1ZU9mZnNldHMpID8gY2hpbGREYXRhIDogdGhpcy5fc2xpY2VDaGlsZHJlbihjaGlsZERhdGEsIGNoaWxkU3RyaWRlICogb2Zmc2V0LCBjaGlsZFN0cmlkZSAqIGxlbmd0aCkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBfY2hhbmdlTGVuZ3RoQW5kQmFja2ZpbGxOdWxsQml0bWFwKG5ld0xlbmd0aDogbnVtYmVyKTogRGF0YTxUPiB7XG4gICAgICAgIGNvbnN0IHsgbGVuZ3RoLCBudWxsQ291bnQgfSA9IHRoaXM7XG4gICAgICAgIC8vIHN0YXJ0IGluaXRpYWxpemVkIHdpdGggMHMgKG51bGxzKSwgdGhlbiBmaWxsIGZyb20gMCB0byBsZW5ndGggd2l0aCAxcyAobm90IG51bGwpXG4gICAgICAgIGNvbnN0IGJpdG1hcCA9IG5ldyBVaW50OEFycmF5KCgobmV3TGVuZ3RoICsgNjMpICYgfjYzKSA+PiAzKS5maWxsKDI1NSwgMCwgbGVuZ3RoID4+IDMpO1xuICAgICAgICAvLyBzZXQgYWxsIHRoZSBiaXRzIGluIHRoZSBsYXN0IGJ5dGUgKHVwIHRvIGJpdCBgbGVuZ3RoIC0gbGVuZ3RoICUgOGApIHRvIDEgKG5vdCBudWxsKVxuICAgICAgICBiaXRtYXBbbGVuZ3RoID4+IDNdID0gKDEgPDwgKGxlbmd0aCAtIChsZW5ndGggJiB+NykpKSAtIDE7XG4gICAgICAgIC8vIGlmIHdlIGhhdmUgYSBudWxsQml0bWFwLCB0cnVuY2F0ZSArIHNsaWNlIGFuZCBzZXQgaXQgb3ZlciB0aGUgcHJlLWZpbGxlZCAxc1xuICAgICAgICBpZiAobnVsbENvdW50ID4gMCkge1xuICAgICAgICAgICAgYml0bWFwLnNldCh0cnVuY2F0ZUJpdG1hcCh0aGlzLm9mZnNldCwgbGVuZ3RoLCB0aGlzLm51bGxCaXRtYXApLCAwKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBidWZmZXJzID0gdGhpcy5idWZmZXJzO1xuICAgICAgICBidWZmZXJzW0J1ZmZlclR5cGUuVkFMSURJVFldID0gYml0bWFwO1xuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZSh0aGlzLnR5cGUsIDAsIG5ld0xlbmd0aCwgbnVsbENvdW50ICsgKG5ld0xlbmd0aCAtIGxlbmd0aCksIGJ1ZmZlcnMpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfc2xpY2VCdWZmZXJzKG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgc3RyaWRlOiBudW1iZXIsIHR5cGVJZDogVFsnVFR5cGUnXSk6IEJ1ZmZlcnM8VD4ge1xuICAgICAgICBsZXQgYXJyOiBhbnksIHsgYnVmZmVycyB9ID0gdGhpcztcbiAgICAgICAgLy8gSWYgdHlwZUlkcyBleGlzdCwgc2xpY2UgdGhlIHR5cGVJZHMgYnVmZmVyXG4gICAgICAgIChhcnIgPSBidWZmZXJzW0J1ZmZlclR5cGUuVFlQRV0pICYmIChidWZmZXJzW0J1ZmZlclR5cGUuVFlQRV0gPSBhcnIuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpKTtcbiAgICAgICAgLy8gSWYgb2Zmc2V0cyBleGlzdCwgb25seSBzbGljZSB0aGUgb2Zmc2V0cyBidWZmZXJcbiAgICAgICAgKGFyciA9IGJ1ZmZlcnNbQnVmZmVyVHlwZS5PRkZTRVRdKSAmJiAoYnVmZmVyc1tCdWZmZXJUeXBlLk9GRlNFVF0gPSBhcnIuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGggKyAxKSkgfHxcbiAgICAgICAgLy8gT3RoZXJ3aXNlIGlmIG5vIG9mZnNldHMsIHNsaWNlIHRoZSBkYXRhIGJ1ZmZlci4gRG9uJ3Qgc2xpY2UgdGhlIGRhdGEgdmVjdG9yIGZvciBCb29sZWFucywgc2luY2UgdGhlIG9mZnNldCBnb2VzIGJ5IGJpdHMgbm90IGJ5dGVzXG4gICAgICAgIChhcnIgPSBidWZmZXJzW0J1ZmZlclR5cGUuREFUQV0pICYmIChidWZmZXJzW0J1ZmZlclR5cGUuREFUQV0gPSB0eXBlSWQgPT09IDYgPyBhcnIgOiBhcnIuc3ViYXJyYXkoc3RyaWRlICogb2Zmc2V0LCBzdHJpZGUgKiAob2Zmc2V0ICsgbGVuZ3RoKSkpO1xuICAgICAgICByZXR1cm4gYnVmZmVycztcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX3NsaWNlQ2hpbGRyZW4oY2hpbGREYXRhOiBEYXRhW10sIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcik6IERhdGFbXSB7XG4gICAgICAgIHJldHVybiBjaGlsZERhdGEubWFwKChjaGlsZCkgPT4gY2hpbGQuc2xpY2Uob2Zmc2V0LCBsZW5ndGgpKTtcbiAgICB9XG5cbiAgICAvL1xuICAgIC8vIENvbnZlbmllbmNlIG1ldGhvZHMgZm9yIGNyZWF0aW5nIERhdGEgaW5zdGFuY2VzIGZvciBlYWNoIG9mIHRoZSBBcnJvdyBWZWN0b3IgdHlwZXNcbiAgICAvL1xuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgTnVsbDxUIGV4dGVuZHMgTnVsbD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgX2RhdGE/OiBOdWxsQnVmZmVyKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBbdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRvVWludDhBcnJheShudWxsQml0bWFwKV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEludDxUIGV4dGVuZHMgSW50Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBbdW5kZWZpbmVkLCB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSksIHRvVWludDhBcnJheShudWxsQml0bWFwKV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIERpY3Rpb25hcnk8VCBleHRlbmRzIERpY3Rpb25hcnk+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIFt1bmRlZmluZWQsIHRvQXJyYXlCdWZmZXJWaWV3PFRbJ1RBcnJheSddPih0eXBlLmluZGljZXMuQXJyYXlUeXBlLCBkYXRhKSwgdG9VaW50OEFycmF5KG51bGxCaXRtYXApXSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgRmxvYXQ8VCBleHRlbmRzIEZsb2F0Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBbdW5kZWZpbmVkLCB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSksIHRvVWludDhBcnJheShudWxsQml0bWFwKV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEJvb2w8VCBleHRlbmRzIEJvb2w+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIFt1bmRlZmluZWQsIHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKSwgdG9VaW50OEFycmF5KG51bGxCaXRtYXApXSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgRGVjaW1hbDxUIGV4dGVuZHMgRGVjaW1hbD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgW3VuZGVmaW5lZCwgdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpLCB0b1VpbnQ4QXJyYXkobnVsbEJpdG1hcCldKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBEYXRlPFQgZXh0ZW5kcyBEYXRlXz4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgW3VuZGVmaW5lZCwgdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpLCB0b1VpbnQ4QXJyYXkobnVsbEJpdG1hcCldKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBUaW1lPFQgZXh0ZW5kcyBUaW1lPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBbdW5kZWZpbmVkLCB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSksIHRvVWludDhBcnJheShudWxsQml0bWFwKV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIFRpbWVzdGFtcDxUIGV4dGVuZHMgVGltZXN0YW1wPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBbdW5kZWZpbmVkLCB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSksIHRvVWludDhBcnJheShudWxsQml0bWFwKV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEludGVydmFsPFQgZXh0ZW5kcyBJbnRlcnZhbD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgW3VuZGVmaW5lZCwgdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpLCB0b1VpbnQ4QXJyYXkobnVsbEJpdG1hcCldKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBGaXhlZFNpemVCaW5hcnk8VCBleHRlbmRzIEZpeGVkU2l6ZUJpbmFyeT4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgW3VuZGVmaW5lZCwgdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpLCB0b1VpbnQ4QXJyYXkobnVsbEJpdG1hcCldKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBCaW5hcnk8VCBleHRlbmRzIEJpbmFyeT4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgdmFsdWVPZmZzZXRzOiBWYWx1ZU9mZnNldHNCdWZmZXIsIGRhdGE6IFVpbnQ4QXJyYXkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIFt0b0ludDMyQXJyYXkodmFsdWVPZmZzZXRzKSwgdG9VaW50OEFycmF5KGRhdGEpLCB0b1VpbnQ4QXJyYXkobnVsbEJpdG1hcCldKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBVdGY4PFQgZXh0ZW5kcyBVdGY4Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCB2YWx1ZU9mZnNldHM6IFZhbHVlT2Zmc2V0c0J1ZmZlciwgZGF0YTogVWludDhBcnJheSkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgW3RvSW50MzJBcnJheSh2YWx1ZU9mZnNldHMpLCB0b1VpbnQ4QXJyYXkoZGF0YSksIHRvVWludDhBcnJheShudWxsQml0bWFwKV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIExpc3Q8VCBleHRlbmRzIExpc3Q+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIHZhbHVlT2Zmc2V0czogVmFsdWVPZmZzZXRzQnVmZmVyLCBjaGlsZDogRGF0YTxUWyd2YWx1ZVR5cGUnXT4gfCBWZWN0b3I8VFsndmFsdWVUeXBlJ10+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBbdG9JbnQzMkFycmF5KHZhbHVlT2Zmc2V0cyksIHVuZGVmaW5lZCwgdG9VaW50OEFycmF5KG51bGxCaXRtYXApXSwgW2NoaWxkXSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgRml4ZWRTaXplTGlzdDxUIGV4dGVuZHMgRml4ZWRTaXplTGlzdD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgY2hpbGQ6IERhdGEgfCBWZWN0b3IpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIFt1bmRlZmluZWQsIHVuZGVmaW5lZCwgdG9VaW50OEFycmF5KG51bGxCaXRtYXApXSwgW2NoaWxkXSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgU3RydWN0PFQgZXh0ZW5kcyBTdHJ1Y3Q+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGNoaWxkcmVuOiAoRGF0YSB8IFZlY3RvcilbXSkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgW3VuZGVmaW5lZCwgdW5kZWZpbmVkLCB0b1VpbnQ4QXJyYXkobnVsbEJpdG1hcCldLCBjaGlsZHJlbik7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgTWFwPFQgZXh0ZW5kcyBNYXBfPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBjaGlsZHJlbjogKERhdGEgfCBWZWN0b3IpW10pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIFt1bmRlZmluZWQsIHVuZGVmaW5lZCwgdG9VaW50OEFycmF5KG51bGxCaXRtYXApXSwgY2hpbGRyZW4pO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIFVuaW9uPFQgZXh0ZW5kcyBTcGFyc2VVbmlvbj4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgdHlwZUlkczogVHlwZUlkc0J1ZmZlciwgY2hpbGRyZW46IChEYXRhIHwgVmVjdG9yKVtdKTogRGF0YTxUPjtcbiAgICBwdWJsaWMgc3RhdGljIFVuaW9uPFQgZXh0ZW5kcyBEZW5zZVVuaW9uPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCB0eXBlSWRzOiBUeXBlSWRzQnVmZmVyLCB2YWx1ZU9mZnNldHM6IFZhbHVlT2Zmc2V0c0J1ZmZlciwgY2hpbGRyZW46IChEYXRhIHwgVmVjdG9yKVtdKTogRGF0YTxUPjtcbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIFVuaW9uPFQgZXh0ZW5kcyBVbmlvbj4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgdHlwZUlkczogVHlwZUlkc0J1ZmZlciwgdmFsdWVPZmZzZXRzT3JDaGlsZHJlbjogVmFsdWVPZmZzZXRzQnVmZmVyIHwgKERhdGEgfCBWZWN0b3IpW10sIGNoaWxkcmVuPzogKERhdGEgfCBWZWN0b3IpW10pIHtcbiAgICAgICAgY29uc3QgYnVmZmVycyA9IDx1bmtub3duPiBbXG4gICAgICAgICAgICB1bmRlZmluZWQsIHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHRvVWludDhBcnJheShudWxsQml0bWFwKSxcbiAgICAgICAgICAgIHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCB0eXBlSWRzKVxuICAgICAgICBdIGFzIFBhcnRpYWw8QnVmZmVyczxUPj47XG4gICAgICAgIGlmICh0eXBlLm1vZGUgPT09IFVuaW9uTW9kZS5TcGFyc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBidWZmZXJzLCB2YWx1ZU9mZnNldHNPckNoaWxkcmVuIGFzIChEYXRhIHwgVmVjdG9yKVtdKTtcbiAgICAgICAgfVxuICAgICAgICBidWZmZXJzW0J1ZmZlclR5cGUuT0ZGU0VUXSA9IHRvSW50MzJBcnJheSg8VmFsdWVPZmZzZXRzQnVmZmVyPiB2YWx1ZU9mZnNldHNPckNoaWxkcmVuKTtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIGJ1ZmZlcnMsIGNoaWxkcmVuKTtcbiAgICB9XG59XG5cbigoRGF0YS5wcm90b3R5cGUgYXMgYW55KS5jaGlsZERhdGEgPSBPYmplY3QuZnJlZXplKFtdKSk7XG4iXX0=
