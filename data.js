"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const bit_1 = require("./util/bit");
const type_1 = require("./type");
function toTypedArray(ArrayType, values) {
    if (!ArrayType && ArrayBuffer.isView(values)) {
        return values;
    }
    return values instanceof ArrayType ? values
        : !values || !ArrayBuffer.isView(values) ? ArrayType.from(values || [])
            : new ArrayType(values.buffer, values.byteOffset, values.byteLength / ArrayType.BYTES_PER_ELEMENT);
}
exports.toTypedArray = toTypedArray;
exports.kUnknownNullCount = -1;
class BaseData {
    constructor(type, length, offset, nullCount) {
        this.type = type;
        this.length = Math.floor(Math.max(length || 0, 0));
        this.offset = Math.floor(Math.max(offset || 0, 0));
        this._nullCount = Math.floor(Math.max(nullCount || 0, -1));
    }
    get typeId() { return this.type.TType; }
    get nullBitmap() { return this[type_1.VectorType.VALIDITY]; }
    get nullCount() {
        let nullCount = this._nullCount;
        let nullBitmap;
        if (nullCount === -1 && (nullBitmap = this[type_1.VectorType.VALIDITY])) {
            this._nullCount = nullCount = this.length - bit_1.popcnt_bit_range(nullBitmap, this.offset, this.offset + this.length);
        }
        return nullCount;
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new BaseData(type, length, offset, nullCount);
    }
    slice(offset, length) {
        return length <= 0 ? this : this.sliceInternal(this.clone(this.type, length, this.offset + offset, +(this._nullCount === 0) - 1), offset, length);
    }
    sliceInternal(clone, offset, length) {
        let arr;
        // If typeIds exist, slice the typeIds buffer
        (arr = this[type_1.VectorType.TYPE]) && (clone[type_1.VectorType.TYPE] = this.sliceData(arr, offset, length));
        // If offsets exist, only slice the offsets buffer
        (arr = this[type_1.VectorType.OFFSET]) && (clone[type_1.VectorType.OFFSET] = this.sliceOffsets(arr, offset, length)) ||
            // Otherwise if no offsets, slice the data buffer
            (arr = this[type_1.VectorType.DATA]) && (clone[type_1.VectorType.DATA] = this.sliceData(arr, offset, length));
        return clone;
    }
    sliceData(data, offset, length) {
        return data.subarray(offset, offset + length);
    }
    sliceOffsets(valueOffsets, offset, length) {
        return valueOffsets.subarray(offset, offset + length + 1);
    }
}
exports.BaseData = BaseData;
class FlatData extends BaseData {
    constructor(type, length, nullBitmap, data, offset, nullCount) {
        super(type, length, offset, nullCount);
        this[type_1.VectorType.DATA] = toTypedArray(this.ArrayType, data);
        this[type_1.VectorType.VALIDITY] = toTypedArray(Uint8Array, nullBitmap);
    }
    get values() { return this[type_1.VectorType.DATA]; }
    get ArrayType() { return this.type.ArrayType; }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new this.constructor(type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.DATA], offset, nullCount);
    }
}
exports.FlatData = FlatData;
class BoolData extends FlatData {
    sliceData(data) { return data; }
}
exports.BoolData = BoolData;
class FlatListData extends FlatData {
    constructor(type, length, nullBitmap, valueOffsets, data, offset, nullCount) {
        super(type, length, nullBitmap, data, offset, nullCount);
        this[type_1.VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    get values() { return this[type_1.VectorType.DATA]; }
    get valueOffsets() { return this[type_1.VectorType.OFFSET]; }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new FlatListData(type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.OFFSET], this[type_1.VectorType.DATA], offset, nullCount);
    }
}
exports.FlatListData = FlatListData;
class DictionaryData extends BaseData {
    constructor(type, dictionary, indices) {
        super(type, indices.length, indices.offset, indices._nullCount);
        this._indices = indices;
        this._dictionary = dictionary;
    }
    get indices() { return this._indices; }
    get dictionary() { return this._dictionary; }
    get nullCount() { return this._indices.nullCount; }
    get nullBitmap() { return this._indices.nullBitmap; }
    clone(type, length = this.length, offset = this.offset) {
        const data = this._dictionary.data.clone(type.dictionary);
        return new DictionaryData(this.type, this._dictionary.clone(data), this._indices.slice(offset - this.offset, length));
    }
    sliceInternal(clone, _offset, _length) {
        clone.length = clone._indices.length;
        clone._nullCount = clone._indices._nullCount;
        return clone;
    }
}
exports.DictionaryData = DictionaryData;
class NestedData extends BaseData {
    constructor(type, length, nullBitmap, childData, offset, nullCount) {
        super(type, length, offset, nullCount);
        this.childData = childData;
        this[type_1.VectorType.VALIDITY] = toTypedArray(Uint8Array, nullBitmap);
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new NestedData(type, length, this[type_1.VectorType.VALIDITY], this.childData, offset, nullCount);
    }
    sliceInternal(clone, offset, length) {
        if (!this[type_1.VectorType.OFFSET]) {
            clone.childData = this.childData.map((child) => child.slice(offset, length));
        }
        return super.sliceInternal(clone, offset, length);
    }
}
exports.NestedData = NestedData;
class SingleNestedData extends NestedData {
    constructor(type, length, nullBitmap, valueChildData, offset, nullCount) {
        super(type, length, nullBitmap, [valueChildData], offset, nullCount);
        this._valuesData = valueChildData;
    }
    get values() { return this._valuesData; }
}
exports.SingleNestedData = SingleNestedData;
class ListData extends SingleNestedData {
    constructor(type, length, nullBitmap, valueOffsets, valueChildData, offset, nullCount) {
        super(type, length, nullBitmap, valueChildData, offset, nullCount);
        this[type_1.VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    get valueOffsets() { return this[type_1.VectorType.OFFSET]; }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new ListData(type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.OFFSET], this._valuesData, offset, nullCount);
    }
}
exports.ListData = ListData;
class UnionData extends NestedData {
    constructor(type, length, nullBitmap, typeIds, childData, offset, nullCount) {
        super(type, length, nullBitmap, childData, offset, nullCount);
        this[type_1.VectorType.TYPE] = toTypedArray(Int8Array, typeIds);
        this.typeIdToChildIndex = type.typeIds.reduce((typeIdToChildIndex, typeId, idx) => {
            return (typeIdToChildIndex[typeId] = idx) && typeIdToChildIndex || typeIdToChildIndex;
        }, Object.create(null));
    }
    get typeIds() { return this[type_1.VectorType.TYPE]; }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new UnionData(type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.TYPE], this.childData, offset, nullCount);
    }
}
exports.UnionData = UnionData;
class SparseUnionData extends UnionData {
    constructor(type, length, nullBitmap, typeIds, childData, offset, nullCount) {
        super(type, length, nullBitmap, typeIds, childData, offset, nullCount);
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new SparseUnionData(type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.TYPE], this.childData, offset, nullCount);
    }
}
exports.SparseUnionData = SparseUnionData;
class DenseUnionData extends UnionData {
    get valueOffsets() { return this[type_1.VectorType.OFFSET]; }
    constructor(type, length, nullBitmap, typeIds, valueOffsets, childData, offset, nullCount) {
        super(type, length, nullBitmap, typeIds, childData, offset, nullCount);
        this[type_1.VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new DenseUnionData(type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.TYPE], this[type_1.VectorType.OFFSET], this.childData, offset, nullCount);
    }
}
exports.DenseUnionData = DenseUnionData;
class ChunkedData extends BaseData {
    constructor(type, length, chunkVectors, offset, nullCount, chunkOffsets) {
        super(type, length, offset, nullCount);
        this._chunkVectors = chunkVectors;
        this._chunkOffsets = chunkOffsets || ChunkedData.computeOffsets(chunkVectors);
    }
    get chunkVectors() { return this._chunkVectors; }
    get chunkOffsets() { return this._chunkOffsets; }
    get chunkData() {
        return this._chunkData || (this._chunkData = this._chunkVectors.map(({ data }) => data));
    }
    get nullCount() {
        let nullCount = this._nullCount;
        if (nullCount === -1) {
            this._nullCount = nullCount = this._chunkVectors.reduce((x, c) => x + c.nullCount, 0);
        }
        return nullCount;
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new ChunkedData(type, length, this._chunkVectors.map((vec) => vec.clone(vec.data.clone(type))), offset, nullCount, this._chunkOffsets);
    }
    sliceInternal(clone, offset, length) {
        const chunks = this._chunkVectors;
        const offsets = this._chunkOffsets;
        const chunkSlices = [];
        for (let childIndex = -1, numChildren = chunks.length; ++childIndex < numChildren;) {
            const child = chunks[childIndex];
            const childLength = child.length;
            const childOffset = offsets[childIndex];
            // If the child is to the right of the slice boundary, exclude
            if (childOffset >= offset + length) {
                continue;
            }
            // If the child is to the left of of the slice boundary, exclude
            if (offset >= childOffset + childLength) {
                continue;
            }
            // If the child is between both left and right boundaries, include w/o slicing
            if (childOffset >= offset && (childOffset + childLength) <= offset + length) {
                chunkSlices.push(child);
                continue;
            }
            // If the child overlaps one of the slice boundaries, include that slice
            const begin = Math.max(0, offset - childOffset);
            const end = begin + Math.min(childLength - begin, (offset + length) - childOffset);
            chunkSlices.push(child.slice(begin, end));
        }
        clone._chunkVectors = chunkSlices;
        clone._chunkOffsets = ChunkedData.computeOffsets(chunkSlices);
        return clone;
    }
    static computeOffsets(childVectors) {
        const childOffsets = new Uint32Array(childVectors.length + 1);
        for (let index = 0, length = childOffsets.length, childOffset = childOffsets[0] = 0; ++index < length;) {
            childOffsets[index] = (childOffset += childVectors[index - 1].length);
        }
        return childOffsets;
    }
}
exports.ChunkedData = ChunkedData;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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RyxDQUFDLENBQUMsQ0FBQztTQUM3QztRQUNELEtBQUssQ0FBQyxhQUFhLEdBQUcsV0FBVyxDQUFDO1FBQ2xDLEtBQUssQ0FBQyxhQUFhLEdBQUcsV0FBVyxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUM5RCxPQUFPLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBQ0QsTUFBTSxDQUFDLGNBQWMsQ0FBcUIsWUFBeUI7UUFDL0QsTUFBTSxZQUFZLEdBQUcsSUFBSSxXQUFXLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM5RCxLQUFLLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRSxNQUFNLEdBQUcsWUFBWSxDQUFDLE1BQU0sRUFBRSxXQUFXLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEtBQUssR0FBRyxNQUFNLEdBQUc7WUFDcEcsWUFBWSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsV0FBVyxJQUFJLFlBQVksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDekU7UUFDRCxPQUFPLFlBQVksQ0FBQztJQUN4QixDQUFDO0NBQ0o7QUEvREQsa0NBK0RDIiwiZmlsZSI6ImRhdGEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4vLyBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbi8vIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4vLyByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4vLyB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4vLyBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Vcbi8vIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbi8vIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4vLyBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuLy8gS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4vLyBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4vLyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgcG9wY250X2JpdF9yYW5nZSB9IGZyb20gJy4vdXRpbC9iaXQnO1xuaW1wb3J0IHsgVmVjdG9yTGlrZSwgVmVjdG9yIH0gZnJvbSAnLi92ZWN0b3InO1xuaW1wb3J0IHsgSW50LCBCb29sLCBGbGF0TGlzdFR5cGUsIExpc3QsIFN0cnVjdCwgTWFwXyB9IGZyb20gJy4vdHlwZSc7XG5pbXBvcnQgeyBWZWN0b3JUeXBlLCBUeXBlZEFycmF5LCBUeXBlZEFycmF5Q29uc3RydWN0b3IsIERpY3Rpb25hcnkgfSBmcm9tICcuL3R5cGUnO1xuaW1wb3J0IHsgRGF0YVR5cGUsIEZsYXRUeXBlLCBMaXN0VHlwZSwgTmVzdGVkVHlwZSwgU2luZ2xlTmVzdGVkVHlwZSwgRGVuc2VVbmlvbiwgU3BhcnNlVW5pb24gfSBmcm9tICcuL3R5cGUnO1xuXG5leHBvcnQgZnVuY3Rpb24gdG9UeXBlZEFycmF5PFQgZXh0ZW5kcyBUeXBlZEFycmF5PihBcnJheVR5cGU6IFR5cGVkQXJyYXlDb25zdHJ1Y3RvcjxUPiwgdmFsdWVzPzogVCB8IEFycmF5TGlrZTxudW1iZXI+IHwgSXRlcmFibGU8bnVtYmVyPiB8IG51bGwpOiBUIHtcbiAgICBpZiAoIUFycmF5VHlwZSAmJiBBcnJheUJ1ZmZlci5pc1ZpZXcodmFsdWVzKSkgeyByZXR1cm4gdmFsdWVzOyB9XG4gICAgcmV0dXJuIHZhbHVlcyBpbnN0YW5jZW9mIEFycmF5VHlwZSA/IHZhbHVlc1xuICAgICAgICAgOiAhdmFsdWVzIHx8ICFBcnJheUJ1ZmZlci5pc1ZpZXcodmFsdWVzKSA/IEFycmF5VHlwZS5mcm9tKHZhbHVlcyB8fCBbXSlcbiAgICAgICAgIDogbmV3IEFycmF5VHlwZSh2YWx1ZXMuYnVmZmVyLCB2YWx1ZXMuYnl0ZU9mZnNldCwgdmFsdWVzLmJ5dGVMZW5ndGggLyBBcnJheVR5cGUuQllURVNfUEVSX0VMRU1FTlQpO1xufVxuXG5leHBvcnQgdHlwZSBEYXRhPFQgZXh0ZW5kcyBEYXRhVHlwZT4gPSBEYXRhVHlwZXM8VD5bVFsnVFR5cGUnXV0gJiBCYXNlRGF0YTxUPjtcbmV4cG9ydCBpbnRlcmZhY2UgRGF0YVR5cGVzPFQgZXh0ZW5kcyBEYXRhVHlwZT4ge1xuLyogICAgICAgICAgICAgICAgW1R5cGUuTk9ORV0qLyAgMDogQmFzZURhdGE8VD47XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5OdWxsXSovICAxOiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgICBbVHlwZS5JbnRdKi8gIDI6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICAgICBbVHlwZS5GbG9hdF0qLyAgMzogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgW1R5cGUuQmluYXJ5XSovICA0OiBGbGF0TGlzdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5VdGY4XSovICA1OiBGbGF0TGlzdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5Cb29sXSovICA2OiBCb29sRGF0YTtcbi8qICAgICAgICAgICAgIFtUeXBlLkRlY2ltYWxdKi8gIDc6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgW1R5cGUuRGF0ZV0qLyAgODogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5UaW1lXSovICA5OiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICBbVHlwZS5UaW1lc3RhbXBdKi8gMTA6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICBbVHlwZS5JbnRlcnZhbF0qLyAxMTogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5MaXN0XSovIDEyOiBMaXN0RGF0YTxMaXN0PFQ+Pjtcbi8qICAgICAgICAgICAgICBbVHlwZS5TdHJ1Y3RdKi8gMTM6IE5lc3RlZERhdGE8U3RydWN0Pjtcbi8qICAgICAgICAgICAgICAgW1R5cGUuVW5pb25dKi8gMTQ6IFVuaW9uRGF0YTtcbi8qICAgICBbVHlwZS5GaXhlZFNpemVCaW5hcnldKi8gMTU6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgW1R5cGUuRml4ZWRTaXplTGlzdF0qLyAxNjogU2luZ2xlTmVzdGVkRGF0YTxhbnk+O1xuLyogICAgICAgICAgICAgICAgIFtUeXBlLk1hcF0qLyAxNzogTmVzdGVkRGF0YTxNYXBfPjtcbi8qICBbVHlwZS5EZW5zZVVuaW9uXSovIERlbnNlVW5pb246IERlbnNlVW5pb25EYXRhO1xuLypbVHlwZS5TcGFyc2VVbmlvbl0qLyBTcGFyc2VVbmlvbjogU3BhcnNlVW5pb25EYXRhO1xuLypbICBUeXBlLkRpY3Rpb25hcnldKi8gRGljdGlvbmFyeTogRGljdGlvbmFyeURhdGE8YW55Pjtcbn1cbi8vIFdoZW4gc2xpY2luZywgd2UgZG8gbm90IGtub3cgdGhlIG51bGwgY291bnQgb2YgdGhlIHNsaWNlZCByYW5nZSB3aXRob3V0XG4vLyBkb2luZyBzb21lIGNvbXB1dGF0aW9uLiBUbyBhdm9pZCBkb2luZyB0aGlzIGVhZ2VybHksIHdlIHNldCB0aGUgbnVsbCBjb3VudFxuLy8gdG8gLTEgKGFueSBuZWdhdGl2ZSBudW1iZXIgd2lsbCBkbykuIFdoZW4gQXJyYXk6Om51bGxfY291bnQgaXMgY2FsbGVkIHRoZVxuLy8gZmlyc3QgdGltZSwgdGhlIG51bGwgY291bnQgd2lsbCBiZSBjb21wdXRlZC4gU2VlIEFSUk9XLTMzXG5leHBvcnQgdHlwZSBrVW5rbm93bk51bGxDb3VudCA9IC0xO1xuZXhwb3J0IGNvbnN0IGtVbmtub3duTnVsbENvdW50ID0gLTE7XG5cbmV4cG9ydCBjbGFzcyBCYXNlRGF0YTxUIGV4dGVuZHMgRGF0YVR5cGUgPSBEYXRhVHlwZT4gaW1wbGVtZW50cyBWZWN0b3JMaWtlIHtcbiAgICBwdWJsaWMgdHlwZTogVDtcbiAgICBwdWJsaWMgbGVuZ3RoOiBudW1iZXI7XG4gICAgcHVibGljIG9mZnNldDogbnVtYmVyO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBwdWJsaWMgY2hpbGREYXRhOiBEYXRhPGFueT5bXTtcbiAgICBwcm90ZWN0ZWQgX251bGxDb3VudDogbnVtYmVyIHwga1Vua25vd25OdWxsQ291bnQ7XG4gICAgcHJvdGVjdGVkIC8qICBbVmVjdG9yVHlwZS5PRkZTRVRdOiovIDA/OiBJbnQzMkFycmF5O1xuICAgIHByb3RlY3RlZCAvKiAgICBbVmVjdG9yVHlwZS5EQVRBXToqLyAxPzogVFsnVEFycmF5J107XG4gICAgcHJvdGVjdGVkIC8qW1ZlY3RvclR5cGUuVkFMSURJVFldOiovIDI/OiBVaW50OEFycmF5O1xuICAgIHByb3RlY3RlZCAvKiAgICBbVmVjdG9yVHlwZS5UWVBFXToqLyAzPzogSW50OEFycmF5O1xuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IE1hdGguZmxvb3IoTWF0aC5tYXgobGVuZ3RoIHx8IDAsIDApKTtcbiAgICAgICAgdGhpcy5vZmZzZXQgPSBNYXRoLmZsb29yKE1hdGgubWF4KG9mZnNldCB8fCAwLCAwKSk7XG4gICAgICAgIHRoaXMuX251bGxDb3VudCA9IE1hdGguZmxvb3IoTWF0aC5tYXgobnVsbENvdW50IHx8IDAsIC0xKSk7XG4gICAgfVxuICAgIHB1YmxpYyBnZXQgdHlwZUlkKCkgeyByZXR1cm4gdGhpcy50eXBlLlRUeXBlOyB9XG4gICAgcHVibGljIGdldCBudWxsQml0bWFwKCkgeyByZXR1cm4gdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXTsgfVxuICAgIHB1YmxpYyBnZXQgbnVsbENvdW50KCkge1xuICAgICAgICBsZXQgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50O1xuICAgICAgICBsZXQgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKG51bGxDb3VudCA9PT0gLTEgJiYgKG51bGxCaXRtYXAgPSB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldKSkge1xuICAgICAgICAgICAgdGhpcy5fbnVsbENvdW50ID0gbnVsbENvdW50ID0gdGhpcy5sZW5ndGggLSBwb3BjbnRfYml0X3JhbmdlKG51bGxCaXRtYXAsIHRoaXMub2Zmc2V0LCB0aGlzLm9mZnNldCArIHRoaXMubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbENvdW50O1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBvZmZzZXQgPSB0aGlzLm9mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KTogRGF0YTxSPiB7XG4gICAgICAgIHJldHVybiBuZXcgQmFzZURhdGEodHlwZSwgbGVuZ3RoLCBvZmZzZXQsIG51bGxDb3VudCkgYXMgYW55O1xuICAgIH1cbiAgICBwdWJsaWMgc2xpY2Uob2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiBsZW5ndGggPD0gMCA/IHRoaXMgOiB0aGlzLnNsaWNlSW50ZXJuYWwodGhpcy5jbG9uZShcbiAgICAgICAgICAgIHRoaXMudHlwZSwgbGVuZ3RoLCB0aGlzLm9mZnNldCArIG9mZnNldCwgKyh0aGlzLl9udWxsQ291bnQgPT09IDApIC0gMVxuICAgICAgICApIGFzIGFueSwgb2Zmc2V0LCBsZW5ndGgpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VJbnRlcm5hbChjbG9uZTogdGhpcywgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIGxldCBhcnI6IGFueTtcbiAgICAgICAgLy8gSWYgdHlwZUlkcyBleGlzdCwgc2xpY2UgdGhlIHR5cGVJZHMgYnVmZmVyXG4gICAgICAgIChhcnIgPSB0aGlzW1ZlY3RvclR5cGUuVFlQRV0pICYmIChjbG9uZVtWZWN0b3JUeXBlLlRZUEVdID0gdGhpcy5zbGljZURhdGEoYXJyLCBvZmZzZXQsIGxlbmd0aCkpO1xuICAgICAgICAvLyBJZiBvZmZzZXRzIGV4aXN0LCBvbmx5IHNsaWNlIHRoZSBvZmZzZXRzIGJ1ZmZlclxuICAgICAgICAoYXJyID0gdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0pICYmIChjbG9uZVtWZWN0b3JUeXBlLk9GRlNFVF0gPSB0aGlzLnNsaWNlT2Zmc2V0cyhhcnIsIG9mZnNldCwgbGVuZ3RoKSkgfHxcbiAgICAgICAgICAgIC8vIE90aGVyd2lzZSBpZiBubyBvZmZzZXRzLCBzbGljZSB0aGUgZGF0YSBidWZmZXJcbiAgICAgICAgICAgIChhcnIgPSB0aGlzW1ZlY3RvclR5cGUuREFUQV0pICYmIChjbG9uZVtWZWN0b3JUeXBlLkRBVEFdID0gdGhpcy5zbGljZURhdGEoYXJyLCBvZmZzZXQsIGxlbmd0aCkpO1xuICAgICAgICByZXR1cm4gY2xvbmU7XG4gICAgfVxuICAgIHByb3RlY3RlZCBzbGljZURhdGEoZGF0YTogVFsnVEFycmF5J10gJiBUeXBlZEFycmF5LCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VPZmZzZXRzKHZhbHVlT2Zmc2V0czogSW50MzJBcnJheSwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZU9mZnNldHMuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGggKyAxKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBGbGF0RGF0YTxUIGV4dGVuZHMgRmxhdFR5cGU+IGV4dGVuZHMgQmFzZURhdGE8VD4ge1xuICAgIHB1YmxpYyAvKiAgICBbVmVjdG9yVHlwZS5EQVRBXToqLyAxOiBUWydUQXJyYXknXTtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlcygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5EQVRBXTsgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgZGF0YTogSXRlcmFibGU8bnVtYmVyPiwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5EQVRBXSA9IHRvVHlwZWRBcnJheSh0aGlzLkFycmF5VHlwZSwgZGF0YSk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0gPSB0b1R5cGVkQXJyYXkoVWludDhBcnJheSwgbnVsbEJpdG1hcCk7XG4gICAgfVxuICAgIHB1YmxpYyBnZXQgQXJyYXlUeXBlKCk6IFRbJ0FycmF5VHlwZSddIHsgcmV0dXJuIHRoaXMudHlwZS5BcnJheVR5cGU7IH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBvZmZzZXQgPSB0aGlzLm9mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgKHRoaXMuY29uc3RydWN0b3IgYXMgYW55KSh0eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXNbVmVjdG9yVHlwZS5EQVRBXSwgb2Zmc2V0LCBudWxsQ291bnQpIGFzIEZsYXREYXRhPFI+O1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEJvb2xEYXRhIGV4dGVuZHMgRmxhdERhdGE8Qm9vbD4ge1xuICAgIHByb3RlY3RlZCBzbGljZURhdGEoZGF0YTogVWludDhBcnJheSkgeyByZXR1cm4gZGF0YTsgfVxufVxuXG5leHBvcnQgY2xhc3MgRmxhdExpc3REYXRhPFQgZXh0ZW5kcyBGbGF0TGlzdFR5cGU+IGV4dGVuZHMgRmxhdERhdGE8VD4ge1xuICAgIHB1YmxpYyAvKiAgW1ZlY3RvclR5cGUuT0ZGU0VUXToqLyAwOiBJbnQzMkFycmF5O1xuICAgIHB1YmxpYyAvKiAgICBbVmVjdG9yVHlwZS5EQVRBXToqLyAxOiBUWydUQXJyYXknXTtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlcygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5EQVRBXTsgfVxuICAgIHB1YmxpYyBnZXQgdmFsdWVPZmZzZXRzKCkgeyByZXR1cm4gdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF07IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHZhbHVlT2Zmc2V0czogSXRlcmFibGU8bnVtYmVyPiwgZGF0YTogVFsnVEFycmF5J10sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgbnVsbEJpdG1hcCwgZGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSA9IHRvVHlwZWRBcnJheShJbnQzMkFycmF5LCB2YWx1ZU9mZnNldHMpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBvZmZzZXQgPSB0aGlzLm9mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgRmxhdExpc3REYXRhKHR5cGUsIGxlbmd0aCwgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSwgdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0sIHRoaXNbVmVjdG9yVHlwZS5EQVRBXSwgb2Zmc2V0LCBudWxsQ291bnQpIGFzIEZsYXRMaXN0RGF0YTxSPjtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBEaWN0aW9uYXJ5RGF0YTxUIGV4dGVuZHMgRGF0YVR5cGU+IGV4dGVuZHMgQmFzZURhdGE8RGljdGlvbmFyeTxUPj4ge1xuICAgIHByb3RlY3RlZCBfZGljdGlvbmFyeTogVmVjdG9yPFQ+O1xuICAgIHByb3RlY3RlZCBfaW5kaWNlczogRGF0YTxJbnQ8YW55Pj47XG4gICAgcHVibGljIGdldCBpbmRpY2VzKCkgeyByZXR1cm4gdGhpcy5faW5kaWNlczsgfVxuICAgIHB1YmxpYyBnZXQgZGljdGlvbmFyeSgpIHsgcmV0dXJuIHRoaXMuX2RpY3Rpb25hcnk7IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBEaWN0aW9uYXJ5PFQ+LCBkaWN0aW9uYXJ5OiBWZWN0b3I8VD4sIGluZGljZXM6IERhdGE8SW50PGFueT4+KSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGluZGljZXMubGVuZ3RoLCBpbmRpY2VzLm9mZnNldCwgKGluZGljZXMgYXMgYW55KS5fbnVsbENvdW50KTtcbiAgICAgICAgdGhpcy5faW5kaWNlcyA9IGluZGljZXM7XG4gICAgICAgIHRoaXMuX2RpY3Rpb25hcnkgPSBkaWN0aW9uYXJ5O1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IG51bGxDb3VudCgpIHsgcmV0dXJuIHRoaXMuX2luZGljZXMubnVsbENvdW50OyB9XG4gICAgcHVibGljIGdldCBudWxsQml0bWFwKCkgeyByZXR1cm4gdGhpcy5faW5kaWNlcy5udWxsQml0bWFwOyB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBEaWN0aW9uYXJ5PFQ+Pih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLmxlbmd0aCwgb2Zmc2V0ID0gdGhpcy5vZmZzZXQpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuX2RpY3Rpb25hcnkuZGF0YS5jbG9uZSh0eXBlLmRpY3Rpb25hcnkgYXMgYW55KTtcbiAgICAgICAgcmV0dXJuIG5ldyBEaWN0aW9uYXJ5RGF0YTxSPihcbiAgICAgICAgICAgIHRoaXMudHlwZSBhcyBhbnksXG4gICAgICAgICAgICB0aGlzLl9kaWN0aW9uYXJ5LmNsb25lKGRhdGEpIGFzIGFueSxcbiAgICAgICAgICAgIHRoaXMuX2luZGljZXMuc2xpY2Uob2Zmc2V0IC0gdGhpcy5vZmZzZXQsIGxlbmd0aClcbiAgICAgICAgKSBhcyBhbnk7XG4gICAgfVxuICAgIHByb3RlY3RlZCBzbGljZUludGVybmFsKGNsb25lOiB0aGlzLCBfb2Zmc2V0OiBudW1iZXIsIF9sZW5ndGg6IG51bWJlcikge1xuICAgICAgICBjbG9uZS5sZW5ndGggPSBjbG9uZS5faW5kaWNlcy5sZW5ndGg7XG4gICAgICAgIGNsb25lLl9udWxsQ291bnQgPSAoY2xvbmUuX2luZGljZXMgYXMgYW55KS5fbnVsbENvdW50O1xuICAgICAgICByZXR1cm4gY2xvbmU7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgTmVzdGVkRGF0YTxUIGV4dGVuZHMgTmVzdGVkVHlwZSA9IE5lc3RlZFR5cGU+IGV4dGVuZHMgQmFzZURhdGE8VD4ge1xuICAgIHB1YmxpYyAvKltWZWN0b3JUeXBlLlZBTElESVRZXToqLyAyOiBVaW50OEFycmF5O1xuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgY2hpbGREYXRhOiBEYXRhPGFueT5bXSwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXMuY2hpbGREYXRhID0gY2hpbGREYXRhO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldID0gdG9UeXBlZEFycmF5KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBvZmZzZXQgPSB0aGlzLm9mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KTogRGF0YTxSPiB7XG4gICAgICAgIHJldHVybiBuZXcgTmVzdGVkRGF0YTxSPih0eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXMuY2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCkgYXMgYW55O1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VJbnRlcm5hbChjbG9uZTogdGhpcywgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIGlmICghdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0pIHtcbiAgICAgICAgICAgIGNsb25lLmNoaWxkRGF0YSA9IHRoaXMuY2hpbGREYXRhLm1hcCgoY2hpbGQpID0+IGNoaWxkLnNsaWNlKG9mZnNldCwgbGVuZ3RoKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1cGVyLnNsaWNlSW50ZXJuYWwoY2xvbmUsIG9mZnNldCwgbGVuZ3RoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTaW5nbGVOZXN0ZWREYXRhPFQgZXh0ZW5kcyBTaW5nbGVOZXN0ZWRUeXBlPiBleHRlbmRzIE5lc3RlZERhdGE8VD4ge1xuICAgIHByb3RlY3RlZCBfdmFsdWVzRGF0YTogRGF0YTxUPjtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlcygpIHsgcmV0dXJuIHRoaXMuX3ZhbHVlc0RhdGE7IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHZhbHVlQ2hpbGREYXRhOiBEYXRhPFQ+LCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIFt2YWx1ZUNoaWxkRGF0YV0sIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpcy5fdmFsdWVzRGF0YSA9IHZhbHVlQ2hpbGREYXRhO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIExpc3REYXRhPFQgZXh0ZW5kcyBMaXN0VHlwZT4gZXh0ZW5kcyBTaW5nbGVOZXN0ZWREYXRhPFQ+IHtcbiAgICBwdWJsaWMgLyogIFtWZWN0b3JUeXBlLk9GRlNFVF06Ki8gMDogSW50MzJBcnJheTtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlT2Zmc2V0cygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdOyB9XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCB2YWx1ZU9mZnNldHM6IEl0ZXJhYmxlPG51bWJlcj4sIHZhbHVlQ2hpbGREYXRhOiBEYXRhPFQ+LCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIHZhbHVlQ2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdID0gdG9UeXBlZEFycmF5KEludDMyQXJyYXksIHZhbHVlT2Zmc2V0cyk7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgVD4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5sZW5ndGgsIG9mZnNldCA9IHRoaXMub2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpOiBEYXRhPFI+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBMaXN0RGF0YSh0eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdLCB0aGlzLl92YWx1ZXNEYXRhIGFzIGFueSwgb2Zmc2V0LCBudWxsQ291bnQpIGFzIGFueTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBVbmlvbkRhdGE8VCBleHRlbmRzIChEZW5zZVVuaW9uIHwgU3BhcnNlVW5pb24pID0gYW55PiBleHRlbmRzIE5lc3RlZERhdGE8VD4ge1xuICAgIHB1YmxpYyAvKiAgICBbVmVjdG9yVHlwZS5UWVBFXToqLyAzOiBUWydUQXJyYXknXTtcbiAgICBwdWJsaWMgZ2V0IHR5cGVJZHMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuVFlQRV07IH1cbiAgICBwdWJsaWMgcmVhZG9ubHkgdHlwZUlkVG9DaGlsZEluZGV4OiB7IFtrZXk6IG51bWJlcl06IG51bWJlciB9O1xuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgdHlwZUlkczogSXRlcmFibGU8bnVtYmVyPiwgY2hpbGREYXRhOiBEYXRhPGFueT5bXSwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBudWxsQml0bWFwLCBjaGlsZERhdGEsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpc1tWZWN0b3JUeXBlLlRZUEVdID0gdG9UeXBlZEFycmF5KEludDhBcnJheSwgdHlwZUlkcyk7XG4gICAgICAgIHRoaXMudHlwZUlkVG9DaGlsZEluZGV4ID0gdHlwZS50eXBlSWRzLnJlZHVjZSgodHlwZUlkVG9DaGlsZEluZGV4LCB0eXBlSWQsIGlkeCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuICh0eXBlSWRUb0NoaWxkSW5kZXhbdHlwZUlkXSA9IGlkeCkgJiYgdHlwZUlkVG9DaGlsZEluZGV4IHx8IHR5cGVJZFRvQ2hpbGRJbmRleDtcbiAgICAgICAgfSwgT2JqZWN0LmNyZWF0ZShudWxsKSBhcyB7IFtrZXk6IG51bWJlcl06IG51bWJlciB9KTtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBUPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLmxlbmd0aCwgb2Zmc2V0ID0gdGhpcy5vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCk6IERhdGE8Uj4ge1xuICAgICAgICByZXR1cm4gbmV3IFVuaW9uRGF0YTxSPih0eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXNbVmVjdG9yVHlwZS5UWVBFXSwgdGhpcy5jaGlsZERhdGEsIG9mZnNldCwgbnVsbENvdW50KSBhcyBhbnk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgU3BhcnNlVW5pb25EYXRhIGV4dGVuZHMgVW5pb25EYXRhPFNwYXJzZVVuaW9uPiB7XG4gICAgY29uc3RydWN0b3IodHlwZTogU3BhcnNlVW5pb24sIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgdHlwZUlkczogSXRlcmFibGU8bnVtYmVyPiwgY2hpbGREYXRhOiBEYXRhPGFueT5bXSwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBudWxsQml0bWFwLCB0eXBlSWRzLCBjaGlsZERhdGEsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBTcGFyc2VVbmlvbj4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5sZW5ndGgsIG9mZnNldCA9IHRoaXMub2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpOiBEYXRhPFI+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBTcGFyc2VVbmlvbkRhdGEoXG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgbGVuZ3RoLFxuICAgICAgICAgICAgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSxcbiAgICAgICAgICAgIHRoaXNbVmVjdG9yVHlwZS5UWVBFXSxcbiAgICAgICAgICAgIHRoaXMuY2hpbGREYXRhLFxuICAgICAgICAgICAgb2Zmc2V0LCBudWxsQ291bnRcbiAgICAgICAgKSBhcyBhbnk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGVuc2VVbmlvbkRhdGEgZXh0ZW5kcyBVbmlvbkRhdGE8RGVuc2VVbmlvbj4ge1xuICAgIHB1YmxpYyAvKiAgW1ZlY3RvclR5cGUuT0ZGU0VUXToqLyAwOiBJbnQzMkFycmF5O1xuICAgIHB1YmxpYyBnZXQgdmFsdWVPZmZzZXRzKCkgeyByZXR1cm4gdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF07IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBEZW5zZVVuaW9uLCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHR5cGVJZHM6IEl0ZXJhYmxlPG51bWJlcj4sIHZhbHVlT2Zmc2V0czogSXRlcmFibGU8bnVtYmVyPiwgY2hpbGREYXRhOiBEYXRhPGFueT5bXSwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBudWxsQml0bWFwLCB0eXBlSWRzLCBjaGlsZERhdGEsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0gPSB0b1R5cGVkQXJyYXkoSW50MzJBcnJheSwgdmFsdWVPZmZzZXRzKTtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBEZW5zZVVuaW9uPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLmxlbmd0aCwgb2Zmc2V0ID0gdGhpcy5vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCk6IERhdGE8Uj4ge1xuICAgICAgICByZXR1cm4gbmV3IERlbnNlVW5pb25EYXRhKFxuICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgIGxlbmd0aCxcbiAgICAgICAgICAgIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sXG4gICAgICAgICAgICB0aGlzW1ZlY3RvclR5cGUuVFlQRV0sXG4gICAgICAgICAgICB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSxcbiAgICAgICAgICAgIHRoaXMuY2hpbGREYXRhLFxuICAgICAgICAgICAgb2Zmc2V0LCBudWxsQ291bnRcbiAgICAgICAgKSBhcyBhbnk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ2h1bmtlZERhdGE8VCBleHRlbmRzIERhdGFUeXBlPiBleHRlbmRzIEJhc2VEYXRhPFQ+IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHJvdGVjdGVkIF9jaHVua0RhdGE6IERhdGE8VD5bXTtcbiAgICBwcm90ZWN0ZWQgX2NodW5rVmVjdG9yczogVmVjdG9yPFQ+W107XG4gICAgcHJvdGVjdGVkIF9jaHVua09mZnNldHM6IFVpbnQzMkFycmF5O1xuICAgIHB1YmxpYyBnZXQgY2h1bmtWZWN0b3JzKCkgeyByZXR1cm4gdGhpcy5fY2h1bmtWZWN0b3JzOyB9XG4gICAgcHVibGljIGdldCBjaHVua09mZnNldHMoKSB7IHJldHVybiB0aGlzLl9jaHVua09mZnNldHM7IH1cbiAgICBwdWJsaWMgZ2V0IGNodW5rRGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NodW5rRGF0YSB8fCAoXG4gICAgICAgICAgICAgICB0aGlzLl9jaHVua0RhdGEgPSB0aGlzLl9jaHVua1ZlY3RvcnMubWFwKCh7IGRhdGEgfSkgPT4gZGF0YSkpO1xuICAgIH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgY2h1bmtWZWN0b3JzOiBWZWN0b3I8VD5bXSwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIsIGNodW5rT2Zmc2V0cz86IFVpbnQzMkFycmF5KSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzLl9jaHVua1ZlY3RvcnMgPSBjaHVua1ZlY3RvcnM7XG4gICAgICAgIHRoaXMuX2NodW5rT2Zmc2V0cyA9IGNodW5rT2Zmc2V0cyB8fCBDaHVua2VkRGF0YS5jb21wdXRlT2Zmc2V0cyhjaHVua1ZlY3RvcnMpO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IG51bGxDb3VudCgpIHtcbiAgICAgICAgbGV0IG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudDtcbiAgICAgICAgaWYgKG51bGxDb3VudCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuX251bGxDb3VudCA9IG51bGxDb3VudCA9IHRoaXMuX2NodW5rVmVjdG9ycy5yZWR1Y2UoKHgsIGMpID0+IHggKyBjLm51bGxDb3VudCwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGxDb3VudDtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBUPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLmxlbmd0aCwgb2Zmc2V0ID0gdGhpcy5vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCk6IERhdGE8Uj4ge1xuICAgICAgICByZXR1cm4gbmV3IENodW5rZWREYXRhKFxuICAgICAgICAgICAgdHlwZSwgbGVuZ3RoLFxuICAgICAgICAgICAgdGhpcy5fY2h1bmtWZWN0b3JzLm1hcCgodmVjKSA9PiB2ZWMuY2xvbmUodmVjLmRhdGEuY2xvbmUodHlwZSkpKSBhcyBhbnksXG4gICAgICAgICAgICBvZmZzZXQsIG51bGxDb3VudCwgdGhpcy5fY2h1bmtPZmZzZXRzXG4gICAgICAgICkgYXMgYW55O1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VJbnRlcm5hbChjbG9uZTogdGhpcywgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IGNodW5rcyA9IHRoaXMuX2NodW5rVmVjdG9ycztcbiAgICAgICAgY29uc3Qgb2Zmc2V0cyA9IHRoaXMuX2NodW5rT2Zmc2V0cztcbiAgICAgICAgY29uc3QgY2h1bmtTbGljZXM6IFZlY3RvcjxUPltdID0gW107XG4gICAgICAgIGZvciAobGV0IGNoaWxkSW5kZXggPSAtMSwgbnVtQ2hpbGRyZW4gPSBjaHVua3MubGVuZ3RoOyArK2NoaWxkSW5kZXggPCBudW1DaGlsZHJlbjspIHtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gY2h1bmtzW2NoaWxkSW5kZXhdO1xuICAgICAgICAgICAgY29uc3QgY2hpbGRMZW5ndGggPSBjaGlsZC5sZW5ndGg7XG4gICAgICAgICAgICBjb25zdCBjaGlsZE9mZnNldCA9IG9mZnNldHNbY2hpbGRJbmRleF07XG4gICAgICAgICAgICAvLyBJZiB0aGUgY2hpbGQgaXMgdG8gdGhlIHJpZ2h0IG9mIHRoZSBzbGljZSBib3VuZGFyeSwgZXhjbHVkZVxuICAgICAgICAgICAgaWYgKGNoaWxkT2Zmc2V0ID49IG9mZnNldCArIGxlbmd0aCkgeyBjb250aW51ZTsgfVxuICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkIGlzIHRvIHRoZSBsZWZ0IG9mIG9mIHRoZSBzbGljZSBib3VuZGFyeSwgZXhjbHVkZVxuICAgICAgICAgICAgaWYgKG9mZnNldCA+PSBjaGlsZE9mZnNldCArIGNoaWxkTGVuZ3RoKSB7IGNvbnRpbnVlOyB9XG4gICAgICAgICAgICAvLyBJZiB0aGUgY2hpbGQgaXMgYmV0d2VlbiBib3RoIGxlZnQgYW5kIHJpZ2h0IGJvdW5kYXJpZXMsIGluY2x1ZGUgdy9vIHNsaWNpbmdcbiAgICAgICAgICAgIGlmIChjaGlsZE9mZnNldCA+PSBvZmZzZXQgJiYgKGNoaWxkT2Zmc2V0ICsgY2hpbGRMZW5ndGgpIDw9IG9mZnNldCArIGxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNodW5rU2xpY2VzLnB1c2goY2hpbGQpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkIG92ZXJsYXBzIG9uZSBvZiB0aGUgc2xpY2UgYm91bmRhcmllcywgaW5jbHVkZSB0aGF0IHNsaWNlXG4gICAgICAgICAgICBjb25zdCBiZWdpbiA9IE1hdGgubWF4KDAsIG9mZnNldCAtIGNoaWxkT2Zmc2V0KTtcbiAgICAgICAgICAgIGNvbnN0IGVuZCA9IGJlZ2luICsgTWF0aC5taW4oY2hpbGRMZW5ndGggLSBiZWdpbiwgKG9mZnNldCArIGxlbmd0aCkgLSBjaGlsZE9mZnNldCk7XG4gICAgICAgICAgICBjaHVua1NsaWNlcy5wdXNoKGNoaWxkLnNsaWNlKGJlZ2luLCBlbmQpKTtcbiAgICAgICAgfVxuICAgICAgICBjbG9uZS5fY2h1bmtWZWN0b3JzID0gY2h1bmtTbGljZXM7XG4gICAgICAgIGNsb25lLl9jaHVua09mZnNldHMgPSBDaHVua2VkRGF0YS5jb21wdXRlT2Zmc2V0cyhjaHVua1NsaWNlcyk7XG4gICAgICAgIHJldHVybiBjbG9uZTtcbiAgICB9XG4gICAgc3RhdGljIGNvbXB1dGVPZmZzZXRzPFQgZXh0ZW5kcyBEYXRhVHlwZT4oY2hpbGRWZWN0b3JzOiBWZWN0b3I8VD5bXSkge1xuICAgICAgICBjb25zdCBjaGlsZE9mZnNldHMgPSBuZXcgVWludDMyQXJyYXkoY2hpbGRWZWN0b3JzLmxlbmd0aCArIDEpO1xuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDAsIGxlbmd0aCA9IGNoaWxkT2Zmc2V0cy5sZW5ndGgsIGNoaWxkT2Zmc2V0ID0gY2hpbGRPZmZzZXRzWzBdID0gMDsgKytpbmRleCA8IGxlbmd0aDspIHtcbiAgICAgICAgICAgIGNoaWxkT2Zmc2V0c1tpbmRleF0gPSAoY2hpbGRPZmZzZXQgKz0gY2hpbGRWZWN0b3JzW2luZGV4IC0gMV0ubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hpbGRPZmZzZXRzO1xuICAgIH1cbn1cbiJdfQ==
