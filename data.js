"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const bit_1 = require("./util/bit");
const buffer_1 = require("./util/buffer");
const enum_1 = require("./enum");
exports.kUnknownNullCount = -1;
class Data {
    constructor(type, offset, length, nullCount, buffers, childData) {
        this._buffers = [];
        this._type = type;
        this._offset = Math.floor(Math.max(offset || 0, 0));
        this._length = Math.floor(Math.max(length || 0, 0));
        this._buffers = Object.assign([], buffers);
        this._nullCount = Math.floor(Math.max(nullCount || 0, -1));
        this._childData = (childData || []).map((x) => x instanceof Data ? x : x.data);
    }
    get type() { return this._type; }
    get length() { return this._length; }
    get offset() { return this._offset; }
    get childData() { return this._childData; }
    get TType() { return this.type.TType; }
    get TArray() { return this.type.TArray; }
    get TValue() { return this.type.TValue; }
    get ArrayType() { return this.type.ArrayType; }
    get values() { return this._buffers[enum_1.VectorType.DATA]; }
    get typeIds() { return this._buffers[enum_1.VectorType.TYPE]; }
    get nullBitmap() { return this._buffers[enum_1.VectorType.VALIDITY]; }
    get valueOffsets() { return this._buffers[enum_1.VectorType.OFFSET]; }
    get nullCount() {
        let nullCount = this._nullCount;
        let nullBitmap;
        if (nullCount === exports.kUnknownNullCount && (nullBitmap = this.nullBitmap)) {
            this._nullCount = nullCount = this.length - bit_1.popcnt_bit_range(nullBitmap, this.offset, this.offset + this.length);
        }
        return nullCount;
    }
    clone(type, offset = this.offset, length = this.length, nullCount = this._nullCount, buffers = this._buffers, childData = this.childData) {
        return new Data(type, offset, length, nullCount, buffers, childData);
    }
    slice(offset, length) {
        // +true === 1, +false === 0, so this means
        // we keep nullCount at 0 if it's already 0,
        // otherwise set to the invalidated flag -1
        const nullCount = +(this._nullCount === 0) - 1;
        const buffers = this.sliceBuffers(offset, length);
        const childData = this.sliceChildren(offset, length);
        return this.clone(this.type, this.offset + offset, length, nullCount, buffers, childData);
    }
    sliceBuffers(offset, length) {
        let arr, buffers = Object.assign([], this._buffers);
        // If typeIds exist, slice the typeIds buffer
        (arr = buffers[enum_1.VectorType.TYPE]) && (buffers[enum_1.VectorType.TYPE] = this.sliceData(arr, offset, length));
        // If offsets exist, only slice the offsets buffer
        (arr = buffers[enum_1.VectorType.OFFSET]) && (buffers[enum_1.VectorType.OFFSET] = this.sliceOffsets(arr, offset, length)) ||
            // Otherwise if no offsets, slice the data buffer
            (arr = buffers[enum_1.VectorType.DATA]) && (buffers[enum_1.VectorType.DATA] = this.sliceData(arr, offset, length));
        return buffers;
    }
    sliceChildren(offset, length) {
        // Only slice children if this isn't variable width data
        if (!this.valueOffsets) {
            return this.childData.map((child) => child.slice(offset, length));
        }
        return this.childData;
    }
    sliceData(data, offset, length) {
        // Don't slice the data vector for Booleans, since the offset goes by bits not bytes
        return this.type.TType === enum_1.Type.Bool ? data : data.subarray(offset, offset + length);
    }
    sliceOffsets(valueOffsets, offset, length) {
        return valueOffsets.subarray(offset, offset + length + 1);
    }
    //
    // Convenience methods for creating Data instances for each of the Arrow Vector types
    //
    /** @nocollapse */
    static Null(type, offset, length, nullCount, nullBitmap) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap)
        });
    }
    /** @nocollapse */
    static Int(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Dictionary(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.indices.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Float(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Bool(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Decimal(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Date(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Time(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Timestamp(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Interval(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static FixedSizeBinary(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Binary(type, offset, length, nullCount, nullBitmap, valueOffsets, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.OFFSET]: buffer_1.toArrayBufferView(Int32Array, valueOffsets),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(Uint8Array, data)
        });
    }
    /** @nocollapse */
    static Utf8(type, offset, length, nullCount, nullBitmap, valueOffsets, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.OFFSET]: buffer_1.toArrayBufferView(Int32Array, valueOffsets),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(Uint8Array, data)
        });
    }
    /** @nocollapse */
    static List(type, offset, length, nullCount, nullBitmap, valueOffsets, childData) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.OFFSET]: buffer_1.toArrayBufferView(Int32Array, valueOffsets)
        }, childData);
    }
    /** @nocollapse */
    static FixedSizeList(type, offset, length, nullCount, nullBitmap, childData) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap)
        }, childData);
    }
    /** @nocollapse */
    static Struct(type, offset, length, nullCount, nullBitmap, childData) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap)
        }, childData);
    }
    /** @nocollapse */
    static Map(type, offset, length, nullCount, nullBitmap, childData) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap)
        }, childData);
    }
    /** @nocollapse */
    static Union(type, offset, length, nullCount, nullBitmap, typeIds, valueOffsetsOrChildData, childData) {
        const buffers = {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.TYPE]: buffer_1.toArrayBufferView(type.ArrayType, typeIds)
        };
        if (type.mode === enum_1.UnionMode.Sparse) {
            return new Data(type, offset, length, nullCount, buffers, valueOffsetsOrChildData);
        }
        buffers[enum_1.VectorType.OFFSET] = buffer_1.toArrayBufferView(Int32Array, valueOffsetsOrChildData);
        return new Data(type, offset, length, nullCount, buffers, childData);
    }
}
exports.Data = Data;
// (Data as any).prototype._type = Object.freeze({});
// (Data as any).prototype._buffers = Object.freeze([]);

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LGlCQUFVLENBQUMsUUFBUSxDQUFDLEVBQUUsMEJBQWlCLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQztZQUNoRSxDQUFDLGlCQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsMEJBQWlCLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUM7U0FDekQsQ0FBQztRQUNULElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxnQkFBUyxDQUFDLE1BQU0sRUFBRTtZQUNoQyxPQUFPLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsdUJBQTRDLENBQUMsQ0FBQztTQUMzRztRQUNELE9BQU8sQ0FBQyxpQkFBVSxDQUFDLE1BQU0sQ0FBQyxHQUFHLDBCQUFpQixDQUFDLFVBQVUsRUFBdUIsdUJBQXVCLENBQUMsQ0FBQztRQUN6RyxPQUFPLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDekUsQ0FBQztDQUNKO0FBek5ELG9CQXlOQztBQUVELHFEQUFxRDtBQUNyRCx3REFBd0QiLCJmaWxlIjoiZGF0YS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBEYXRhVHlwZSB9IGZyb20gJy4vdHlwZSc7XG5pbXBvcnQgeyBWZWN0b3IgfSBmcm9tICcuL3ZlY3Rvcic7XG5pbXBvcnQgeyBwb3BjbnRfYml0X3JhbmdlIH0gZnJvbSAnLi91dGlsL2JpdCc7XG5pbXBvcnQgeyB0b0FycmF5QnVmZmVyVmlldyB9IGZyb20gJy4vdXRpbC9idWZmZXInO1xuaW1wb3J0IHsgVHlwZSwgVmVjdG9yVHlwZSBhcyBCdWZmZXJUeXBlLCBVbmlvbk1vZGUgfSBmcm9tICcuL2VudW0nO1xuaW1wb3J0IHtcbiAgICBEaWN0aW9uYXJ5LFxuICAgIE51bGwsIEludCwgRmxvYXQsXG4gICAgQmluYXJ5LCBCb29sLCBVdGY4LCBEZWNpbWFsLFxuICAgIERhdGVfLCBUaW1lLCBUaW1lc3RhbXAsIEludGVydmFsLFxuICAgIExpc3QsIFN0cnVjdCwgVW5pb24sIEZpeGVkU2l6ZUJpbmFyeSwgRml4ZWRTaXplTGlzdCwgTWFwXyxcbn0gZnJvbSAnLi90eXBlJztcblxuLy8gV2hlbiBzbGljaW5nLCB3ZSBkbyBub3Qga25vdyB0aGUgbnVsbCBjb3VudCBvZiB0aGUgc2xpY2VkIHJhbmdlIHdpdGhvdXRcbi8vIGRvaW5nIHNvbWUgY29tcHV0YXRpb24uIFRvIGF2b2lkIGRvaW5nIHRoaXMgZWFnZXJseSwgd2Ugc2V0IHRoZSBudWxsIGNvdW50XG4vLyB0byAtMSAoYW55IG5lZ2F0aXZlIG51bWJlciB3aWxsIGRvKS4gV2hlbiBBcnJheTo6bnVsbF9jb3VudCBpcyBjYWxsZWQgdGhlXG4vLyBmaXJzdCB0aW1lLCB0aGUgbnVsbCBjb3VudCB3aWxsIGJlIGNvbXB1dGVkLiBTZWUgQVJST1ctMzNcbmV4cG9ydCB0eXBlIGtVbmtub3duTnVsbENvdW50ID0gLTE7XG5leHBvcnQgY29uc3Qga1Vua25vd25OdWxsQ291bnQgPSAtMTtcblxuZXhwb3J0IHR5cGUgTnVsbEJ1ZmZlciA9IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkO1xuZXhwb3J0IHR5cGUgVmFsdWVPZmZzZXRzQnVmZmVyID0gSW50MzJBcnJheSAgfCBBcnJheUxpa2U8bnVtYmVyPiB8IEl0ZXJhYmxlPG51bWJlcj47XG5leHBvcnQgdHlwZSBEYXRhQnVmZmVyPFQgZXh0ZW5kcyBEYXRhVHlwZT4gPSBUWydUQXJyYXknXSB8IEFycmF5TGlrZTxudW1iZXI+IHwgSXRlcmFibGU8bnVtYmVyPjtcblxuZXhwb3J0IGludGVyZmFjZSBCdWZmZXJzPFQgZXh0ZW5kcyBEYXRhVHlwZT4ge1xuICAgICAgW0J1ZmZlclR5cGUuT0ZGU0VUXT86IEludDMyQXJyYXk7XG4gICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdPzogVFsnVEFycmF5J107XG4gICAgW0J1ZmZlclR5cGUuVkFMSURJVFldPzogVWludDhBcnJheTtcbiAgICAgICAgW0J1ZmZlclR5cGUuVFlQRV0/OiBUWydUQXJyYXknXTtcbn1cblxuZXhwb3J0IGNsYXNzIERhdGE8VCBleHRlbmRzIERhdGFUeXBlID0gRGF0YVR5cGU+IHtcblxuICAgIHByb3RlY3RlZCBfdHlwZTogVDtcbiAgICBwcm90ZWN0ZWQgX2xlbmd0aDogbnVtYmVyO1xuICAgIHByb3RlY3RlZCBfb2Zmc2V0OiBudW1iZXI7XG5cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHJvdGVjdGVkIF9jaGlsZERhdGE6IERhdGFbXTtcbiAgICBwcm90ZWN0ZWQgX2J1ZmZlcnMgPSBbXSBhcyBCdWZmZXJzPFQ+O1xuICAgIHByb3RlY3RlZCBfbnVsbENvdW50OiBudW1iZXIgfCBrVW5rbm93bk51bGxDb3VudDtcblxuICAgIHB1YmxpYyBnZXQgdHlwZSgpIHsgcmV0dXJuIHRoaXMuX3R5cGU7IH1cbiAgICBwdWJsaWMgZ2V0IGxlbmd0aCgpIHsgcmV0dXJuIHRoaXMuX2xlbmd0aDsgfVxuICAgIHB1YmxpYyBnZXQgb2Zmc2V0KCkgeyByZXR1cm4gdGhpcy5fb2Zmc2V0OyB9XG4gICAgcHVibGljIGdldCBjaGlsZERhdGEoKSB7IHJldHVybiB0aGlzLl9jaGlsZERhdGE7IH1cblxuICAgIHB1YmxpYyBnZXQgVFR5cGUoKSB7IHJldHVybiB0aGlzLnR5cGUuVFR5cGU7IH1cbiAgICBwdWJsaWMgZ2V0IFRBcnJheSgpIHsgcmV0dXJuIHRoaXMudHlwZS5UQXJyYXk7IH1cbiAgICBwdWJsaWMgZ2V0IFRWYWx1ZSgpIHsgcmV0dXJuIHRoaXMudHlwZS5UVmFsdWU7IH1cbiAgICBwdWJsaWMgZ2V0IEFycmF5VHlwZSgpIHsgcmV0dXJuIHRoaXMudHlwZS5BcnJheVR5cGU7IH1cblxuICAgIHB1YmxpYyBnZXQgdmFsdWVzKCkgeyByZXR1cm4gdGhpcy5fYnVmZmVyc1tCdWZmZXJUeXBlLkRBVEFdITsgfVxuICAgIHB1YmxpYyBnZXQgdHlwZUlkcygpIHsgcmV0dXJuIHRoaXMuX2J1ZmZlcnNbQnVmZmVyVHlwZS5UWVBFXSE7IH1cbiAgICBwdWJsaWMgZ2V0IG51bGxCaXRtYXAoKSB7IHJldHVybiB0aGlzLl9idWZmZXJzW0J1ZmZlclR5cGUuVkFMSURJVFldITsgfVxuICAgIHB1YmxpYyBnZXQgdmFsdWVPZmZzZXRzKCkgeyByZXR1cm4gdGhpcy5fYnVmZmVyc1tCdWZmZXJUeXBlLk9GRlNFVF0hOyB9XG4gICAgcHVibGljIGdldCBudWxsQ291bnQoKSB7XG4gICAgICAgIGxldCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQ7XG4gICAgICAgIGxldCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgdW5kZWZpbmVkO1xuICAgICAgICBpZiAobnVsbENvdW50ID09PSBrVW5rbm93bk51bGxDb3VudCAmJiAobnVsbEJpdG1hcCA9IHRoaXMubnVsbEJpdG1hcCkpIHtcbiAgICAgICAgICAgIHRoaXMuX251bGxDb3VudCA9IG51bGxDb3VudCA9IHRoaXMubGVuZ3RoIC0gcG9wY250X2JpdF9yYW5nZShudWxsQml0bWFwLCB0aGlzLm9mZnNldCwgdGhpcy5vZmZzZXQgKyB0aGlzLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGxDb3VudDtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlciwgYnVmZmVycz86IEJ1ZmZlcnM8VD4sIGNoaWxkRGF0YT86IChEYXRhIHwgVmVjdG9yKVtdKSB7XG4gICAgICAgIHRoaXMuX3R5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLl9vZmZzZXQgPSBNYXRoLmZsb29yKE1hdGgubWF4KG9mZnNldCB8fCAwLCAwKSk7XG4gICAgICAgIHRoaXMuX2xlbmd0aCA9IE1hdGguZmxvb3IoTWF0aC5tYXgobGVuZ3RoIHx8IDAsIDApKTtcbiAgICAgICAgdGhpcy5fYnVmZmVycyA9IE9iamVjdC5hc3NpZ24oW10sIGJ1ZmZlcnMpIGFzIEJ1ZmZlcnM8VD47XG4gICAgICAgIHRoaXMuX251bGxDb3VudCA9IE1hdGguZmxvb3IoTWF0aC5tYXgobnVsbENvdW50IHx8IDAsIC0xKSk7XG4gICAgICAgIHRoaXMuX2NoaWxkRGF0YSA9IChjaGlsZERhdGEgfHwgW10pLm1hcCgoeCkgPT4geCBpbnN0YW5jZW9mIERhdGEgPyB4IDogeC5kYXRhKSBhcyBEYXRhW107XG4gICAgfVxuXG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBEYXRhVHlwZT4odHlwZTogUiwgb2Zmc2V0ID0gdGhpcy5vZmZzZXQsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQsIGJ1ZmZlcnM6IEJ1ZmZlcnM8Uj4gPSA8YW55PiB0aGlzLl9idWZmZXJzLCBjaGlsZERhdGE6IChEYXRhIHwgVmVjdG9yKVtdID0gdGhpcy5jaGlsZERhdGEpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIGJ1ZmZlcnMsIGNoaWxkRGF0YSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNsaWNlKG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcik6IERhdGE8VD4ge1xuICAgICAgICAvLyArdHJ1ZSA9PT0gMSwgK2ZhbHNlID09PSAwLCBzbyB0aGlzIG1lYW5zXG4gICAgICAgIC8vIHdlIGtlZXAgbnVsbENvdW50IGF0IDAgaWYgaXQncyBhbHJlYWR5IDAsXG4gICAgICAgIC8vIG90aGVyd2lzZSBzZXQgdG8gdGhlIGludmFsaWRhdGVkIGZsYWcgLTFcbiAgICAgICAgY29uc3QgbnVsbENvdW50ID0gKyh0aGlzLl9udWxsQ291bnQgPT09IDApIC0gMTtcbiAgICAgICAgY29uc3QgYnVmZmVycyA9IHRoaXMuc2xpY2VCdWZmZXJzKG9mZnNldCwgbGVuZ3RoKTtcbiAgICAgICAgY29uc3QgY2hpbGREYXRhID0gdGhpcy5zbGljZUNoaWxkcmVuKG9mZnNldCwgbGVuZ3RoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmU8VD4odGhpcy50eXBlLCB0aGlzLm9mZnNldCArIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIGJ1ZmZlcnMsIGNoaWxkRGF0YSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHNsaWNlQnVmZmVycyhvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpOiBCdWZmZXJzPFQ+IHtcbiAgICAgICAgbGV0IGFycjogYW55LCBidWZmZXJzID0gT2JqZWN0LmFzc2lnbihbXSwgdGhpcy5fYnVmZmVycykgYXMgQnVmZmVyczxUPjtcbiAgICAgICAgLy8gSWYgdHlwZUlkcyBleGlzdCwgc2xpY2UgdGhlIHR5cGVJZHMgYnVmZmVyXG4gICAgICAgIChhcnIgPSBidWZmZXJzW0J1ZmZlclR5cGUuVFlQRV0pICYmIChidWZmZXJzW0J1ZmZlclR5cGUuVFlQRV0gPSB0aGlzLnNsaWNlRGF0YShhcnIsIG9mZnNldCwgbGVuZ3RoKSk7XG4gICAgICAgIC8vIElmIG9mZnNldHMgZXhpc3QsIG9ubHkgc2xpY2UgdGhlIG9mZnNldHMgYnVmZmVyXG4gICAgICAgIChhcnIgPSBidWZmZXJzW0J1ZmZlclR5cGUuT0ZGU0VUXSkgJiYgKGJ1ZmZlcnNbQnVmZmVyVHlwZS5PRkZTRVRdID0gdGhpcy5zbGljZU9mZnNldHMoYXJyLCBvZmZzZXQsIGxlbmd0aCkpIHx8XG4gICAgICAgICAgICAvLyBPdGhlcndpc2UgaWYgbm8gb2Zmc2V0cywgc2xpY2UgdGhlIGRhdGEgYnVmZmVyXG4gICAgICAgICAgICAoYXJyID0gYnVmZmVyc1tCdWZmZXJUeXBlLkRBVEFdKSAmJiAoYnVmZmVyc1tCdWZmZXJUeXBlLkRBVEFdID0gdGhpcy5zbGljZURhdGEoYXJyLCBvZmZzZXQsIGxlbmd0aCkpO1xuICAgICAgICByZXR1cm4gYnVmZmVycztcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgc2xpY2VDaGlsZHJlbihvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpOiBEYXRhW10ge1xuICAgICAgICAvLyBPbmx5IHNsaWNlIGNoaWxkcmVuIGlmIHRoaXMgaXNuJ3QgdmFyaWFibGUgd2lkdGggZGF0YVxuICAgICAgICBpZiAoIXRoaXMudmFsdWVPZmZzZXRzKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jaGlsZERhdGEubWFwKChjaGlsZCkgPT4gY2hpbGQuc2xpY2Uob2Zmc2V0LCBsZW5ndGgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5jaGlsZERhdGE7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHNsaWNlRGF0YShkYXRhOiBUWydUQXJyYXknXSAmIEFycmF5QnVmZmVyVmlldywgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIC8vIERvbid0IHNsaWNlIHRoZSBkYXRhIHZlY3RvciBmb3IgQm9vbGVhbnMsIHNpbmNlIHRoZSBvZmZzZXQgZ29lcyBieSBiaXRzIG5vdCBieXRlc1xuICAgICAgICByZXR1cm4gdGhpcy50eXBlLlRUeXBlID09PSBUeXBlLkJvb2wgPyBkYXRhIDogZGF0YS5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIGxlbmd0aCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHNsaWNlT2Zmc2V0cyh2YWx1ZU9mZnNldHM6IEludDMyQXJyYXksIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gdmFsdWVPZmZzZXRzLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoICsgMSk7XG4gICAgfVxuXG4gICAgLy9cbiAgICAvLyBDb252ZW5pZW5jZSBtZXRob2RzIGZvciBjcmVhdGluZyBEYXRhIGluc3RhbmNlcyBmb3IgZWFjaCBvZiB0aGUgQXJyb3cgVmVjdG9yIHR5cGVzXG4gICAgLy9cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIE51bGw8VCBleHRlbmRzIE51bGw+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcClcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgSW50PFQgZXh0ZW5kcyBJbnQ+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIERpY3Rpb25hcnk8VCBleHRlbmRzIERpY3Rpb25hcnk+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXc8VFsnVEFycmF5J10+KHR5cGUuaW5kaWNlcy5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEZsb2F0PFQgZXh0ZW5kcyBGbG9hdD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgQm9vbDxUIGV4dGVuZHMgQm9vbD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgRGVjaW1hbDxUIGV4dGVuZHMgRGVjaW1hbD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgRGF0ZTxUIGV4dGVuZHMgRGF0ZV8+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIFRpbWU8VCBleHRlbmRzIFRpbWU+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIFRpbWVzdGFtcDxUIGV4dGVuZHMgVGltZXN0YW1wPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBJbnRlcnZhbDxUIGV4dGVuZHMgSW50ZXJ2YWw+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEZpeGVkU2l6ZUJpbmFyeTxUIGV4dGVuZHMgRml4ZWRTaXplQmluYXJ5Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBCaW5hcnk8VCBleHRlbmRzIEJpbmFyeT4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgdmFsdWVPZmZzZXRzOiBWYWx1ZU9mZnNldHNCdWZmZXIsIGRhdGE6IFVpbnQ4QXJyYXkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5PRkZTRVRdOiB0b0FycmF5QnVmZmVyVmlldyhJbnQzMkFycmF5LCB2YWx1ZU9mZnNldHMpLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIFV0Zjg8VCBleHRlbmRzIFV0Zjg+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIHZhbHVlT2Zmc2V0czogVmFsdWVPZmZzZXRzQnVmZmVyLCBkYXRhOiBVaW50OEFycmF5KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuT0ZGU0VUXTogdG9BcnJheUJ1ZmZlclZpZXcoSW50MzJBcnJheSwgdmFsdWVPZmZzZXRzKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBMaXN0PFQgZXh0ZW5kcyBMaXN0Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCB2YWx1ZU9mZnNldHM6IFZhbHVlT2Zmc2V0c0J1ZmZlciwgY2hpbGREYXRhOiAoRGF0YSB8IFZlY3RvcilbXSkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLk9GRlNFVF06IHRvQXJyYXlCdWZmZXJWaWV3KEludDMyQXJyYXksIHZhbHVlT2Zmc2V0cylcbiAgICAgICAgfSwgY2hpbGREYXRhKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBGaXhlZFNpemVMaXN0PFQgZXh0ZW5kcyBGaXhlZFNpemVMaXN0Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBjaGlsZERhdGE6IChEYXRhIHwgVmVjdG9yKVtdKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXG4gICAgICAgIH0sIGNoaWxkRGF0YSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgU3RydWN0PFQgZXh0ZW5kcyBTdHJ1Y3Q+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGNoaWxkRGF0YTogKERhdGEgfCBWZWN0b3IpW10pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcClcbiAgICAgICAgfSwgY2hpbGREYXRhKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBNYXA8VCBleHRlbmRzIE1hcF8+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGNoaWxkRGF0YTogKERhdGEgfCBWZWN0b3IpW10pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcClcbiAgICAgICAgfSwgY2hpbGREYXRhKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBVbmlvbjxUIGV4dGVuZHMgVW5pb24+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIHR5cGVJZHM6IFVpbnQ4QXJyYXksIHZhbHVlT2Zmc2V0c09yQ2hpbGREYXRhOiBWYWx1ZU9mZnNldHNCdWZmZXIgfCAoRGF0YSB8IFZlY3RvcilbXSwgY2hpbGREYXRhPzogKERhdGEgfCBWZWN0b3IpW10pIHtcbiAgICAgICAgY29uc3QgYnVmZmVycyA9IHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5UWVBFXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIHR5cGVJZHMpXG4gICAgICAgIH0gYXMgYW55O1xuICAgICAgICBpZiAodHlwZS5tb2RlID09PSBVbmlvbk1vZGUuU3BhcnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgYnVmZmVycywgdmFsdWVPZmZzZXRzT3JDaGlsZERhdGEgYXMgKERhdGEgfCBWZWN0b3IpW10pO1xuICAgICAgICB9XG4gICAgICAgIGJ1ZmZlcnNbQnVmZmVyVHlwZS5PRkZTRVRdID0gdG9BcnJheUJ1ZmZlclZpZXcoSW50MzJBcnJheSwgPFZhbHVlT2Zmc2V0c0J1ZmZlcj4gdmFsdWVPZmZzZXRzT3JDaGlsZERhdGEpO1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgYnVmZmVycywgY2hpbGREYXRhKTtcbiAgICB9XG59XG5cbi8vIChEYXRhIGFzIGFueSkucHJvdG90eXBlLl90eXBlID0gT2JqZWN0LmZyZWV6ZSh7fSk7XG4vLyAoRGF0YSBhcyBhbnkpLnByb3RvdHlwZS5fYnVmZmVycyA9IE9iamVjdC5mcmVlemUoW10pO1xuIl19
