"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const bit_1 = require("./util/bit");
const type_1 = require("./type");
function toTypedArray(ArrayType, values) {
    if (!ArrayType && ArrayBuffer.isView(values)) {
        return values;
    }
    return values instanceof ArrayType ? values
        : !values || !ArrayBuffer.isView(values) ? ArrayType.from(values || [])
            : new ArrayType(values.buffer, values.byteOffset, values.byteLength / ArrayType.BYTES_PER_ELEMENT);
}
exports.toTypedArray = toTypedArray;
exports.kUnknownNullCount = -1;
class BaseData {
    constructor(type, length, offset, nullCount) {
        this.type = type;
        this.length = Math.floor(Math.max(length || 0, 0));
        this.offset = Math.floor(Math.max(offset || 0, 0));
        this._nullCount = Math.floor(Math.max(nullCount || 0, -1));
    }
    get typeId() { return this.type.TType; }
    get nullBitmap() { return this[type_1.VectorType.VALIDITY]; }
    get nullCount() {
        let nullCount = this._nullCount;
        let nullBitmap;
        if (nullCount === -1 && (nullBitmap = this[type_1.VectorType.VALIDITY])) {
            this._nullCount = nullCount = this.length - bit_1.popcnt_bit_range(nullBitmap, this.offset, this.offset + this.length);
        }
        return nullCount;
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new BaseData(type, length, offset, nullCount);
    }
    slice(offset, length) {
        return length <= 0 ? this : this.sliceInternal(this.clone(this.type, length, this.offset + offset, +(this._nullCount === 0) - 1), offset, length);
    }
    sliceInternal(clone, offset, length) {
        let arr;
        // If typeIds exist, slice the typeIds buffer
        (arr = this[type_1.VectorType.TYPE]) && (clone[type_1.VectorType.TYPE] = this.sliceData(arr, offset, length));
        // If offsets exist, only slice the offsets buffer
        (arr = this[type_1.VectorType.OFFSET]) && (clone[type_1.VectorType.OFFSET] = this.sliceOffsets(arr, offset, length)) ||
            // Otherwise if no offsets, slice the data buffer
            (arr = this[type_1.VectorType.DATA]) && (clone[type_1.VectorType.DATA] = this.sliceData(arr, offset, length));
        return clone;
    }
    sliceData(data, offset, length) {
        return data.subarray(offset, offset + length);
    }
    sliceOffsets(valueOffsets, offset, length) {
        return valueOffsets.subarray(offset, offset + length + 1);
    }
}
exports.BaseData = BaseData;
class FlatData extends BaseData {
    constructor(type, length, nullBitmap, data, offset, nullCount) {
        super(type, length, offset, nullCount);
        this[type_1.VectorType.DATA] = toTypedArray(this.ArrayType, data);
        this[type_1.VectorType.VALIDITY] = toTypedArray(Uint8Array, nullBitmap);
    }
    get values() { return this[type_1.VectorType.DATA]; }
    get ArrayType() { return this.type.ArrayType; }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new this.constructor(type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.DATA], offset, nullCount);
    }
}
exports.FlatData = FlatData;
class BoolData extends FlatData {
    sliceData(data) { return data; }
}
exports.BoolData = BoolData;
class FlatListData extends FlatData {
    constructor(type, length, nullBitmap, valueOffsets, data, offset, nullCount) {
        super(type, length, nullBitmap, data, offset, nullCount);
        this[type_1.VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    get values() { return this[type_1.VectorType.DATA]; }
    get valueOffsets() { return this[type_1.VectorType.OFFSET]; }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new FlatListData(type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.OFFSET], this[type_1.VectorType.DATA], offset, nullCount);
    }
}
exports.FlatListData = FlatListData;
class DictionaryData extends BaseData {
    constructor(type, dictionary, indices) {
        super(type, indices.length, indices.offset, indices._nullCount);
        this._indices = indices;
        this._dictionary = dictionary;
    }
    get indices() { return this._indices; }
    get dictionary() { return this._dictionary; }
    get nullCount() { return this._indices.nullCount; }
    get nullBitmap() { return this._indices.nullBitmap; }
    clone(type, length = this.length, offset = this.offset) {
        const data = this._dictionary.data.clone(type.dictionary);
        return new DictionaryData(this.type, this._dictionary.clone(data), this._indices.slice(offset - this.offset, length));
    }
    sliceInternal(clone, _offset, _length) {
        clone.length = clone._indices.length;
        clone._nullCount = clone._indices._nullCount;
        return clone;
    }
}
exports.DictionaryData = DictionaryData;
class NestedData extends BaseData {
    constructor(type, length, nullBitmap, childData, offset, nullCount) {
        super(type, length, offset, nullCount);
        this.childData = childData;
        this[type_1.VectorType.VALIDITY] = toTypedArray(Uint8Array, nullBitmap);
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new NestedData(type, length, this[type_1.VectorType.VALIDITY], this.childData, offset, nullCount);
    }
    sliceInternal(clone, offset, length) {
        if (!this[type_1.VectorType.OFFSET]) {
            clone.childData = this.childData.map((child) => child.slice(offset, length));
        }
        return super.sliceInternal(clone, offset, length);
    }
}
exports.NestedData = NestedData;
class SingleNestedData extends NestedData {
    constructor(type, length, nullBitmap, valueChildData, offset, nullCount) {
        super(type, length, nullBitmap, [valueChildData], offset, nullCount);
        this._valuesData = valueChildData;
    }
    get values() { return this._valuesData; }
}
exports.SingleNestedData = SingleNestedData;
class ListData extends SingleNestedData {
    constructor(type, length, nullBitmap, valueOffsets, valueChildData, offset, nullCount) {
        super(type, length, nullBitmap, valueChildData, offset, nullCount);
        this[type_1.VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    get valueOffsets() { return this[type_1.VectorType.OFFSET]; }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new ListData(type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.OFFSET], this._valuesData, offset, nullCount);
    }
}
exports.ListData = ListData;
class UnionData extends NestedData {
    constructor(type, length, nullBitmap, typeIds, childData, offset, nullCount) {
        super(type, length, nullBitmap, childData, offset, nullCount);
        this[type_1.VectorType.TYPE] = toTypedArray(Int8Array, typeIds);
    }
    get typeIds() { return this[type_1.VectorType.TYPE]; }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new UnionData(type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.TYPE], this.childData, offset, nullCount);
    }
}
exports.UnionData = UnionData;
class SparseUnionData extends UnionData {
    constructor(type, length, nullBitmap, typeIds, childData, offset, nullCount) {
        super(type, length, nullBitmap, typeIds, childData, offset, nullCount);
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new SparseUnionData(type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.TYPE], this.childData, offset, nullCount);
    }
}
exports.SparseUnionData = SparseUnionData;
class DenseUnionData extends UnionData {
    get valueOffsets() { return this[type_1.VectorType.OFFSET]; }
    constructor(type, length, nullBitmap, typeIds, valueOffsets, childData, offset, nullCount) {
        super(type, length, nullBitmap, typeIds, childData, offset, nullCount);
        this[type_1.VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new DenseUnionData(type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.TYPE], this[type_1.VectorType.OFFSET], this.childData, offset, nullCount);
    }
}
exports.DenseUnionData = DenseUnionData;
class ChunkedData extends BaseData {
    constructor(type, length, chunkVectors, offset, nullCount, chunkOffsets) {
        super(type, length, offset, nullCount);
        this._chunkVectors = chunkVectors;
        this._chunkOffsets = chunkOffsets || ChunkedData.computeOffsets(chunkVectors);
    }
    get chunkVectors() { return this._chunkVectors; }
    get chunkOffsets() { return this._chunkOffsets; }
    get chunkData() {
        return this._chunkData || (this._chunkData = this._chunkVectors.map(({ data }) => data));
    }
    get nullCount() {
        let nullCount = this._nullCount;
        if (nullCount === -1) {
            this._nullCount = nullCount = this._chunkVectors.reduce((x, c) => x + c.nullCount, 0);
        }
        return nullCount;
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new ChunkedData(type, length, this._chunkVectors.map((vec) => vec.clone(vec.data.clone(type))), offset, nullCount, this._chunkOffsets);
    }
    sliceInternal(clone, offset, length) {
        const chunks = this._chunkVectors;
        const offsets = this._chunkOffsets;
        const chunkSlices = [];
        for (let childIndex = -1, numChildren = chunks.length; ++childIndex < numChildren;) {
            const child = chunks[childIndex];
            const childLength = child.length;
            const childOffset = offsets[childIndex];
            // If the child is to the right of the slice boundary, exclude
            if (childOffset >= offset + length) {
                continue;
            }
            // If the child is to the left of of the slice boundary, exclude
            if (offset >= childOffset + childLength) {
                continue;
            }
            // If the child is between both left and right boundaries, include w/o slicing
            if (childOffset >= offset && (childOffset + childLength) <= offset + length) {
                chunkSlices.push(child);
                continue;
            }
            // If the child overlaps one of the slice boundaries, include that slice
            const begin = Math.max(0, offset - childOffset);
            const end = begin + Math.min(childLength - begin, (offset + length) - childOffset);
            chunkSlices.push(child.slice(begin, end));
        }
        clone._chunkVectors = chunkSlices;
        clone._chunkOffsets = ChunkedData.computeOffsets(chunkSlices);
        return clone;
    }
    static computeOffsets(childVectors) {
        const childOffsets = new Uint32Array(childVectors.length + 1);
        for (let index = 0, length = childOffsets.length, childOffset = childOffsets[0] = 0; ++index < length;) {
            childOffsets[index] = (childOffset += childVectors[index - 1].length);
        }
        return childOffsets;
    }
}
exports.ChunkedData = ChunkedData;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LE1BQU0sQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDO1lBQ25GLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM5QyxDQUFDO1FBQ0QsS0FBSyxDQUFDLGFBQWEsR0FBRyxXQUFXLENBQUM7UUFDbEMsS0FBSyxDQUFDLGFBQWEsR0FBRyxXQUFXLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzlELE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUNELE1BQU0sQ0FBQyxjQUFjLENBQXFCLFlBQXlCO1FBQy9ELE1BQU0sWUFBWSxHQUFHLElBQUksV0FBVyxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDOUQsR0FBRyxDQUFDLENBQUMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxFQUFFLE1BQU0sR0FBRyxZQUFZLENBQUMsTUFBTSxFQUFFLFdBQVcsR0FBRyxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsS0FBSyxHQUFHLE1BQU0sR0FBRyxDQUFDO1lBQ3JHLFlBQVksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFdBQVcsSUFBSSxZQUFZLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFFLENBQUM7UUFDRCxNQUFNLENBQUMsWUFBWSxDQUFDO0lBQ3hCLENBQUM7Q0FDSjtBQS9ERCxrQ0ErREMiLCJmaWxlIjoiZGF0YS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBwb3BjbnRfYml0X3JhbmdlIH0gZnJvbSAnLi91dGlsL2JpdCc7XG5pbXBvcnQgeyBWZWN0b3JMaWtlLCBWZWN0b3IgfSBmcm9tICcuL3ZlY3Rvcic7XG5pbXBvcnQgeyBJbnQsIEJvb2wsIEZsYXRMaXN0VHlwZSwgTGlzdCwgU3RydWN0LCBNYXBfIH0gZnJvbSAnLi90eXBlJztcbmltcG9ydCB7IFZlY3RvclR5cGUsIFR5cGVkQXJyYXksIFR5cGVkQXJyYXlDb25zdHJ1Y3RvciwgRGljdGlvbmFyeSB9IGZyb20gJy4vdHlwZSc7XG5pbXBvcnQgeyBEYXRhVHlwZSwgRmxhdFR5cGUsIExpc3RUeXBlLCBOZXN0ZWRUeXBlLCBTaW5nbGVOZXN0ZWRUeXBlLCBEZW5zZVVuaW9uLCBTcGFyc2VVbmlvbiB9IGZyb20gJy4vdHlwZSc7XG5cbmV4cG9ydCBmdW5jdGlvbiB0b1R5cGVkQXJyYXk8VCBleHRlbmRzIFR5cGVkQXJyYXk+KEFycmF5VHlwZTogVHlwZWRBcnJheUNvbnN0cnVjdG9yPFQ+LCB2YWx1ZXM/OiBUIHwgQXJyYXlMaWtlPG51bWJlcj4gfCBJdGVyYWJsZTxudW1iZXI+IHwgbnVsbCk6IFQge1xuICAgIGlmICghQXJyYXlUeXBlICYmIEFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZXMpKSB7IHJldHVybiB2YWx1ZXM7IH1cbiAgICByZXR1cm4gdmFsdWVzIGluc3RhbmNlb2YgQXJyYXlUeXBlID8gdmFsdWVzXG4gICAgICAgICA6ICF2YWx1ZXMgfHwgIUFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZXMpID8gQXJyYXlUeXBlLmZyb20odmFsdWVzIHx8IFtdKVxuICAgICAgICAgOiBuZXcgQXJyYXlUeXBlKHZhbHVlcy5idWZmZXIsIHZhbHVlcy5ieXRlT2Zmc2V0LCB2YWx1ZXMuYnl0ZUxlbmd0aCAvIEFycmF5VHlwZS5CWVRFU19QRVJfRUxFTUVOVCk7XG59XG5cbmV4cG9ydCB0eXBlIERhdGE8VCBleHRlbmRzIERhdGFUeXBlPiA9IERhdGFUeXBlczxUPltUWydUVHlwZSddXSAmIEJhc2VEYXRhPFQ+O1xuZXhwb3J0IGludGVyZmFjZSBEYXRhVHlwZXM8VCBleHRlbmRzIERhdGFUeXBlPiB7XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5OT05FXSovICAwOiBCYXNlRGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLk51bGxdKi8gIDE6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgIFtUeXBlLkludF0qLyAgMjogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgIFtUeXBlLkZsb2F0XSovICAzOiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICBbVHlwZS5CaW5hcnldKi8gIDQ6IEZsYXRMaXN0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLlV0ZjhdKi8gIDU6IEZsYXRMaXN0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLkJvb2xdKi8gIDY6IEJvb2xEYXRhO1xuLyogICAgICAgICAgICAgW1R5cGUuRGVjaW1hbF0qLyAgNzogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5EYXRlXSovICA4OiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLlRpbWVdKi8gIDk6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgIFtUeXBlLlRpbWVzdGFtcF0qLyAxMDogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgIFtUeXBlLkludGVydmFsXSovIDExOiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLkxpc3RdKi8gMTI6IExpc3REYXRhPExpc3Q8VD4+O1xuLyogICAgICAgICAgICAgIFtUeXBlLlN0cnVjdF0qLyAxMzogTmVzdGVkRGF0YTxTdHJ1Y3Q+O1xuLyogICAgICAgICAgICAgICBbVHlwZS5Vbmlvbl0qLyAxNDogVW5pb25EYXRhO1xuLyogICAgIFtUeXBlLkZpeGVkU2l6ZUJpbmFyeV0qLyAxNTogRmxhdERhdGE8VD47XG4vKiAgICAgICBbVHlwZS5GaXhlZFNpemVMaXN0XSovIDE2OiBTaW5nbGVOZXN0ZWREYXRhPGFueT47XG4vKiAgICAgICAgICAgICAgICAgW1R5cGUuTWFwXSovIDE3OiBOZXN0ZWREYXRhPE1hcF8+O1xuLyogIFtUeXBlLkRlbnNlVW5pb25dKi8gRGVuc2VVbmlvbjogRGVuc2VVbmlvbkRhdGE7XG4vKltUeXBlLlNwYXJzZVVuaW9uXSovIFNwYXJzZVVuaW9uOiBTcGFyc2VVbmlvbkRhdGE7XG4vKlsgIFR5cGUuRGljdGlvbmFyeV0qLyBEaWN0aW9uYXJ5OiBEaWN0aW9uYXJ5RGF0YTxhbnk+O1xufVxuLy8gV2hlbiBzbGljaW5nLCB3ZSBkbyBub3Qga25vdyB0aGUgbnVsbCBjb3VudCBvZiB0aGUgc2xpY2VkIHJhbmdlIHdpdGhvdXRcbi8vIGRvaW5nIHNvbWUgY29tcHV0YXRpb24uIFRvIGF2b2lkIGRvaW5nIHRoaXMgZWFnZXJseSwgd2Ugc2V0IHRoZSBudWxsIGNvdW50XG4vLyB0byAtMSAoYW55IG5lZ2F0aXZlIG51bWJlciB3aWxsIGRvKS4gV2hlbiBBcnJheTo6bnVsbF9jb3VudCBpcyBjYWxsZWQgdGhlXG4vLyBmaXJzdCB0aW1lLCB0aGUgbnVsbCBjb3VudCB3aWxsIGJlIGNvbXB1dGVkLiBTZWUgQVJST1ctMzNcbmV4cG9ydCB0eXBlIGtVbmtub3duTnVsbENvdW50ID0gLTE7XG5leHBvcnQgY29uc3Qga1Vua25vd25OdWxsQ291bnQgPSAtMTtcblxuZXhwb3J0IGNsYXNzIEJhc2VEYXRhPFQgZXh0ZW5kcyBEYXRhVHlwZSA9IERhdGFUeXBlPiBpbXBsZW1lbnRzIFZlY3Rvckxpa2Uge1xuICAgIHB1YmxpYyB0eXBlOiBUO1xuICAgIHB1YmxpYyBsZW5ndGg6IG51bWJlcjtcbiAgICBwdWJsaWMgb2Zmc2V0OiBudW1iZXI7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHB1YmxpYyBjaGlsZERhdGE6IERhdGE8YW55PltdO1xuICAgIHByb3RlY3RlZCBfbnVsbENvdW50OiBudW1iZXIgfCBrVW5rbm93bk51bGxDb3VudDtcbiAgICBwcm90ZWN0ZWQgLyogIFtWZWN0b3JUeXBlLk9GRlNFVF06Ki8gMD86IEludDMyQXJyYXk7XG4gICAgcHJvdGVjdGVkIC8qICAgIFtWZWN0b3JUeXBlLkRBVEFdOiovIDE/OiBUWydUQXJyYXknXTtcbiAgICBwcm90ZWN0ZWQgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMj86IFVpbnQ4QXJyYXk7XG4gICAgcHJvdGVjdGVkIC8qICAgIFtWZWN0b3JUeXBlLlRZUEVdOiovIDM/OiBJbnQ4QXJyYXk7XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gTWF0aC5mbG9vcihNYXRoLm1heChsZW5ndGggfHwgMCwgMCkpO1xuICAgICAgICB0aGlzLm9mZnNldCA9IE1hdGguZmxvb3IoTWF0aC5tYXgob2Zmc2V0IHx8IDAsIDApKTtcbiAgICAgICAgdGhpcy5fbnVsbENvdW50ID0gTWF0aC5mbG9vcihNYXRoLm1heChudWxsQ291bnQgfHwgMCwgLTEpKTtcbiAgICB9XG4gICAgcHVibGljIGdldCB0eXBlSWQoKSB7IHJldHVybiB0aGlzLnR5cGUuVFR5cGU7IH1cbiAgICBwdWJsaWMgZ2V0IG51bGxCaXRtYXAoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldOyB9XG4gICAgcHVibGljIGdldCBudWxsQ291bnQoKSB7XG4gICAgICAgIGxldCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQ7XG4gICAgICAgIGxldCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgdW5kZWZpbmVkO1xuICAgICAgICBpZiAobnVsbENvdW50ID09PSAtMSAmJiAobnVsbEJpdG1hcCA9IHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0pKSB7XG4gICAgICAgICAgICB0aGlzLl9udWxsQ291bnQgPSBudWxsQ291bnQgPSB0aGlzLmxlbmd0aCAtIHBvcGNudF9iaXRfcmFuZ2UobnVsbEJpdG1hcCwgdGhpcy5vZmZzZXQsIHRoaXMub2Zmc2V0ICsgdGhpcy5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsQ291bnQ7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgVD4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5sZW5ndGgsIG9mZnNldCA9IHRoaXMub2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCYXNlRGF0YSh0eXBlLCBsZW5ndGgsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICB9XG4gICAgcHVibGljIHNsaWNlKG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gbGVuZ3RoIDw9IDAgPyB0aGlzIDogdGhpcy5zbGljZUludGVybmFsKHRoaXMuY2xvbmUoXG4gICAgICAgICAgICB0aGlzLnR5cGUsIGxlbmd0aCwgdGhpcy5vZmZzZXQgKyBvZmZzZXQsICsodGhpcy5fbnVsbENvdW50ID09PSAwKSAtIDFcbiAgICAgICAgKSBhcyBhbnksIG9mZnNldCwgbGVuZ3RoKTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNsaWNlSW50ZXJuYWwoY2xvbmU6IHRoaXMsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICBsZXQgYXJyOiBhbnk7XG4gICAgICAgIC8vIElmIHR5cGVJZHMgZXhpc3QsIHNsaWNlIHRoZSB0eXBlSWRzIGJ1ZmZlclxuICAgICAgICAoYXJyID0gdGhpc1tWZWN0b3JUeXBlLlRZUEVdKSAmJiAoY2xvbmVbVmVjdG9yVHlwZS5UWVBFXSA9IHRoaXMuc2xpY2VEYXRhKGFyciwgb2Zmc2V0LCBsZW5ndGgpKTtcbiAgICAgICAgLy8gSWYgb2Zmc2V0cyBleGlzdCwgb25seSBzbGljZSB0aGUgb2Zmc2V0cyBidWZmZXJcbiAgICAgICAgKGFyciA9IHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdKSAmJiAoY2xvbmVbVmVjdG9yVHlwZS5PRkZTRVRdID0gdGhpcy5zbGljZU9mZnNldHMoYXJyLCBvZmZzZXQsIGxlbmd0aCkpIHx8XG4gICAgICAgICAgICAvLyBPdGhlcndpc2UgaWYgbm8gb2Zmc2V0cywgc2xpY2UgdGhlIGRhdGEgYnVmZmVyXG4gICAgICAgICAgICAoYXJyID0gdGhpc1tWZWN0b3JUeXBlLkRBVEFdKSAmJiAoY2xvbmVbVmVjdG9yVHlwZS5EQVRBXSA9IHRoaXMuc2xpY2VEYXRhKGFyciwgb2Zmc2V0LCBsZW5ndGgpKTtcbiAgICAgICAgcmV0dXJuIGNsb25lO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VEYXRhKGRhdGE6IFRbJ1RBcnJheSddICYgVHlwZWRBcnJheSwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiBkYXRhLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNsaWNlT2Zmc2V0cyh2YWx1ZU9mZnNldHM6IEludDMyQXJyYXksIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gdmFsdWVPZmZzZXRzLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoICsgMSk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRmxhdERhdGE8VCBleHRlbmRzIEZsYXRUeXBlPiBleHRlbmRzIEJhc2VEYXRhPFQ+IHtcbiAgICBwdWJsaWMgLyogICAgW1ZlY3RvclR5cGUuREFUQV06Ki8gMTogVFsnVEFycmF5J107XG4gICAgcHVibGljIC8qW1ZlY3RvclR5cGUuVkFMSURJVFldOiovIDI6IFVpbnQ4QXJyYXk7XG4gICAgcHVibGljIGdldCB2YWx1ZXMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuREFUQV07IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIGRhdGE6IEl0ZXJhYmxlPG51bWJlcj4sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuREFUQV0gPSB0b1R5cGVkQXJyYXkodGhpcy5BcnJheVR5cGUsIGRhdGEpO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldID0gdG9UeXBlZEFycmF5KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IEFycmF5VHlwZSgpOiBUWydBcnJheVR5cGUnXSB7IHJldHVybiB0aGlzLnR5cGUuQXJyYXlUeXBlOyB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBUPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLmxlbmd0aCwgb2Zmc2V0ID0gdGhpcy5vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3ICh0aGlzLmNvbnN0cnVjdG9yIGFzIGFueSkodHlwZSwgbGVuZ3RoLCB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLCB0aGlzW1ZlY3RvclR5cGUuREFUQV0sIG9mZnNldCwgbnVsbENvdW50KSBhcyBGbGF0RGF0YTxSPjtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBCb29sRGF0YSBleHRlbmRzIEZsYXREYXRhPEJvb2w+IHtcbiAgICBwcm90ZWN0ZWQgc2xpY2VEYXRhKGRhdGE6IFVpbnQ4QXJyYXkpIHsgcmV0dXJuIGRhdGE7IH1cbn1cblxuZXhwb3J0IGNsYXNzIEZsYXRMaXN0RGF0YTxUIGV4dGVuZHMgRmxhdExpc3RUeXBlPiBleHRlbmRzIEZsYXREYXRhPFQ+IHtcbiAgICBwdWJsaWMgLyogIFtWZWN0b3JUeXBlLk9GRlNFVF06Ki8gMDogSW50MzJBcnJheTtcbiAgICBwdWJsaWMgLyogICAgW1ZlY3RvclR5cGUuREFUQV06Ki8gMTogVFsnVEFycmF5J107XG4gICAgcHVibGljIC8qW1ZlY3RvclR5cGUuVkFMSURJVFldOiovIDI6IFVpbnQ4QXJyYXk7XG4gICAgcHVibGljIGdldCB2YWx1ZXMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuREFUQV07IH1cbiAgICBwdWJsaWMgZ2V0IHZhbHVlT2Zmc2V0cygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdOyB9XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCB2YWx1ZU9mZnNldHM6IEl0ZXJhYmxlPG51bWJlcj4sIGRhdGE6IFRbJ1RBcnJheSddLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIGRhdGEsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0gPSB0b1R5cGVkQXJyYXkoSW50MzJBcnJheSwgdmFsdWVPZmZzZXRzKTtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBUPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLmxlbmd0aCwgb2Zmc2V0ID0gdGhpcy5vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IEZsYXRMaXN0RGF0YSh0eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdLCB0aGlzW1ZlY3RvclR5cGUuREFUQV0sIG9mZnNldCwgbnVsbENvdW50KSBhcyBGbGF0TGlzdERhdGE8Uj47XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGljdGlvbmFyeURhdGE8VCBleHRlbmRzIERhdGFUeXBlPiBleHRlbmRzIEJhc2VEYXRhPERpY3Rpb25hcnk8VD4+IHtcbiAgICBwcm90ZWN0ZWQgX2RpY3Rpb25hcnk6IFZlY3RvcjxUPjtcbiAgICBwcm90ZWN0ZWQgX2luZGljZXM6IERhdGE8SW50PGFueT4+O1xuICAgIHB1YmxpYyBnZXQgaW5kaWNlcygpIHsgcmV0dXJuIHRoaXMuX2luZGljZXM7IH1cbiAgICBwdWJsaWMgZ2V0IGRpY3Rpb25hcnkoKSB7IHJldHVybiB0aGlzLl9kaWN0aW9uYXJ5OyB9XG4gICAgY29uc3RydWN0b3IodHlwZTogRGljdGlvbmFyeTxUPiwgZGljdGlvbmFyeTogVmVjdG9yPFQ+LCBpbmRpY2VzOiBEYXRhPEludDxhbnk+Pikge1xuICAgICAgICBzdXBlcih0eXBlLCBpbmRpY2VzLmxlbmd0aCwgaW5kaWNlcy5vZmZzZXQsIChpbmRpY2VzIGFzIGFueSkuX251bGxDb3VudCk7XG4gICAgICAgIHRoaXMuX2luZGljZXMgPSBpbmRpY2VzO1xuICAgICAgICB0aGlzLl9kaWN0aW9uYXJ5ID0gZGljdGlvbmFyeTtcbiAgICB9XG4gICAgcHVibGljIGdldCBudWxsQ291bnQoKSB7IHJldHVybiB0aGlzLl9pbmRpY2VzLm51bGxDb3VudDsgfVxuICAgIHB1YmxpYyBnZXQgbnVsbEJpdG1hcCgpIHsgcmV0dXJuIHRoaXMuX2luZGljZXMubnVsbEJpdG1hcDsgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgRGljdGlvbmFyeTxUPj4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5sZW5ndGgsIG9mZnNldCA9IHRoaXMub2Zmc2V0KSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLl9kaWN0aW9uYXJ5LmRhdGEuY2xvbmUodHlwZS5kaWN0aW9uYXJ5IGFzIGFueSk7XG4gICAgICAgIHJldHVybiBuZXcgRGljdGlvbmFyeURhdGE8Uj4oXG4gICAgICAgICAgICB0aGlzLnR5cGUgYXMgYW55LFxuICAgICAgICAgICAgdGhpcy5fZGljdGlvbmFyeS5jbG9uZShkYXRhKSBhcyBhbnksXG4gICAgICAgICAgICB0aGlzLl9pbmRpY2VzLnNsaWNlKG9mZnNldCAtIHRoaXMub2Zmc2V0LCBsZW5ndGgpXG4gICAgICAgICkgYXMgYW55O1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VJbnRlcm5hbChjbG9uZTogdGhpcywgX29mZnNldDogbnVtYmVyLCBfbGVuZ3RoOiBudW1iZXIpIHtcbiAgICAgICAgY2xvbmUubGVuZ3RoID0gY2xvbmUuX2luZGljZXMubGVuZ3RoO1xuICAgICAgICBjbG9uZS5fbnVsbENvdW50ID0gKGNsb25lLl9pbmRpY2VzIGFzIGFueSkuX251bGxDb3VudDtcbiAgICAgICAgcmV0dXJuIGNsb25lO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIE5lc3RlZERhdGE8VCBleHRlbmRzIE5lc3RlZFR5cGUgPSBOZXN0ZWRUeXBlPiBleHRlbmRzIEJhc2VEYXRhPFQ+IHtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIGNoaWxkRGF0YTogRGF0YTxhbnk+W10sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzLmNoaWxkRGF0YSA9IGNoaWxkRGF0YTtcbiAgICAgICAgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSA9IHRvVHlwZWRBcnJheShVaW50OEFycmF5LCBudWxsQml0bWFwKTtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBUPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLmxlbmd0aCwgb2Zmc2V0ID0gdGhpcy5vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IE5lc3RlZERhdGE8Uj4odHlwZSwgbGVuZ3RoLCB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLCB0aGlzLmNoaWxkRGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VJbnRlcm5hbChjbG9uZTogdGhpcywgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIGlmICghdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0pIHtcbiAgICAgICAgICAgIGNsb25lLmNoaWxkRGF0YSA9IHRoaXMuY2hpbGREYXRhLm1hcCgoY2hpbGQpID0+IGNoaWxkLnNsaWNlKG9mZnNldCwgbGVuZ3RoKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1cGVyLnNsaWNlSW50ZXJuYWwoY2xvbmUsIG9mZnNldCwgbGVuZ3RoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTaW5nbGVOZXN0ZWREYXRhPFQgZXh0ZW5kcyBTaW5nbGVOZXN0ZWRUeXBlPiBleHRlbmRzIE5lc3RlZERhdGE8VD4ge1xuICAgIHByb3RlY3RlZCBfdmFsdWVzRGF0YTogRGF0YTxUPjtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlcygpIHsgcmV0dXJuIHRoaXMuX3ZhbHVlc0RhdGE7IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHZhbHVlQ2hpbGREYXRhOiBEYXRhPFQ+LCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIFt2YWx1ZUNoaWxkRGF0YV0sIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpcy5fdmFsdWVzRGF0YSA9IHZhbHVlQ2hpbGREYXRhO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIExpc3REYXRhPFQgZXh0ZW5kcyBMaXN0VHlwZT4gZXh0ZW5kcyBTaW5nbGVOZXN0ZWREYXRhPFQ+IHtcbiAgICBwdWJsaWMgLyogIFtWZWN0b3JUeXBlLk9GRlNFVF06Ki8gMDogSW50MzJBcnJheTtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlT2Zmc2V0cygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdOyB9XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCB2YWx1ZU9mZnNldHM6IEl0ZXJhYmxlPG51bWJlcj4sIHZhbHVlQ2hpbGREYXRhOiBEYXRhPFQ+LCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIHZhbHVlQ2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdID0gdG9UeXBlZEFycmF5KEludDMyQXJyYXksIHZhbHVlT2Zmc2V0cyk7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgVD4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5sZW5ndGgsIG9mZnNldCA9IHRoaXMub2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBMaXN0RGF0YTxSPih0eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdLCB0aGlzLl92YWx1ZXNEYXRhIGFzIGFueSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFVuaW9uRGF0YTxUIGV4dGVuZHMgKERlbnNlVW5pb24gfCBTcGFyc2VVbmlvbikgPSBhbnk+IGV4dGVuZHMgTmVzdGVkRGF0YTxUPiB7XG4gICAgcHVibGljIC8qICAgIFtWZWN0b3JUeXBlLlRZUEVdOiovIDM6IFRbJ1RBcnJheSddO1xuICAgIHB1YmxpYyBnZXQgdHlwZUlkcygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5UWVBFXTsgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgdHlwZUlkczogSXRlcmFibGU8bnVtYmVyPiwgY2hpbGREYXRhOiBEYXRhPGFueT5bXSwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBudWxsQml0bWFwLCBjaGlsZERhdGEsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpc1tWZWN0b3JUeXBlLlRZUEVdID0gdG9UeXBlZEFycmF5KEludDhBcnJheSwgdHlwZUlkcyk7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgVD4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5sZW5ndGgsIG9mZnNldCA9IHRoaXMub2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBVbmlvbkRhdGE8Uj4odHlwZSwgbGVuZ3RoLCB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLCB0aGlzW1ZlY3RvclR5cGUuVFlQRV0sIHRoaXMuY2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgU3BhcnNlVW5pb25EYXRhIGV4dGVuZHMgVW5pb25EYXRhPFNwYXJzZVVuaW9uPiB7XG4gICAgY29uc3RydWN0b3IodHlwZTogU3BhcnNlVW5pb24sIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgdHlwZUlkczogSXRlcmFibGU8bnVtYmVyPiwgY2hpbGREYXRhOiBEYXRhPGFueT5bXSwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBudWxsQml0bWFwLCB0eXBlSWRzLCBjaGlsZERhdGEsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBTcGFyc2VVbmlvbj4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5sZW5ndGgsIG9mZnNldCA9IHRoaXMub2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTcGFyc2VVbmlvbkRhdGEoXG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgbGVuZ3RoLFxuICAgICAgICAgICAgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSxcbiAgICAgICAgICAgIHRoaXNbVmVjdG9yVHlwZS5UWVBFXSxcbiAgICAgICAgICAgIHRoaXMuY2hpbGREYXRhLFxuICAgICAgICAgICAgb2Zmc2V0LCBudWxsQ291bnRcbiAgICAgICAgKSBhcyBhbnkgYXMgVW5pb25EYXRhPFI+O1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIERlbnNlVW5pb25EYXRhIGV4dGVuZHMgVW5pb25EYXRhPERlbnNlVW5pb24+IHtcbiAgICBwdWJsaWMgLyogIFtWZWN0b3JUeXBlLk9GRlNFVF06Ki8gMDogSW50MzJBcnJheTtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlT2Zmc2V0cygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdOyB9XG4gICAgY29uc3RydWN0b3IodHlwZTogRGVuc2VVbmlvbiwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCB0eXBlSWRzOiBJdGVyYWJsZTxudW1iZXI+LCB2YWx1ZU9mZnNldHM6IEl0ZXJhYmxlPG51bWJlcj4sIGNoaWxkRGF0YTogRGF0YTxhbnk+W10sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgbnVsbEJpdG1hcCwgdHlwZUlkcywgY2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdID0gdG9UeXBlZEFycmF5KEludDMyQXJyYXksIHZhbHVlT2Zmc2V0cyk7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgRGVuc2VVbmlvbj4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5sZW5ndGgsIG9mZnNldCA9IHRoaXMub2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEZW5zZVVuaW9uRGF0YShcbiAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICBsZW5ndGgsXG4gICAgICAgICAgICB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLFxuICAgICAgICAgICAgdGhpc1tWZWN0b3JUeXBlLlRZUEVdLFxuICAgICAgICAgICAgdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0sXG4gICAgICAgICAgICB0aGlzLmNoaWxkRGF0YSxcbiAgICAgICAgICAgIG9mZnNldCwgbnVsbENvdW50XG4gICAgICAgICkgYXMgYW55IGFzIFVuaW9uRGF0YTxSPjtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDaHVua2VkRGF0YTxUIGV4dGVuZHMgRGF0YVR5cGU+IGV4dGVuZHMgQmFzZURhdGE8VD4ge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBwcm90ZWN0ZWQgX2NodW5rRGF0YTogRGF0YTxUPltdO1xuICAgIHByb3RlY3RlZCBfY2h1bmtWZWN0b3JzOiBWZWN0b3I8VD5bXTtcbiAgICBwcm90ZWN0ZWQgX2NodW5rT2Zmc2V0czogVWludDMyQXJyYXk7XG4gICAgcHVibGljIGdldCBjaHVua1ZlY3RvcnMoKSB7IHJldHVybiB0aGlzLl9jaHVua1ZlY3RvcnM7IH1cbiAgICBwdWJsaWMgZ2V0IGNodW5rT2Zmc2V0cygpIHsgcmV0dXJuIHRoaXMuX2NodW5rT2Zmc2V0czsgfVxuICAgIHB1YmxpYyBnZXQgY2h1bmtEYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2h1bmtEYXRhIHx8IChcbiAgICAgICAgICAgICAgIHRoaXMuX2NodW5rRGF0YSA9IHRoaXMuX2NodW5rVmVjdG9ycy5tYXAoKHsgZGF0YSB9KSA9PiBkYXRhKSk7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBjaHVua1ZlY3RvcnM6IFZlY3RvcjxUPltdLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlciwgY2h1bmtPZmZzZXRzPzogVWludDMyQXJyYXkpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXMuX2NodW5rVmVjdG9ycyA9IGNodW5rVmVjdG9ycztcbiAgICAgICAgdGhpcy5fY2h1bmtPZmZzZXRzID0gY2h1bmtPZmZzZXRzIHx8IENodW5rZWREYXRhLmNvbXB1dGVPZmZzZXRzKGNodW5rVmVjdG9ycyk7XG4gICAgfVxuICAgIHB1YmxpYyBnZXQgbnVsbENvdW50KCkge1xuICAgICAgICBsZXQgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50O1xuICAgICAgICBpZiAobnVsbENvdW50ID09PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5fbnVsbENvdW50ID0gbnVsbENvdW50ID0gdGhpcy5fY2h1bmtWZWN0b3JzLnJlZHVjZSgoeCwgYykgPT4geCArIGMubnVsbENvdW50LCAwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbENvdW50O1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBvZmZzZXQgPSB0aGlzLm9mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgQ2h1bmtlZERhdGE8Uj4oXG4gICAgICAgICAgICB0eXBlLCBsZW5ndGgsXG4gICAgICAgICAgICB0aGlzLl9jaHVua1ZlY3RvcnMubWFwKCh2ZWMpID0+IHZlYy5jbG9uZSh2ZWMuZGF0YS5jbG9uZSh0eXBlKSkpIGFzIGFueSxcbiAgICAgICAgICAgIG9mZnNldCwgbnVsbENvdW50LCB0aGlzLl9jaHVua09mZnNldHNcbiAgICAgICAgKTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNsaWNlSW50ZXJuYWwoY2xvbmU6IHRoaXMsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICBjb25zdCBjaHVua3MgPSB0aGlzLl9jaHVua1ZlY3RvcnM7XG4gICAgICAgIGNvbnN0IG9mZnNldHMgPSB0aGlzLl9jaHVua09mZnNldHM7XG4gICAgICAgIGNvbnN0IGNodW5rU2xpY2VzOiBWZWN0b3I8VD5bXSA9IFtdO1xuICAgICAgICBmb3IgKGxldCBjaGlsZEluZGV4ID0gLTEsIG51bUNoaWxkcmVuID0gY2h1bmtzLmxlbmd0aDsgKytjaGlsZEluZGV4IDwgbnVtQ2hpbGRyZW47KSB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZCA9IGNodW5rc1tjaGlsZEluZGV4XTtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkTGVuZ3RoID0gY2hpbGQubGVuZ3RoO1xuICAgICAgICAgICAgY29uc3QgY2hpbGRPZmZzZXQgPSBvZmZzZXRzW2NoaWxkSW5kZXhdO1xuICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkIGlzIHRvIHRoZSByaWdodCBvZiB0aGUgc2xpY2UgYm91bmRhcnksIGV4Y2x1ZGVcbiAgICAgICAgICAgIGlmIChjaGlsZE9mZnNldCA+PSBvZmZzZXQgKyBsZW5ndGgpIHsgY29udGludWU7IH1cbiAgICAgICAgICAgIC8vIElmIHRoZSBjaGlsZCBpcyB0byB0aGUgbGVmdCBvZiBvZiB0aGUgc2xpY2UgYm91bmRhcnksIGV4Y2x1ZGVcbiAgICAgICAgICAgIGlmIChvZmZzZXQgPj0gY2hpbGRPZmZzZXQgKyBjaGlsZExlbmd0aCkgeyBjb250aW51ZTsgfVxuICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkIGlzIGJldHdlZW4gYm90aCBsZWZ0IGFuZCByaWdodCBib3VuZGFyaWVzLCBpbmNsdWRlIHcvbyBzbGljaW5nXG4gICAgICAgICAgICBpZiAoY2hpbGRPZmZzZXQgPj0gb2Zmc2V0ICYmIChjaGlsZE9mZnNldCArIGNoaWxkTGVuZ3RoKSA8PSBvZmZzZXQgKyBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBjaHVua1NsaWNlcy5wdXNoKGNoaWxkKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIHRoZSBjaGlsZCBvdmVybGFwcyBvbmUgb2YgdGhlIHNsaWNlIGJvdW5kYXJpZXMsIGluY2x1ZGUgdGhhdCBzbGljZVxuICAgICAgICAgICAgY29uc3QgYmVnaW4gPSBNYXRoLm1heCgwLCBvZmZzZXQgLSBjaGlsZE9mZnNldCk7XG4gICAgICAgICAgICBjb25zdCBlbmQgPSBiZWdpbiArIE1hdGgubWluKGNoaWxkTGVuZ3RoIC0gYmVnaW4sIChvZmZzZXQgKyBsZW5ndGgpIC0gY2hpbGRPZmZzZXQpO1xuICAgICAgICAgICAgY2h1bmtTbGljZXMucHVzaChjaGlsZC5zbGljZShiZWdpbiwgZW5kKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2xvbmUuX2NodW5rVmVjdG9ycyA9IGNodW5rU2xpY2VzO1xuICAgICAgICBjbG9uZS5fY2h1bmtPZmZzZXRzID0gQ2h1bmtlZERhdGEuY29tcHV0ZU9mZnNldHMoY2h1bmtTbGljZXMpO1xuICAgICAgICByZXR1cm4gY2xvbmU7XG4gICAgfVxuICAgIHN0YXRpYyBjb21wdXRlT2Zmc2V0czxUIGV4dGVuZHMgRGF0YVR5cGU+KGNoaWxkVmVjdG9yczogVmVjdG9yPFQ+W10pIHtcbiAgICAgICAgY29uc3QgY2hpbGRPZmZzZXRzID0gbmV3IFVpbnQzMkFycmF5KGNoaWxkVmVjdG9ycy5sZW5ndGggKyAxKTtcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwLCBsZW5ndGggPSBjaGlsZE9mZnNldHMubGVuZ3RoLCBjaGlsZE9mZnNldCA9IGNoaWxkT2Zmc2V0c1swXSA9IDA7ICsraW5kZXggPCBsZW5ndGg7KSB7XG4gICAgICAgICAgICBjaGlsZE9mZnNldHNbaW5kZXhdID0gKGNoaWxkT2Zmc2V0ICs9IGNoaWxkVmVjdG9yc1tpbmRleCAtIDFdLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoaWxkT2Zmc2V0cztcbiAgICB9XG59XG4iXX0=
