"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const bit_1 = require("./util/bit");
const type_1 = require("./type");
function toTypedArray(ArrayType, values) {
    if (!ArrayType && ArrayBuffer.isView(values)) {
        return values;
    }
    return values instanceof ArrayType ? values
        : !values || !ArrayBuffer.isView(values) ? ArrayType.from(values || [])
            : new ArrayType(values.buffer, values.byteOffset, values.byteLength / ArrayType.BYTES_PER_ELEMENT);
}
exports.toTypedArray = toTypedArray;
exports.kUnknownNullCount = -1;
class BaseData {
    constructor(type, length, offset, nullCount) {
        this._type = type;
        this._length = Math.floor(Math.max(length || 0, 0));
        this._offset = Math.floor(Math.max(offset || 0, 0));
        this._nullCount = Math.floor(Math.max(nullCount || 0, -1));
    }
    get type() { return this._type; }
    get length() { return this._length; }
    get offset() { return this._offset; }
    get typeId() { return this._type.TType; }
    get childData() { return this._childData; }
    get nullBitmap() { return this[type_1.VectorType.VALIDITY]; }
    get nullCount() {
        let nullCount = this._nullCount;
        let nullBitmap;
        if (nullCount === -1 && (nullBitmap = this[type_1.VectorType.VALIDITY])) {
            this._nullCount = nullCount = bit_1.popcnt_bit_range(nullBitmap, this._offset, this._offset + this._length);
        }
        return nullCount;
    }
    clone(length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new BaseData(this._type, length, offset, nullCount);
    }
    slice(offset, length) {
        return length <= 0 ? this : this.sliceInternal(this.clone(length, this._offset + offset, +(this._nullCount === 0) - 1), offset, length);
    }
    sliceInternal(clone, offset, length) {
        let arr;
        // If typeIds exist, slice the typeIds buffer
        (arr = this[type_1.VectorType.TYPE]) && (clone[type_1.VectorType.TYPE] = this.sliceData(arr, offset, length));
        // If offsets exist, only slice the offsets buffer
        (arr = this[type_1.VectorType.OFFSET]) && (clone[type_1.VectorType.OFFSET] = this.sliceOffsets(arr, offset, length)) ||
            // Otherwise if no offsets, slice the data buffer
            (arr = this[type_1.VectorType.DATA]) && (clone[type_1.VectorType.DATA] = this.sliceData(arr, offset, length));
        return clone;
    }
    sliceData(data, offset, length) {
        return data.subarray(offset, offset + length);
    }
    sliceOffsets(valueOffsets, offset, length) {
        return valueOffsets.subarray(offset, offset + length + 1);
    }
}
exports.BaseData = BaseData;
class FlatData extends BaseData {
    constructor(type, length, nullBitmap, data, offset, nullCount) {
        super(type, length, offset, nullCount);
        this[type_1.VectorType.DATA] = toTypedArray(this.ArrayType, data);
        this[type_1.VectorType.VALIDITY] = toTypedArray(Uint8Array, nullBitmap);
    }
    get values() { return this[type_1.VectorType.DATA]; }
    get ArrayType() { return this._type.ArrayType; }
    clone(length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new FlatData(this._type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.DATA], offset, nullCount);
    }
}
exports.FlatData = FlatData;
class BoolData extends FlatData {
    sliceData(data) { return data; }
    clone(length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new BoolData(this._type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.DATA], offset, nullCount);
    }
}
exports.BoolData = BoolData;
class FlatListData extends FlatData {
    constructor(type, length, nullBitmap, valueOffsets, data, offset, nullCount) {
        super(type, length, nullBitmap, data, offset, nullCount);
        this[type_1.VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    get values() { return this[type_1.VectorType.DATA]; }
    get valueOffsets() { return this[type_1.VectorType.OFFSET]; }
    clone(length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new FlatListData(this._type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.OFFSET], this[type_1.VectorType.DATA], offset, nullCount);
    }
}
exports.FlatListData = FlatListData;
class DictionaryData extends BaseData {
    constructor(type, dictionary, indicies) {
        super(type, indicies.length, indicies._nullCount);
        this._indicies = indicies;
        this._dictionary = dictionary;
    }
    get indicies() { return this._indicies; }
    get dictionary() { return this._dictionary; }
    get length() { return this._indicies.length; }
    get nullCount() { return this._indicies.nullCount; }
    clone(length = this._length, offset = this._offset) {
        return new DictionaryData(this._type, this._dictionary, this._indicies.slice(offset - this._offset, length));
    }
    sliceInternal(clone, _offset, _length) {
        clone._length = clone._indicies.length;
        clone._nullCount = clone._indicies._nullCount;
        return clone;
    }
}
exports.DictionaryData = DictionaryData;
class NestedData extends BaseData {
    constructor(type, length, nullBitmap, childData, offset, nullCount) {
        super(type, length, offset, nullCount);
        this._childData = childData;
        this[type_1.VectorType.VALIDITY] = toTypedArray(Uint8Array, nullBitmap);
    }
    clone(length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new NestedData(this._type, length, this[type_1.VectorType.VALIDITY], this._childData, offset, nullCount);
    }
    sliceInternal(clone, offset, length) {
        if (!this[type_1.VectorType.OFFSET]) {
            clone._childData = this._childData.map((child) => child.slice(offset, length));
        }
        return super.sliceInternal(clone, offset, length);
    }
}
exports.NestedData = NestedData;
class ListData extends NestedData {
    constructor(type, length, nullBitmap, valueOffsets, valueChildData, offset, nullCount) {
        super(type, length, nullBitmap, [valueChildData], offset, nullCount);
        this._valuesData = valueChildData;
        this[type_1.VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    get values() { return this._valuesData; }
    get valueOffsets() { return this[type_1.VectorType.OFFSET]; }
    clone(length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new ListData(this._type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.OFFSET], this._valuesData, offset, nullCount);
    }
}
exports.ListData = ListData;
class UnionData extends NestedData {
    constructor(type, length, nullBitmap, typeIds, childData, offset, nullCount) {
        super(type, length, nullBitmap, childData, offset, nullCount);
        this[type_1.VectorType.TYPE] = toTypedArray(Int8Array, typeIds);
    }
    get typeIds() { return this[type_1.VectorType.TYPE]; }
    clone(length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new UnionData(this._type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.TYPE], this._childData, offset, nullCount);
    }
}
exports.UnionData = UnionData;
class SparseUnionData extends UnionData {
    constructor(type, length, nullBitmap, typeIds, childData, offset, nullCount) {
        super(type, length, nullBitmap, typeIds, childData, offset, nullCount);
    }
    clone(length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new SparseUnionData(this._type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.TYPE], this._childData, offset, nullCount);
    }
}
exports.SparseUnionData = SparseUnionData;
class DenseUnionData extends UnionData {
    get valueOffsets() { return this[type_1.VectorType.OFFSET]; }
    constructor(type, length, nullBitmap, typeIds, valueOffsets, childData, offset, nullCount) {
        super(type, length, nullBitmap, typeIds, childData, offset, nullCount);
        this[type_1.VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    clone(length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new DenseUnionData(this._type, length, this[type_1.VectorType.VALIDITY], this[type_1.VectorType.TYPE], this[type_1.VectorType.OFFSET], this._childData, offset, nullCount);
    }
}
exports.DenseUnionData = DenseUnionData;
class ChunkedData extends BaseData {
    constructor(type, length, childVectors, offset, nullCount, childOffsets) {
        super(type, length, offset, nullCount);
        this._childVectors = childVectors;
        this._childOffsets = childOffsets || ChunkedData.computeOffsets(childVectors);
    }
    get childVectors() { return this._childVectors; }
    get childOffsets() { return this._childOffsets; }
    get childData() {
        return this._childData || (this._childData = this._childVectors.map(({ data }) => data));
    }
    get nullCount() {
        let nullCount = this._nullCount;
        if (nullCount === -1) {
            this._nullCount = nullCount = this._childVectors.reduce((x, c) => x + c.nullCount, 0);
        }
        return nullCount;
    }
    clone(length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new ChunkedData(this._type, length, this._childVectors, offset, nullCount, this._childOffsets);
    }
    sliceInternal(clone, offset, length) {
        const chunks = this._childVectors;
        const offsets = this._childOffsets;
        const chunkSlices = [];
        for (let childIndex = -1, numChildren = chunks.length; ++childIndex < numChildren;) {
            const child = chunks[childIndex];
            const childLength = child.length;
            const childOffset = offsets[childIndex];
            // If the child is to the right of the slice boundary, exclude
            if (childOffset >= offset + length) {
                continue;
            }
            // If the child is to the left of of the slice boundary, exclude
            if (offset >= childOffset + childLength) {
                continue;
            }
            // If the child is between both left and right boundaries, include w/o slicing
            if (childOffset >= offset && (childOffset + childLength) <= offset + length) {
                chunkSlices.push(child);
                continue;
            }
            // If the child overlaps one of the slice boundaries, include that slice
            const begin = Math.max(0, offset - childOffset);
            const end = begin + Math.min(childLength - begin, (offset + length) - childOffset);
            chunkSlices.push(child.slice(begin, end));
        }
        clone._childVectors = chunkSlices;
        clone._childOffsets = ChunkedData.computeOffsets(chunkSlices);
        return clone;
    }
    static computeOffsets(childVectors) {
        const childOffsets = new Uint32Array(childVectors.length + 1);
        for (let index = 0, length = childOffsets.length, childOffset = childOffsets[0] = 0; ++index < length;) {
            childOffsets[index] = (childOffset += childVectors[index - 1].length);
        }
        return childOffsets;
    }
}
exports.ChunkedData = ChunkedData;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LEdBQUcsV0FBVyxDQUFDLENBQUM7WUFDbkYsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzlDLENBQUM7UUFDRCxLQUFLLENBQUMsYUFBYSxHQUFHLFdBQVcsQ0FBQztRQUNsQyxLQUFLLENBQUMsYUFBYSxHQUFHLFdBQVcsQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDOUQsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBQ0QsTUFBTSxDQUFDLGNBQWMsQ0FBcUIsWUFBeUI7UUFDL0QsTUFBTSxZQUFZLEdBQUcsSUFBSSxXQUFXLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM5RCxHQUFHLENBQUMsQ0FBQyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsTUFBTSxHQUFHLFlBQVksQ0FBQyxNQUFNLEVBQUUsV0FBVyxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxLQUFLLEdBQUcsTUFBTSxHQUFHLENBQUM7WUFDckcsWUFBWSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsV0FBVyxJQUFJLFlBQVksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUUsQ0FBQztRQUNELE1BQU0sQ0FBQyxZQUFZLENBQUM7SUFDeEIsQ0FBQztDQUNKO0FBekRELGtDQXlEQyIsImZpbGUiOiJkYXRhLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IHBvcGNudF9iaXRfcmFuZ2UgfSBmcm9tICcuL3V0aWwvYml0JztcbmltcG9ydCB7IFZlY3Rvckxpa2UsIFZlY3RvciB9IGZyb20gJy4vdmVjdG9yJztcbmltcG9ydCB7IFZlY3RvclR5cGUsIFR5cGVkQXJyYXksIFR5cGVkQXJyYXlDb25zdHJ1Y3RvciwgRGljdGlvbmFyeSB9IGZyb20gJy4vdHlwZSc7XG5pbXBvcnQgeyBJbnQsIEJvb2wsIEZsYXRMaXN0VHlwZSwgTGlzdCwgRml4ZWRTaXplTGlzdCwgU3RydWN0LCBNYXBfIH0gZnJvbSAnLi90eXBlJztcbmltcG9ydCB7IERhdGFUeXBlLCBGbGF0VHlwZSwgTGlzdFR5cGUsIE5lc3RlZFR5cGUsIERlbnNlVW5pb24sIFNwYXJzZVVuaW9uIH0gZnJvbSAnLi90eXBlJztcblxuZXhwb3J0IGZ1bmN0aW9uIHRvVHlwZWRBcnJheTxUIGV4dGVuZHMgVHlwZWRBcnJheT4oQXJyYXlUeXBlOiBUeXBlZEFycmF5Q29uc3RydWN0b3I8VD4sIHZhbHVlcz86IFQgfCBBcnJheUxpa2U8bnVtYmVyPiB8IEl0ZXJhYmxlPG51bWJlcj4gfCBudWxsKTogVCB7XG4gICAgaWYgKCFBcnJheVR5cGUgJiYgQXJyYXlCdWZmZXIuaXNWaWV3KHZhbHVlcykpIHsgcmV0dXJuIHZhbHVlczsgfVxuICAgIHJldHVybiB2YWx1ZXMgaW5zdGFuY2VvZiBBcnJheVR5cGUgPyB2YWx1ZXNcbiAgICAgICAgIDogIXZhbHVlcyB8fCAhQXJyYXlCdWZmZXIuaXNWaWV3KHZhbHVlcykgPyBBcnJheVR5cGUuZnJvbSh2YWx1ZXMgfHwgW10pXG4gICAgICAgICA6IG5ldyBBcnJheVR5cGUodmFsdWVzLmJ1ZmZlciwgdmFsdWVzLmJ5dGVPZmZzZXQsIHZhbHVlcy5ieXRlTGVuZ3RoIC8gQXJyYXlUeXBlLkJZVEVTX1BFUl9FTEVNRU5UKTtcbn1cblxuZXhwb3J0IHR5cGUgRGF0YTxUIGV4dGVuZHMgRGF0YVR5cGU+ID0gRGF0YVR5cGVzPFQ+W1RbJ1RUeXBlJ11dICYgQmFzZURhdGE8VD47XG5leHBvcnQgaW50ZXJmYWNlIERhdGFUeXBlczxUIGV4dGVuZHMgRGF0YVR5cGU+IHtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLk5PTkVdKi8gIDA6IEJhc2VEYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgW1R5cGUuTnVsbF0qLyAgMTogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgICAgW1R5cGUuSW50XSovICAyOiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgW1R5cGUuRmxvYXRdKi8gIDM6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICAgIFtUeXBlLkJpbmFyeV0qLyAgNDogRmxhdExpc3REYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgW1R5cGUuVXRmOF0qLyAgNTogRmxhdExpc3REYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgW1R5cGUuQm9vbF0qLyAgNjogQm9vbERhdGE7XG4vKiAgICAgICAgICAgICBbVHlwZS5EZWNpbWFsXSovICA3OiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLkRhdGVdKi8gIDg6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgW1R5cGUuVGltZV0qLyAgOTogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgW1R5cGUuVGltZXN0YW1wXSovIDEwOiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgW1R5cGUuSW50ZXJ2YWxdKi8gMTE6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgW1R5cGUuTGlzdF0qLyAxMjogTGlzdERhdGE8TGlzdDxUPj47XG4vKiAgICAgICAgICAgICAgW1R5cGUuU3RydWN0XSovIDEzOiBOZXN0ZWREYXRhPFN0cnVjdD47XG4vKiAgICAgICAgICAgICAgIFtUeXBlLlVuaW9uXSovIDE0OiBVbmlvbkRhdGE7XG4vKiAgICAgW1R5cGUuRml4ZWRTaXplQmluYXJ5XSovIDE1OiBGbGF0RGF0YTxUPjtcbi8qICAgICAgIFtUeXBlLkZpeGVkU2l6ZUxpc3RdKi8gMTY6IExpc3REYXRhPEZpeGVkU2l6ZUxpc3Q8VD4+O1xuLyogICAgICAgICAgICAgICAgIFtUeXBlLk1hcF0qLyAxNzogTmVzdGVkRGF0YTxNYXBfPjtcbi8qICBbVHlwZS5EZW5zZVVuaW9uXSovIERlbnNlVW5pb246IERlbnNlVW5pb25EYXRhO1xuLypbVHlwZS5TcGFyc2VVbmlvbl0qLyBTcGFyc2VVbmlvbjogU3BhcnNlVW5pb25EYXRhO1xuLypbICBUeXBlLkRpY3Rpb25hcnldKi8gRGljdGlvbmFyeTogRGljdGlvbmFyeURhdGE8YW55Pjtcbn1cbi8vIFdoZW4gc2xpY2luZywgd2UgZG8gbm90IGtub3cgdGhlIG51bGwgY291bnQgb2YgdGhlIHNsaWNlZCByYW5nZSB3aXRob3V0XG4vLyBkb2luZyBzb21lIGNvbXB1dGF0aW9uLiBUbyBhdm9pZCBkb2luZyB0aGlzIGVhZ2VybHksIHdlIHNldCB0aGUgbnVsbCBjb3VudFxuLy8gdG8gLTEgKGFueSBuZWdhdGl2ZSBudW1iZXIgd2lsbCBkbykuIFdoZW4gQXJyYXk6Om51bGxfY291bnQgaXMgY2FsbGVkIHRoZVxuLy8gZmlyc3QgdGltZSwgdGhlIG51bGwgY291bnQgd2lsbCBiZSBjb21wdXRlZC4gU2VlIEFSUk9XLTMzXG5leHBvcnQgdHlwZSBrVW5rbm93bk51bGxDb3VudCA9IC0xO1xuZXhwb3J0IGNvbnN0IGtVbmtub3duTnVsbENvdW50ID0gLTE7XG5cbmV4cG9ydCBjbGFzcyBCYXNlRGF0YTxUIGV4dGVuZHMgRGF0YVR5cGUgPSBEYXRhVHlwZT4gaW1wbGVtZW50cyBWZWN0b3JMaWtlIHtcbiAgICBwcm90ZWN0ZWQgX3R5cGU6IFQ7XG4gICAgcHJvdGVjdGVkIF9sZW5ndGg6IG51bWJlcjtcbiAgICBwcm90ZWN0ZWQgX29mZnNldDogbnVtYmVyO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBwcm90ZWN0ZWQgX2NoaWxkRGF0YTogRGF0YTxhbnk+W107XG4gICAgcHJvdGVjdGVkIF9udWxsQ291bnQ6IG51bWJlciB8IGtVbmtub3duTnVsbENvdW50O1xuICAgIHByb3RlY3RlZCAvKiAgW1ZlY3RvclR5cGUuT0ZGU0VUXToqLyAwPzogSW50MzJBcnJheTtcbiAgICBwcm90ZWN0ZWQgLyogICAgW1ZlY3RvclR5cGUuREFUQV06Ki8gMT86IFRbJ1RBcnJheSddO1xuICAgIHByb3RlY3RlZCAvKltWZWN0b3JUeXBlLlZBTElESVRZXToqLyAyPzogVWludDhBcnJheTtcbiAgICBwcm90ZWN0ZWQgLyogICAgW1ZlY3RvclR5cGUuVFlQRV06Ki8gMz86IEludDhBcnJheTtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fdHlwZSA9IHR5cGU7XG4gICAgICAgIHRoaXMuX2xlbmd0aCA9IE1hdGguZmxvb3IoTWF0aC5tYXgobGVuZ3RoIHx8IDAsIDApKTtcbiAgICAgICAgdGhpcy5fb2Zmc2V0ID0gTWF0aC5mbG9vcihNYXRoLm1heChvZmZzZXQgfHwgMCwgMCkpO1xuICAgICAgICB0aGlzLl9udWxsQ291bnQgPSBNYXRoLmZsb29yKE1hdGgubWF4KG51bGxDb3VudCB8fCAwLCAtMSkpO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IHR5cGUoKSB7IHJldHVybiB0aGlzLl90eXBlOyB9XG4gICAgcHVibGljIGdldCBsZW5ndGgoKSB7IHJldHVybiB0aGlzLl9sZW5ndGg7IH1cbiAgICBwdWJsaWMgZ2V0IG9mZnNldCgpIHsgcmV0dXJuIHRoaXMuX29mZnNldDsgfVxuICAgIHB1YmxpYyBnZXQgdHlwZUlkKCkgeyByZXR1cm4gdGhpcy5fdHlwZS5UVHlwZTsgfVxuICAgIHB1YmxpYyBnZXQgY2hpbGREYXRhKCkgeyByZXR1cm4gdGhpcy5fY2hpbGREYXRhOyB9XG4gICAgcHVibGljIGdldCBudWxsQml0bWFwKCkgeyByZXR1cm4gdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXTsgfVxuICAgIHB1YmxpYyBnZXQgbnVsbENvdW50KCkge1xuICAgICAgICBsZXQgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50O1xuICAgICAgICBsZXQgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKG51bGxDb3VudCA9PT0gLTEgJiYgKG51bGxCaXRtYXAgPSB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldKSkge1xuICAgICAgICAgICAgdGhpcy5fbnVsbENvdW50ID0gbnVsbENvdW50ID0gcG9wY250X2JpdF9yYW5nZShudWxsQml0bWFwLCB0aGlzLl9vZmZzZXQsIHRoaXMuX29mZnNldCArIHRoaXMuX2xlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGxDb3VudDtcbiAgICB9XG4gICAgcHVibGljIGNsb25lKGxlbmd0aCA9IHRoaXMuX2xlbmd0aCwgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCYXNlRGF0YTxUPih0aGlzLl90eXBlLCBsZW5ndGgsIG9mZnNldCwgbnVsbENvdW50KSBhcyB0aGlzO1xuICAgIH1cbiAgICBwdWJsaWMgc2xpY2Uob2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiBsZW5ndGggPD0gMCA/IHRoaXMgOiB0aGlzLnNsaWNlSW50ZXJuYWwodGhpcy5jbG9uZShcbiAgICAgICAgICAgIGxlbmd0aCwgdGhpcy5fb2Zmc2V0ICsgb2Zmc2V0LCArKHRoaXMuX251bGxDb3VudCA9PT0gMCkgLSAxXG4gICAgICAgICksIG9mZnNldCwgbGVuZ3RoKTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNsaWNlSW50ZXJuYWwoY2xvbmU6IHRoaXMsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICBsZXQgYXJyOiBhbnk7XG4gICAgICAgIC8vIElmIHR5cGVJZHMgZXhpc3QsIHNsaWNlIHRoZSB0eXBlSWRzIGJ1ZmZlclxuICAgICAgICAoYXJyID0gdGhpc1tWZWN0b3JUeXBlLlRZUEVdKSAmJiAoY2xvbmVbVmVjdG9yVHlwZS5UWVBFXSA9IHRoaXMuc2xpY2VEYXRhKGFyciwgb2Zmc2V0LCBsZW5ndGgpKTtcbiAgICAgICAgLy8gSWYgb2Zmc2V0cyBleGlzdCwgb25seSBzbGljZSB0aGUgb2Zmc2V0cyBidWZmZXJcbiAgICAgICAgKGFyciA9IHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdKSAmJiAoY2xvbmVbVmVjdG9yVHlwZS5PRkZTRVRdID0gdGhpcy5zbGljZU9mZnNldHMoYXJyLCBvZmZzZXQsIGxlbmd0aCkpIHx8XG4gICAgICAgICAgICAvLyBPdGhlcndpc2UgaWYgbm8gb2Zmc2V0cywgc2xpY2UgdGhlIGRhdGEgYnVmZmVyXG4gICAgICAgICAgICAoYXJyID0gdGhpc1tWZWN0b3JUeXBlLkRBVEFdKSAmJiAoY2xvbmVbVmVjdG9yVHlwZS5EQVRBXSA9IHRoaXMuc2xpY2VEYXRhKGFyciwgb2Zmc2V0LCBsZW5ndGgpKTtcbiAgICAgICAgcmV0dXJuIGNsb25lO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VEYXRhKGRhdGE6IFRbJ1RBcnJheSddICYgVHlwZWRBcnJheSwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiBkYXRhLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNsaWNlT2Zmc2V0cyh2YWx1ZU9mZnNldHM6IEludDMyQXJyYXksIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gdmFsdWVPZmZzZXRzLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoICsgMSk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRmxhdERhdGE8VCBleHRlbmRzIEZsYXRUeXBlPiBleHRlbmRzIEJhc2VEYXRhPFQ+IHtcbiAgICBwdWJsaWMgLyogICAgW1ZlY3RvclR5cGUuREFUQV06Ki8gMTogVFsnVEFycmF5J107XG4gICAgcHVibGljIC8qW1ZlY3RvclR5cGUuVkFMSURJVFldOiovIDI6IFVpbnQ4QXJyYXk7XG4gICAgcHVibGljIGdldCB2YWx1ZXMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuREFUQV07IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIGRhdGE6IEl0ZXJhYmxlPG51bWJlcj4sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuREFUQV0gPSB0b1R5cGVkQXJyYXkodGhpcy5BcnJheVR5cGUsIGRhdGEpO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldID0gdG9UeXBlZEFycmF5KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IEFycmF5VHlwZSgpOiBUWydBcnJheVR5cGUnXSB7IHJldHVybiB0aGlzLl90eXBlLkFycmF5VHlwZTsgfVxuICAgIHB1YmxpYyBjbG9uZShsZW5ndGggPSB0aGlzLl9sZW5ndGgsIG9mZnNldCA9IHRoaXMuX29mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgRmxhdERhdGE8VD4odGhpcy5fdHlwZSwgbGVuZ3RoLCB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLCB0aGlzW1ZlY3RvclR5cGUuREFUQV0sIG9mZnNldCwgbnVsbENvdW50KSBhcyB0aGlzO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEJvb2xEYXRhIGV4dGVuZHMgRmxhdERhdGE8Qm9vbD4ge1xuICAgIHByb3RlY3RlZCBzbGljZURhdGEoZGF0YTogVWludDhBcnJheSkgeyByZXR1cm4gZGF0YTsgfVxuICAgIHB1YmxpYyBjbG9uZShsZW5ndGggPSB0aGlzLl9sZW5ndGgsIG9mZnNldCA9IHRoaXMuX29mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgQm9vbERhdGEodGhpcy5fdHlwZSwgbGVuZ3RoLCB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLCB0aGlzW1ZlY3RvclR5cGUuREFUQV0sIG9mZnNldCwgbnVsbENvdW50KSBhcyB0aGlzO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEZsYXRMaXN0RGF0YTxUIGV4dGVuZHMgRmxhdExpc3RUeXBlPiBleHRlbmRzIEZsYXREYXRhPFQ+IHtcbiAgICBwdWJsaWMgLyogIFtWZWN0b3JUeXBlLk9GRlNFVF06Ki8gMDogSW50MzJBcnJheTtcbiAgICBwdWJsaWMgLyogICAgW1ZlY3RvclR5cGUuREFUQV06Ki8gMTogVFsnVEFycmF5J107XG4gICAgcHVibGljIC8qW1ZlY3RvclR5cGUuVkFMSURJVFldOiovIDI6IFVpbnQ4QXJyYXk7XG4gICAgcHVibGljIGdldCB2YWx1ZXMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuREFUQV07IH1cbiAgICBwdWJsaWMgZ2V0IHZhbHVlT2Zmc2V0cygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdOyB9XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCB2YWx1ZU9mZnNldHM6IEl0ZXJhYmxlPG51bWJlcj4sIGRhdGE6IFRbJ1RBcnJheSddLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIGRhdGEsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0gPSB0b1R5cGVkQXJyYXkoSW50MzJBcnJheSwgdmFsdWVPZmZzZXRzKTtcbiAgICB9XG4gICAgcHVibGljIGNsb25lKGxlbmd0aCA9IHRoaXMuX2xlbmd0aCwgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBGbGF0TGlzdERhdGE8VD4odGhpcy5fdHlwZSwgbGVuZ3RoLCB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLCB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSwgdGhpc1tWZWN0b3JUeXBlLkRBVEFdLCBvZmZzZXQsIG51bGxDb3VudCkgYXMgdGhpcztcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBEaWN0aW9uYXJ5RGF0YTxUIGV4dGVuZHMgRGF0YVR5cGU+IGV4dGVuZHMgQmFzZURhdGE8RGljdGlvbmFyeTxUPj4ge1xuICAgIHByb3RlY3RlZCBfZGljdGlvbmFyeTogVmVjdG9yPFQ+O1xuICAgIHByb3RlY3RlZCBfaW5kaWNpZXM6IERhdGE8SW50PGFueT4+O1xuICAgIHB1YmxpYyBnZXQgaW5kaWNpZXMoKSB7IHJldHVybiB0aGlzLl9pbmRpY2llczsgfVxuICAgIHB1YmxpYyBnZXQgZGljdGlvbmFyeSgpIHsgcmV0dXJuIHRoaXMuX2RpY3Rpb25hcnk7IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBEaWN0aW9uYXJ5PFQ+LCBkaWN0aW9uYXJ5OiBWZWN0b3I8VD4sIGluZGljaWVzOiBEYXRhPEludDxhbnk+Pikge1xuICAgICAgICBzdXBlcih0eXBlLCBpbmRpY2llcy5sZW5ndGgsIChpbmRpY2llcyBhcyBhbnkpLl9udWxsQ291bnQpO1xuICAgICAgICB0aGlzLl9pbmRpY2llcyA9IGluZGljaWVzO1xuICAgICAgICB0aGlzLl9kaWN0aW9uYXJ5ID0gZGljdGlvbmFyeTtcbiAgICB9XG4gICAgcHVibGljIGdldCBsZW5ndGgoKSB7IHJldHVybiB0aGlzLl9pbmRpY2llcy5sZW5ndGg7IH1cbiAgICBwdWJsaWMgZ2V0IG51bGxDb3VudCgpIHsgcmV0dXJuIHRoaXMuX2luZGljaWVzLm51bGxDb3VudDsgfVxuICAgIHB1YmxpYyBjbG9uZShsZW5ndGggPSB0aGlzLl9sZW5ndGgsIG9mZnNldCA9IHRoaXMuX29mZnNldCkge1xuICAgICAgICByZXR1cm4gbmV3IERpY3Rpb25hcnlEYXRhPFQ+KHRoaXMuX3R5cGUsIHRoaXMuX2RpY3Rpb25hcnksIHRoaXMuX2luZGljaWVzLnNsaWNlKG9mZnNldCAtIHRoaXMuX29mZnNldCwgbGVuZ3RoKSkgYXMgdGhpcztcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNsaWNlSW50ZXJuYWwoY2xvbmU6IHRoaXMsIF9vZmZzZXQ6IG51bWJlciwgX2xlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIGNsb25lLl9sZW5ndGggPSBjbG9uZS5faW5kaWNpZXMubGVuZ3RoO1xuICAgICAgICBjbG9uZS5fbnVsbENvdW50ID0gKGNsb25lLl9pbmRpY2llcyBhcyBhbnkpLl9udWxsQ291bnQ7XG4gICAgICAgIHJldHVybiBjbG9uZTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBOZXN0ZWREYXRhPFQgZXh0ZW5kcyBOZXN0ZWRUeXBlID0gTmVzdGVkVHlwZT4gZXh0ZW5kcyBCYXNlRGF0YTxUPiB7XG4gICAgcHVibGljIC8qW1ZlY3RvclR5cGUuVkFMSURJVFldOiovIDI6IFVpbnQ4QXJyYXk7XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCBjaGlsZERhdGE6IERhdGE8YW55PltdLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpcy5fY2hpbGREYXRhID0gY2hpbGREYXRhO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldID0gdG9UeXBlZEFycmF5KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmUobGVuZ3RoID0gdGhpcy5fbGVuZ3RoLCBvZmZzZXQgPSB0aGlzLl9vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IE5lc3RlZERhdGE8VD4odGhpcy5fdHlwZSwgbGVuZ3RoLCB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLCB0aGlzLl9jaGlsZERhdGEsIG9mZnNldCwgbnVsbENvdW50KSBhcyB0aGlzO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VJbnRlcm5hbChjbG9uZTogdGhpcywgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIGlmICghdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0pIHtcbiAgICAgICAgICAgIGNsb25lLl9jaGlsZERhdGEgPSB0aGlzLl9jaGlsZERhdGEubWFwKChjaGlsZCkgPT4gY2hpbGQuc2xpY2Uob2Zmc2V0LCBsZW5ndGgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3VwZXIuc2xpY2VJbnRlcm5hbChjbG9uZSwgb2Zmc2V0LCBsZW5ndGgpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIExpc3REYXRhPFQgZXh0ZW5kcyBMaXN0VHlwZT4gZXh0ZW5kcyBOZXN0ZWREYXRhPFQ+IHtcbiAgICBwdWJsaWMgLyogIFtWZWN0b3JUeXBlLk9GRlNFVF06Ki8gMDogSW50MzJBcnJheTtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBwcm90ZWN0ZWQgX3ZhbHVlc0RhdGE6IERhdGE8VD47XG4gICAgcHVibGljIGdldCB2YWx1ZXMoKSB7IHJldHVybiB0aGlzLl92YWx1ZXNEYXRhOyB9XG4gICAgcHVibGljIGdldCB2YWx1ZU9mZnNldHMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXTsgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgdmFsdWVPZmZzZXRzOiBJdGVyYWJsZTxudW1iZXI+LCB2YWx1ZUNoaWxkRGF0YTogRGF0YTxUPiwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBudWxsQml0bWFwLCBbdmFsdWVDaGlsZERhdGFdLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXMuX3ZhbHVlc0RhdGEgPSB2YWx1ZUNoaWxkRGF0YTtcbiAgICAgICAgdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0gPSB0b1R5cGVkQXJyYXkoSW50MzJBcnJheSwgdmFsdWVPZmZzZXRzKTtcbiAgICB9XG4gICAgcHVibGljIGNsb25lKGxlbmd0aCA9IHRoaXMuX2xlbmd0aCwgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBMaXN0RGF0YTxUPih0aGlzLl90eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdLCB0aGlzLl92YWx1ZXNEYXRhLCBvZmZzZXQsIG51bGxDb3VudCkgYXMgdGhpcztcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBVbmlvbkRhdGE8VCBleHRlbmRzIChEZW5zZVVuaW9uIHwgU3BhcnNlVW5pb24pID0gYW55PiBleHRlbmRzIE5lc3RlZERhdGE8VD4ge1xuICAgIHB1YmxpYyAvKiAgICBbVmVjdG9yVHlwZS5UWVBFXToqLyAzOiBUWydUQXJyYXknXTtcbiAgICBwdWJsaWMgZ2V0IHR5cGVJZHMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuVFlQRV07IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHR5cGVJZHM6IEl0ZXJhYmxlPG51bWJlcj4sIGNoaWxkRGF0YTogRGF0YTxhbnk+W10sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgbnVsbEJpdG1hcCwgY2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5UWVBFXSA9IHRvVHlwZWRBcnJheShJbnQ4QXJyYXksIHR5cGVJZHMpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmUobGVuZ3RoID0gdGhpcy5fbGVuZ3RoLCBvZmZzZXQgPSB0aGlzLl9vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IFVuaW9uRGF0YTxUPih0aGlzLl90eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXNbVmVjdG9yVHlwZS5UWVBFXSwgdGhpcy5fY2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCkgYXMgdGhpcztcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTcGFyc2VVbmlvbkRhdGEgZXh0ZW5kcyBVbmlvbkRhdGE8U3BhcnNlVW5pb24+IHtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBTcGFyc2VVbmlvbiwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCB0eXBlSWRzOiBJdGVyYWJsZTxudW1iZXI+LCBjaGlsZERhdGE6IERhdGE8YW55PltdLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIHR5cGVJZHMsIGNoaWxkRGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmUobGVuZ3RoID0gdGhpcy5fbGVuZ3RoLCBvZmZzZXQgPSB0aGlzLl9vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IFNwYXJzZVVuaW9uRGF0YSh0aGlzLl90eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXNbVmVjdG9yVHlwZS5UWVBFXSwgdGhpcy5fY2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCkgYXMgdGhpcztcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBEZW5zZVVuaW9uRGF0YSBleHRlbmRzIFVuaW9uRGF0YTxEZW5zZVVuaW9uPiB7XG4gICAgcHVibGljIC8qICBbVmVjdG9yVHlwZS5PRkZTRVRdOiovIDA6IEludDMyQXJyYXk7XG4gICAgcHVibGljIGdldCB2YWx1ZU9mZnNldHMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXTsgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IERlbnNlVW5pb24sIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgdHlwZUlkczogSXRlcmFibGU8bnVtYmVyPiwgdmFsdWVPZmZzZXRzOiBJdGVyYWJsZTxudW1iZXI+LCBjaGlsZERhdGE6IERhdGE8YW55PltdLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIHR5cGVJZHMsIGNoaWxkRGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSA9IHRvVHlwZWRBcnJheShJbnQzMkFycmF5LCB2YWx1ZU9mZnNldHMpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmUobGVuZ3RoID0gdGhpcy5fbGVuZ3RoLCBvZmZzZXQgPSB0aGlzLl9vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IERlbnNlVW5pb25EYXRhKHRoaXMuX3R5cGUsIGxlbmd0aCwgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSwgdGhpc1tWZWN0b3JUeXBlLlRZUEVdLCB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSwgdGhpcy5fY2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCkgYXMgdGhpcztcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDaHVua2VkRGF0YTxUIGV4dGVuZHMgRGF0YVR5cGU+IGV4dGVuZHMgQmFzZURhdGE8VD4ge1xuICAgIHByb3RlY3RlZCBfY2hpbGRWZWN0b3JzOiBWZWN0b3I8VD5bXTtcbiAgICBwcm90ZWN0ZWQgX2NoaWxkT2Zmc2V0czogVWludDMyQXJyYXk7XG4gICAgcHVibGljIGdldCBjaGlsZFZlY3RvcnMoKSB7IHJldHVybiB0aGlzLl9jaGlsZFZlY3RvcnM7IH1cbiAgICBwdWJsaWMgZ2V0IGNoaWxkT2Zmc2V0cygpIHsgcmV0dXJuIHRoaXMuX2NoaWxkT2Zmc2V0czsgfVxuICAgIHB1YmxpYyBnZXQgY2hpbGREYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGREYXRhIHx8IChcbiAgICAgICAgICAgICAgIHRoaXMuX2NoaWxkRGF0YSA9IHRoaXMuX2NoaWxkVmVjdG9ycy5tYXAoKHsgZGF0YSB9KSA9PiBkYXRhKSk7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBjaGlsZFZlY3RvcnM6IFZlY3RvcjxUPltdLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlciwgY2hpbGRPZmZzZXRzPzogVWludDMyQXJyYXkpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXMuX2NoaWxkVmVjdG9ycyA9IGNoaWxkVmVjdG9ycztcbiAgICAgICAgdGhpcy5fY2hpbGRPZmZzZXRzID0gY2hpbGRPZmZzZXRzIHx8IENodW5rZWREYXRhLmNvbXB1dGVPZmZzZXRzKGNoaWxkVmVjdG9ycyk7XG4gICAgfVxuICAgIHB1YmxpYyBnZXQgbnVsbENvdW50KCkge1xuICAgICAgICBsZXQgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50O1xuICAgICAgICBpZiAobnVsbENvdW50ID09PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5fbnVsbENvdW50ID0gbnVsbENvdW50ID0gdGhpcy5fY2hpbGRWZWN0b3JzLnJlZHVjZSgoeCwgYykgPT4geCArIGMubnVsbENvdW50LCAwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbENvdW50O1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmUobGVuZ3RoID0gdGhpcy5fbGVuZ3RoLCBvZmZzZXQgPSB0aGlzLl9vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IENodW5rZWREYXRhPFQ+KHRoaXMuX3R5cGUsIGxlbmd0aCwgdGhpcy5fY2hpbGRWZWN0b3JzLCBvZmZzZXQsIG51bGxDb3VudCwgdGhpcy5fY2hpbGRPZmZzZXRzKSBhcyB0aGlzO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VJbnRlcm5hbChjbG9uZTogdGhpcywgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IGNodW5rcyA9IHRoaXMuX2NoaWxkVmVjdG9ycztcbiAgICAgICAgY29uc3Qgb2Zmc2V0cyA9IHRoaXMuX2NoaWxkT2Zmc2V0cztcbiAgICAgICAgY29uc3QgY2h1bmtTbGljZXM6IFZlY3RvcjxUPltdID0gW107XG4gICAgICAgIGZvciAobGV0IGNoaWxkSW5kZXggPSAtMSwgbnVtQ2hpbGRyZW4gPSBjaHVua3MubGVuZ3RoOyArK2NoaWxkSW5kZXggPCBudW1DaGlsZHJlbjspIHtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gY2h1bmtzW2NoaWxkSW5kZXhdO1xuICAgICAgICAgICAgY29uc3QgY2hpbGRMZW5ndGggPSBjaGlsZC5sZW5ndGg7XG4gICAgICAgICAgICBjb25zdCBjaGlsZE9mZnNldCA9IG9mZnNldHNbY2hpbGRJbmRleF07XG4gICAgICAgICAgICAvLyBJZiB0aGUgY2hpbGQgaXMgdG8gdGhlIHJpZ2h0IG9mIHRoZSBzbGljZSBib3VuZGFyeSwgZXhjbHVkZVxuICAgICAgICAgICAgaWYgKGNoaWxkT2Zmc2V0ID49IG9mZnNldCArIGxlbmd0aCkgeyBjb250aW51ZTsgfVxuICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkIGlzIHRvIHRoZSBsZWZ0IG9mIG9mIHRoZSBzbGljZSBib3VuZGFyeSwgZXhjbHVkZVxuICAgICAgICAgICAgaWYgKG9mZnNldCA+PSBjaGlsZE9mZnNldCArIGNoaWxkTGVuZ3RoKSB7IGNvbnRpbnVlOyB9XG4gICAgICAgICAgICAvLyBJZiB0aGUgY2hpbGQgaXMgYmV0d2VlbiBib3RoIGxlZnQgYW5kIHJpZ2h0IGJvdW5kYXJpZXMsIGluY2x1ZGUgdy9vIHNsaWNpbmdcbiAgICAgICAgICAgIGlmIChjaGlsZE9mZnNldCA+PSBvZmZzZXQgJiYgKGNoaWxkT2Zmc2V0ICsgY2hpbGRMZW5ndGgpIDw9IG9mZnNldCArIGxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNodW5rU2xpY2VzLnB1c2goY2hpbGQpO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkIG92ZXJsYXBzIG9uZSBvZiB0aGUgc2xpY2UgYm91bmRhcmllcywgaW5jbHVkZSB0aGF0IHNsaWNlXG4gICAgICAgICAgICBjb25zdCBiZWdpbiA9IE1hdGgubWF4KDAsIG9mZnNldCAtIGNoaWxkT2Zmc2V0KTtcbiAgICAgICAgICAgIGNvbnN0IGVuZCA9IGJlZ2luICsgTWF0aC5taW4oY2hpbGRMZW5ndGggLSBiZWdpbiwgKG9mZnNldCArIGxlbmd0aCkgLSBjaGlsZE9mZnNldCk7XG4gICAgICAgICAgICBjaHVua1NsaWNlcy5wdXNoKGNoaWxkLnNsaWNlKGJlZ2luLCBlbmQpKTtcbiAgICAgICAgfVxuICAgICAgICBjbG9uZS5fY2hpbGRWZWN0b3JzID0gY2h1bmtTbGljZXM7XG4gICAgICAgIGNsb25lLl9jaGlsZE9mZnNldHMgPSBDaHVua2VkRGF0YS5jb21wdXRlT2Zmc2V0cyhjaHVua1NsaWNlcyk7XG4gICAgICAgIHJldHVybiBjbG9uZTtcbiAgICB9XG4gICAgc3RhdGljIGNvbXB1dGVPZmZzZXRzPFQgZXh0ZW5kcyBEYXRhVHlwZT4oY2hpbGRWZWN0b3JzOiBWZWN0b3I8VD5bXSkge1xuICAgICAgICBjb25zdCBjaGlsZE9mZnNldHMgPSBuZXcgVWludDMyQXJyYXkoY2hpbGRWZWN0b3JzLmxlbmd0aCArIDEpO1xuICAgICAgICBmb3IgKGxldCBpbmRleCA9IDAsIGxlbmd0aCA9IGNoaWxkT2Zmc2V0cy5sZW5ndGgsIGNoaWxkT2Zmc2V0ID0gY2hpbGRPZmZzZXRzWzBdID0gMDsgKytpbmRleCA8IGxlbmd0aDspIHtcbiAgICAgICAgICAgIGNoaWxkT2Zmc2V0c1tpbmRleF0gPSAoY2hpbGRPZmZzZXQgKz0gY2hpbGRWZWN0b3JzW2luZGV4IC0gMV0ubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hpbGRPZmZzZXRzO1xuICAgIH1cbn1cbiJdfQ==
