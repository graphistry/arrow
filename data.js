"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const bit_1 = require("./util/bit");
const buffer_1 = require("./util/buffer");
const enum_1 = require("./enum");
/** @ignore */ exports.kUnknownNullCount = -1;
/** @ignore */
class Data {
    constructor(type, offset, length, nullCount, buffers, childData) {
        this.type = type;
        this.offset = Math.floor(Math.max(offset || 0, 0));
        this.length = Math.floor(Math.max(length || 0, 0));
        this._nullCount = Math.floor(Math.max(nullCount || 0, -1));
        this.childData = (childData || []).map((x) => x instanceof Data ? x : x.data);
        let buffer;
        if (buffers instanceof Data) {
            this.stride = buffers.stride;
            this.values = buffers.values;
            this.typeIds = buffers.typeIds;
            this.nullBitmap = buffers.nullBitmap;
            this.valueOffsets = buffers.valueOffsets;
        }
        else {
            if (buffers) {
                (buffer = buffers[0]) && (this.valueOffsets = buffer);
                (buffer = buffers[1]) && (this.values = buffer);
                (buffer = buffers[2]) && (this.nullBitmap = buffer);
                (buffer = buffers[3]) && (this.typeIds = buffer);
            }
            const t = type;
            switch (type.typeId) {
                case enum_1.Type.Decimal:
                    this.stride = 4;
                    break;
                case enum_1.Type.Timestamp:
                    this.stride = 2;
                    break;
                case enum_1.Type.Date:
                    this.stride = 1 + t.unit;
                    break;
                case enum_1.Type.Interval:
                    this.stride = 1 + t.unit;
                    break;
                case enum_1.Type.Int:
                    this.stride = 1 + +(t.bitWidth > 32);
                    break;
                case enum_1.Type.Time:
                    this.stride = 1 + +(t.bitWidth > 32);
                    break;
                case enum_1.Type.FixedSizeList:
                    this.stride = t.listSize;
                    break;
                case enum_1.Type.FixedSizeBinary:
                    this.stride = t.byteWidth;
                    break;
                default: this.stride = 1;
            }
        }
    }
    get ArrayType() { return this.type.ArrayType; }
    get typeId() { return this.type.typeId; }
    get buffers() {
        return [this.valueOffsets, this.values, this.nullBitmap, this.typeIds];
    }
    get nullCount() {
        let nullCount = this._nullCount;
        let nullBitmap;
        if (nullCount <= exports.kUnknownNullCount && (nullBitmap = this.nullBitmap)) {
            this._nullCount = nullCount = this.length - bit_1.popcnt_bit_range(nullBitmap, this.offset, this.offset + this.length);
        }
        return nullCount;
    }
    clone(type, offset = this.offset, length = this.length, nullCount = this._nullCount, buffers = this, childData = this.childData) {
        return new Data(type, offset, length, nullCount, buffers, childData);
    }
    slice(offset, length) {
        // +true === 1, +false === 0, so this means
        // we keep nullCount at 0 if it's already 0,
        // otherwise set to the invalidated flag -1
        const { stride, typeId, childData } = this;
        const nullCount = +(this._nullCount === 0) - 1;
        const childStride = typeId === 16 /* FixedSizeList */ ? stride : 1;
        const buffers = this._sliceBuffers(offset, length, stride, typeId);
        return this.clone(this.type, this.offset + offset, length, nullCount, buffers, 
        // Don't slice children if we have value offsets (the variable-width types)
        (!childData.length || this.valueOffsets) ? childData : this._sliceChildren(childData, childStride * offset, childStride * length));
    }
    _sliceBuffers(offset, length, stride, typeId) {
        let arr, { buffers } = this;
        // If typeIds exist, slice the typeIds buffer
        (arr = buffers[enum_1.VectorType.TYPE]) && (buffers[enum_1.VectorType.TYPE] = arr.subarray(offset, offset + length));
        // If offsets exist, only slice the offsets buffer
        (arr = buffers[enum_1.VectorType.OFFSET]) && (buffers[enum_1.VectorType.OFFSET] = arr.subarray(offset, offset + length + 1)) ||
            // Otherwise if no offsets, slice the data buffer. Don't slice the data vector for Booleans, since the offset goes by bits not bytes
            (arr = buffers[enum_1.VectorType.DATA]) && (buffers[enum_1.VectorType.DATA] = typeId === 6 ? arr : arr.subarray(stride * offset, stride * (offset + length)));
        return buffers;
    }
    _sliceChildren(childData, offset, length) {
        return childData.map((child) => child.slice(offset, length));
    }
    //
    // Convenience methods for creating Data instances for each of the Arrow Vector types
    //
    /** @nocollapse */
    static Null(type, offset, length, nullCount, nullBitmap) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap)
        });
    }
    /** @nocollapse */
    static Int(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Dictionary(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.indices.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Float(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Bool(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Decimal(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Date(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Time(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Timestamp(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Interval(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static FixedSizeBinary(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Binary(type, offset, length, nullCount, nullBitmap, valueOffsets, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.OFFSET]: buffer_1.toArrayBufferView(Int32Array, valueOffsets),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(Uint8Array, data)
        });
    }
    /** @nocollapse */
    static Utf8(type, offset, length, nullCount, nullBitmap, valueOffsets, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.OFFSET]: buffer_1.toArrayBufferView(Int32Array, valueOffsets),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(Uint8Array, data)
        });
    }
    /** @nocollapse */
    static List(type, offset, length, nullCount, nullBitmap, valueOffsets, child) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.OFFSET]: buffer_1.toArrayBufferView(Int32Array, valueOffsets)
        }, [child]);
    }
    /** @nocollapse */
    static FixedSizeList(type, offset, length, nullCount, nullBitmap, child) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap)
        }, [child]);
    }
    /** @nocollapse */
    static Struct(type, offset, length, nullCount, nullBitmap, children) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap)
        }, children);
    }
    /** @nocollapse */
    static Map(type, offset, length, nullCount, nullBitmap, children) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap)
        }, children);
    }
    /** @nocollapse */
    static Union(type, offset, length, nullCount, nullBitmap, typeIds, valueOffsetsOrChildren, children) {
        const buffers = {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.TYPE]: buffer_1.toArrayBufferView(type.ArrayType, typeIds)
        };
        if (type.mode === enum_1.UnionMode.Sparse) {
            return new Data(type, offset, length, nullCount, buffers, valueOffsetsOrChildren);
        }
        buffers[enum_1.VectorType.OFFSET] = buffer_1.toArrayBufferView(Int32Array, valueOffsetsOrChildren);
        return new Data(type, offset, length, nullCount, buffers, children);
    }
}
exports.Data = Data;
(Data.prototype.childData = Object.freeze([]));

//# sourceMappingURL=data:application/json;charset=utf8;base64,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SUFBSSxDQUFpQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDdEksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUU7WUFDN0MsQ0FBQyxpQkFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLDBCQUFpQixDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUM7WUFDaEUsQ0FBQyxpQkFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLDBCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDO1NBQzdELENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsT0FBTyxDQUFvQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDNUksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUU7WUFDN0MsQ0FBQyxpQkFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLDBCQUFpQixDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUM7WUFDaEUsQ0FBQyxpQkFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLDBCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDO1NBQzdELENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsSUFBSSxDQUFrQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDdkksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUU7WUFDN0MsQ0FBQyxpQkFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLDBCQUFpQixDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUM7WUFDaEUsQ0FBQyxpQkFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLDBCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDO1NBQzdELENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsSUFBSSxDQUFpQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDdEksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUU7WUFDN0MsQ0FBQyxpQkFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLDBCQUFpQixDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUM7WUFDaEUsQ0FBQyxpQkFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLDBCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDO1NBQzdELENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsU0FBUyxDQUFzQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDaEosT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUU7WUFDN0MsQ0FBQyxpQkFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLDBCQUFpQixDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUM7WUFDaEUsQ0FBQyxpQkFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLDBCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDO1NBQzdELENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsUUFBUSxDQUFxQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDOUksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0s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VSxFQUFFLFVBQVUsQ0FBQztZQUNoRSxDQUFDLGlCQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsMEJBQWlCLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUM7U0FDekMsQ0FBQztRQUN6QixJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssZ0JBQVMsQ0FBQyxNQUFNLEVBQUU7WUFDaEMsT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLHNCQUEyQyxDQUFDLENBQUM7U0FDMUc7UUFDRCxPQUFPLENBQUMsaUJBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRywwQkFBaUIsQ0FBQyxVQUFVLEVBQXVCLHNCQUFzQixDQUFDLENBQUM7UUFDeEcsT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ3hFLENBQUM7Q0FDSjtBQXhPRCxvQkF3T0M7QUFFRCxDQUFFLElBQUksQ0FBQyxTQUFpQixDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiZGF0YS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBWZWN0b3IgfSBmcm9tICcuL3ZlY3Rvcic7XG5pbXBvcnQgeyBwb3BjbnRfYml0X3JhbmdlIH0gZnJvbSAnLi91dGlsL2JpdCc7XG5pbXBvcnQgeyB0b0FycmF5QnVmZmVyVmlldyB9IGZyb20gJy4vdXRpbC9idWZmZXInO1xuaW1wb3J0IHsgRGF0YVR5cGUsIFNwYXJzZVVuaW9uLCBEZW5zZVVuaW9uIH0gZnJvbSAnLi90eXBlJztcbmltcG9ydCB7IFZlY3RvclR5cGUgYXMgQnVmZmVyVHlwZSwgVW5pb25Nb2RlLCBUeXBlIH0gZnJvbSAnLi9lbnVtJztcbmltcG9ydCB7XG4gICAgRGljdGlvbmFyeSxcbiAgICBOdWxsLCBJbnQsIEZsb2F0LFxuICAgIEJpbmFyeSwgQm9vbCwgVXRmOCwgRGVjaW1hbCxcbiAgICBEYXRlXywgVGltZSwgVGltZXN0YW1wLCBJbnRlcnZhbCxcbiAgICBMaXN0LCBTdHJ1Y3QsIFVuaW9uLCBGaXhlZFNpemVCaW5hcnksIEZpeGVkU2l6ZUxpc3QsIE1hcF8sXG59IGZyb20gJy4vdHlwZSc7XG5cbi8vIFdoZW4gc2xpY2luZywgd2UgZG8gbm90IGtub3cgdGhlIG51bGwgY291bnQgb2YgdGhlIHNsaWNlZCByYW5nZSB3aXRob3V0XG4vLyBkb2luZyBzb21lIGNvbXB1dGF0aW9uLiBUbyBhdm9pZCBkb2luZyB0aGlzIGVhZ2VybHksIHdlIHNldCB0aGUgbnVsbCBjb3VudFxuLy8gdG8gLTEgKGFueSBuZWdhdGl2ZSBudW1iZXIgd2lsbCBkbykuIFdoZW4gVmVjdG9yLm51bGxDb3VudCBpcyBjYWxsZWQgdGhlXG4vLyBmaXJzdCB0aW1lLCB0aGUgbnVsbCBjb3VudCB3aWxsIGJlIGNvbXB1dGVkLiBTZWUgQVJST1ctMzNcbi8qKiBAaWdub3JlICovIGV4cG9ydCB0eXBlIGtVbmtub3duTnVsbENvdW50ID0gLTE7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3Qga1Vua25vd25OdWxsQ291bnQgPSAtMTtcblxuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IHR5cGUgTnVsbEJ1ZmZlciA9IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IHR5cGUgVHlwZUlkc0J1ZmZlciA9IEludDhBcnJheSAgfCBBcnJheUxpa2U8bnVtYmVyPiB8IEl0ZXJhYmxlPG51bWJlcj47XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgdHlwZSBWYWx1ZU9mZnNldHNCdWZmZXIgPSBJbnQzMkFycmF5ICB8IEFycmF5TGlrZTxudW1iZXI+IHwgSXRlcmFibGU8bnVtYmVyPjtcbi8qKiBAaWdub3JlICovIGV4cG9ydCB0eXBlIERhdGFCdWZmZXI8VCBleHRlbmRzIERhdGFUeXBlPiA9IFRbJ1RBcnJheSddIHwgQXJyYXlMaWtlPG51bWJlcj4gfCBJdGVyYWJsZTxudW1iZXI+O1xuXG4vKiogQGlnbm9yZSAqL1xuZXhwb3J0IGludGVyZmFjZSBCdWZmZXJzPFQgZXh0ZW5kcyBEYXRhVHlwZT4ge1xuICAgICAgW0J1ZmZlclR5cGUuT0ZGU0VUXTogSW50MzJBcnJheTtcbiAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IFRbJ1RBcnJheSddO1xuICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogVWludDhBcnJheTtcbiAgICAgICAgW0J1ZmZlclR5cGUuVFlQRV06IFRbJ1RBcnJheSddO1xufVxuXG4vKiogQGlnbm9yZSAqL1xuZXhwb3J0IGludGVyZmFjZSBEYXRhPFQgZXh0ZW5kcyBEYXRhVHlwZSA9IERhdGFUeXBlPiB7XG4gICAgcmVhZG9ubHkgVFR5cGU6IFRbJ1RUeXBlJ107XG4gICAgcmVhZG9ubHkgVEFycmF5OiBUWydUQXJyYXknXTtcbiAgICByZWFkb25seSBUVmFsdWU6IFRbJ1RWYWx1ZSddO1xufVxuXG4vKiogQGlnbm9yZSAqL1xuZXhwb3J0IGNsYXNzIERhdGE8VCBleHRlbmRzIERhdGFUeXBlID0gRGF0YVR5cGU+IHtcblxuICAgIHB1YmxpYyByZWFkb25seSB0eXBlOiBUO1xuICAgIHB1YmxpYyByZWFkb25seSBsZW5ndGg6IG51bWJlcjtcbiAgICBwdWJsaWMgcmVhZG9ubHkgb2Zmc2V0OiBudW1iZXI7XG4gICAgcHVibGljIHJlYWRvbmx5IHN0cmlkZTogbnVtYmVyO1xuICAgIHB1YmxpYyByZWFkb25seSBjaGlsZERhdGE6IERhdGFbXTtcbiAgICBwdWJsaWMgcmVhZG9ubHkgdmFsdWVzOiBCdWZmZXJzPFQ+W0J1ZmZlclR5cGUuREFUQV07XG4gICAgcHVibGljIHJlYWRvbmx5IHR5cGVJZHM6IEJ1ZmZlcnM8VD5bQnVmZmVyVHlwZS5UWVBFXTtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHVibGljIHJlYWRvbmx5IG51bGxCaXRtYXA6IEJ1ZmZlcnM8VD5bQnVmZmVyVHlwZS5WQUxJRElUWV07XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHB1YmxpYyByZWFkb25seSB2YWx1ZU9mZnNldHM6IEJ1ZmZlcnM8VD5bQnVmZmVyVHlwZS5PRkZTRVRdO1xuXG4gICAgcHVibGljIGdldCBBcnJheVR5cGUoKSB7IHJldHVybiB0aGlzLnR5cGUuQXJyYXlUeXBlOyB9XG4gICAgcHVibGljIGdldCB0eXBlSWQoKTogVFsnVFR5cGUnXSB7IHJldHVybiB0aGlzLnR5cGUudHlwZUlkOyB9XG4gICAgcHVibGljIGdldCBidWZmZXJzKCkge1xuICAgICAgICByZXR1cm4gW3RoaXMudmFsdWVPZmZzZXRzLCB0aGlzLnZhbHVlcywgdGhpcy5udWxsQml0bWFwLCB0aGlzLnR5cGVJZHNdIGFzIEJ1ZmZlcnM8VD47XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9udWxsQ291bnQ6IG51bWJlciB8IGtVbmtub3duTnVsbENvdW50O1xuXG4gICAgcHVibGljIGdldCBudWxsQ291bnQoKSB7XG4gICAgICAgIGxldCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQ7XG4gICAgICAgIGxldCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgdW5kZWZpbmVkO1xuICAgICAgICBpZiAobnVsbENvdW50IDw9IGtVbmtub3duTnVsbENvdW50ICYmIChudWxsQml0bWFwID0gdGhpcy5udWxsQml0bWFwKSkge1xuICAgICAgICAgICAgdGhpcy5fbnVsbENvdW50ID0gbnVsbENvdW50ID0gdGhpcy5sZW5ndGggLSBwb3BjbnRfYml0X3JhbmdlKG51bGxCaXRtYXAsIHRoaXMub2Zmc2V0LCB0aGlzLm9mZnNldCArIHRoaXMubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbENvdW50O1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyLCBidWZmZXJzPzogUGFydGlhbDxCdWZmZXJzPFQ+PiB8IERhdGE8VD4sIGNoaWxkRGF0YT86IChEYXRhIHwgVmVjdG9yKVtdKSB7XG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIHRoaXMub2Zmc2V0ID0gTWF0aC5mbG9vcihNYXRoLm1heChvZmZzZXQgfHwgMCwgMCkpO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IE1hdGguZmxvb3IoTWF0aC5tYXgobGVuZ3RoIHx8IDAsIDApKTtcbiAgICAgICAgdGhpcy5fbnVsbENvdW50ID0gTWF0aC5mbG9vcihNYXRoLm1heChudWxsQ291bnQgfHwgMCwgLTEpKTtcbiAgICAgICAgdGhpcy5jaGlsZERhdGEgPSAoY2hpbGREYXRhIHx8IFtdKS5tYXAoKHgpID0+IHggaW5zdGFuY2VvZiBEYXRhID8geCA6IHguZGF0YSkgYXMgRGF0YVtdO1xuICAgICAgICBsZXQgYnVmZmVyOiBCdWZmZXJzPFQ+W2tleW9mIEJ1ZmZlcnM8VD5dO1xuICAgICAgICBpZiAoYnVmZmVycyBpbnN0YW5jZW9mIERhdGEpIHtcbiAgICAgICAgICAgIHRoaXMuc3RyaWRlID0gYnVmZmVycy5zdHJpZGU7XG4gICAgICAgICAgICB0aGlzLnZhbHVlcyA9IGJ1ZmZlcnMudmFsdWVzO1xuICAgICAgICAgICAgdGhpcy50eXBlSWRzID0gYnVmZmVycy50eXBlSWRzO1xuICAgICAgICAgICAgdGhpcy5udWxsQml0bWFwID0gYnVmZmVycy5udWxsQml0bWFwO1xuICAgICAgICAgICAgdGhpcy52YWx1ZU9mZnNldHMgPSBidWZmZXJzLnZhbHVlT2Zmc2V0cztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChidWZmZXJzKSB7XG4gICAgICAgICAgICAgICAgKGJ1ZmZlciA9IChidWZmZXJzIGFzIEJ1ZmZlcnM8VD4pWzBdKSAmJiAodGhpcy52YWx1ZU9mZnNldHMgPSBidWZmZXIpO1xuICAgICAgICAgICAgICAgIChidWZmZXIgPSAoYnVmZmVycyBhcyBCdWZmZXJzPFQ+KVsxXSkgJiYgKHRoaXMudmFsdWVzID0gYnVmZmVyKTtcbiAgICAgICAgICAgICAgICAoYnVmZmVyID0gKGJ1ZmZlcnMgYXMgQnVmZmVyczxUPilbMl0pICYmICh0aGlzLm51bGxCaXRtYXAgPSBidWZmZXIpO1xuICAgICAgICAgICAgICAgIChidWZmZXIgPSAoYnVmZmVycyBhcyBCdWZmZXJzPFQ+KVszXSkgJiYgKHRoaXMudHlwZUlkcyA9IGJ1ZmZlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB0OiBhbnkgPSB0eXBlO1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlLnR5cGVJZCkge1xuICAgICAgICAgICAgICAgIGNhc2UgVHlwZS5EZWNpbWFsOiB0aGlzLnN0cmlkZSA9IDQ7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVHlwZS5UaW1lc3RhbXA6IHRoaXMuc3RyaWRlID0gMjsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBUeXBlLkRhdGU6IHRoaXMuc3RyaWRlID0gMSArICh0IGFzIERhdGVfKS51bml0OyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFR5cGUuSW50ZXJ2YWw6IHRoaXMuc3RyaWRlID0gMSArICh0IGFzIEludGVydmFsKS51bml0OyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFR5cGUuSW50OiB0aGlzLnN0cmlkZSA9IDEgKyArKCh0IGFzIEludCkuYml0V2lkdGggPiAzMik7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVHlwZS5UaW1lOiB0aGlzLnN0cmlkZSA9IDEgKyArKCh0IGFzIFRpbWUpLmJpdFdpZHRoID4gMzIpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFR5cGUuRml4ZWRTaXplTGlzdDogdGhpcy5zdHJpZGUgPSAodCBhcyBGaXhlZFNpemVMaXN0KS5saXN0U2l6ZTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBUeXBlLkZpeGVkU2l6ZUJpbmFyeTogdGhpcy5zdHJpZGUgPSAodCBhcyBGaXhlZFNpemVCaW5hcnkpLmJ5dGVXaWR0aDsgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy5zdHJpZGUgPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBEYXRhVHlwZT4odHlwZTogUiwgb2Zmc2V0ID0gdGhpcy5vZmZzZXQsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQsIGJ1ZmZlcnM6IEJ1ZmZlcnM8Uj4gPSA8YW55PiB0aGlzLCBjaGlsZERhdGE6IChEYXRhIHwgVmVjdG9yKVtdID0gdGhpcy5jaGlsZERhdGEpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIGJ1ZmZlcnMsIGNoaWxkRGF0YSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNsaWNlKG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcik6IERhdGE8VD4ge1xuICAgICAgICAvLyArdHJ1ZSA9PT0gMSwgK2ZhbHNlID09PSAwLCBzbyB0aGlzIG1lYW5zXG4gICAgICAgIC8vIHdlIGtlZXAgbnVsbENvdW50IGF0IDAgaWYgaXQncyBhbHJlYWR5IDAsXG4gICAgICAgIC8vIG90aGVyd2lzZSBzZXQgdG8gdGhlIGludmFsaWRhdGVkIGZsYWcgLTFcbiAgICAgICAgY29uc3QgeyBzdHJpZGUsIHR5cGVJZCwgY2hpbGREYXRhIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBudWxsQ291bnQgPSArKHRoaXMuX251bGxDb3VudCA9PT0gMCkgLSAxO1xuICAgICAgICBjb25zdCBjaGlsZFN0cmlkZSA9IHR5cGVJZCA9PT0gMTYgLyogRml4ZWRTaXplTGlzdCAqLyA/IHN0cmlkZSA6IDE7XG4gICAgICAgIGNvbnN0IGJ1ZmZlcnMgPSB0aGlzLl9zbGljZUJ1ZmZlcnMob2Zmc2V0LCBsZW5ndGgsIHN0cmlkZSwgdHlwZUlkKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmU8VD4odGhpcy50eXBlLCB0aGlzLm9mZnNldCArIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIGJ1ZmZlcnMsXG4gICAgICAgICAgICAvLyBEb24ndCBzbGljZSBjaGlsZHJlbiBpZiB3ZSBoYXZlIHZhbHVlIG9mZnNldHMgKHRoZSB2YXJpYWJsZS13aWR0aCB0eXBlcylcbiAgICAgICAgICAgICghY2hpbGREYXRhLmxlbmd0aCB8fCB0aGlzLnZhbHVlT2Zmc2V0cykgPyBjaGlsZERhdGEgOiB0aGlzLl9zbGljZUNoaWxkcmVuKGNoaWxkRGF0YSwgY2hpbGRTdHJpZGUgKiBvZmZzZXQsIGNoaWxkU3RyaWRlICogbGVuZ3RoKSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9zbGljZUJ1ZmZlcnMob2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBzdHJpZGU6IG51bWJlciwgdHlwZUlkOiBUWydUVHlwZSddKTogQnVmZmVyczxUPiB7XG4gICAgICAgIGxldCBhcnI6IGFueSwgeyBidWZmZXJzIH0gPSB0aGlzO1xuICAgICAgICAvLyBJZiB0eXBlSWRzIGV4aXN0LCBzbGljZSB0aGUgdHlwZUlkcyBidWZmZXJcbiAgICAgICAgKGFyciA9IGJ1ZmZlcnNbQnVmZmVyVHlwZS5UWVBFXSkgJiYgKGJ1ZmZlcnNbQnVmZmVyVHlwZS5UWVBFXSA9IGFyci5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIGxlbmd0aCkpO1xuICAgICAgICAvLyBJZiBvZmZzZXRzIGV4aXN0LCBvbmx5IHNsaWNlIHRoZSBvZmZzZXRzIGJ1ZmZlclxuICAgICAgICAoYXJyID0gYnVmZmVyc1tCdWZmZXJUeXBlLk9GRlNFVF0pICYmIChidWZmZXJzW0J1ZmZlclR5cGUuT0ZGU0VUXSA9IGFyci5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIGxlbmd0aCArIDEpKSB8fFxuICAgICAgICAvLyBPdGhlcndpc2UgaWYgbm8gb2Zmc2V0cywgc2xpY2UgdGhlIGRhdGEgYnVmZmVyLiBEb24ndCBzbGljZSB0aGUgZGF0YSB2ZWN0b3IgZm9yIEJvb2xlYW5zLCBzaW5jZSB0aGUgb2Zmc2V0IGdvZXMgYnkgYml0cyBub3QgYnl0ZXNcbiAgICAgICAgKGFyciA9IGJ1ZmZlcnNbQnVmZmVyVHlwZS5EQVRBXSkgJiYgKGJ1ZmZlcnNbQnVmZmVyVHlwZS5EQVRBXSA9IHR5cGVJZCA9PT0gNiA/IGFyciA6IGFyci5zdWJhcnJheShzdHJpZGUgKiBvZmZzZXQsIHN0cmlkZSAqIChvZmZzZXQgKyBsZW5ndGgpKSk7XG4gICAgICAgIHJldHVybiBidWZmZXJzO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfc2xpY2VDaGlsZHJlbihjaGlsZERhdGE6IERhdGFbXSwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKTogRGF0YVtdIHtcbiAgICAgICAgcmV0dXJuIGNoaWxkRGF0YS5tYXAoKGNoaWxkKSA9PiBjaGlsZC5zbGljZShvZmZzZXQsIGxlbmd0aCkpO1xuICAgIH1cblxuICAgIC8vXG4gICAgLy8gQ29udmVuaWVuY2UgbWV0aG9kcyBmb3IgY3JlYXRpbmcgRGF0YSBpbnN0YW5jZXMgZm9yIGVhY2ggb2YgdGhlIEFycm93IFZlY3RvciB0eXBlc1xuICAgIC8vXG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBOdWxsPFQgZXh0ZW5kcyBOdWxsPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEludDxUIGV4dGVuZHMgSW50Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBEaWN0aW9uYXJ5PFQgZXh0ZW5kcyBEaWN0aW9uYXJ5Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3PFRbJ1RBcnJheSddPih0eXBlLmluZGljZXMuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBGbG9hdDxUIGV4dGVuZHMgRmxvYXQ+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEJvb2w8VCBleHRlbmRzIEJvb2w+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIERlY2ltYWw8VCBleHRlbmRzIERlY2ltYWw+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIERhdGU8VCBleHRlbmRzIERhdGVfPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBUaW1lPFQgZXh0ZW5kcyBUaW1lPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBUaW1lc3RhbXA8VCBleHRlbmRzIFRpbWVzdGFtcD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgSW50ZXJ2YWw8VCBleHRlbmRzIEludGVydmFsPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBGaXhlZFNpemVCaW5hcnk8VCBleHRlbmRzIEZpeGVkU2l6ZUJpbmFyeT4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgQmluYXJ5PFQgZXh0ZW5kcyBCaW5hcnk+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIHZhbHVlT2Zmc2V0czogVmFsdWVPZmZzZXRzQnVmZmVyLCBkYXRhOiBVaW50OEFycmF5KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuT0ZGU0VUXTogdG9BcnJheUJ1ZmZlclZpZXcoSW50MzJBcnJheSwgdmFsdWVPZmZzZXRzKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBVdGY4PFQgZXh0ZW5kcyBVdGY4Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCB2YWx1ZU9mZnNldHM6IFZhbHVlT2Zmc2V0c0J1ZmZlciwgZGF0YTogVWludDhBcnJheSkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLk9GRlNFVF06IHRvQXJyYXlCdWZmZXJWaWV3KEludDMyQXJyYXksIHZhbHVlT2Zmc2V0cyksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxUIGV4dGVuZHMgTGlzdD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgdmFsdWVPZmZzZXRzOiBWYWx1ZU9mZnNldHNCdWZmZXIsIGNoaWxkOiBEYXRhPFRbJ3ZhbHVlVHlwZSddPiB8IFZlY3RvcjxUWyd2YWx1ZVR5cGUnXT4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5PRkZTRVRdOiB0b0FycmF5QnVmZmVyVmlldyhJbnQzMkFycmF5LCB2YWx1ZU9mZnNldHMpXG4gICAgICAgIH0sIFtjaGlsZF0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEZpeGVkU2l6ZUxpc3Q8VCBleHRlbmRzIEZpeGVkU2l6ZUxpc3Q+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGNoaWxkOiBEYXRhIHwgVmVjdG9yKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXG4gICAgICAgIH0sIFtjaGlsZF0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIFN0cnVjdDxUIGV4dGVuZHMgU3RydWN0Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBjaGlsZHJlbjogKERhdGEgfCBWZWN0b3IpW10pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcClcbiAgICAgICAgfSwgY2hpbGRyZW4pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIE1hcDxUIGV4dGVuZHMgTWFwXz4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgY2hpbGRyZW46IChEYXRhIHwgVmVjdG9yKVtdKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXG4gICAgICAgIH0sIGNoaWxkcmVuKTtcbiAgICB9XG4gICAgcHVibGljIHN0YXRpYyBVbmlvbjxUIGV4dGVuZHMgU3BhcnNlVW5pb24+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIHR5cGVJZHM6IFR5cGVJZHNCdWZmZXIsIGNoaWxkcmVuOiAoRGF0YSB8IFZlY3RvcilbXSk6IERhdGE8VD47XG4gICAgcHVibGljIHN0YXRpYyBVbmlvbjxUIGV4dGVuZHMgRGVuc2VVbmlvbj4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgdHlwZUlkczogVHlwZUlkc0J1ZmZlciwgdmFsdWVPZmZzZXRzOiBWYWx1ZU9mZnNldHNCdWZmZXIsIGNoaWxkcmVuOiAoRGF0YSB8IFZlY3RvcilbXSk6IERhdGE8VD47XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBVbmlvbjxUIGV4dGVuZHMgVW5pb24+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIHR5cGVJZHM6IFR5cGVJZHNCdWZmZXIsIHZhbHVlT2Zmc2V0c09yQ2hpbGRyZW46IFZhbHVlT2Zmc2V0c0J1ZmZlciB8IChEYXRhIHwgVmVjdG9yKVtdLCBjaGlsZHJlbj86IChEYXRhIHwgVmVjdG9yKVtdKSB7XG4gICAgICAgIGNvbnN0IGJ1ZmZlcnMgPSB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVFlQRV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCB0eXBlSWRzKVxuICAgICAgICB9IGFzIFBhcnRpYWw8QnVmZmVyczxUPj47XG4gICAgICAgIGlmICh0eXBlLm1vZGUgPT09IFVuaW9uTW9kZS5TcGFyc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBidWZmZXJzLCB2YWx1ZU9mZnNldHNPckNoaWxkcmVuIGFzIChEYXRhIHwgVmVjdG9yKVtdKTtcbiAgICAgICAgfVxuICAgICAgICBidWZmZXJzW0J1ZmZlclR5cGUuT0ZGU0VUXSA9IHRvQXJyYXlCdWZmZXJWaWV3KEludDMyQXJyYXksIDxWYWx1ZU9mZnNldHNCdWZmZXI+IHZhbHVlT2Zmc2V0c09yQ2hpbGRyZW4pO1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgYnVmZmVycywgY2hpbGRyZW4pO1xuICAgIH1cbn1cblxuKChEYXRhLnByb3RvdHlwZSBhcyBhbnkpLmNoaWxkRGF0YSA9IE9iamVjdC5mcmVlemUoW10pKTtcbiJdfQ==
