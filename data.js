"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const bit_1 = require("./util/bit");
const buffer_1 = require("./util/buffer");
const enum_1 = require("./enum");
/** @ignore */ exports.kUnknownNullCount = -1;
/** @ignore */
class Data {
    constructor(type, offset, length, nullCount, buffers, childData) {
        this.type = type;
        this.offset = Math.floor(Math.max(offset || 0, 0));
        this.length = Math.floor(Math.max(length || 0, 0));
        this._nullCount = Math.floor(Math.max(nullCount || 0, -1));
        this.childData = (childData || []).map((x) => x instanceof Data ? x : x.data);
        let buffer;
        if (buffers instanceof Data) {
            this.stride = buffers.stride;
            this.values = buffers.values;
            this.typeIds = buffers.typeIds;
            this.nullBitmap = buffers.nullBitmap;
            this.valueOffsets = buffers.valueOffsets;
        }
        else {
            if (buffers) {
                (buffer = buffers[0]) && (this.valueOffsets = buffer);
                (buffer = buffers[1]) && (this.values = buffer);
                (buffer = buffers[2]) && (this.nullBitmap = buffer);
                (buffer = buffers[3]) && (this.typeIds = buffer);
            }
            const t = type;
            switch (type.typeId) {
                case enum_1.Type.Decimal:
                    this.stride = 4;
                    break;
                case enum_1.Type.Timestamp:
                    this.stride = 2;
                    break;
                case enum_1.Type.Date:
                    this.stride = 1 + t.unit;
                    break;
                case enum_1.Type.Interval:
                    this.stride = 1 + t.unit;
                    break;
                case enum_1.Type.Int:
                    this.stride = 1 + +(t.bitWidth > 32);
                    break;
                case enum_1.Type.Time:
                    this.stride = 1 + +(t.bitWidth > 32);
                    break;
                case enum_1.Type.FixedSizeList:
                    this.stride = t.listSize;
                    break;
                case enum_1.Type.FixedSizeBinary:
                    this.stride = t.byteWidth;
                    break;
                default: this.stride = 1;
            }
        }
    }
    get ArrayType() { return this.type.ArrayType; }
    get typeId() { return this.type.typeId; }
    get buffers() {
        return [this.valueOffsets, this.values, this.nullBitmap, this.typeIds];
    }
    get nullCount() {
        let nullCount = this._nullCount;
        let nullBitmap;
        if (nullCount <= exports.kUnknownNullCount && (nullBitmap = this.nullBitmap)) {
            this._nullCount = nullCount = this.length - bit_1.popcnt_bit_range(nullBitmap, this.offset, this.offset + this.length);
        }
        return nullCount;
    }
    clone(type, offset = this.offset, length = this.length, nullCount = this._nullCount, buffers = this, childData = this.childData) {
        return new Data(type, offset, length, nullCount, buffers, childData);
    }
    slice(offset, length) {
        // +true === 1, +false === 0, so this means
        // we keep nullCount at 0 if it's already 0,
        // otherwise set to the invalidated flag -1
        const { stride, typeId, childData } = this;
        const nullCount = +(this._nullCount === 0) - 1;
        const childStride = typeId === 16 /* FixedSizeList */ ? stride : 1;
        const buffers = this._sliceBuffers(offset, length, stride, typeId);
        return this.clone(this.type, this.offset + offset, length, nullCount, buffers, 
        // Don't slice children if we have value offsets (the variable-width types)
        (!childData.length || this.valueOffsets) ? childData : this._sliceChildren(childData, childStride * offset, childStride * length));
    }
    _sliceBuffers(offset, length, stride, typeId) {
        let arr, { buffers } = this;
        // If typeIds exist, slice the typeIds buffer
        (arr = buffers[enum_1.VectorType.TYPE]) && (buffers[enum_1.VectorType.TYPE] = arr.subarray(offset, offset + length));
        // If offsets exist, only slice the offsets buffer
        (arr = buffers[enum_1.VectorType.OFFSET]) && (buffers[enum_1.VectorType.OFFSET] = arr.subarray(offset, offset + length + 1)) ||
            // Otherwise if no offsets, slice the data buffer. Don't slice the data vector for Booleans, since the offset goes by bits not bytes
            (arr = buffers[enum_1.VectorType.DATA]) && (buffers[enum_1.VectorType.DATA] = typeId === 6 ? arr : arr.subarray(stride * offset, stride * (offset + length)));
        return buffers;
    }
    _sliceChildren(childData, offset, length) {
        return childData.map((child) => child.slice(offset, length));
    }
    //
    // Convenience methods for creating Data instances for each of the Arrow Vector types
    //
    /** @nocollapse */
    static Null(type, offset, length, nullCount, nullBitmap) {
        return new Data(type, offset, length, nullCount, [undefined, undefined, buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static Int(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static Dictionary(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.indices.ArrayType, data), buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static Float(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static Bool(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static Decimal(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static Date(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static Time(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static Timestamp(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static Interval(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static FixedSizeBinary(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, [undefined, buffer_1.toArrayBufferView(type.ArrayType, data), buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static Binary(type, offset, length, nullCount, nullBitmap, valueOffsets, data) {
        return new Data(type, offset, length, nullCount, [buffer_1.toArrayBufferView(Int32Array, valueOffsets), buffer_1.toArrayBufferView(Uint8Array, data), buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static Utf8(type, offset, length, nullCount, nullBitmap, valueOffsets, data) {
        return new Data(type, offset, length, nullCount, [buffer_1.toArrayBufferView(Int32Array, valueOffsets), buffer_1.toArrayBufferView(Uint8Array, data), buffer_1.toArrayBufferView(Uint8Array, nullBitmap)]);
    }
    /** @nocollapse */
    static List(type, offset, length, nullCount, nullBitmap, valueOffsets, child) {
        return new Data(type, offset, length, nullCount, [buffer_1.toArrayBufferView(Int32Array, valueOffsets), undefined, buffer_1.toArrayBufferView(Uint8Array, nullBitmap)], [child]);
    }
    /** @nocollapse */
    static FixedSizeList(type, offset, length, nullCount, nullBitmap, child) {
        return new Data(type, offset, length, nullCount, [undefined, undefined, buffer_1.toArrayBufferView(Uint8Array, nullBitmap)], [child]);
    }
    /** @nocollapse */
    static Struct(type, offset, length, nullCount, nullBitmap, children) {
        return new Data(type, offset, length, nullCount, [undefined, undefined, buffer_1.toArrayBufferView(Uint8Array, nullBitmap)], children);
    }
    /** @nocollapse */
    static Map(type, offset, length, nullCount, nullBitmap, children) {
        return new Data(type, offset, length, nullCount, [undefined, undefined, buffer_1.toArrayBufferView(Uint8Array, nullBitmap)], children);
    }
    /** @nocollapse */
    static Union(type, offset, length, nullCount, nullBitmap, typeIds, valueOffsetsOrChildren, children) {
        const buffers = [
            undefined, undefined,
            buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            buffer_1.toArrayBufferView(type.ArrayType, typeIds)
        ];
        if (type.mode === enum_1.UnionMode.Sparse) {
            return new Data(type, offset, length, nullCount, buffers, valueOffsetsOrChildren);
        }
        buffers[enum_1.VectorType.OFFSET] = buffer_1.toArrayBufferView(Int32Array, valueOffsetsOrChildren);
        return new Data(type, offset, length, nullCount, buffers, children);
    }
}
exports.Data = Data;
(Data.prototype.childData = Object.freeze([]));

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QVMsRUFBRSxJQUFJLENBQUMsRUFBRSwwQkFBaUIsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RKLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsT0FBTyxDQUFvQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDNUksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsQ0FBQyxTQUFTLEVBQUUsMEJBQWlCLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSwwQkFBaUIsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RKLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsSUFBSSxDQUFrQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDdkksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsQ0FBQyxTQUFTLEVBQUUsMEJBQWlCLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSwwQkFBaUIsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RKLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsSUFBSSxDQUFpQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDdEksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsQ0FBQyxTQUFTLEVBQUUsMEJBQWlCLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSwwQkFBaUIsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFD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LE9BQU8sR0FBYTtZQUN0QixTQUFTLEVBQUUsU0FBUztZQUNwQiwwQkFBaUIsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDO1lBQ3pDLDBCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDO1NBQ3RCLENBQUM7UUFDekIsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLGdCQUFTLENBQUMsTUFBTSxFQUFFO1lBQ2hDLE9BQU8sSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxzQkFBMkMsQ0FBQyxDQUFDO1NBQzFHO1FBQ0QsT0FBTyxDQUFDLGlCQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsMEJBQWlCLENBQUMsVUFBVSxFQUF1QixzQkFBc0IsQ0FBQyxDQUFDO1FBQ3hHLE9BQU8sSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN4RSxDQUFDO0NBQ0o7QUF4TEQsb0JBd0xDO0FBRUQsQ0FBRSxJQUFJLENBQUMsU0FBaUIsQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImRhdGEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4vLyBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbi8vIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4vLyByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4vLyB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4vLyBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Vcbi8vIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbi8vIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4vLyBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuLy8gS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4vLyBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4vLyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgVmVjdG9yIH0gZnJvbSAnLi92ZWN0b3InO1xuaW1wb3J0IHsgcG9wY250X2JpdF9yYW5nZSB9IGZyb20gJy4vdXRpbC9iaXQnO1xuaW1wb3J0IHsgdG9BcnJheUJ1ZmZlclZpZXcgfSBmcm9tICcuL3V0aWwvYnVmZmVyJztcbmltcG9ydCB7IERhdGFUeXBlLCBTcGFyc2VVbmlvbiwgRGVuc2VVbmlvbiB9IGZyb20gJy4vdHlwZSc7XG5pbXBvcnQgeyBWZWN0b3JUeXBlIGFzIEJ1ZmZlclR5cGUsIFVuaW9uTW9kZSwgVHlwZSB9IGZyb20gJy4vZW51bSc7XG5pbXBvcnQge1xuICAgIERpY3Rpb25hcnksXG4gICAgTnVsbCwgSW50LCBGbG9hdCxcbiAgICBCaW5hcnksIEJvb2wsIFV0ZjgsIERlY2ltYWwsXG4gICAgRGF0ZV8sIFRpbWUsIFRpbWVzdGFtcCwgSW50ZXJ2YWwsXG4gICAgTGlzdCwgU3RydWN0LCBVbmlvbiwgRml4ZWRTaXplQmluYXJ5LCBGaXhlZFNpemVMaXN0LCBNYXBfLFxufSBmcm9tICcuL3R5cGUnO1xuXG4vLyBXaGVuIHNsaWNpbmcsIHdlIGRvIG5vdCBrbm93IHRoZSBudWxsIGNvdW50IG9mIHRoZSBzbGljZWQgcmFuZ2Ugd2l0aG91dFxuLy8gZG9pbmcgc29tZSBjb21wdXRhdGlvbi4gVG8gYXZvaWQgZG9pbmcgdGhpcyBlYWdlcmx5LCB3ZSBzZXQgdGhlIG51bGwgY291bnRcbi8vIHRvIC0xIChhbnkgbmVnYXRpdmUgbnVtYmVyIHdpbGwgZG8pLiBXaGVuIFZlY3Rvci5udWxsQ291bnQgaXMgY2FsbGVkIHRoZVxuLy8gZmlyc3QgdGltZSwgdGhlIG51bGwgY291bnQgd2lsbCBiZSBjb21wdXRlZC4gU2VlIEFSUk9XLTMzXG4vKiogQGlnbm9yZSAqLyBleHBvcnQgdHlwZSBrVW5rbm93bk51bGxDb3VudCA9IC0xO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IGtVbmtub3duTnVsbENvdW50ID0gLTE7XG5cbi8qKiBAaWdub3JlICovIGV4cG9ydCB0eXBlIE51bGxCdWZmZXIgPSBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZDtcbi8qKiBAaWdub3JlICovIGV4cG9ydCB0eXBlIFR5cGVJZHNCdWZmZXIgPSBJbnQ4QXJyYXkgIHwgQXJyYXlMaWtlPG51bWJlcj4gfCBJdGVyYWJsZTxudW1iZXI+O1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IHR5cGUgVmFsdWVPZmZzZXRzQnVmZmVyID0gSW50MzJBcnJheSAgfCBBcnJheUxpa2U8bnVtYmVyPiB8IEl0ZXJhYmxlPG51bWJlcj47XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgdHlwZSBEYXRhQnVmZmVyPFQgZXh0ZW5kcyBEYXRhVHlwZT4gPSBUWydUQXJyYXknXSB8IEFycmF5TGlrZTxudW1iZXI+IHwgSXRlcmFibGU8bnVtYmVyPjtcblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBpbnRlcmZhY2UgQnVmZmVyczxUIGV4dGVuZHMgRGF0YVR5cGU+IHtcbiAgICAgIFtCdWZmZXJUeXBlLk9GRlNFVF06IEludDMyQXJyYXk7XG4gICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiBUWydUQXJyYXknXTtcbiAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IFVpbnQ4QXJyYXk7XG4gICAgICAgIFtCdWZmZXJUeXBlLlRZUEVdOiBUWydUQXJyYXknXTtcbn1cblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBpbnRlcmZhY2UgRGF0YTxUIGV4dGVuZHMgRGF0YVR5cGUgPSBEYXRhVHlwZT4ge1xuICAgIHJlYWRvbmx5IFRUeXBlOiBUWydUVHlwZSddO1xuICAgIHJlYWRvbmx5IFRBcnJheTogVFsnVEFycmF5J107XG4gICAgcmVhZG9ubHkgVFZhbHVlOiBUWydUVmFsdWUnXTtcbn1cblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBjbGFzcyBEYXRhPFQgZXh0ZW5kcyBEYXRhVHlwZSA9IERhdGFUeXBlPiB7XG5cbiAgICBwdWJsaWMgcmVhZG9ubHkgdHlwZTogVDtcbiAgICBwdWJsaWMgcmVhZG9ubHkgbGVuZ3RoOiBudW1iZXI7XG4gICAgcHVibGljIHJlYWRvbmx5IG9mZnNldDogbnVtYmVyO1xuICAgIHB1YmxpYyByZWFkb25seSBzdHJpZGU6IG51bWJlcjtcbiAgICBwdWJsaWMgcmVhZG9ubHkgY2hpbGREYXRhOiBEYXRhW107XG4gICAgcHVibGljIHJlYWRvbmx5IHZhbHVlczogQnVmZmVyczxUPltCdWZmZXJUeXBlLkRBVEFdO1xuICAgIHB1YmxpYyByZWFkb25seSB0eXBlSWRzOiBCdWZmZXJzPFQ+W0J1ZmZlclR5cGUuVFlQRV07XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHB1YmxpYyByZWFkb25seSBudWxsQml0bWFwOiBCdWZmZXJzPFQ+W0J1ZmZlclR5cGUuVkFMSURJVFldO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBwdWJsaWMgcmVhZG9ubHkgdmFsdWVPZmZzZXRzOiBCdWZmZXJzPFQ+W0J1ZmZlclR5cGUuT0ZGU0VUXTtcblxuICAgIHB1YmxpYyBnZXQgQXJyYXlUeXBlKCkgeyByZXR1cm4gdGhpcy50eXBlLkFycmF5VHlwZTsgfVxuICAgIHB1YmxpYyBnZXQgdHlwZUlkKCk6IFRbJ1RUeXBlJ10geyByZXR1cm4gdGhpcy50eXBlLnR5cGVJZDsgfVxuICAgIHB1YmxpYyBnZXQgYnVmZmVycygpIHtcbiAgICAgICAgcmV0dXJuIFt0aGlzLnZhbHVlT2Zmc2V0cywgdGhpcy52YWx1ZXMsIHRoaXMubnVsbEJpdG1hcCwgdGhpcy50eXBlSWRzXSBhcyBCdWZmZXJzPFQ+O1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfbnVsbENvdW50OiBudW1iZXIgfCBrVW5rbm93bk51bGxDb3VudDtcblxuICAgIHB1YmxpYyBnZXQgbnVsbENvdW50KCkge1xuICAgICAgICBsZXQgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50O1xuICAgICAgICBsZXQgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKG51bGxDb3VudCA8PSBrVW5rbm93bk51bGxDb3VudCAmJiAobnVsbEJpdG1hcCA9IHRoaXMubnVsbEJpdG1hcCkpIHtcbiAgICAgICAgICAgIHRoaXMuX251bGxDb3VudCA9IG51bGxDb3VudCA9IHRoaXMubGVuZ3RoIC0gcG9wY250X2JpdF9yYW5nZShudWxsQml0bWFwLCB0aGlzLm9mZnNldCwgdGhpcy5vZmZzZXQgKyB0aGlzLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGxDb3VudDtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlciwgYnVmZmVycz86IFBhcnRpYWw8QnVmZmVyczxUPj4gfCBEYXRhPFQ+LCBjaGlsZERhdGE/OiAoRGF0YSB8IFZlY3RvcilbXSkge1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLm9mZnNldCA9IE1hdGguZmxvb3IoTWF0aC5tYXgob2Zmc2V0IHx8IDAsIDApKTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSBNYXRoLmZsb29yKE1hdGgubWF4KGxlbmd0aCB8fCAwLCAwKSk7XG4gICAgICAgIHRoaXMuX251bGxDb3VudCA9IE1hdGguZmxvb3IoTWF0aC5tYXgobnVsbENvdW50IHx8IDAsIC0xKSk7XG4gICAgICAgIHRoaXMuY2hpbGREYXRhID0gKGNoaWxkRGF0YSB8fCBbXSkubWFwKCh4KSA9PiB4IGluc3RhbmNlb2YgRGF0YSA/IHggOiB4LmRhdGEpIGFzIERhdGFbXTtcbiAgICAgICAgbGV0IGJ1ZmZlcjogQnVmZmVyczxUPltrZXlvZiBCdWZmZXJzPFQ+XTtcbiAgICAgICAgaWYgKGJ1ZmZlcnMgaW5zdGFuY2VvZiBEYXRhKSB7XG4gICAgICAgICAgICB0aGlzLnN0cmlkZSA9IGJ1ZmZlcnMuc3RyaWRlO1xuICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBidWZmZXJzLnZhbHVlcztcbiAgICAgICAgICAgIHRoaXMudHlwZUlkcyA9IGJ1ZmZlcnMudHlwZUlkcztcbiAgICAgICAgICAgIHRoaXMubnVsbEJpdG1hcCA9IGJ1ZmZlcnMubnVsbEJpdG1hcDtcbiAgICAgICAgICAgIHRoaXMudmFsdWVPZmZzZXRzID0gYnVmZmVycy52YWx1ZU9mZnNldHM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoYnVmZmVycykge1xuICAgICAgICAgICAgICAgIChidWZmZXIgPSAoYnVmZmVycyBhcyBCdWZmZXJzPFQ+KVswXSkgJiYgKHRoaXMudmFsdWVPZmZzZXRzID0gYnVmZmVyKTtcbiAgICAgICAgICAgICAgICAoYnVmZmVyID0gKGJ1ZmZlcnMgYXMgQnVmZmVyczxUPilbMV0pICYmICh0aGlzLnZhbHVlcyA9IGJ1ZmZlcik7XG4gICAgICAgICAgICAgICAgKGJ1ZmZlciA9IChidWZmZXJzIGFzIEJ1ZmZlcnM8VD4pWzJdKSAmJiAodGhpcy5udWxsQml0bWFwID0gYnVmZmVyKTtcbiAgICAgICAgICAgICAgICAoYnVmZmVyID0gKGJ1ZmZlcnMgYXMgQnVmZmVyczxUPilbM10pICYmICh0aGlzLnR5cGVJZHMgPSBidWZmZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdDogYW55ID0gdHlwZTtcbiAgICAgICAgICAgIHN3aXRjaCAodHlwZS50eXBlSWQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFR5cGUuRGVjaW1hbDogdGhpcy5zdHJpZGUgPSA0OyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFR5cGUuVGltZXN0YW1wOiB0aGlzLnN0cmlkZSA9IDI7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVHlwZS5EYXRlOiB0aGlzLnN0cmlkZSA9IDEgKyAodCBhcyBEYXRlXykudW5pdDsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBUeXBlLkludGVydmFsOiB0aGlzLnN0cmlkZSA9IDEgKyAodCBhcyBJbnRlcnZhbCkudW5pdDsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBUeXBlLkludDogdGhpcy5zdHJpZGUgPSAxICsgKygodCBhcyBJbnQpLmJpdFdpZHRoID4gMzIpOyBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFR5cGUuVGltZTogdGhpcy5zdHJpZGUgPSAxICsgKygodCBhcyBUaW1lKS5iaXRXaWR0aCA+IDMyKTsgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBUeXBlLkZpeGVkU2l6ZUxpc3Q6IHRoaXMuc3RyaWRlID0gKHQgYXMgRml4ZWRTaXplTGlzdCkubGlzdFNpemU7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVHlwZS5GaXhlZFNpemVCaW5hcnk6IHRoaXMuc3RyaWRlID0gKHQgYXMgRml4ZWRTaXplQmluYXJ5KS5ieXRlV2lkdGg7IGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMuc3RyaWRlID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgRGF0YVR5cGU+KHR5cGU6IFIsIG9mZnNldCA9IHRoaXMub2Zmc2V0LCBsZW5ndGggPSB0aGlzLmxlbmd0aCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50LCBidWZmZXJzOiBCdWZmZXJzPFI+ID0gPGFueT4gdGhpcywgY2hpbGREYXRhOiAoRGF0YSB8IFZlY3RvcilbXSA9IHRoaXMuY2hpbGREYXRhKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBidWZmZXJzLCBjaGlsZERhdGEpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzbGljZShvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpOiBEYXRhPFQ+IHtcbiAgICAgICAgLy8gK3RydWUgPT09IDEsICtmYWxzZSA9PT0gMCwgc28gdGhpcyBtZWFuc1xuICAgICAgICAvLyB3ZSBrZWVwIG51bGxDb3VudCBhdCAwIGlmIGl0J3MgYWxyZWFkeSAwLFxuICAgICAgICAvLyBvdGhlcndpc2Ugc2V0IHRvIHRoZSBpbnZhbGlkYXRlZCBmbGFnIC0xXG4gICAgICAgIGNvbnN0IHsgc3RyaWRlLCB0eXBlSWQsIGNoaWxkRGF0YSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgbnVsbENvdW50ID0gKyh0aGlzLl9udWxsQ291bnQgPT09IDApIC0gMTtcbiAgICAgICAgY29uc3QgY2hpbGRTdHJpZGUgPSB0eXBlSWQgPT09IDE2IC8qIEZpeGVkU2l6ZUxpc3QgKi8gPyBzdHJpZGUgOiAxO1xuICAgICAgICBjb25zdCBidWZmZXJzID0gdGhpcy5fc2xpY2VCdWZmZXJzKG9mZnNldCwgbGVuZ3RoLCBzdHJpZGUsIHR5cGVJZCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lPFQ+KHRoaXMudHlwZSwgdGhpcy5vZmZzZXQgKyBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBidWZmZXJzLFxuICAgICAgICAgICAgLy8gRG9uJ3Qgc2xpY2UgY2hpbGRyZW4gaWYgd2UgaGF2ZSB2YWx1ZSBvZmZzZXRzICh0aGUgdmFyaWFibGUtd2lkdGggdHlwZXMpXG4gICAgICAgICAgICAoIWNoaWxkRGF0YS5sZW5ndGggfHwgdGhpcy52YWx1ZU9mZnNldHMpID8gY2hpbGREYXRhIDogdGhpcy5fc2xpY2VDaGlsZHJlbihjaGlsZERhdGEsIGNoaWxkU3RyaWRlICogb2Zmc2V0LCBjaGlsZFN0cmlkZSAqIGxlbmd0aCkpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfc2xpY2VCdWZmZXJzKG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgc3RyaWRlOiBudW1iZXIsIHR5cGVJZDogVFsnVFR5cGUnXSk6IEJ1ZmZlcnM8VD4ge1xuICAgICAgICBsZXQgYXJyOiBhbnksIHsgYnVmZmVycyB9ID0gdGhpcztcbiAgICAgICAgLy8gSWYgdHlwZUlkcyBleGlzdCwgc2xpY2UgdGhlIHR5cGVJZHMgYnVmZmVyXG4gICAgICAgIChhcnIgPSBidWZmZXJzW0J1ZmZlclR5cGUuVFlQRV0pICYmIChidWZmZXJzW0J1ZmZlclR5cGUuVFlQRV0gPSBhcnIuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpKTtcbiAgICAgICAgLy8gSWYgb2Zmc2V0cyBleGlzdCwgb25seSBzbGljZSB0aGUgb2Zmc2V0cyBidWZmZXJcbiAgICAgICAgKGFyciA9IGJ1ZmZlcnNbQnVmZmVyVHlwZS5PRkZTRVRdKSAmJiAoYnVmZmVyc1tCdWZmZXJUeXBlLk9GRlNFVF0gPSBhcnIuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGggKyAxKSkgfHxcbiAgICAgICAgLy8gT3RoZXJ3aXNlIGlmIG5vIG9mZnNldHMsIHNsaWNlIHRoZSBkYXRhIGJ1ZmZlci4gRG9uJ3Qgc2xpY2UgdGhlIGRhdGEgdmVjdG9yIGZvciBCb29sZWFucywgc2luY2UgdGhlIG9mZnNldCBnb2VzIGJ5IGJpdHMgbm90IGJ5dGVzXG4gICAgICAgIChhcnIgPSBidWZmZXJzW0J1ZmZlclR5cGUuREFUQV0pICYmIChidWZmZXJzW0J1ZmZlclR5cGUuREFUQV0gPSB0eXBlSWQgPT09IDYgPyBhcnIgOiBhcnIuc3ViYXJyYXkoc3RyaWRlICogb2Zmc2V0LCBzdHJpZGUgKiAob2Zmc2V0ICsgbGVuZ3RoKSkpO1xuICAgICAgICByZXR1cm4gYnVmZmVycztcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX3NsaWNlQ2hpbGRyZW4oY2hpbGREYXRhOiBEYXRhW10sIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcik6IERhdGFbXSB7XG4gICAgICAgIHJldHVybiBjaGlsZERhdGEubWFwKChjaGlsZCkgPT4gY2hpbGQuc2xpY2Uob2Zmc2V0LCBsZW5ndGgpKTtcbiAgICB9XG5cbiAgICAvL1xuICAgIC8vIENvbnZlbmllbmNlIG1ldGhvZHMgZm9yIGNyZWF0aW5nIERhdGEgaW5zdGFuY2VzIGZvciBlYWNoIG9mIHRoZSBBcnJvdyBWZWN0b3IgdHlwZXNcbiAgICAvL1xuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgTnVsbDxUIGV4dGVuZHMgTnVsbD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlcikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgW3VuZGVmaW5lZCwgdW5kZWZpbmVkLCB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEludDxUIGV4dGVuZHMgSW50Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBbdW5kZWZpbmVkLCB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSksIHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgRGljdGlvbmFyeTxUIGV4dGVuZHMgRGljdGlvbmFyeT4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgW3VuZGVmaW5lZCwgdG9BcnJheUJ1ZmZlclZpZXc8VFsnVEFycmF5J10+KHR5cGUuaW5kaWNlcy5BcnJheVR5cGUsIGRhdGEpLCB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEZsb2F0PFQgZXh0ZW5kcyBGbG9hdD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgW3VuZGVmaW5lZCwgdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpLCB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEJvb2w8VCBleHRlbmRzIEJvb2w+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIFt1bmRlZmluZWQsIHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKSwgdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCldKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBEZWNpbWFsPFQgZXh0ZW5kcyBEZWNpbWFsPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBbdW5kZWZpbmVkLCB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSksIHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgRGF0ZTxUIGV4dGVuZHMgRGF0ZV8+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIFt1bmRlZmluZWQsIHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKSwgdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCldKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBUaW1lPFQgZXh0ZW5kcyBUaW1lPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBbdW5kZWZpbmVkLCB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSksIHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgVGltZXN0YW1wPFQgZXh0ZW5kcyBUaW1lc3RhbXA+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIFt1bmRlZmluZWQsIHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKSwgdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCldKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBJbnRlcnZhbDxUIGV4dGVuZHMgSW50ZXJ2YWw+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIFt1bmRlZmluZWQsIHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKSwgdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCldKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBGaXhlZFNpemVCaW5hcnk8VCBleHRlbmRzIEZpeGVkU2l6ZUJpbmFyeT4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgW3VuZGVmaW5lZCwgdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpLCB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEJpbmFyeTxUIGV4dGVuZHMgQmluYXJ5Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCB2YWx1ZU9mZnNldHM6IFZhbHVlT2Zmc2V0c0J1ZmZlciwgZGF0YTogVWludDhBcnJheSkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgW3RvQXJyYXlCdWZmZXJWaWV3KEludDMyQXJyYXksIHZhbHVlT2Zmc2V0cyksIHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIGRhdGEpLCB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIFV0Zjg8VCBleHRlbmRzIFV0Zjg+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIHZhbHVlT2Zmc2V0czogVmFsdWVPZmZzZXRzQnVmZmVyLCBkYXRhOiBVaW50OEFycmF5KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBbdG9BcnJheUJ1ZmZlclZpZXcoSW50MzJBcnJheSwgdmFsdWVPZmZzZXRzKSwgdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgZGF0YSksIHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxUIGV4dGVuZHMgTGlzdD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgdmFsdWVPZmZzZXRzOiBWYWx1ZU9mZnNldHNCdWZmZXIsIGNoaWxkOiBEYXRhPFRbJ3ZhbHVlVHlwZSddPiB8IFZlY3RvcjxUWyd2YWx1ZVR5cGUnXT4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIFt0b0FycmF5QnVmZmVyVmlldyhJbnQzMkFycmF5LCB2YWx1ZU9mZnNldHMpLCB1bmRlZmluZWQsIHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXSwgW2NoaWxkXSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgRml4ZWRTaXplTGlzdDxUIGV4dGVuZHMgRml4ZWRTaXplTGlzdD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgY2hpbGQ6IERhdGEgfCBWZWN0b3IpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIFt1bmRlZmluZWQsIHVuZGVmaW5lZCwgdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCldLCBbY2hpbGRdKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBTdHJ1Y3Q8VCBleHRlbmRzIFN0cnVjdD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgY2hpbGRyZW46IChEYXRhIHwgVmVjdG9yKVtdKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBbdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXSwgY2hpbGRyZW4pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIE1hcDxUIGV4dGVuZHMgTWFwXz4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgY2hpbGRyZW46IChEYXRhIHwgVmVjdG9yKVtdKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBbdW5kZWZpbmVkLCB1bmRlZmluZWQsIHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXSwgY2hpbGRyZW4pO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIFVuaW9uPFQgZXh0ZW5kcyBTcGFyc2VVbmlvbj4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgdHlwZUlkczogVHlwZUlkc0J1ZmZlciwgY2hpbGRyZW46IChEYXRhIHwgVmVjdG9yKVtdKTogRGF0YTxUPjtcbiAgICBwdWJsaWMgc3RhdGljIFVuaW9uPFQgZXh0ZW5kcyBEZW5zZVVuaW9uPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCB0eXBlSWRzOiBUeXBlSWRzQnVmZmVyLCB2YWx1ZU9mZnNldHM6IFZhbHVlT2Zmc2V0c0J1ZmZlciwgY2hpbGRyZW46IChEYXRhIHwgVmVjdG9yKVtdKTogRGF0YTxUPjtcbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIFVuaW9uPFQgZXh0ZW5kcyBVbmlvbj4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgdHlwZUlkczogVHlwZUlkc0J1ZmZlciwgdmFsdWVPZmZzZXRzT3JDaGlsZHJlbjogVmFsdWVPZmZzZXRzQnVmZmVyIHwgKERhdGEgfCBWZWN0b3IpW10sIGNoaWxkcmVuPzogKERhdGEgfCBWZWN0b3IpW10pIHtcbiAgICAgICAgY29uc3QgYnVmZmVycyA9IDx1bmtub3duPiBbXG4gICAgICAgICAgICB1bmRlZmluZWQsIHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIHR5cGVJZHMpXG4gICAgICAgIF0gYXMgUGFydGlhbDxCdWZmZXJzPFQ+PjtcbiAgICAgICAgaWYgKHR5cGUubW9kZSA9PT0gVW5pb25Nb2RlLlNwYXJzZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIGJ1ZmZlcnMsIHZhbHVlT2Zmc2V0c09yQ2hpbGRyZW4gYXMgKERhdGEgfCBWZWN0b3IpW10pO1xuICAgICAgICB9XG4gICAgICAgIGJ1ZmZlcnNbQnVmZmVyVHlwZS5PRkZTRVRdID0gdG9BcnJheUJ1ZmZlclZpZXcoSW50MzJBcnJheSwgPFZhbHVlT2Zmc2V0c0J1ZmZlcj4gdmFsdWVPZmZzZXRzT3JDaGlsZHJlbik7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBidWZmZXJzLCBjaGlsZHJlbik7XG4gICAgfVxufVxuXG4oKERhdGEucHJvdG90eXBlIGFzIGFueSkuY2hpbGREYXRhID0gT2JqZWN0LmZyZWV6ZShbXSkpO1xuIl19
