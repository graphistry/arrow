"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const bit_1 = require("./util/bit");
const buffer_1 = require("./util/buffer");
const enum_1 = require("./enum");
exports.kUnknownNullCount = -1;
class Data {
    constructor(type, offset, length, nullCount, buffers, childData) {
        this._buffers = [];
        this._type = type;
        this._offset = Math.floor(Math.max(offset || 0, 0));
        this._length = Math.floor(Math.max(length || 0, 0));
        this._buffers = Object.assign([], buffers);
        this._nullCount = Math.floor(Math.max(nullCount || 0, -1));
        this._childData = (childData || []).map((x) => x instanceof Data ? x : x.data);
    }
    get type() { return this._type; }
    get length() { return this._length; }
    get offset() { return this._offset; }
    get typeId() { return this._type.typeId; }
    get childData() { return this._childData; }
    get ArrayType() { return this._type.ArrayType; }
    get values() { return this._buffers[enum_1.VectorType.DATA]; }
    get typeIds() { return this._buffers[enum_1.VectorType.TYPE]; }
    get nullBitmap() { return this._buffers[enum_1.VectorType.VALIDITY]; }
    get valueOffsets() { return this._buffers[enum_1.VectorType.OFFSET]; }
    get nullCount() {
        let nullCount = this._nullCount;
        let nullBitmap;
        if (nullCount === exports.kUnknownNullCount && (nullBitmap = this._buffers[enum_1.VectorType.VALIDITY])) {
            this._nullCount = nullCount = this._length - bit_1.popcnt_bit_range(nullBitmap, this._offset, this._offset + this._length);
        }
        return nullCount;
    }
    clone(type, offset = this._offset, length = this._length, nullCount = this._nullCount, buffers = this._buffers, childData = this._childData) {
        return new Data(type, offset, length, nullCount, buffers, childData);
    }
    slice(offset, length) {
        // +true === 1, +false === 0, so this means
        // we keep nullCount at 0 if it's already 0,
        // otherwise set to the invalidated flag -1
        const nullCount = +(this._nullCount === 0) - 1;
        const buffers = this.sliceBuffers(offset, length);
        const childData = this.sliceChildren(offset, length);
        return this.clone(this._type, this._offset + offset, length, nullCount, buffers, childData);
    }
    sliceBuffers(offset, length) {
        let arr, buffers = Object.assign([], this._buffers);
        // If typeIds exist, slice the typeIds buffer
        (arr = buffers[enum_1.VectorType.TYPE]) && (buffers[enum_1.VectorType.TYPE] = this.sliceData(arr, offset, length));
        // If offsets exist, only slice the offsets buffer
        (arr = buffers[enum_1.VectorType.OFFSET]) && (buffers[enum_1.VectorType.OFFSET] = this.sliceOffsets(arr, offset, length)) ||
            // Otherwise if no offsets, slice the data buffer
            (arr = buffers[enum_1.VectorType.DATA]) && (buffers[enum_1.VectorType.DATA] = this.sliceData(arr, offset, length));
        return buffers;
    }
    sliceChildren(offset, length) {
        // Only slice children if this isn't variable width data
        if (!this._buffers[enum_1.VectorType.OFFSET]) {
            return this._childData.map((child) => child.slice(offset, length));
        }
        return this._childData;
    }
    sliceData(data, offset, length) {
        // Don't slice the data vector for Booleans, since the offset goes by bits not bytes
        return this._type.typeId === 6 ? data : data.subarray(offset, offset + length);
    }
    sliceOffsets(valueOffsets, offset, length) {
        return valueOffsets.subarray(offset, offset + length + 1);
    }
    //
    // Convenience methods for creating Data instances for each of the Arrow Vector types
    //
    /** @nocollapse */
    static Null(type, offset, length, nullCount, nullBitmap) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap)
        });
    }
    /** @nocollapse */
    static Int(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Dictionary(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.indices.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Float(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Bool(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Decimal(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Date(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Time(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Timestamp(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Interval(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static FixedSizeBinary(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Binary(type, offset, length, nullCount, nullBitmap, valueOffsets, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.OFFSET]: buffer_1.toArrayBufferView(Int32Array, valueOffsets),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(Uint8Array, data)
        });
    }
    /** @nocollapse */
    static Utf8(type, offset, length, nullCount, nullBitmap, valueOffsets, data) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.OFFSET]: buffer_1.toArrayBufferView(Int32Array, valueOffsets),
            [enum_1.VectorType.DATA]: buffer_1.toArrayBufferView(Uint8Array, data)
        });
    }
    /** @nocollapse */
    static List(type, offset, length, nullCount, nullBitmap, valueOffsets, childData) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.OFFSET]: buffer_1.toArrayBufferView(Int32Array, valueOffsets)
        }, [childData]);
    }
    /** @nocollapse */
    static FixedSizeList(type, offset, length, nullCount, nullBitmap, childData) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap)
        }, [childData]);
    }
    /** @nocollapse */
    static Struct(type, offset, length, nullCount, nullBitmap, childData) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap)
        }, childData);
    }
    /** @nocollapse */
    static Map(type, offset, length, nullCount, nullBitmap, childData) {
        return new Data(type, offset, length, nullCount, {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap)
        }, childData);
    }
    /** @nocollapse */
    static Union(type, offset, length, nullCount, nullBitmap, typeIds, valueOffsetsOrChildData, childData) {
        const buffers = {
            [enum_1.VectorType.VALIDITY]: buffer_1.toArrayBufferView(Uint8Array, nullBitmap),
            [enum_1.VectorType.TYPE]: buffer_1.toArrayBufferView(type.ArrayType, typeIds)
        };
        if (type.mode === enum_1.UnionMode.Sparse) {
            return new Data(type, offset, length, nullCount, buffers, valueOffsetsOrChildData);
        }
        buffers[enum_1.VectorType.OFFSET] = buffer_1.toArrayBufferView(Int32Array, valueOffsetsOrChildData);
        return new Data(type, offset, length, nullCount, buffers, childData);
    }
}
exports.Data = Data;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDdEksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUU7WUFDN0MsQ0FBQyxpQkFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLDBCQUFpQixDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUM7WUFDaEUsQ0FBQyxpQkFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLDBCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDO1NBQzdELENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsT0FBTyxDQUFvQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDNUksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUU7WUFDN0MsQ0FBQyxpQkFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLDBCQUFpQixDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUM7WUFDaEUsQ0FBQyxpQkFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLDBCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDO1NBQzdELENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsSUFBSSxDQUFrQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDdkksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUU7WUFDN0MsQ0FBQyxpQkFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLDBCQUFpQixDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUM7WUFDaEUsQ0FBQyxpQkFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLDBCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDO1NBQzdELENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsSUFBSSxDQUFpQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDdEksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUU7WUFDN0MsQ0FBQyxpQkFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLDBCQUFpQixDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUM7WUFDaEUsQ0FBQyxpQkFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLDBCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDO1NBQzdELENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsU0FBUyxDQUFzQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDaEosT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUU7WUFDN0MsQ0FBQyxpQkFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLDBCQUFpQixDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUM7WUFDaEUsQ0FBQyxpQkFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLDBCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDO1NBQzdELENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsUUFBUSxDQUFxQixJQUFPLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFBRSxTQUFpQixFQUFFLFVBQXNCLEVBQUUsSUFBbUI7UUFDOUksT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUU7WUFDN0MsQ0FBQyxp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LGlCQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsMEJBQWlCLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUM7U0FDekQsQ0FBQztRQUNULElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxnQkFBUyxDQUFDLE1BQU0sRUFBRTtZQUNoQyxPQUFPLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsdUJBQTRDLENBQUMsQ0FBQztTQUMzRztRQUNELE9BQU8sQ0FBQyxpQkFBVSxDQUFDLE1BQU0sQ0FBQyxHQUFHLDBCQUFpQixDQUFDLFVBQVUsRUFBdUIsdUJBQXVCLENBQUMsQ0FBQztRQUN6RyxPQUFPLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDekUsQ0FBQztDQUNKO0FBdk5ELG9CQXVOQyIsImZpbGUiOiJkYXRhLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IERhdGFUeXBlIH0gZnJvbSAnLi90eXBlJztcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gJy4vdmVjdG9yJztcbmltcG9ydCB7IHBvcGNudF9iaXRfcmFuZ2UgfSBmcm9tICcuL3V0aWwvYml0JztcbmltcG9ydCB7IHRvQXJyYXlCdWZmZXJWaWV3IH0gZnJvbSAnLi91dGlsL2J1ZmZlcic7XG5pbXBvcnQgeyBWZWN0b3JUeXBlIGFzIEJ1ZmZlclR5cGUsIFVuaW9uTW9kZSB9IGZyb20gJy4vZW51bSc7XG5pbXBvcnQge1xuICAgIERpY3Rpb25hcnksXG4gICAgTnVsbCwgSW50LCBGbG9hdCxcbiAgICBCaW5hcnksIEJvb2wsIFV0ZjgsIERlY2ltYWwsXG4gICAgRGF0ZV8sIFRpbWUsIFRpbWVzdGFtcCwgSW50ZXJ2YWwsXG4gICAgTGlzdCwgU3RydWN0LCBVbmlvbiwgRml4ZWRTaXplQmluYXJ5LCBGaXhlZFNpemVMaXN0LCBNYXBfLFxufSBmcm9tICcuL3R5cGUnO1xuXG4vLyBXaGVuIHNsaWNpbmcsIHdlIGRvIG5vdCBrbm93IHRoZSBudWxsIGNvdW50IG9mIHRoZSBzbGljZWQgcmFuZ2Ugd2l0aG91dFxuLy8gZG9pbmcgc29tZSBjb21wdXRhdGlvbi4gVG8gYXZvaWQgZG9pbmcgdGhpcyBlYWdlcmx5LCB3ZSBzZXQgdGhlIG51bGwgY291bnRcbi8vIHRvIC0xIChhbnkgbmVnYXRpdmUgbnVtYmVyIHdpbGwgZG8pLiBXaGVuIEFycmF5OjpudWxsX2NvdW50IGlzIGNhbGxlZCB0aGVcbi8vIGZpcnN0IHRpbWUsIHRoZSBudWxsIGNvdW50IHdpbGwgYmUgY29tcHV0ZWQuIFNlZSBBUlJPVy0zM1xuZXhwb3J0IHR5cGUga1Vua25vd25OdWxsQ291bnQgPSAtMTtcbmV4cG9ydCBjb25zdCBrVW5rbm93bk51bGxDb3VudCA9IC0xO1xuXG5leHBvcnQgdHlwZSBOdWxsQnVmZmVyID0gVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQ7XG5leHBvcnQgdHlwZSBUeXBlSWRzQnVmZmVyID0gSW50OEFycmF5ICB8IEFycmF5TGlrZTxudW1iZXI+IHwgSXRlcmFibGU8bnVtYmVyPjtcbmV4cG9ydCB0eXBlIFZhbHVlT2Zmc2V0c0J1ZmZlciA9IEludDMyQXJyYXkgIHwgQXJyYXlMaWtlPG51bWJlcj4gfCBJdGVyYWJsZTxudW1iZXI+O1xuZXhwb3J0IHR5cGUgRGF0YUJ1ZmZlcjxUIGV4dGVuZHMgRGF0YVR5cGU+ID0gVFsnVEFycmF5J10gfCBBcnJheUxpa2U8bnVtYmVyPiB8IEl0ZXJhYmxlPG51bWJlcj47XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnVmZmVyczxUIGV4dGVuZHMgRGF0YVR5cGU+IHtcbiAgICAgIFtCdWZmZXJUeXBlLk9GRlNFVF0/OiBJbnQzMkFycmF5O1xuICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXT86IFRbJ1RBcnJheSddO1xuICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXT86IFVpbnQ4QXJyYXk7XG4gICAgICAgIFtCdWZmZXJUeXBlLlRZUEVdPzogVFsnVEFycmF5J107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGF0YTxUIGV4dGVuZHMgRGF0YVR5cGUgPSBEYXRhVHlwZT4ge1xuICAgIHJlYWRvbmx5IFRUeXBlOiBUWydUVHlwZSddO1xuICAgIHJlYWRvbmx5IFRBcnJheTogVFsnVEFycmF5J107XG4gICAgcmVhZG9ubHkgVFZhbHVlOiBUWydUVmFsdWUnXTtcbn1cblxuZXhwb3J0IGNsYXNzIERhdGE8VCBleHRlbmRzIERhdGFUeXBlID0gRGF0YVR5cGU+IHtcblxuICAgIHByb3RlY3RlZCBfdHlwZTogVDtcbiAgICBwcm90ZWN0ZWQgX2xlbmd0aDogbnVtYmVyO1xuICAgIHByb3RlY3RlZCBfb2Zmc2V0OiBudW1iZXI7XG5cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHJvdGVjdGVkIF9jaGlsZERhdGE6IERhdGFbXTtcbiAgICBwcm90ZWN0ZWQgX2J1ZmZlcnMgPSBbXSBhcyBCdWZmZXJzPFQ+O1xuICAgIHByb3RlY3RlZCBfbnVsbENvdW50OiBudW1iZXIgfCBrVW5rbm93bk51bGxDb3VudDtcblxuICAgIHB1YmxpYyBnZXQgdHlwZSgpIHsgcmV0dXJuIHRoaXMuX3R5cGU7IH1cbiAgICBwdWJsaWMgZ2V0IGxlbmd0aCgpIHsgcmV0dXJuIHRoaXMuX2xlbmd0aDsgfVxuICAgIHB1YmxpYyBnZXQgb2Zmc2V0KCkgeyByZXR1cm4gdGhpcy5fb2Zmc2V0OyB9XG4gICAgcHVibGljIGdldCB0eXBlSWQoKSB7IHJldHVybiB0aGlzLl90eXBlLnR5cGVJZDsgfVxuICAgIHB1YmxpYyBnZXQgY2hpbGREYXRhKCkgeyByZXR1cm4gdGhpcy5fY2hpbGREYXRhOyB9XG5cbiAgICBwdWJsaWMgZ2V0IEFycmF5VHlwZSgpIHsgcmV0dXJuIHRoaXMuX3R5cGUuQXJyYXlUeXBlOyB9XG5cbiAgICBwdWJsaWMgZ2V0IHZhbHVlcygpIHsgcmV0dXJuIHRoaXMuX2J1ZmZlcnNbQnVmZmVyVHlwZS5EQVRBXSE7IH1cbiAgICBwdWJsaWMgZ2V0IHR5cGVJZHMoKSB7IHJldHVybiB0aGlzLl9idWZmZXJzW0J1ZmZlclR5cGUuVFlQRV0hOyB9XG4gICAgcHVibGljIGdldCBudWxsQml0bWFwKCkgeyByZXR1cm4gdGhpcy5fYnVmZmVyc1tCdWZmZXJUeXBlLlZBTElESVRZXSE7IH1cbiAgICBwdWJsaWMgZ2V0IHZhbHVlT2Zmc2V0cygpIHsgcmV0dXJuIHRoaXMuX2J1ZmZlcnNbQnVmZmVyVHlwZS5PRkZTRVRdITsgfVxuICAgIHB1YmxpYyBnZXQgbnVsbENvdW50KCkge1xuICAgICAgICBsZXQgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50O1xuICAgICAgICBsZXQgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKG51bGxDb3VudCA9PT0ga1Vua25vd25OdWxsQ291bnQgJiYgKG51bGxCaXRtYXAgPSB0aGlzLl9idWZmZXJzW0J1ZmZlclR5cGUuVkFMSURJVFldKSkge1xuICAgICAgICAgICAgdGhpcy5fbnVsbENvdW50ID0gbnVsbENvdW50ID0gdGhpcy5fbGVuZ3RoIC0gcG9wY250X2JpdF9yYW5nZShudWxsQml0bWFwLCB0aGlzLl9vZmZzZXQsIHRoaXMuX29mZnNldCArIHRoaXMuX2xlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGxDb3VudDtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlciwgYnVmZmVycz86IEJ1ZmZlcnM8VD4sIGNoaWxkRGF0YT86IChEYXRhIHwgVmVjdG9yKVtdKSB7XG4gICAgICAgIHRoaXMuX3R5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLl9vZmZzZXQgPSBNYXRoLmZsb29yKE1hdGgubWF4KG9mZnNldCB8fCAwLCAwKSk7XG4gICAgICAgIHRoaXMuX2xlbmd0aCA9IE1hdGguZmxvb3IoTWF0aC5tYXgobGVuZ3RoIHx8IDAsIDApKTtcbiAgICAgICAgdGhpcy5fYnVmZmVycyA9IE9iamVjdC5hc3NpZ24oW10sIGJ1ZmZlcnMpIGFzIEJ1ZmZlcnM8VD47XG4gICAgICAgIHRoaXMuX251bGxDb3VudCA9IE1hdGguZmxvb3IoTWF0aC5tYXgobnVsbENvdW50IHx8IDAsIC0xKSk7XG4gICAgICAgIHRoaXMuX2NoaWxkRGF0YSA9IChjaGlsZERhdGEgfHwgW10pLm1hcCgoeCkgPT4geCBpbnN0YW5jZW9mIERhdGEgPyB4IDogeC5kYXRhKSBhcyBEYXRhW107XG4gICAgfVxuXG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBEYXRhVHlwZT4odHlwZTogUiwgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0LCBsZW5ndGggPSB0aGlzLl9sZW5ndGgsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCwgYnVmZmVyczogQnVmZmVyczxSPiA9IDxhbnk+IHRoaXMuX2J1ZmZlcnMsIGNoaWxkRGF0YTogKERhdGEgfCBWZWN0b3IpW10gPSB0aGlzLl9jaGlsZERhdGEpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIGJ1ZmZlcnMsIGNoaWxkRGF0YSk7XG4gICAgfVxuXG4gICAgcHVibGljIHNsaWNlKG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcik6IERhdGE8VD4ge1xuICAgICAgICAvLyArdHJ1ZSA9PT0gMSwgK2ZhbHNlID09PSAwLCBzbyB0aGlzIG1lYW5zXG4gICAgICAgIC8vIHdlIGtlZXAgbnVsbENvdW50IGF0IDAgaWYgaXQncyBhbHJlYWR5IDAsXG4gICAgICAgIC8vIG90aGVyd2lzZSBzZXQgdG8gdGhlIGludmFsaWRhdGVkIGZsYWcgLTFcbiAgICAgICAgY29uc3QgbnVsbENvdW50ID0gKyh0aGlzLl9udWxsQ291bnQgPT09IDApIC0gMTtcbiAgICAgICAgY29uc3QgYnVmZmVycyA9IHRoaXMuc2xpY2VCdWZmZXJzKG9mZnNldCwgbGVuZ3RoKTtcbiAgICAgICAgY29uc3QgY2hpbGREYXRhID0gdGhpcy5zbGljZUNoaWxkcmVuKG9mZnNldCwgbGVuZ3RoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmU8VD4odGhpcy5fdHlwZSwgdGhpcy5fb2Zmc2V0ICsgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgYnVmZmVycywgY2hpbGREYXRhKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgc2xpY2VCdWZmZXJzKG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcik6IEJ1ZmZlcnM8VD4ge1xuICAgICAgICBsZXQgYXJyOiBhbnksIGJ1ZmZlcnMgPSBPYmplY3QuYXNzaWduKFtdLCB0aGlzLl9idWZmZXJzKSBhcyBCdWZmZXJzPFQ+O1xuICAgICAgICAvLyBJZiB0eXBlSWRzIGV4aXN0LCBzbGljZSB0aGUgdHlwZUlkcyBidWZmZXJcbiAgICAgICAgKGFyciA9IGJ1ZmZlcnNbQnVmZmVyVHlwZS5UWVBFXSkgJiYgKGJ1ZmZlcnNbQnVmZmVyVHlwZS5UWVBFXSA9IHRoaXMuc2xpY2VEYXRhKGFyciwgb2Zmc2V0LCBsZW5ndGgpKTtcbiAgICAgICAgLy8gSWYgb2Zmc2V0cyBleGlzdCwgb25seSBzbGljZSB0aGUgb2Zmc2V0cyBidWZmZXJcbiAgICAgICAgKGFyciA9IGJ1ZmZlcnNbQnVmZmVyVHlwZS5PRkZTRVRdKSAmJiAoYnVmZmVyc1tCdWZmZXJUeXBlLk9GRlNFVF0gPSB0aGlzLnNsaWNlT2Zmc2V0cyhhcnIsIG9mZnNldCwgbGVuZ3RoKSkgfHxcbiAgICAgICAgICAgIC8vIE90aGVyd2lzZSBpZiBubyBvZmZzZXRzLCBzbGljZSB0aGUgZGF0YSBidWZmZXJcbiAgICAgICAgICAgIChhcnIgPSBidWZmZXJzW0J1ZmZlclR5cGUuREFUQV0pICYmIChidWZmZXJzW0J1ZmZlclR5cGUuREFUQV0gPSB0aGlzLnNsaWNlRGF0YShhcnIsIG9mZnNldCwgbGVuZ3RoKSk7XG4gICAgICAgIHJldHVybiBidWZmZXJzO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBzbGljZUNoaWxkcmVuKG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcik6IERhdGFbXSB7XG4gICAgICAgIC8vIE9ubHkgc2xpY2UgY2hpbGRyZW4gaWYgdGhpcyBpc24ndCB2YXJpYWJsZSB3aWR0aCBkYXRhXG4gICAgICAgIGlmICghdGhpcy5fYnVmZmVyc1tCdWZmZXJUeXBlLk9GRlNFVF0pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jaGlsZERhdGEubWFwKChjaGlsZCkgPT4gY2hpbGQuc2xpY2Uob2Zmc2V0LCBsZW5ndGgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGREYXRhO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBzbGljZURhdGEoZGF0YTogVFsnVEFycmF5J10gJiBBcnJheUJ1ZmZlclZpZXcsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICAvLyBEb24ndCBzbGljZSB0aGUgZGF0YSB2ZWN0b3IgZm9yIEJvb2xlYW5zLCBzaW5jZSB0aGUgb2Zmc2V0IGdvZXMgYnkgYml0cyBub3QgYnl0ZXNcbiAgICAgICAgcmV0dXJuIHRoaXMuX3R5cGUudHlwZUlkID09PSA2ID8gZGF0YSA6IGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBzbGljZU9mZnNldHModmFsdWVPZmZzZXRzOiBJbnQzMkFycmF5LCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlT2Zmc2V0cy5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIGxlbmd0aCArIDEpO1xuICAgIH1cblxuICAgIC8vXG4gICAgLy8gQ29udmVuaWVuY2UgbWV0aG9kcyBmb3IgY3JlYXRpbmcgRGF0YSBpbnN0YW5jZXMgZm9yIGVhY2ggb2YgdGhlIEFycm93IFZlY3RvciB0eXBlc1xuICAgIC8vXG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBOdWxsPFQgZXh0ZW5kcyBOdWxsPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEludDxUIGV4dGVuZHMgSW50Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBEaWN0aW9uYXJ5PFQgZXh0ZW5kcyBEaWN0aW9uYXJ5Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3PFRbJ1RBcnJheSddPih0eXBlLmluZGljZXMuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBGbG9hdDxUIGV4dGVuZHMgRmxvYXQ+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEJvb2w8VCBleHRlbmRzIEJvb2w+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIERlY2ltYWw8VCBleHRlbmRzIERlY2ltYWw+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIERhdGU8VCBleHRlbmRzIERhdGVfPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBUaW1lPFQgZXh0ZW5kcyBUaW1lPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBUaW1lc3RhbXA8VCBleHRlbmRzIFRpbWVzdGFtcD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgSW50ZXJ2YWw8VCBleHRlbmRzIEludGVydmFsPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBGaXhlZFNpemVCaW5hcnk8VCBleHRlbmRzIEZpeGVkU2l6ZUJpbmFyeT4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgQmluYXJ5PFQgZXh0ZW5kcyBCaW5hcnk+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIHZhbHVlT2Zmc2V0czogVmFsdWVPZmZzZXRzQnVmZmVyLCBkYXRhOiBVaW50OEFycmF5KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuT0ZGU0VUXTogdG9BcnJheUJ1ZmZlclZpZXcoSW50MzJBcnJheSwgdmFsdWVPZmZzZXRzKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBVdGY4PFQgZXh0ZW5kcyBVdGY4Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCB2YWx1ZU9mZnNldHM6IFZhbHVlT2Zmc2V0c0J1ZmZlciwgZGF0YTogVWludDhBcnJheSkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLk9GRlNFVF06IHRvQXJyYXlCdWZmZXJWaWV3KEludDMyQXJyYXksIHZhbHVlT2Zmc2V0cyksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgTGlzdDxUIGV4dGVuZHMgTGlzdD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgdmFsdWVPZmZzZXRzOiBWYWx1ZU9mZnNldHNCdWZmZXIsIGNoaWxkRGF0YTogRGF0YSB8IFZlY3Rvcikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLk9GRlNFVF06IHRvQXJyYXlCdWZmZXJWaWV3KEludDMyQXJyYXksIHZhbHVlT2Zmc2V0cylcbiAgICAgICAgfSwgW2NoaWxkRGF0YV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEZpeGVkU2l6ZUxpc3Q8VCBleHRlbmRzIEZpeGVkU2l6ZUxpc3Q+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGNoaWxkRGF0YTogRGF0YSB8IFZlY3Rvcikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKVxuICAgICAgICB9LCBbY2hpbGREYXRhXSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgU3RydWN0PFQgZXh0ZW5kcyBTdHJ1Y3Q+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGNoaWxkRGF0YTogKERhdGEgfCBWZWN0b3IpW10pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcClcbiAgICAgICAgfSwgY2hpbGREYXRhKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBNYXA8VCBleHRlbmRzIE1hcF8+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGNoaWxkRGF0YTogKERhdGEgfCBWZWN0b3IpW10pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcClcbiAgICAgICAgfSwgY2hpbGREYXRhKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBVbmlvbjxUIGV4dGVuZHMgVW5pb24+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIHR5cGVJZHM6IFR5cGVJZHNCdWZmZXIsIHZhbHVlT2Zmc2V0c09yQ2hpbGREYXRhOiBWYWx1ZU9mZnNldHNCdWZmZXIgfCAoRGF0YSB8IFZlY3RvcilbXSwgY2hpbGREYXRhPzogKERhdGEgfCBWZWN0b3IpW10pIHtcbiAgICAgICAgY29uc3QgYnVmZmVycyA9IHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5UWVBFXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIHR5cGVJZHMpXG4gICAgICAgIH0gYXMgYW55O1xuICAgICAgICBpZiAodHlwZS5tb2RlID09PSBVbmlvbk1vZGUuU3BhcnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgYnVmZmVycywgdmFsdWVPZmZzZXRzT3JDaGlsZERhdGEgYXMgKERhdGEgfCBWZWN0b3IpW10pO1xuICAgICAgICB9XG4gICAgICAgIGJ1ZmZlcnNbQnVmZmVyVHlwZS5PRkZTRVRdID0gdG9BcnJheUJ1ZmZlclZpZXcoSW50MzJBcnJheSwgPFZhbHVlT2Zmc2V0c0J1ZmZlcj4gdmFsdWVPZmZzZXRzT3JDaGlsZERhdGEpO1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwgYnVmZmVycywgY2hpbGREYXRhKTtcbiAgICB9XG59XG4iXX0=
