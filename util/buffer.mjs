// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import { flatbuffers } from 'flatbuffers';
var ByteBuffer = flatbuffers.ByteBuffer;
import { isPromise, isIterable, isAsyncIterable, isIteratorResult } from './compat';
const SharedArrayBuf = (typeof SharedArrayBuffer !== 'undefined' ? SharedArrayBuffer : ArrayBuffer);
function collapseContiguousByteRanges(chunks) {
    for (let x, y, i = 0; ++i < chunks.length;) {
        x = chunks[i - 1];
        y = chunks[i - 0];
        // continue x and y don't share the same underlying ArrayBuffer
        if (!x || !y || x.buffer !== y.buffer) {
            continue;
        }
        const { byteOffset: xOffset, byteLength: xLen } = x;
        const { byteOffset: yOffset, byteLength: yLen } = y;
        // continue if the byte ranges of x and y aren't contiguous
        if ((xOffset + xLen) < yOffset || (yOffset + yLen) < xOffset) {
            continue;
        }
        chunks.splice(--i, 2, new Uint8Array(x.buffer, xOffset, yOffset - xOffset + yLen));
    }
    return chunks;
}
/**
 * @ignore
 */
export function memcpy(target, source, targetByteOffset = 0, sourceByteLength = source.byteLength) {
    const targetByteLength = target.byteLength;
    const dst = new Uint8Array(target.buffer, target.byteOffset, targetByteLength);
    const src = new Uint8Array(source.buffer, source.byteOffset, Math.min(sourceByteLength, targetByteLength));
    dst.set(src, targetByteOffset);
    return target;
}
/**
 * @ignore
 */
export function joinUint8Arrays(chunks, size) {
    // collapse chunks that share the same underlying ArrayBuffer and whose byte ranges overlap,
    // to avoid unnecessarily copying the bytes to do this buffer join. This is a common case during
    // streaming, where we may be reading partial byte ranges out of the same underlying ArrayBuffer
    chunks = collapseContiguousByteRanges(chunks);
    let offset = 0, index = -1, chunksLen = chunks.length;
    let source, sliced, buffer;
    let length = typeof size === 'number' ? size : chunks.reduce((x, y) => x + y.length, 0);
    while (++index < chunksLen) {
        source = chunks[index];
        sliced = source.subarray(0, Math.min(source.length, length - offset));
        if (length <= (offset + sliced.length)) {
            if (sliced.length < source.length) {
                chunks[index] = source.subarray(sliced.length);
            }
            else if (sliced.length === source.length) {
                index++;
            }
            buffer ? memcpy(buffer, sliced, offset) : (buffer = sliced);
            break;
        }
        (buffer || (buffer = new Uint8Array(length))).set(sliced, offset);
        offset += sliced.length;
    }
    return [buffer || new Uint8Array(0), chunks.slice(index)];
}
/**
 * @ignore
 */
export function toArrayBufferView(ArrayBufferViewCtor, input) {
    let value = isIteratorResult(input) ? input.value : input;
    if (!value) {
        return new ArrayBufferViewCtor(0);
    }
    if (typeof value === 'string') {
        value = decodeUtf8(value);
    }
    if (value instanceof ArrayBufferViewCtor) {
        return value;
    }
    if (value instanceof ArrayBuffer) {
        return new ArrayBufferViewCtor(value);
    }
    if (value instanceof SharedArrayBuf) {
        return new ArrayBufferViewCtor(value);
    }
    if (value instanceof ByteBuffer) {
        return toArrayBufferView(ArrayBufferViewCtor, value.bytes());
    }
    return !ArrayBuffer.isView(value) ? ArrayBufferViewCtor.from(value) : value.byteLength <= 0 ? new ArrayBufferViewCtor(0)
        : new ArrayBufferViewCtor(value.buffer, value.byteOffset, value.byteLength / ArrayBufferViewCtor.BYTES_PER_ELEMENT);
}
/** @ignore */ export const toInt8Array = (input) => toArrayBufferView(Int8Array, input);
/** @ignore */ export const toInt16Array = (input) => toArrayBufferView(Int16Array, input);
/** @ignore */ export const toInt32Array = (input) => toArrayBufferView(Int32Array, input);
/** @ignore */ export const toUint8Array = (input) => toArrayBufferView(Uint8Array, input);
/** @ignore */ export const toUint16Array = (input) => toArrayBufferView(Uint16Array, input);
/** @ignore */ export const toUint32Array = (input) => toArrayBufferView(Uint32Array, input);
/** @ignore */ export const toFloat32Array = (input) => toArrayBufferView(Float32Array, input);
/** @ignore */ export const toFloat64Array = (input) => toArrayBufferView(Float64Array, input);
/** @ignore */ export const toUint8ClampedArray = (input) => toArrayBufferView(Uint8ClampedArray, input);
const pump = (iterator) => { iterator.next(); return iterator; };
/** @ignore */
export function* toArrayBufferViewIterator(ArrayCtor, source) {
    const wrap = function* (x) { yield x; };
    const buffers = (typeof source === 'string') ? wrap(source)
        : (ArrayBuffer.isView(source)) ? wrap(source)
            : (source instanceof ArrayBuffer) ? wrap(source)
                : (source instanceof SharedArrayBuf) ? wrap(source)
                    : !isIterable(source) ? wrap(source) : source;
    yield* pump((function* (it) {
        let r = null;
        do {
            r = it.next(yield toArrayBufferView(ArrayCtor, r));
        } while (!r.done);
    })(buffers[Symbol.iterator]()));
}
/** @ignore */ export const toInt8ArrayIterator = (input) => toArrayBufferViewIterator(Int8Array, input);
/** @ignore */ export const toInt16ArrayIterator = (input) => toArrayBufferViewIterator(Int16Array, input);
/** @ignore */ export const toInt32ArrayIterator = (input) => toArrayBufferViewIterator(Int32Array, input);
/** @ignore */ export const toUint8ArrayIterator = (input) => toArrayBufferViewIterator(Uint8Array, input);
/** @ignore */ export const toUint16ArrayIterator = (input) => toArrayBufferViewIterator(Uint16Array, input);
/** @ignore */ export const toUint32ArrayIterator = (input) => toArrayBufferViewIterator(Uint32Array, input);
/** @ignore */ export const toFloat32ArrayIterator = (input) => toArrayBufferViewIterator(Float32Array, input);
/** @ignore */ export const toFloat64ArrayIterator = (input) => toArrayBufferViewIterator(Float64Array, input);
/** @ignore */ export const toUint8ClampedArrayIterator = (input) => toArrayBufferViewIterator(Uint8ClampedArray, input);
/** @ignore */
export async function* toArrayBufferViewAsyncIterator(ArrayCtor, source) {
    // if a Promise, unwrap the Promise and iterate the resolved value
    if (isPromise(source)) {
        return yield* toArrayBufferViewAsyncIterator(ArrayCtor, await source);
    }
    const wrap = async function* (x) { yield await x; };
    const emit = async function* (source) {
        yield* pump((function* (it) {
            let r = null;
            do {
                r = it.next(yield r && r.value);
            } while (!r.done);
        })(source[Symbol.iterator]()));
    };
    const buffers = (typeof source === 'string') ? wrap(source) // if string, wrap in an AsyncIterableIterator
        : (ArrayBuffer.isView(source)) ? wrap(source) // if TypedArray, wrap in an AsyncIterableIterator
            : (source instanceof ArrayBuffer) ? wrap(source) // if ArrayBuffer, wrap in an AsyncIterableIterator
                : (source instanceof SharedArrayBuf) ? wrap(source) // if SharedArrayBuffer, wrap in an AsyncIterableIterator
                    : isIterable(source) ? emit(source) // If Iterable, wrap in an AsyncIterableIterator and compose the `next` values
                        : !isAsyncIterable(source) ? wrap(source) // If not an AsyncIterable, treat as a sentinel and wrap in an AsyncIterableIterator
                            : source; // otherwise if AsyncIterable, use it
    yield* pump((async function* (it) {
        let r = null;
        do {
            r = await it.next(yield toArrayBufferView(ArrayCtor, r));
        } while (!r.done);
    })(buffers[Symbol.asyncIterator]()));
}
/** @ignore */ export const toInt8ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Int8Array, input);
/** @ignore */ export const toInt16ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Int16Array, input);
/** @ignore */ export const toInt32ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Int32Array, input);
/** @ignore */ export const toUint8ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint8Array, input);
/** @ignore */ export const toUint16ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint16Array, input);
/** @ignore */ export const toUint32ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint32Array, input);
/** @ignore */ export const toFloat32ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Float32Array, input);
/** @ignore */ export const toFloat64ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Float64Array, input);
/** @ignore */ export const toUint8ClampedArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint8ClampedArray, input);
/**
 * @ignore
 */
function decodeUtf8(chunk) {
    const bytes = new Uint8Array(chunk.length);
    for (let i = -1, n = chunk.length; ++i < n;) {
        bytes[i] = chunk.charCodeAt(i);
    }
    return bytes;
}
/**
 * @ignore
 */
export function rebaseValueOffsets(offset, length, valueOffsets) {
    // If we have a non-zero offset, create a new offsets array with the values
    // shifted by the start offset, such that the new start offset is 0
    if (offset !== 0) {
        valueOffsets = valueOffsets.slice(0, length + 1);
        for (let i = -1; ++i <= length;) {
            valueOffsets[i] += offset;
        }
    }
    return valueOffsets;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWwvYnVmZmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDZEQUE2RDtBQUM3RCwrREFBK0Q7QUFDL0Qsd0RBQXdEO0FBQ3hELDZEQUE2RDtBQUM3RCxvREFBb0Q7QUFDcEQsNkRBQTZEO0FBQzdELDZEQUE2RDtBQUM3RCxFQUFFO0FBQ0YsK0NBQStDO0FBQy9DLEVBQUU7QUFDRiw2REFBNkQ7QUFDN0QsOERBQThEO0FBQzlELHlEQUF5RDtBQUN6RCw0REFBNEQ7QUFDNUQsMERBQTBEO0FBQzFELHFCQUFxQjtBQUVyQixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQzFDLElBQU8sVUFBVSxHQUFHLFdBQVcsQ0FBQyxVQUFVLENBQUM7QUFFM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsZUFBZSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sVUFBVSxDQUFDO0FBQ3BGLE1BQU0sY0FBYyxHQUFHLENBQUMsT0FBTyxpQkFBaUIsS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUVwRyxTQUFTLDRCQUE0QixDQUFDLE1BQW9CO0lBQ3RELEtBQUssSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sR0FBRztRQUN4QyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNsQixDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNsQiwrREFBK0Q7UUFDL0QsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxNQUFNLEVBQUU7WUFBRSxTQUFTO1NBQUU7UUFDcEQsTUFBTSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNwRCxNQUFNLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3BELDJEQUEyRDtRQUMzRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLE9BQU8sSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxPQUFPLEVBQUU7WUFBRSxTQUFTO1NBQUU7UUFDM0UsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxHQUFHLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO0tBQ3RGO0lBQ0QsT0FBTyxNQUFNLENBQUM7QUFDbEIsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLE1BQU0sQ0FBbUUsTUFBZSxFQUFFLE1BQWUsRUFBRSxnQkFBZ0IsR0FBRyxDQUFDLEVBQUUsZ0JBQWdCLEdBQUcsTUFBTSxDQUFDLFVBQVU7SUFDakwsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDO0lBQzNDLE1BQU0sR0FBRyxHQUFHLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLFVBQVUsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0lBQy9FLE1BQU0sR0FBRyxHQUFHLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLGdCQUFnQixDQUFDLENBQUMsQ0FBQztJQUMzRyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0lBQy9CLE9BQU8sTUFBTSxDQUFDO0FBQ2xCLENBQUM7QUFFRDs7R0FFRztBQUNILE1BQU0sVUFBVSxlQUFlLENBQUMsTUFBb0IsRUFBRSxJQUFvQjtJQUN0RSw0RkFBNEY7SUFDNUYsZ0dBQWdHO0lBQ2hHLGdHQUFnRztJQUNoRyxNQUFNLEdBQUcsNEJBQTRCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDOUMsSUFBSSxNQUFNLEdBQUcsQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLENBQUMsRUFBRSxTQUFTLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUN0RCxJQUFJLE1BQWtCLEVBQUUsTUFBa0IsRUFBRSxNQUF5QixDQUFDO0lBQ3RFLElBQUksTUFBTSxHQUFHLE9BQU8sSUFBSSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDeEYsT0FBTyxFQUFFLEtBQUssR0FBRyxTQUFTLEVBQUU7UUFDeEIsTUFBTSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN2QixNQUFNLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLE1BQU0sR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ3RFLElBQUksTUFBTSxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUNwQyxJQUFJLE1BQU0sQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRTtnQkFDL0IsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQ2xEO2lCQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sS0FBSyxNQUFNLENBQUMsTUFBTSxFQUFFO2dCQUFFLEtBQUssRUFBRSxDQUFDO2FBQUU7WUFDeEQsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLENBQUM7WUFDNUQsTUFBTTtTQUNUO1FBQ0QsQ0FBQyxNQUFNLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDbEUsTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUM7S0FDM0I7SUFDRCxPQUFPLENBQUMsTUFBTSxJQUFJLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztBQUM5RCxDQUFDO0FBTUQ7O0dBRUc7QUFDSCxNQUFNLFVBQVUsaUJBQWlCLENBQTRCLG1CQUFrRCxFQUFFLEtBQTJCO0lBRXhJLElBQUksS0FBSyxHQUFRLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFFL0QsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUFFLE9BQU8sSUFBSSxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUFFO0lBQ2xELElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO1FBQUUsS0FBSyxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUFFO0lBQzdELElBQUksS0FBSyxZQUFZLG1CQUFtQixFQUFFO1FBQUUsT0FBTyxLQUFLLENBQUM7S0FBRTtJQUMzRCxJQUFJLEtBQUssWUFBWSxXQUFXLEVBQUU7UUFBRSxPQUFPLElBQUksbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQUM7S0FBRTtJQUM1RSxJQUFJLEtBQUssWUFBWSxjQUFjLEVBQUU7UUFBRSxPQUFPLElBQUksbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQUM7S0FBRTtJQUMvRSxJQUFJLEtBQUssWUFBWSxVQUFVLEVBQUU7UUFBRSxPQUFPLGlCQUFpQixDQUFDLG1CQUFtQixFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO0tBQUU7SUFDbEcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksbUJBQW1CLENBQUMsQ0FBQyxDQUFDO1FBQ3BILENBQUMsQ0FBQyxJQUFJLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVSxHQUFHLG1CQUFtQixDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFDNUgsQ0FBQztBQUVELGNBQWMsQ0FBQyxNQUFNLENBQUMsTUFBTSxXQUFXLEdBQUcsQ0FBQyxLQUEyQixFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDL0csY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBRyxDQUFDLEtBQTJCLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNqSCxjQUFjLENBQUMsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHLENBQUMsS0FBMkIsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ2pILGNBQWMsQ0FBQyxNQUFNLENBQUMsTUFBTSxZQUFZLEdBQUcsQ0FBQyxLQUEyQixFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDakgsY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxDQUFDLEtBQTJCLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNuSCxjQUFjLENBQUMsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFHLENBQUMsS0FBMkIsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ25ILGNBQWMsQ0FBQyxNQUFNLENBQUMsTUFBTSxjQUFjLEdBQUcsQ0FBQyxLQUEyQixFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDckgsY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLGNBQWMsR0FBRyxDQUFDLEtBQTJCLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNySCxjQUFjLENBQUMsTUFBTSxDQUFDLE1BQU0sbUJBQW1CLEdBQUcsQ0FBQyxLQUEyQixFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUkvSCxNQUFNLElBQUksR0FBRyxDQUErQyxRQUFXLEVBQUUsRUFBRSxHQUFHLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLE9BQU8sUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRWxILGNBQWM7QUFDZCxNQUFNLFNBQVMsQ0FBQyxDQUFDLHlCQUF5QixDQUE0QixTQUF3QyxFQUFFLE1BQW9DO0lBRWhKLE1BQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxFQUFJLENBQUksSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM3QyxNQUFNLE9BQU8sR0FDRSxDQUFDLE9BQU8sTUFBTSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQzdDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUNoRCxDQUFDLENBQUMsQ0FBQyxNQUFNLFlBQVksV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7Z0JBQ25ELENBQUMsQ0FBQyxDQUFDLE1BQU0sWUFBWSxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztvQkFDMUQsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUF1QixNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7SUFFcEUsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRTtRQUN0QixJQUFJLENBQUMsR0FBOEIsSUFBSSxDQUFDO1FBQ3hDLEdBQUc7WUFDQyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLGlCQUFpQixDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3RELFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFO0lBQ3RCLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDcEMsQ0FBQztBQUVELGNBQWMsQ0FBQyxNQUFNLENBQUMsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN2SSxjQUFjLENBQUMsTUFBTSxDQUFDLE1BQU0sb0JBQW9CLEdBQUcsQ0FBQyxLQUFtQyxFQUFFLEVBQUUsQ0FBQyx5QkFBeUIsQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDekksY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLG9CQUFvQixHQUFHLENBQUMsS0FBbUMsRUFBRSxFQUFFLENBQUMseUJBQXlCLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ3pJLGNBQWMsQ0FBQyxNQUFNLENBQUMsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN6SSxjQUFjLENBQUMsTUFBTSxDQUFDLE1BQU0scUJBQXFCLEdBQUcsQ0FBQyxLQUFtQyxFQUFFLEVBQUUsQ0FBQyx5QkFBeUIsQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDM0ksY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLHFCQUFxQixHQUFHLENBQUMsS0FBbUMsRUFBRSxFQUFFLENBQUMseUJBQXlCLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzNJLGNBQWMsQ0FBQyxNQUFNLENBQUMsTUFBTSxzQkFBc0IsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQztBQUM3SSxjQUFjLENBQUMsTUFBTSxDQUFDLE1BQU0sc0JBQXNCLEdBQUcsQ0FBQyxLQUFtQyxFQUFFLEVBQUUsQ0FBQyx5QkFBeUIsQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDN0ksY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLDJCQUEyQixHQUFHLENBQUMsS0FBbUMsRUFBRSxFQUFFLENBQUMseUJBQXlCLENBQUMsaUJBQWlCLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFJdkosY0FBYztBQUNkLE1BQU0sQ0FBQyxLQUFLLFNBQVMsQ0FBQyxDQUFDLDhCQUE4QixDQUE0QixTQUF3QyxFQUFFLE1BQXlDO0lBRWhLLGtFQUFrRTtJQUNsRSxJQUFJLFNBQVMsQ0FBdUIsTUFBTSxDQUFDLEVBQUU7UUFDekMsT0FBTyxLQUFLLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQyxTQUFTLEVBQUUsTUFBTSxNQUFNLENBQUMsQ0FBQztLQUN6RTtJQUVELE1BQU0sSUFBSSxHQUFHLEtBQUssU0FBUyxDQUFDLEVBQUksQ0FBSSxJQUFJLE1BQU0sTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekQsTUFBTSxJQUFJLEdBQUcsS0FBSyxTQUFTLENBQUMsRUFBMkIsTUFBUztRQUM1RCxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBQyxFQUFpQjtZQUNwQyxJQUFJLENBQUMsR0FBOEIsSUFBSSxDQUFDO1lBQ3hDLEdBQUc7Z0JBQ0MsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ25DLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFO1FBQ3RCLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDbkMsQ0FBQyxDQUFDO0lBRUYsTUFBTSxPQUFPLEdBQ08sQ0FBQyxPQUFPLE1BQU0sS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLDhDQUE4QztRQUM1RixDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxrREFBa0Q7WUFDbkcsQ0FBQyxDQUFDLENBQUMsTUFBTSxZQUFZLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsbURBQW1EO2dCQUN2RyxDQUFDLENBQUMsQ0FBQyxNQUFNLFlBQVksY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyx5REFBeUQ7b0JBQ25ILENBQUMsQ0FBQyxVQUFVLENBQXVCLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsOEVBQThFO3dCQUM5SSxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQXVCLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsb0ZBQW9GOzRCQUNuRyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMscUNBQXFDO0lBRWhHLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssU0FBUyxDQUFDLEVBQUUsRUFBRTtRQUM1QixJQUFJLENBQUMsR0FBOEIsSUFBSSxDQUFDO1FBQ3hDLEdBQUc7WUFDQyxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0saUJBQWlCLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDNUQsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUU7SUFDdEIsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUN6QyxDQUFDO0FBRUQsY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLHdCQUF3QixHQUFHLENBQUMsS0FBd0MsRUFBRSxFQUFFLENBQUMsOEJBQThCLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ3RKLGNBQWMsQ0FBQyxNQUFNLENBQUMsTUFBTSx5QkFBeUIsR0FBRyxDQUFDLEtBQXdDLEVBQUUsRUFBRSxDQUFDLDhCQUE4QixDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN4SixjQUFjLENBQUMsTUFBTSxDQUFDLE1BQU0seUJBQXlCLEdBQUcsQ0FBQyxLQUF3QyxFQUFFLEVBQUUsQ0FBQyw4QkFBOEIsQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDeEosY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLHlCQUF5QixHQUFHLENBQUMsS0FBd0MsRUFBRSxFQUFFLENBQUMsOEJBQThCLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ3hKLGNBQWMsQ0FBQyxNQUFNLENBQUMsTUFBTSwwQkFBMEIsR0FBRyxDQUFDLEtBQXdDLEVBQUUsRUFBRSxDQUFDLDhCQUE4QixDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUMxSixjQUFjLENBQUMsTUFBTSxDQUFDLE1BQU0sMEJBQTBCLEdBQUcsQ0FBQyxLQUF3QyxFQUFFLEVBQUUsQ0FBQyw4QkFBOEIsQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDMUosY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLDJCQUEyQixHQUFHLENBQUMsS0FBd0MsRUFBRSxFQUFFLENBQUMsOEJBQThCLENBQUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzVKLGNBQWMsQ0FBQyxNQUFNLENBQUMsTUFBTSwyQkFBMkIsR0FBRyxDQUFDLEtBQXdDLEVBQUUsRUFBRSxDQUFDLDhCQUE4QixDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQztBQUM1SixjQUFjLENBQUMsTUFBTSxDQUFDLE1BQU0sZ0NBQWdDLEdBQUcsQ0FBQyxLQUF3QyxFQUFFLEVBQUUsQ0FBQyw4QkFBOEIsQ0FBQyxpQkFBaUIsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUV0Szs7R0FFRztBQUNILFNBQVMsVUFBVSxDQUFDLEtBQWE7SUFDN0IsTUFBTSxLQUFLLEdBQUcsSUFBSSxVQUFVLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzNDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHO1FBQ3pDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQ2xDO0lBQ0QsT0FBTyxLQUFLLENBQUM7QUFDakIsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxVQUFVLGtCQUFrQixDQUFDLE1BQWMsRUFBRSxNQUFjLEVBQUUsWUFBd0I7SUFDdkYsMkVBQTJFO0lBQzNFLG1FQUFtRTtJQUNuRSxJQUFJLE1BQU0sS0FBSyxDQUFDLEVBQUU7UUFDZCxZQUFZLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2pELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksTUFBTSxHQUFHO1lBQzdCLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUM7U0FDN0I7S0FDSjtJQUNELE9BQU8sWUFBWSxDQUFDO0FBQ3hCLENBQUMiLCJmaWxlIjoidXRpbC9idWZmZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4vLyBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbi8vIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4vLyByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4vLyB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4vLyBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Vcbi8vIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbi8vIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4vLyBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuLy8gS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4vLyBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4vLyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgZmxhdGJ1ZmZlcnMgfSBmcm9tICdmbGF0YnVmZmVycyc7XG5pbXBvcnQgQnl0ZUJ1ZmZlciA9IGZsYXRidWZmZXJzLkJ5dGVCdWZmZXI7XG5pbXBvcnQgeyBBcnJheUJ1ZmZlclZpZXdDb25zdHJ1Y3RvciB9IGZyb20gJy4uL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgaXNQcm9taXNlLCBpc0l0ZXJhYmxlLCBpc0FzeW5jSXRlcmFibGUsIGlzSXRlcmF0b3JSZXN1bHQgfSBmcm9tICcuL2NvbXBhdCc7XG5jb25zdCBTaGFyZWRBcnJheUJ1ZiA9ICh0eXBlb2YgU2hhcmVkQXJyYXlCdWZmZXIgIT09ICd1bmRlZmluZWQnID8gU2hhcmVkQXJyYXlCdWZmZXIgOiBBcnJheUJ1ZmZlcik7XG5cbmZ1bmN0aW9uIGNvbGxhcHNlQ29udGlndW91c0J5dGVSYW5nZXMoY2h1bmtzOiBVaW50OEFycmF5W10pIHtcbiAgICBmb3IgKGxldCB4LCB5LCBpID0gMDsgKytpIDwgY2h1bmtzLmxlbmd0aDspIHtcbiAgICAgICAgeCA9IGNodW5rc1tpIC0gMV07XG4gICAgICAgIHkgPSBjaHVua3NbaSAtIDBdO1xuICAgICAgICAvLyBjb250aW51ZSB4IGFuZCB5IGRvbid0IHNoYXJlIHRoZSBzYW1lIHVuZGVybHlpbmcgQXJyYXlCdWZmZXJcbiAgICAgICAgaWYgKCF4IHx8ICF5IHx8IHguYnVmZmVyICE9PSB5LmJ1ZmZlcikgeyBjb250aW51ZTsgfVxuICAgICAgICBjb25zdCB7IGJ5dGVPZmZzZXQ6IHhPZmZzZXQsIGJ5dGVMZW5ndGg6IHhMZW4gfSA9IHg7XG4gICAgICAgIGNvbnN0IHsgYnl0ZU9mZnNldDogeU9mZnNldCwgYnl0ZUxlbmd0aDogeUxlbiB9ID0geTtcbiAgICAgICAgLy8gY29udGludWUgaWYgdGhlIGJ5dGUgcmFuZ2VzIG9mIHggYW5kIHkgYXJlbid0IGNvbnRpZ3VvdXNcbiAgICAgICAgaWYgKCh4T2Zmc2V0ICsgeExlbikgPCB5T2Zmc2V0IHx8ICh5T2Zmc2V0ICsgeUxlbikgPCB4T2Zmc2V0KSB7IGNvbnRpbnVlOyB9XG4gICAgICAgIGNodW5rcy5zcGxpY2UoLS1pLCAyLCBuZXcgVWludDhBcnJheSh4LmJ1ZmZlciwgeE9mZnNldCwgeU9mZnNldCAtIHhPZmZzZXQgKyB5TGVuKSk7XG4gICAgfVxuICAgIHJldHVybiBjaHVua3M7XG59XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgZnVuY3Rpb24gbWVtY3B5PFRUYXJnZXQgZXh0ZW5kcyBBcnJheUJ1ZmZlclZpZXcsIFRTb3VyY2UgZXh0ZW5kcyBBcnJheUJ1ZmZlclZpZXc+KHRhcmdldDogVFRhcmdldCwgc291cmNlOiBUU291cmNlLCB0YXJnZXRCeXRlT2Zmc2V0ID0gMCwgc291cmNlQnl0ZUxlbmd0aCA9IHNvdXJjZS5ieXRlTGVuZ3RoKSB7XG4gICAgY29uc3QgdGFyZ2V0Qnl0ZUxlbmd0aCA9IHRhcmdldC5ieXRlTGVuZ3RoO1xuICAgIGNvbnN0IGRzdCA9IG5ldyBVaW50OEFycmF5KHRhcmdldC5idWZmZXIsIHRhcmdldC5ieXRlT2Zmc2V0LCB0YXJnZXRCeXRlTGVuZ3RoKTtcbiAgICBjb25zdCBzcmMgPSBuZXcgVWludDhBcnJheShzb3VyY2UuYnVmZmVyLCBzb3VyY2UuYnl0ZU9mZnNldCwgTWF0aC5taW4oc291cmNlQnl0ZUxlbmd0aCwgdGFyZ2V0Qnl0ZUxlbmd0aCkpO1xuICAgIGRzdC5zZXQoc3JjLCB0YXJnZXRCeXRlT2Zmc2V0KTtcbiAgICByZXR1cm4gdGFyZ2V0O1xufVxuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGpvaW5VaW50OEFycmF5cyhjaHVua3M6IFVpbnQ4QXJyYXlbXSwgc2l6ZT86IG51bWJlciB8IG51bGwpOiBbVWludDhBcnJheSwgVWludDhBcnJheVtdXSB7XG4gICAgLy8gY29sbGFwc2UgY2h1bmtzIHRoYXQgc2hhcmUgdGhlIHNhbWUgdW5kZXJseWluZyBBcnJheUJ1ZmZlciBhbmQgd2hvc2UgYnl0ZSByYW5nZXMgb3ZlcmxhcCxcbiAgICAvLyB0byBhdm9pZCB1bm5lY2Vzc2FyaWx5IGNvcHlpbmcgdGhlIGJ5dGVzIHRvIGRvIHRoaXMgYnVmZmVyIGpvaW4uIFRoaXMgaXMgYSBjb21tb24gY2FzZSBkdXJpbmdcbiAgICAvLyBzdHJlYW1pbmcsIHdoZXJlIHdlIG1heSBiZSByZWFkaW5nIHBhcnRpYWwgYnl0ZSByYW5nZXMgb3V0IG9mIHRoZSBzYW1lIHVuZGVybHlpbmcgQXJyYXlCdWZmZXJcbiAgICBjaHVua3MgPSBjb2xsYXBzZUNvbnRpZ3VvdXNCeXRlUmFuZ2VzKGNodW5rcyk7XG4gICAgbGV0IG9mZnNldCA9IDAsIGluZGV4ID0gLTEsIGNodW5rc0xlbiA9IGNodW5rcy5sZW5ndGg7XG4gICAgbGV0IHNvdXJjZTogVWludDhBcnJheSwgc2xpY2VkOiBVaW50OEFycmF5LCBidWZmZXI6IFVpbnQ4QXJyYXkgfCB2b2lkO1xuICAgIGxldCBsZW5ndGggPSB0eXBlb2Ygc2l6ZSA9PT0gJ251bWJlcicgPyBzaXplIDogY2h1bmtzLnJlZHVjZSgoeCwgeSkgPT4geCArIHkubGVuZ3RoLCAwKTtcbiAgICB3aGlsZSAoKytpbmRleCA8IGNodW5rc0xlbikge1xuICAgICAgICBzb3VyY2UgPSBjaHVua3NbaW5kZXhdO1xuICAgICAgICBzbGljZWQgPSBzb3VyY2Uuc3ViYXJyYXkoMCwgTWF0aC5taW4oc291cmNlLmxlbmd0aCwgbGVuZ3RoIC0gb2Zmc2V0KSk7XG4gICAgICAgIGlmIChsZW5ndGggPD0gKG9mZnNldCArIHNsaWNlZC5sZW5ndGgpKSB7XG4gICAgICAgICAgICBpZiAoc2xpY2VkLmxlbmd0aCA8IHNvdXJjZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBjaHVua3NbaW5kZXhdID0gc291cmNlLnN1YmFycmF5KHNsaWNlZC5sZW5ndGgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzbGljZWQubGVuZ3RoID09PSBzb3VyY2UubGVuZ3RoKSB7IGluZGV4Kys7IH1cbiAgICAgICAgICAgIGJ1ZmZlciA/IG1lbWNweShidWZmZXIsIHNsaWNlZCwgb2Zmc2V0KSA6IChidWZmZXIgPSBzbGljZWQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgKGJ1ZmZlciB8fCAoYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKSkpLnNldChzbGljZWQsIG9mZnNldCk7XG4gICAgICAgIG9mZnNldCArPSBzbGljZWQubGVuZ3RoO1xuICAgIH1cbiAgICByZXR1cm4gW2J1ZmZlciB8fCBuZXcgVWludDhBcnJheSgwKSwgY2h1bmtzLnNsaWNlKGluZGV4KV07XG59XG5cbmV4cG9ydCB0eXBlIEFycmF5QnVmZmVyVmlld0lucHV0ID0gQXJyYXlCdWZmZXJWaWV3IHwgQXJyYXlCdWZmZXJMaWtlIHwgQXJyYXlCdWZmZXJWaWV3IHwgSXRlcmFibGU8bnVtYmVyPiB8IEFycmF5TGlrZTxudW1iZXI+IHwgQnl0ZUJ1ZmZlciB8IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQgIHxcbiAgICAgICAgICAgICAgICAgICAgSXRlcmF0b3JSZXN1bHQ8QXJyYXlCdWZmZXJWaWV3IHwgQXJyYXlCdWZmZXJMaWtlIHwgQXJyYXlCdWZmZXJWaWV3IHwgSXRlcmFibGU8bnVtYmVyPiB8IEFycmF5TGlrZTxudW1iZXI+IHwgQnl0ZUJ1ZmZlciB8IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ+IHxcbiAgICAgICAgICBSZWFkYWJsZVN0cmVhbVJlYWRSZXN1bHQ8QXJyYXlCdWZmZXJWaWV3IHwgQXJyYXlCdWZmZXJMaWtlIHwgQXJyYXlCdWZmZXJWaWV3IHwgSXRlcmFibGU8bnVtYmVyPiB8IEFycmF5TGlrZTxudW1iZXI+IHwgQnl0ZUJ1ZmZlciB8IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ+IDtcblxuLyoqXG4gKiBAaWdub3JlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0b0FycmF5QnVmZmVyVmlldzxUIGV4dGVuZHMgQXJyYXlCdWZmZXJWaWV3PihBcnJheUJ1ZmZlclZpZXdDdG9yOiBBcnJheUJ1ZmZlclZpZXdDb25zdHJ1Y3RvcjxUPiwgaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KTogVCB7XG5cbiAgICBsZXQgdmFsdWU6IGFueSA9IGlzSXRlcmF0b3JSZXN1bHQoaW5wdXQpID8gaW5wdXQudmFsdWUgOiBpbnB1dDtcblxuICAgIGlmICghdmFsdWUpIHsgcmV0dXJuIG5ldyBBcnJheUJ1ZmZlclZpZXdDdG9yKDApOyB9XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsgdmFsdWUgPSBkZWNvZGVVdGY4KHZhbHVlKTsgfVxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyVmlld0N0b3IpIHsgcmV0dXJuIHZhbHVlOyB9XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsgcmV0dXJuIG5ldyBBcnJheUJ1ZmZlclZpZXdDdG9yKHZhbHVlKTsgfVxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFNoYXJlZEFycmF5QnVmKSB7IHJldHVybiBuZXcgQXJyYXlCdWZmZXJWaWV3Q3Rvcih2YWx1ZSk7IH1cbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBCeXRlQnVmZmVyKSB7IHJldHVybiB0b0FycmF5QnVmZmVyVmlldyhBcnJheUJ1ZmZlclZpZXdDdG9yLCB2YWx1ZS5ieXRlcygpKTsgfVxuICAgIHJldHVybiAhQXJyYXlCdWZmZXIuaXNWaWV3KHZhbHVlKSA/IEFycmF5QnVmZmVyVmlld0N0b3IuZnJvbSh2YWx1ZSkgOiB2YWx1ZS5ieXRlTGVuZ3RoIDw9IDAgPyBuZXcgQXJyYXlCdWZmZXJWaWV3Q3RvcigwKVxuICAgICAgICA6IG5ldyBBcnJheUJ1ZmZlclZpZXdDdG9yKHZhbHVlLmJ1ZmZlciwgdmFsdWUuYnl0ZU9mZnNldCwgdmFsdWUuYnl0ZUxlbmd0aCAvIEFycmF5QnVmZmVyVmlld0N0b3IuQllURVNfUEVSX0VMRU1FTlQpO1xufVxuXG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQ4QXJyYXkgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlldyhJbnQ4QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDE2QXJyYXkgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlldyhJbnQxNkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQzMkFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoSW50MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDhBcnJheSA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQxNkFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoVWludDE2QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQzMkFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoVWludDMyQXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0Zsb2F0MzJBcnJheSA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3KEZsb2F0MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvRmxvYXQ2NEFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoRmxvYXQ2NEFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50OENsYW1wZWRBcnJheSA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4Q2xhbXBlZEFycmF5LCBpbnB1dCk7XG5cbnR5cGUgQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCA9IEl0ZXJhYmxlPEFycmF5QnVmZmVyVmlld0lucHV0PiB8IEFycmF5QnVmZmVyVmlld0lucHV0O1xuXG5jb25zdCBwdW1wID0gPFQgZXh0ZW5kcyBJdGVyYXRvcjxhbnk+IHwgQXN5bmNJdGVyYXRvcjxhbnk+PihpdGVyYXRvcjogVCkgPT4geyBpdGVyYXRvci5uZXh0KCk7IHJldHVybiBpdGVyYXRvcjsgfTtcblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBmdW5jdGlvbiogdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcjxUIGV4dGVuZHMgQXJyYXlCdWZmZXJWaWV3PihBcnJheUN0b3I6IEFycmF5QnVmZmVyVmlld0NvbnN0cnVjdG9yPFQ+LCBzb3VyY2U6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpIHtcblxuICAgIGNvbnN0IHdyYXAgPSBmdW5jdGlvbio8VD4oeDogVCkgeyB5aWVsZCB4OyB9O1xuICAgIGNvbnN0IGJ1ZmZlcnM6IEl0ZXJhYmxlPEFycmF5QnVmZmVyVmlld0lucHV0PiA9XG4gICAgICAgICAgICAgICAgICAgKHR5cGVvZiBzb3VyY2UgPT09ICdzdHJpbmcnKSA/IHdyYXAoc291cmNlKVxuICAgICAgICAgICAgICAgICA6IChBcnJheUJ1ZmZlci5pc1ZpZXcoc291cmNlKSkgPyB3cmFwKHNvdXJjZSlcbiAgICAgICAgICAgICAgOiAoc291cmNlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpID8gd3JhcChzb3VyY2UpXG4gICAgICAgICAgIDogKHNvdXJjZSBpbnN0YW5jZW9mIFNoYXJlZEFycmF5QnVmKSA/IHdyYXAoc291cmNlKVxuICAgIDogIWlzSXRlcmFibGU8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+KHNvdXJjZSkgPyB3cmFwKHNvdXJjZSkgOiBzb3VyY2U7XG5cbiAgICB5aWVsZCogcHVtcCgoZnVuY3Rpb24qIChpdCkge1xuICAgICAgICBsZXQgcjogSXRlcmF0b3JSZXN1bHQ8YW55PiA9IDxhbnk+IG51bGw7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHIgPSBpdC5uZXh0KHlpZWxkIHRvQXJyYXlCdWZmZXJWaWV3KEFycmF5Q3RvciwgcikpO1xuICAgICAgICB9IHdoaWxlICghci5kb25lKTtcbiAgICB9KShidWZmZXJzW1N5bWJvbC5pdGVyYXRvcl0oKSkpO1xufVxuXG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQ4QXJyYXlJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcihJbnQ4QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDE2QXJyYXlJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcihJbnQxNkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQzMkFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoSW50MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDhBcnJheUl0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0l0ZXJhdG9yKFVpbnQ4QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQxNkFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoVWludDE2QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQzMkFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoVWludDMyQXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0Zsb2F0MzJBcnJheUl0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0l0ZXJhdG9yKEZsb2F0MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvRmxvYXQ2NEFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoRmxvYXQ2NEFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50OENsYW1wZWRBcnJheUl0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0l0ZXJhdG9yKFVpbnQ4Q2xhbXBlZEFycmF5LCBpbnB1dCk7XG5cbnR5cGUgQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0ID0gQXN5bmNJdGVyYWJsZTxBcnJheUJ1ZmZlclZpZXdJbnB1dD4gfCBJdGVyYWJsZTxBcnJheUJ1ZmZlclZpZXdJbnB1dD4gfCBQcm9taXNlTGlrZTxBcnJheUJ1ZmZlclZpZXdJbnB1dD4gfCBBcnJheUJ1ZmZlclZpZXdJbnB1dDtcblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiogdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yPFQgZXh0ZW5kcyBBcnJheUJ1ZmZlclZpZXc+KEFycmF5Q3RvcjogQXJyYXlCdWZmZXJWaWV3Q29uc3RydWN0b3I8VD4sIHNvdXJjZTogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KTogQXN5bmNJdGVyYWJsZUl0ZXJhdG9yPFQ+IHtcblxuICAgIC8vIGlmIGEgUHJvbWlzZSwgdW53cmFwIHRoZSBQcm9taXNlIGFuZCBpdGVyYXRlIHRoZSByZXNvbHZlZCB2YWx1ZVxuICAgIGlmIChpc1Byb21pc2U8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+KHNvdXJjZSkpIHtcbiAgICAgICAgcmV0dXJuIHlpZWxkKiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoQXJyYXlDdG9yLCBhd2FpdCBzb3VyY2UpO1xuICAgIH1cblxuICAgIGNvbnN0IHdyYXAgPSBhc3luYyBmdW5jdGlvbio8VD4oeDogVCkgeyB5aWVsZCBhd2FpdCB4OyB9O1xuICAgIGNvbnN0IGVtaXQgPSBhc3luYyBmdW5jdGlvbiogPFQgZXh0ZW5kcyBJdGVyYWJsZTxhbnk+Pihzb3VyY2U6IFQpIHtcbiAgICAgICAgeWllbGQqIHB1bXAoKGZ1bmN0aW9uKihpdDogSXRlcmF0b3I8YW55Pikge1xuICAgICAgICAgICAgbGV0IHI6IEl0ZXJhdG9yUmVzdWx0PGFueT4gPSA8YW55PiBudWxsO1xuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIHIgPSBpdC5uZXh0KHlpZWxkIHIgJiYgci52YWx1ZSk7XG4gICAgICAgICAgICB9IHdoaWxlICghci5kb25lKTtcbiAgICAgICAgfSkoc291cmNlW1N5bWJvbC5pdGVyYXRvcl0oKSkpO1xuICAgIH07XG5cbiAgICBjb25zdCBidWZmZXJzOiBBc3luY0l0ZXJhYmxlPEFycmF5QnVmZmVyVmlld0lucHV0PiA9XG4gICAgICAgICAgICAgICAgICAgICAgICAodHlwZW9mIHNvdXJjZSA9PT0gJ3N0cmluZycpID8gd3JhcChzb3VyY2UpIC8vIGlmIHN0cmluZywgd3JhcCBpbiBhbiBBc3luY0l0ZXJhYmxlSXRlcmF0b3JcbiAgICAgICAgICAgICAgICAgICAgICA6IChBcnJheUJ1ZmZlci5pc1ZpZXcoc291cmNlKSkgPyB3cmFwKHNvdXJjZSkgLy8gaWYgVHlwZWRBcnJheSwgd3JhcCBpbiBhbiBBc3luY0l0ZXJhYmxlSXRlcmF0b3JcbiAgICAgICAgICAgICAgICAgICA6IChzb3VyY2UgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgPyB3cmFwKHNvdXJjZSkgLy8gaWYgQXJyYXlCdWZmZXIsIHdyYXAgaW4gYW4gQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXG4gICAgICAgICAgICAgICAgOiAoc291cmNlIGluc3RhbmNlb2YgU2hhcmVkQXJyYXlCdWYpID8gd3JhcChzb3VyY2UpIC8vIGlmIFNoYXJlZEFycmF5QnVmZmVyLCB3cmFwIGluIGFuIEFzeW5jSXRlcmFibGVJdGVyYXRvclxuICAgICAgICAgIDogaXNJdGVyYWJsZTxBcnJheUJ1ZmZlclZpZXdJbnB1dD4oc291cmNlKSA/IGVtaXQoc291cmNlKSAvLyBJZiBJdGVyYWJsZSwgd3JhcCBpbiBhbiBBc3luY0l0ZXJhYmxlSXRlcmF0b3IgYW5kIGNvbXBvc2UgdGhlIGBuZXh0YCB2YWx1ZXNcbiAgICA6ICFpc0FzeW5jSXRlcmFibGU8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+KHNvdXJjZSkgPyB3cmFwKHNvdXJjZSkgLy8gSWYgbm90IGFuIEFzeW5jSXRlcmFibGUsIHRyZWF0IGFzIGEgc2VudGluZWwgYW5kIHdyYXAgaW4gYW4gQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogc291cmNlOyAvLyBvdGhlcndpc2UgaWYgQXN5bmNJdGVyYWJsZSwgdXNlIGl0XG5cbiAgICB5aWVsZCogcHVtcCgoYXN5bmMgZnVuY3Rpb24qIChpdCkge1xuICAgICAgICBsZXQgcjogSXRlcmF0b3JSZXN1bHQ8YW55PiA9IDxhbnk+IG51bGw7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHIgPSBhd2FpdCBpdC5uZXh0KHlpZWxkIHRvQXJyYXlCdWZmZXJWaWV3KEFycmF5Q3RvciwgcikpO1xuICAgICAgICB9IHdoaWxlICghci5kb25lKTtcbiAgICB9KShidWZmZXJzW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpKSk7XG59XG5cbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDhBcnJheUFzeW5jSXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yKEludDhBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvSW50MTZBcnJheUFzeW5jSXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yKEludDE2QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDMyQXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihJbnQzMkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50OEFycmF5QXN5bmNJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoVWludDhBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDE2QXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihVaW50MTZBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDMyQXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihVaW50MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvRmxvYXQzMkFycmF5QXN5bmNJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoRmxvYXQzMkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9GbG9hdDY0QXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihGbG9hdDY0QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQ4Q2xhbXBlZEFycmF5QXN5bmNJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoVWludDhDbGFtcGVkQXJyYXksIGlucHV0KTtcblxuLyoqXG4gKiBAaWdub3JlXG4gKi9cbmZ1bmN0aW9uIGRlY29kZVV0ZjgoY2h1bms6IHN0cmluZykge1xuICAgIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoY2h1bmsubGVuZ3RoKTtcbiAgICBmb3IgKGxldCBpID0gLTEsIG4gPSBjaHVuay5sZW5ndGg7ICsraSA8IG47KSB7XG4gICAgICAgIGJ5dGVzW2ldID0gY2h1bmsuY2hhckNvZGVBdChpKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ5dGVzO1xufVxuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlYmFzZVZhbHVlT2Zmc2V0cyhvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIHZhbHVlT2Zmc2V0czogSW50MzJBcnJheSkge1xuICAgIC8vIElmIHdlIGhhdmUgYSBub24temVybyBvZmZzZXQsIGNyZWF0ZSBhIG5ldyBvZmZzZXRzIGFycmF5IHdpdGggdGhlIHZhbHVlc1xuICAgIC8vIHNoaWZ0ZWQgYnkgdGhlIHN0YXJ0IG9mZnNldCwgc3VjaCB0aGF0IHRoZSBuZXcgc3RhcnQgb2Zmc2V0IGlzIDBcbiAgICBpZiAob2Zmc2V0ICE9PSAwKSB7XG4gICAgICAgIHZhbHVlT2Zmc2V0cyA9IHZhbHVlT2Zmc2V0cy5zbGljZSgwLCBsZW5ndGggKyAxKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IC0xOyArK2kgPD0gbGVuZ3RoOykge1xuICAgICAgICAgICAgdmFsdWVPZmZzZXRzW2ldICs9IG9mZnNldDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdmFsdWVPZmZzZXRzO1xufVxuIl19
