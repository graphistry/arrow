"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const flatbuffers_1 = require("flatbuffers");
const utf8_1 = require("../util/utf8");
var ByteBuffer = flatbuffers_1.flatbuffers.ByteBuffer;
const compat_1 = require("./compat");
const SharedArrayBuf = (typeof SharedArrayBuffer !== 'undefined' ? SharedArrayBuffer : ArrayBuffer);
function collapseContiguousByteRanges(chunks) {
    for (let x, y, i = 0; ++i < chunks.length;) {
        x = chunks[i - 1];
        y = chunks[i - 0];
        // continue x and y don't share the same underlying ArrayBuffer
        if (!x || !y || x.buffer !== y.buffer) {
            continue;
        }
        const { byteOffset: xOffset, byteLength: xLen } = x;
        const { byteOffset: yOffset, byteLength: yLen } = y;
        // continue if the byte ranges of x and y aren't contiguous
        if ((xOffset + xLen) < yOffset || (yOffset + yLen) < xOffset) {
            continue;
        }
        chunks.splice(--i, 2, new Uint8Array(x.buffer, xOffset, yOffset - xOffset + yLen));
    }
    return chunks;
}
/**
 * @ignore
 */
function memcpy(target, source, targetByteOffset = 0, sourceByteLength = source.byteLength) {
    const targetByteLength = target.byteLength;
    const dst = new Uint8Array(target.buffer, target.byteOffset, targetByteLength);
    const src = new Uint8Array(source.buffer, source.byteOffset, Math.min(sourceByteLength, targetByteLength));
    dst.set(src, targetByteOffset);
    return target;
}
exports.memcpy = memcpy;
/**
 * @ignore
 */
function joinUint8Arrays(chunks, size) {
    // collapse chunks that share the same underlying ArrayBuffer and whose byte ranges overlap,
    // to avoid unnecessarily copying the bytes to do this buffer join. This is a common case during
    // streaming, where we may be reading partial byte ranges out of the same underlying ArrayBuffer
    chunks = collapseContiguousByteRanges(chunks);
    let offset = 0, index = -1, numChunks = chunks.length;
    let chunksLen = chunks.reduce((x, y) => x + y.byteLength, 0);
    let source, sliced, buffer;
    let length = Math.min(chunksLen, typeof size === 'number' ? size : Infinity);
    while (++index < numChunks) {
        source = chunks[index];
        sliced = source.subarray(0, Math.min(source.length, length - offset));
        if (length <= (offset + sliced.length)) {
            if (sliced.length < source.length) {
                chunks[index] = source.subarray(sliced.length);
            }
            else if (sliced.length === source.length) {
                index++;
            }
            buffer ? memcpy(buffer, sliced, offset) : (buffer = sliced);
            break;
        }
        (buffer || (buffer = new Uint8Array(length))).set(sliced, offset);
        offset += sliced.length;
    }
    return [buffer || new Uint8Array(0), chunks.slice(index)];
}
exports.joinUint8Arrays = joinUint8Arrays;
/**
 * @ignore
 */
function toArrayBufferView(ArrayBufferViewCtor, input) {
    let value = compat_1.isIteratorResult(input) ? input.value : input;
    if (!value) {
        return new ArrayBufferViewCtor(0);
    }
    if (typeof value === 'string') {
        value = utf8_1.encodeUtf8(value);
    }
    if (value instanceof ArrayBufferViewCtor) {
        return value;
    }
    if (value instanceof ArrayBuffer) {
        return new ArrayBufferViewCtor(value);
    }
    if (value instanceof SharedArrayBuf) {
        return new ArrayBufferViewCtor(value);
    }
    if (value instanceof ByteBuffer) {
        return toArrayBufferView(ArrayBufferViewCtor, value.bytes());
    }
    return !ArrayBuffer.isView(value) ? ArrayBufferViewCtor.from(value) : value.byteLength <= 0 ? new ArrayBufferViewCtor(0)
        : new ArrayBufferViewCtor(value.buffer, value.byteOffset, value.byteLength / ArrayBufferViewCtor.BYTES_PER_ELEMENT);
}
exports.toArrayBufferView = toArrayBufferView;
/** @ignore */ exports.toInt8Array = (input) => toArrayBufferView(Int8Array, input);
/** @ignore */ exports.toInt16Array = (input) => toArrayBufferView(Int16Array, input);
/** @ignore */ exports.toInt32Array = (input) => toArrayBufferView(Int32Array, input);
/** @ignore */ exports.toUint8Array = (input) => toArrayBufferView(Uint8Array, input);
/** @ignore */ exports.toUint16Array = (input) => toArrayBufferView(Uint16Array, input);
/** @ignore */ exports.toUint32Array = (input) => toArrayBufferView(Uint32Array, input);
/** @ignore */ exports.toFloat32Array = (input) => toArrayBufferView(Float32Array, input);
/** @ignore */ exports.toFloat64Array = (input) => toArrayBufferView(Float64Array, input);
/** @ignore */ exports.toUint8ClampedArray = (input) => toArrayBufferView(Uint8ClampedArray, input);
const pump = (iterator) => { iterator.next(); return iterator; };
/** @ignore */
function* toArrayBufferViewIterator(ArrayCtor, source) {
    const wrap = function* (x) { yield x; };
    const buffers = (typeof source === 'string') ? wrap(source)
        : (ArrayBuffer.isView(source)) ? wrap(source)
            : (source instanceof ArrayBuffer) ? wrap(source)
                : (source instanceof SharedArrayBuf) ? wrap(source)
                    : !compat_1.isIterable(source) ? wrap(source) : source;
    yield* pump((function* (it) {
        let r = null;
        do {
            r = it.next(yield toArrayBufferView(ArrayCtor, r));
        } while (!r.done);
    })(buffers[Symbol.iterator]()));
}
exports.toArrayBufferViewIterator = toArrayBufferViewIterator;
/** @ignore */ exports.toInt8ArrayIterator = (input) => toArrayBufferViewIterator(Int8Array, input);
/** @ignore */ exports.toInt16ArrayIterator = (input) => toArrayBufferViewIterator(Int16Array, input);
/** @ignore */ exports.toInt32ArrayIterator = (input) => toArrayBufferViewIterator(Int32Array, input);
/** @ignore */ exports.toUint8ArrayIterator = (input) => toArrayBufferViewIterator(Uint8Array, input);
/** @ignore */ exports.toUint16ArrayIterator = (input) => toArrayBufferViewIterator(Uint16Array, input);
/** @ignore */ exports.toUint32ArrayIterator = (input) => toArrayBufferViewIterator(Uint32Array, input);
/** @ignore */ exports.toFloat32ArrayIterator = (input) => toArrayBufferViewIterator(Float32Array, input);
/** @ignore */ exports.toFloat64ArrayIterator = (input) => toArrayBufferViewIterator(Float64Array, input);
/** @ignore */ exports.toUint8ClampedArrayIterator = (input) => toArrayBufferViewIterator(Uint8ClampedArray, input);
/** @ignore */
function toArrayBufferViewAsyncIterator(ArrayCtor, source) {
    return tslib_1.__asyncGenerator(this, arguments, function* toArrayBufferViewAsyncIterator_1() {
        // if a Promise, unwrap the Promise and iterate the resolved value
        if (compat_1.isPromise(source)) {
            return yield tslib_1.__await(yield tslib_1.__await(yield* tslib_1.__asyncDelegator(tslib_1.__asyncValues(toArrayBufferViewAsyncIterator(ArrayCtor, yield tslib_1.__await(source))))));
        }
        const wrap = function (x) { return tslib_1.__asyncGenerator(this, arguments, function* () { yield yield tslib_1.__await(yield tslib_1.__await(x)); }); };
        const emit = function (source) {
            return tslib_1.__asyncGenerator(this, arguments, function* () {
                yield tslib_1.__await(yield* tslib_1.__asyncDelegator(tslib_1.__asyncValues(pump((function* (it) {
                    let r = null;
                    do {
                        r = it.next(yield r && r.value);
                    } while (!r.done);
                })(source[Symbol.iterator]())))));
            });
        };
        const buffers = (typeof source === 'string') ? wrap(source) // if string, wrap in an AsyncIterableIterator
            : (ArrayBuffer.isView(source)) ? wrap(source) // if TypedArray, wrap in an AsyncIterableIterator
                : (source instanceof ArrayBuffer) ? wrap(source) // if ArrayBuffer, wrap in an AsyncIterableIterator
                    : (source instanceof SharedArrayBuf) ? wrap(source) // if SharedArrayBuffer, wrap in an AsyncIterableIterator
                        : compat_1.isIterable(source) ? emit(source) // If Iterable, wrap in an AsyncIterableIterator and compose the `next` values
                            : !compat_1.isAsyncIterable(source) ? wrap(source) // If not an AsyncIterable, treat as a sentinel and wrap in an AsyncIterableIterator
                                : source; // otherwise if AsyncIterable, use it
        yield tslib_1.__await(// otherwise if AsyncIterable, use it
        yield* tslib_1.__asyncDelegator(tslib_1.__asyncValues(pump((function (it) {
            return tslib_1.__asyncGenerator(this, arguments, function* () {
                let r = null;
                do {
                    r = yield tslib_1.__await(it.next(yield yield tslib_1.__await(toArrayBufferView(ArrayCtor, r))));
                } while (!r.done);
            });
        })(buffers[Symbol.asyncIterator]())))));
    });
}
exports.toArrayBufferViewAsyncIterator = toArrayBufferViewAsyncIterator;
/** @ignore */ exports.toInt8ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Int8Array, input);
/** @ignore */ exports.toInt16ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Int16Array, input);
/** @ignore */ exports.toInt32ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Int32Array, input);
/** @ignore */ exports.toUint8ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint8Array, input);
/** @ignore */ exports.toUint16ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint16Array, input);
/** @ignore */ exports.toUint32ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint32Array, input);
/** @ignore */ exports.toFloat32ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Float32Array, input);
/** @ignore */ exports.toFloat64ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Float64Array, input);
/** @ignore */ exports.toUint8ClampedArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint8ClampedArray, input);
/**
 * @ignore
 */
function rebaseValueOffsets(offset, length, valueOffsets) {
    // If we have a non-zero offset, create a new offsets array with the values
    // shifted by the start offset, such that the new start offset is 0
    if (offset !== 0) {
        valueOffsets = valueOffsets.slice(0, length + 1);
        for (let i = -1; ++i <= length;) {
            valueOffsets[i] += offset;
        }
    }
    return valueOffsets;
}
exports.rebaseValueOffsets = rebaseValueOffsets;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWwvYnVmZmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSw2REFBNkQ7QUFDN0QsK0RBQStEO0FBQy9ELHdEQUF3RDtBQUN4RCw2REFBNkQ7QUFDN0Qsb0RBQW9EO0FBQ3BELDZEQUE2RDtBQUM3RCw2REFBNkQ7QUFDN0QsRUFBRTtBQUNGLCtDQUErQztBQUMvQyxFQUFFO0FBQ0YsNkRBQTZEO0FBQzdELDhEQUE4RDtBQUM5RCx5REFBeUQ7QUFDekQsNERBQTREO0FBQzVELDBEQUEwRDtBQUMxRCxxQkFBcUI7OztBQUVyQiw2Q0FBMEM7QUFDMUMsdUNBQTBDO0FBQzFDLElBQU8sVUFBVSxHQUFHLHlCQUFXLENBQUMsVUFBVSxDQUFDO0FBRTNDLHFDQUFvRjtBQUNwRixNQUFNLGNBQWMsR0FBRyxDQUFDLE9BQU8saUJBQWlCLEtBQUssV0FBVyxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUM7QUFFcEcsU0FBUyw0QkFBNEIsQ0FBQyxNQUFvQjtJQUN0RCxLQUFLLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUc7UUFDeEMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDbEIsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDbEIsK0RBQStEO1FBQy9ELElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsTUFBTSxFQUFFO1lBQUUsU0FBUztTQUFFO1FBQ3BELE1BQU0sRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDcEQsTUFBTSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNwRCwyREFBMkQ7UUFDM0QsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxPQUFPLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsT0FBTyxFQUFFO1lBQUUsU0FBUztTQUFFO1FBQzNFLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sR0FBRyxPQUFPLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztLQUN0RjtJQUNELE9BQU8sTUFBTSxDQUFDO0FBQ2xCLENBQUM7QUFFRDs7R0FFRztBQUNILFNBQWdCLE1BQU0sQ0FBbUUsTUFBZSxFQUFFLE1BQWUsRUFBRSxnQkFBZ0IsR0FBRyxDQUFDLEVBQUUsZ0JBQWdCLEdBQUcsTUFBTSxDQUFDLFVBQVU7SUFDakwsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDO0lBQzNDLE1BQU0sR0FBRyxHQUFHLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLFVBQVUsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0lBQy9FLE1BQU0sR0FBRyxHQUFHLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLGdCQUFnQixDQUFDLENBQUMsQ0FBQztJQUMzRyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0lBQy9CLE9BQU8sTUFBTSxDQUFDO0FBQ2xCLENBQUM7QUFORCx3QkFNQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsZUFBZSxDQUFDLE1BQW9CLEVBQUUsSUFBb0I7SUFDdEUsNEZBQTRGO0lBQzVGLGdHQUFnRztJQUNoRyxnR0FBZ0c7SUFDaEcsTUFBTSxHQUFHLDRCQUE0QixDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzlDLElBQUksTUFBTSxHQUFHLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEVBQUUsU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDdEQsSUFBSSxTQUFTLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzdELElBQUksTUFBa0IsRUFBRSxNQUFrQixFQUFFLE1BQXlCLENBQUM7SUFDdEUsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsT0FBTyxJQUFJLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzdFLE9BQU8sRUFBRSxLQUFLLEdBQUcsU0FBUyxFQUFFO1FBQ3hCLE1BQU0sR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkIsTUFBTSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxNQUFNLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUN0RSxJQUFJLE1BQU0sSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDcEMsSUFBSSxNQUFNLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUU7Z0JBQy9CLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQzthQUNsRDtpQkFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssTUFBTSxDQUFDLE1BQU0sRUFBRTtnQkFBRSxLQUFLLEVBQUUsQ0FBQzthQUFFO1lBQ3hELE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxDQUFDO1lBQzVELE1BQU07U0FDVDtRQUNELENBQUMsTUFBTSxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ2xFLE1BQU0sSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDO0tBQzNCO0lBQ0QsT0FBTyxDQUFDLE1BQU0sSUFBSSxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDOUQsQ0FBQztBQXZCRCwwQ0F1QkM7QUFNRDs7R0FFRztBQUNILFNBQWdCLGlCQUFpQixDQUE0QixtQkFBa0QsRUFBRSxLQUEyQjtJQUV4SSxJQUFJLEtBQUssR0FBUSx5QkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0lBRS9ELElBQUksQ0FBQyxLQUFLLEVBQUU7UUFBRSxPQUFPLElBQUksbUJBQW1CLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FBRTtJQUNsRCxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFBRTtRQUFFLEtBQUssR0FBRyxpQkFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQUU7SUFDN0QsSUFBSSxLQUFLLFlBQVksbUJBQW1CLEVBQUU7UUFBRSxPQUFPLEtBQUssQ0FBQztLQUFFO0lBQzNELElBQUksS0FBSyxZQUFZLFdBQVcsRUFBRTtRQUFFLE9BQU8sSUFBSSxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUFFO0lBQzVFLElBQUksS0FBSyxZQUFZLGNBQWMsRUFBRTtRQUFFLE9BQU8sSUFBSSxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUFFO0lBQy9FLElBQUksS0FBSyxZQUFZLFVBQVUsRUFBRTtRQUFFLE9BQU8saUJBQWlCLENBQUMsbUJBQW1CLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7S0FBRTtJQUNsRyxPQUFPLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxtQkFBbUIsQ0FBQyxDQUFDLENBQUM7UUFDcEgsQ0FBQyxDQUFDLElBQUksbUJBQW1CLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxVQUFVLEdBQUcsbUJBQW1CLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUM1SCxDQUFDO0FBWkQsOENBWUM7QUFFRCxjQUFjLENBQWMsUUFBQSxXQUFXLEdBQUcsQ0FBQyxLQUEyQixFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDL0csY0FBYyxDQUFjLFFBQUEsWUFBWSxHQUFHLENBQUMsS0FBMkIsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ2pILGNBQWMsQ0FBYyxRQUFBLFlBQVksR0FBRyxDQUFDLEtBQTJCLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNqSCxjQUFjLENBQWMsUUFBQSxZQUFZLEdBQUcsQ0FBQyxLQUEyQixFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDakgsY0FBYyxDQUFjLFFBQUEsYUFBYSxHQUFHLENBQUMsS0FBMkIsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ25ILGNBQWMsQ0FBYyxRQUFBLGFBQWEsR0FBRyxDQUFDLEtBQTJCLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNuSCxjQUFjLENBQWMsUUFBQSxjQUFjLEdBQUcsQ0FBQyxLQUEyQixFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDckgsY0FBYyxDQUFjLFFBQUEsY0FBYyxHQUFHLENBQUMsS0FBMkIsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ3JILGNBQWMsQ0FBYyxRQUFBLG1CQUFtQixHQUFHLENBQUMsS0FBMkIsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFJL0gsTUFBTSxJQUFJLEdBQUcsQ0FBK0MsUUFBVyxFQUFFLEVBQUUsR0FBRyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxPQUFPLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUVsSCxjQUFjO0FBQ2QsUUFBZSxDQUFDLENBQUMseUJBQXlCLENBQTRCLFNBQXdDLEVBQUUsTUFBb0M7SUFFaEosTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLEVBQUksQ0FBSSxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzdDLE1BQU0sT0FBTyxHQUNFLENBQUMsT0FBTyxNQUFNLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDN0MsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ2hELENBQUMsQ0FBQyxDQUFDLE1BQU0sWUFBWSxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztnQkFDbkQsQ0FBQyxDQUFDLENBQUMsTUFBTSxZQUFZLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO29CQUMxRCxDQUFDLENBQUMsQ0FBQyxtQkFBVSxDQUF1QixNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUM7SUFFcEUsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRTtRQUN0QixJQUFJLENBQUMsR0FBOEIsSUFBSSxDQUFDO1FBQ3hDLEdBQUc7WUFDQyxDQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLGlCQUFpQixDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3RELFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFO0lBQ3RCLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDcEMsQ0FBQztBQWhCRCw4REFnQkM7QUFFRCxjQUFjLENBQWMsUUFBQSxtQkFBbUIsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN2SSxjQUFjLENBQWMsUUFBQSxvQkFBb0IsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN6SSxjQUFjLENBQWMsUUFBQSxvQkFBb0IsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN6SSxjQUFjLENBQWMsUUFBQSxvQkFBb0IsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN6SSxjQUFjLENBQWMsUUFBQSxxQkFBcUIsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUMzSSxjQUFjLENBQWMsUUFBQSxxQkFBcUIsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUMzSSxjQUFjLENBQWMsUUFBQSxzQkFBc0IsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQztBQUM3SSxjQUFjLENBQWMsUUFBQSxzQkFBc0IsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQztBQUM3SSxjQUFjLENBQWMsUUFBQSwyQkFBMkIsR0FBRyxDQUFDLEtBQW1DLEVBQUUsRUFBRSxDQUFDLHlCQUF5QixDQUFDLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxDQUFDO0FBSXZKLGNBQWM7QUFDZCxTQUF1Qiw4QkFBOEIsQ0FBNEIsU0FBd0MsRUFBRSxNQUF5Qzs7UUFFaEssa0VBQWtFO1FBQ2xFLElBQUksa0JBQVMsQ0FBdUIsTUFBTSxDQUFDLEVBQUU7WUFDekMsNkJBQU8sc0JBQUEsS0FBSyxDQUFDLENBQUMseUJBQUEsc0JBQUEsOEJBQThCLENBQUMsU0FBUyxFQUFFLHNCQUFNLE1BQU0sQ0FBQSxDQUFDLENBQUEsQ0FBQSxDQUFBLEVBQUM7U0FDekU7UUFFRCxNQUFNLElBQUksR0FBRyxVQUFtQixDQUFJLG9FQUFJLDRCQUFNLHNCQUFNLENBQUMsQ0FBQSxDQUFBLENBQUMsQ0FBQyxDQUFDLElBQUEsQ0FBQztRQUN6RCxNQUFNLElBQUksR0FBRyxVQUEwQyxNQUFTOztnQkFDNUQsc0JBQUEsS0FBSyxDQUFDLENBQUMseUJBQUEsc0JBQUEsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUMsRUFBaUI7b0JBQ3BDLElBQUksQ0FBQyxHQUE4QixJQUFJLENBQUM7b0JBQ3hDLEdBQUc7d0JBQ0MsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO3FCQUNuQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRTtnQkFDdEIsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQSxDQUFBLENBQUEsQ0FBQztZQUNuQyxDQUFDO1NBQUEsQ0FBQztRQUVGLE1BQU0sT0FBTyxHQUNPLENBQUMsT0FBTyxNQUFNLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyw4Q0FBOEM7WUFDNUYsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsa0RBQWtEO2dCQUNuRyxDQUFDLENBQUMsQ0FBQyxNQUFNLFlBQVksV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxtREFBbUQ7b0JBQ3ZHLENBQUMsQ0FBQyxDQUFDLE1BQU0sWUFBWSxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLHlEQUF5RDt3QkFDbkgsQ0FBQyxDQUFDLG1CQUFVLENBQXVCLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsOEVBQThFOzRCQUM5SSxDQUFDLENBQUMsQ0FBQyx3QkFBZSxDQUF1QixNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLG9GQUFvRjtnQ0FDbkcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLHFDQUFxQztRQUVoRyxzQkFGMkQscUNBQXFDO1FBRWhHLEtBQUssQ0FBQyxDQUFDLHlCQUFBLHNCQUFBLElBQUksQ0FBQyxDQUFDLFVBQWlCLEVBQUU7O2dCQUM1QixJQUFJLENBQUMsR0FBOEIsSUFBSSxDQUFDO2dCQUN4QyxHQUFHO29CQUNDLENBQUMsR0FBRyxzQkFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLDRCQUFNLGlCQUFpQixDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQSxDQUFDLENBQUEsQ0FBQztpQkFDNUQsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUU7WUFDdEIsQ0FBQztTQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBLENBQUEsQ0FBQSxDQUFDO0lBQ3pDLENBQUM7Q0FBQTtBQWhDRCx3RUFnQ0M7QUFFRCxjQUFjLENBQWMsUUFBQSx3QkFBd0IsR0FBRyxDQUFDLEtBQXdDLEVBQUUsRUFBRSxDQUFDLDhCQUE4QixDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN0SixjQUFjLENBQWMsUUFBQSx5QkFBeUIsR0FBRyxDQUFDLEtBQXdDLEVBQUUsRUFBRSxDQUFDLDhCQUE4QixDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN4SixjQUFjLENBQWMsUUFBQSx5QkFBeUIsR0FBRyxDQUFDLEtBQXdDLEVBQUUsRUFBRSxDQUFDLDhCQUE4QixDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN4SixjQUFjLENBQWMsUUFBQSx5QkFBeUIsR0FBRyxDQUFDLEtBQXdDLEVBQUUsRUFBRSxDQUFDLDhCQUE4QixDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN4SixjQUFjLENBQWMsUUFBQSwwQkFBMEIsR0FBRyxDQUFDLEtBQXdDLEVBQUUsRUFBRSxDQUFDLDhCQUE4QixDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUMxSixjQUFjLENBQWMsUUFBQSwwQkFBMEIsR0FBRyxDQUFDLEtBQXdDLEVBQUUsRUFBRSxDQUFDLDhCQUE4QixDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUMxSixjQUFjLENBQWMsUUFBQSwyQkFBMkIsR0FBRyxDQUFDLEtBQXdDLEVBQUUsRUFBRSxDQUFDLDhCQUE4QixDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQztBQUM1SixjQUFjLENBQWMsUUFBQSwyQkFBMkIsR0FBRyxDQUFDLEtBQXdDLEVBQUUsRUFBRSxDQUFDLDhCQUE4QixDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQztBQUM1SixjQUFjLENBQWMsUUFBQSxnQ0FBZ0MsR0FBRyxDQUFDLEtBQXdDLEVBQUUsRUFBRSxDQUFDLDhCQUE4QixDQUFDLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxDQUFDO0FBRXRLOztHQUVHO0FBQ0gsU0FBZ0Isa0JBQWtCLENBQUMsTUFBYyxFQUFFLE1BQWMsRUFBRSxZQUF3QjtJQUN2RiwyRUFBMkU7SUFDM0UsbUVBQW1FO0lBQ25FLElBQUksTUFBTSxLQUFLLENBQUMsRUFBRTtRQUNkLFlBQVksR0FBRyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDakQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxNQUFNLEdBQUc7WUFDN0IsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQztTQUM3QjtLQUNKO0lBQ0QsT0FBTyxZQUFZLENBQUM7QUFDeEIsQ0FBQztBQVZELGdEQVVDIiwiZmlsZSI6InV0aWwvYnVmZmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IGZsYXRidWZmZXJzIH0gZnJvbSAnZmxhdGJ1ZmZlcnMnO1xuaW1wb3J0IHsgZW5jb2RlVXRmOCB9IGZyb20gJy4uL3V0aWwvdXRmOCc7XG5pbXBvcnQgQnl0ZUJ1ZmZlciA9IGZsYXRidWZmZXJzLkJ5dGVCdWZmZXI7XG5pbXBvcnQgeyBBcnJheUJ1ZmZlclZpZXdDb25zdHJ1Y3RvciB9IGZyb20gJy4uL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgaXNQcm9taXNlLCBpc0l0ZXJhYmxlLCBpc0FzeW5jSXRlcmFibGUsIGlzSXRlcmF0b3JSZXN1bHQgfSBmcm9tICcuL2NvbXBhdCc7XG5jb25zdCBTaGFyZWRBcnJheUJ1ZiA9ICh0eXBlb2YgU2hhcmVkQXJyYXlCdWZmZXIgIT09ICd1bmRlZmluZWQnID8gU2hhcmVkQXJyYXlCdWZmZXIgOiBBcnJheUJ1ZmZlcik7XG5cbmZ1bmN0aW9uIGNvbGxhcHNlQ29udGlndW91c0J5dGVSYW5nZXMoY2h1bmtzOiBVaW50OEFycmF5W10pIHtcbiAgICBmb3IgKGxldCB4LCB5LCBpID0gMDsgKytpIDwgY2h1bmtzLmxlbmd0aDspIHtcbiAgICAgICAgeCA9IGNodW5rc1tpIC0gMV07XG4gICAgICAgIHkgPSBjaHVua3NbaSAtIDBdO1xuICAgICAgICAvLyBjb250aW51ZSB4IGFuZCB5IGRvbid0IHNoYXJlIHRoZSBzYW1lIHVuZGVybHlpbmcgQXJyYXlCdWZmZXJcbiAgICAgICAgaWYgKCF4IHx8ICF5IHx8IHguYnVmZmVyICE9PSB5LmJ1ZmZlcikgeyBjb250aW51ZTsgfVxuICAgICAgICBjb25zdCB7IGJ5dGVPZmZzZXQ6IHhPZmZzZXQsIGJ5dGVMZW5ndGg6IHhMZW4gfSA9IHg7XG4gICAgICAgIGNvbnN0IHsgYnl0ZU9mZnNldDogeU9mZnNldCwgYnl0ZUxlbmd0aDogeUxlbiB9ID0geTtcbiAgICAgICAgLy8gY29udGludWUgaWYgdGhlIGJ5dGUgcmFuZ2VzIG9mIHggYW5kIHkgYXJlbid0IGNvbnRpZ3VvdXNcbiAgICAgICAgaWYgKCh4T2Zmc2V0ICsgeExlbikgPCB5T2Zmc2V0IHx8ICh5T2Zmc2V0ICsgeUxlbikgPCB4T2Zmc2V0KSB7IGNvbnRpbnVlOyB9XG4gICAgICAgIGNodW5rcy5zcGxpY2UoLS1pLCAyLCBuZXcgVWludDhBcnJheSh4LmJ1ZmZlciwgeE9mZnNldCwgeU9mZnNldCAtIHhPZmZzZXQgKyB5TGVuKSk7XG4gICAgfVxuICAgIHJldHVybiBjaHVua3M7XG59XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgZnVuY3Rpb24gbWVtY3B5PFRUYXJnZXQgZXh0ZW5kcyBBcnJheUJ1ZmZlclZpZXcsIFRTb3VyY2UgZXh0ZW5kcyBBcnJheUJ1ZmZlclZpZXc+KHRhcmdldDogVFRhcmdldCwgc291cmNlOiBUU291cmNlLCB0YXJnZXRCeXRlT2Zmc2V0ID0gMCwgc291cmNlQnl0ZUxlbmd0aCA9IHNvdXJjZS5ieXRlTGVuZ3RoKSB7XG4gICAgY29uc3QgdGFyZ2V0Qnl0ZUxlbmd0aCA9IHRhcmdldC5ieXRlTGVuZ3RoO1xuICAgIGNvbnN0IGRzdCA9IG5ldyBVaW50OEFycmF5KHRhcmdldC5idWZmZXIsIHRhcmdldC5ieXRlT2Zmc2V0LCB0YXJnZXRCeXRlTGVuZ3RoKTtcbiAgICBjb25zdCBzcmMgPSBuZXcgVWludDhBcnJheShzb3VyY2UuYnVmZmVyLCBzb3VyY2UuYnl0ZU9mZnNldCwgTWF0aC5taW4oc291cmNlQnl0ZUxlbmd0aCwgdGFyZ2V0Qnl0ZUxlbmd0aCkpO1xuICAgIGRzdC5zZXQoc3JjLCB0YXJnZXRCeXRlT2Zmc2V0KTtcbiAgICByZXR1cm4gdGFyZ2V0O1xufVxuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGpvaW5VaW50OEFycmF5cyhjaHVua3M6IFVpbnQ4QXJyYXlbXSwgc2l6ZT86IG51bWJlciB8IG51bGwpOiBbVWludDhBcnJheSwgVWludDhBcnJheVtdXSB7XG4gICAgLy8gY29sbGFwc2UgY2h1bmtzIHRoYXQgc2hhcmUgdGhlIHNhbWUgdW5kZXJseWluZyBBcnJheUJ1ZmZlciBhbmQgd2hvc2UgYnl0ZSByYW5nZXMgb3ZlcmxhcCxcbiAgICAvLyB0byBhdm9pZCB1bm5lY2Vzc2FyaWx5IGNvcHlpbmcgdGhlIGJ5dGVzIHRvIGRvIHRoaXMgYnVmZmVyIGpvaW4uIFRoaXMgaXMgYSBjb21tb24gY2FzZSBkdXJpbmdcbiAgICAvLyBzdHJlYW1pbmcsIHdoZXJlIHdlIG1heSBiZSByZWFkaW5nIHBhcnRpYWwgYnl0ZSByYW5nZXMgb3V0IG9mIHRoZSBzYW1lIHVuZGVybHlpbmcgQXJyYXlCdWZmZXJcbiAgICBjaHVua3MgPSBjb2xsYXBzZUNvbnRpZ3VvdXNCeXRlUmFuZ2VzKGNodW5rcyk7XG4gICAgbGV0IG9mZnNldCA9IDAsIGluZGV4ID0gLTEsIG51bUNodW5rcyA9IGNodW5rcy5sZW5ndGg7XG4gICAgbGV0IGNodW5rc0xlbiA9IGNodW5rcy5yZWR1Y2UoKHgsIHkpID0+IHggKyB5LmJ5dGVMZW5ndGgsIDApO1xuICAgIGxldCBzb3VyY2U6IFVpbnQ4QXJyYXksIHNsaWNlZDogVWludDhBcnJheSwgYnVmZmVyOiBVaW50OEFycmF5IHwgdm9pZDtcbiAgICBsZXQgbGVuZ3RoID0gTWF0aC5taW4oY2h1bmtzTGVuLCB0eXBlb2Ygc2l6ZSA9PT0gJ251bWJlcicgPyBzaXplIDogSW5maW5pdHkpO1xuICAgIHdoaWxlICgrK2luZGV4IDwgbnVtQ2h1bmtzKSB7XG4gICAgICAgIHNvdXJjZSA9IGNodW5rc1tpbmRleF07XG4gICAgICAgIHNsaWNlZCA9IHNvdXJjZS5zdWJhcnJheSgwLCBNYXRoLm1pbihzb3VyY2UubGVuZ3RoLCBsZW5ndGggLSBvZmZzZXQpKTtcbiAgICAgICAgaWYgKGxlbmd0aCA8PSAob2Zmc2V0ICsgc2xpY2VkLmxlbmd0aCkpIHtcbiAgICAgICAgICAgIGlmIChzbGljZWQubGVuZ3RoIDwgc291cmNlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNodW5rc1tpbmRleF0gPSBzb3VyY2Uuc3ViYXJyYXkoc2xpY2VkLmxlbmd0aCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHNsaWNlZC5sZW5ndGggPT09IHNvdXJjZS5sZW5ndGgpIHsgaW5kZXgrKzsgfVxuICAgICAgICAgICAgYnVmZmVyID8gbWVtY3B5KGJ1ZmZlciwgc2xpY2VkLCBvZmZzZXQpIDogKGJ1ZmZlciA9IHNsaWNlZCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICAoYnVmZmVyIHx8IChidWZmZXIgPSBuZXcgVWludDhBcnJheShsZW5ndGgpKSkuc2V0KHNsaWNlZCwgb2Zmc2V0KTtcbiAgICAgICAgb2Zmc2V0ICs9IHNsaWNlZC5sZW5ndGg7XG4gICAgfVxuICAgIHJldHVybiBbYnVmZmVyIHx8IG5ldyBVaW50OEFycmF5KDApLCBjaHVua3Muc2xpY2UoaW5kZXgpXTtcbn1cblxuZXhwb3J0IHR5cGUgQXJyYXlCdWZmZXJWaWV3SW5wdXQgPSBBcnJheUJ1ZmZlclZpZXcgfCBBcnJheUJ1ZmZlckxpa2UgfCBBcnJheUJ1ZmZlclZpZXcgfCBJdGVyYWJsZTxudW1iZXI+IHwgQXJyYXlMaWtlPG51bWJlcj4gfCBCeXRlQnVmZmVyIHwgc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCAgfFxuICAgICAgICAgICAgICAgICAgICBJdGVyYXRvclJlc3VsdDxBcnJheUJ1ZmZlclZpZXcgfCBBcnJheUJ1ZmZlckxpa2UgfCBBcnJheUJ1ZmZlclZpZXcgfCBJdGVyYWJsZTxudW1iZXI+IHwgQXJyYXlMaWtlPG51bWJlcj4gfCBCeXRlQnVmZmVyIHwgc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZD4gfFxuICAgICAgICAgIFJlYWRhYmxlU3RyZWFtUmVhZFJlc3VsdDxBcnJheUJ1ZmZlclZpZXcgfCBBcnJheUJ1ZmZlckxpa2UgfCBBcnJheUJ1ZmZlclZpZXcgfCBJdGVyYWJsZTxudW1iZXI+IHwgQXJyYXlMaWtlPG51bWJlcj4gfCBCeXRlQnVmZmVyIHwgc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZD4gO1xuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRvQXJyYXlCdWZmZXJWaWV3PFQgZXh0ZW5kcyBBcnJheUJ1ZmZlclZpZXc+KEFycmF5QnVmZmVyVmlld0N0b3I6IEFycmF5QnVmZmVyVmlld0NvbnN0cnVjdG9yPFQ+LCBpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpOiBUIHtcblxuICAgIGxldCB2YWx1ZTogYW55ID0gaXNJdGVyYXRvclJlc3VsdChpbnB1dCkgPyBpbnB1dC52YWx1ZSA6IGlucHV0O1xuXG4gICAgaWYgKCF2YWx1ZSkgeyByZXR1cm4gbmV3IEFycmF5QnVmZmVyVmlld0N0b3IoMCk7IH1cbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgeyB2YWx1ZSA9IGVuY29kZVV0ZjgodmFsdWUpOyB9XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXJWaWV3Q3RvcikgeyByZXR1cm4gdmFsdWU7IH1cbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgeyByZXR1cm4gbmV3IEFycmF5QnVmZmVyVmlld0N0b3IodmFsdWUpOyB9XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgU2hhcmVkQXJyYXlCdWYpIHsgcmV0dXJuIG5ldyBBcnJheUJ1ZmZlclZpZXdDdG9yKHZhbHVlKTsgfVxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEJ5dGVCdWZmZXIpIHsgcmV0dXJuIHRvQXJyYXlCdWZmZXJWaWV3KEFycmF5QnVmZmVyVmlld0N0b3IsIHZhbHVlLmJ5dGVzKCkpOyB9XG4gICAgcmV0dXJuICFBcnJheUJ1ZmZlci5pc1ZpZXcodmFsdWUpID8gQXJyYXlCdWZmZXJWaWV3Q3Rvci5mcm9tKHZhbHVlKSA6IHZhbHVlLmJ5dGVMZW5ndGggPD0gMCA/IG5ldyBBcnJheUJ1ZmZlclZpZXdDdG9yKDApXG4gICAgICAgIDogbmV3IEFycmF5QnVmZmVyVmlld0N0b3IodmFsdWUuYnVmZmVyLCB2YWx1ZS5ieXRlT2Zmc2V0LCB2YWx1ZS5ieXRlTGVuZ3RoIC8gQXJyYXlCdWZmZXJWaWV3Q3Rvci5CWVRFU19QRVJfRUxFTUVOVCk7XG59XG5cbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDhBcnJheSA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3KEludDhBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvSW50MTZBcnJheSA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3KEludDE2QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDMyQXJyYXkgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlldyhJbnQzMkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50OEFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDE2QXJyYXkgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlldyhVaW50MTZBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDMyQXJyYXkgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlldyhVaW50MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvRmxvYXQzMkFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoRmxvYXQzMkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9GbG9hdDY0QXJyYXkgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlldyhGbG9hdDY0QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQ4Q2xhbXBlZEFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoVWludDhDbGFtcGVkQXJyYXksIGlucHV0KTtcblxudHlwZSBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0ID0gSXRlcmFibGU8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+IHwgQXJyYXlCdWZmZXJWaWV3SW5wdXQ7XG5cbmNvbnN0IHB1bXAgPSA8VCBleHRlbmRzIEl0ZXJhdG9yPGFueT4gfCBBc3luY0l0ZXJhdG9yPGFueT4+KGl0ZXJhdG9yOiBUKSA9PiB7IGl0ZXJhdG9yLm5leHQoKTsgcmV0dXJuIGl0ZXJhdG9yOyB9O1xuXG4vKiogQGlnbm9yZSAqL1xuZXhwb3J0IGZ1bmN0aW9uKiB0b0FycmF5QnVmZmVyVmlld0l0ZXJhdG9yPFQgZXh0ZW5kcyBBcnJheUJ1ZmZlclZpZXc+KEFycmF5Q3RvcjogQXJyYXlCdWZmZXJWaWV3Q29uc3RydWN0b3I8VD4sIHNvdXJjZTogQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCkge1xuXG4gICAgY29uc3Qgd3JhcCA9IGZ1bmN0aW9uKjxUPih4OiBUKSB7IHlpZWxkIHg7IH07XG4gICAgY29uc3QgYnVmZmVyczogSXRlcmFibGU8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+ID1cbiAgICAgICAgICAgICAgICAgICAodHlwZW9mIHNvdXJjZSA9PT0gJ3N0cmluZycpID8gd3JhcChzb3VyY2UpXG4gICAgICAgICAgICAgICAgIDogKEFycmF5QnVmZmVyLmlzVmlldyhzb3VyY2UpKSA/IHdyYXAoc291cmNlKVxuICAgICAgICAgICAgICA6IChzb3VyY2UgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgPyB3cmFwKHNvdXJjZSlcbiAgICAgICAgICAgOiAoc291cmNlIGluc3RhbmNlb2YgU2hhcmVkQXJyYXlCdWYpID8gd3JhcChzb3VyY2UpXG4gICAgOiAhaXNJdGVyYWJsZTxBcnJheUJ1ZmZlclZpZXdJbnB1dD4oc291cmNlKSA/IHdyYXAoc291cmNlKSA6IHNvdXJjZTtcblxuICAgIHlpZWxkKiBwdW1wKChmdW5jdGlvbiogKGl0KSB7XG4gICAgICAgIGxldCByOiBJdGVyYXRvclJlc3VsdDxhbnk+ID0gPGFueT4gbnVsbDtcbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgciA9IGl0Lm5leHQoeWllbGQgdG9BcnJheUJ1ZmZlclZpZXcoQXJyYXlDdG9yLCByKSk7XG4gICAgICAgIH0gd2hpbGUgKCFyLmRvbmUpO1xuICAgIH0pKGJ1ZmZlcnNbU3ltYm9sLml0ZXJhdG9yXSgpKSk7XG59XG5cbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDhBcnJheUl0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0l0ZXJhdG9yKEludDhBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvSW50MTZBcnJheUl0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0l0ZXJhdG9yKEludDE2QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDMyQXJyYXlJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcihJbnQzMkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50OEFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoVWludDhBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDE2QXJyYXlJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcihVaW50MTZBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDMyQXJyYXlJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcihVaW50MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvRmxvYXQzMkFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoRmxvYXQzMkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9GbG9hdDY0QXJyYXlJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcihGbG9hdDY0QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQ4Q2xhbXBlZEFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoVWludDhDbGFtcGVkQXJyYXksIGlucHV0KTtcblxudHlwZSBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQgPSBBc3luY0l0ZXJhYmxlPEFycmF5QnVmZmVyVmlld0lucHV0PiB8IEl0ZXJhYmxlPEFycmF5QnVmZmVyVmlld0lucHV0PiB8IFByb21pc2VMaWtlPEFycmF5QnVmZmVyVmlld0lucHV0PiB8IEFycmF5QnVmZmVyVmlld0lucHV0O1xuXG4vKiogQGlnbm9yZSAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uKiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3I8VCBleHRlbmRzIEFycmF5QnVmZmVyVmlldz4oQXJyYXlDdG9yOiBBcnJheUJ1ZmZlclZpZXdDb25zdHJ1Y3RvcjxUPiwgc291cmNlOiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpOiBBc3luY0l0ZXJhYmxlSXRlcmF0b3I8VD4ge1xuXG4gICAgLy8gaWYgYSBQcm9taXNlLCB1bndyYXAgdGhlIFByb21pc2UgYW5kIGl0ZXJhdGUgdGhlIHJlc29sdmVkIHZhbHVlXG4gICAgaWYgKGlzUHJvbWlzZTxBcnJheUJ1ZmZlclZpZXdJbnB1dD4oc291cmNlKSkge1xuICAgICAgICByZXR1cm4geWllbGQqIHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihBcnJheUN0b3IsIGF3YWl0IHNvdXJjZSk7XG4gICAgfVxuXG4gICAgY29uc3Qgd3JhcCA9IGFzeW5jIGZ1bmN0aW9uKjxUPih4OiBUKSB7IHlpZWxkIGF3YWl0IHg7IH07XG4gICAgY29uc3QgZW1pdCA9IGFzeW5jIGZ1bmN0aW9uKiA8VCBleHRlbmRzIEl0ZXJhYmxlPGFueT4+KHNvdXJjZTogVCkge1xuICAgICAgICB5aWVsZCogcHVtcCgoZnVuY3Rpb24qKGl0OiBJdGVyYXRvcjxhbnk+KSB7XG4gICAgICAgICAgICBsZXQgcjogSXRlcmF0b3JSZXN1bHQ8YW55PiA9IDxhbnk+IG51bGw7XG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgciA9IGl0Lm5leHQoeWllbGQgciAmJiByLnZhbHVlKTtcbiAgICAgICAgICAgIH0gd2hpbGUgKCFyLmRvbmUpO1xuICAgICAgICB9KShzb3VyY2VbU3ltYm9sLml0ZXJhdG9yXSgpKSk7XG4gICAgfTtcblxuICAgIGNvbnN0IGJ1ZmZlcnM6IEFzeW5jSXRlcmFibGU8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+ID1cbiAgICAgICAgICAgICAgICAgICAgICAgICh0eXBlb2Ygc291cmNlID09PSAnc3RyaW5nJykgPyB3cmFwKHNvdXJjZSkgLy8gaWYgc3RyaW5nLCB3cmFwIGluIGFuIEFzeW5jSXRlcmFibGVJdGVyYXRvclxuICAgICAgICAgICAgICAgICAgICAgIDogKEFycmF5QnVmZmVyLmlzVmlldyhzb3VyY2UpKSA/IHdyYXAoc291cmNlKSAvLyBpZiBUeXBlZEFycmF5LCB3cmFwIGluIGFuIEFzeW5jSXRlcmFibGVJdGVyYXRvclxuICAgICAgICAgICAgICAgICAgIDogKHNvdXJjZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSA/IHdyYXAoc291cmNlKSAvLyBpZiBBcnJheUJ1ZmZlciwgd3JhcCBpbiBhbiBBc3luY0l0ZXJhYmxlSXRlcmF0b3JcbiAgICAgICAgICAgICAgICA6IChzb3VyY2UgaW5zdGFuY2VvZiBTaGFyZWRBcnJheUJ1ZikgPyB3cmFwKHNvdXJjZSkgLy8gaWYgU2hhcmVkQXJyYXlCdWZmZXIsIHdyYXAgaW4gYW4gQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXG4gICAgICAgICAgOiBpc0l0ZXJhYmxlPEFycmF5QnVmZmVyVmlld0lucHV0Pihzb3VyY2UpID8gZW1pdChzb3VyY2UpIC8vIElmIEl0ZXJhYmxlLCB3cmFwIGluIGFuIEFzeW5jSXRlcmFibGVJdGVyYXRvciBhbmQgY29tcG9zZSB0aGUgYG5leHRgIHZhbHVlc1xuICAgIDogIWlzQXN5bmNJdGVyYWJsZTxBcnJheUJ1ZmZlclZpZXdJbnB1dD4oc291cmNlKSA/IHdyYXAoc291cmNlKSAvLyBJZiBub3QgYW4gQXN5bmNJdGVyYWJsZSwgdHJlYXQgYXMgYSBzZW50aW5lbCBhbmQgd3JhcCBpbiBhbiBBc3luY0l0ZXJhYmxlSXRlcmF0b3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBzb3VyY2U7IC8vIG90aGVyd2lzZSBpZiBBc3luY0l0ZXJhYmxlLCB1c2UgaXRcblxuICAgIHlpZWxkKiBwdW1wKChhc3luYyBmdW5jdGlvbiogKGl0KSB7XG4gICAgICAgIGxldCByOiBJdGVyYXRvclJlc3VsdDxhbnk+ID0gPGFueT4gbnVsbDtcbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgciA9IGF3YWl0IGl0Lm5leHQoeWllbGQgdG9BcnJheUJ1ZmZlclZpZXcoQXJyYXlDdG9yLCByKSk7XG4gICAgICAgIH0gd2hpbGUgKCFyLmRvbmUpO1xuICAgIH0pKGJ1ZmZlcnNbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkpKTtcbn1cblxuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvSW50OEFycmF5QXN5bmNJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoSW50OEFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQxNkFycmF5QXN5bmNJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoSW50MTZBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvSW50MzJBcnJheUFzeW5jSXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yKEludDMyQXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQ4QXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihVaW50OEFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50MTZBcnJheUFzeW5jSXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yKFVpbnQxNkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50MzJBcnJheUFzeW5jSXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yKFVpbnQzMkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9GbG9hdDMyQXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihGbG9hdDMyQXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0Zsb2F0NjRBcnJheUFzeW5jSXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yKEZsb2F0NjRBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDhDbGFtcGVkQXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihVaW50OENsYW1wZWRBcnJheSwgaW5wdXQpO1xuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlYmFzZVZhbHVlT2Zmc2V0cyhvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIHZhbHVlT2Zmc2V0czogSW50MzJBcnJheSkge1xuICAgIC8vIElmIHdlIGhhdmUgYSBub24temVybyBvZmZzZXQsIGNyZWF0ZSBhIG5ldyBvZmZzZXRzIGFycmF5IHdpdGggdGhlIHZhbHVlc1xuICAgIC8vIHNoaWZ0ZWQgYnkgdGhlIHN0YXJ0IG9mZnNldCwgc3VjaCB0aGF0IHRoZSBuZXcgc3RhcnQgb2Zmc2V0IGlzIDBcbiAgICBpZiAob2Zmc2V0ICE9PSAwKSB7XG4gICAgICAgIHZhbHVlT2Zmc2V0cyA9IHZhbHVlT2Zmc2V0cy5zbGljZSgwLCBsZW5ndGggKyAxKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IC0xOyArK2kgPD0gbGVuZ3RoOykge1xuICAgICAgICAgICAgdmFsdWVPZmZzZXRzW2ldICs9IG9mZnNldDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdmFsdWVPZmZzZXRzO1xufVxuIl19
