"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const flatbuffers_1 = require("flatbuffers");
const utf8_1 = require("../util/utf8");
var ByteBuffer = flatbuffers_1.flatbuffers.ByteBuffer;
const compat_1 = require("./compat");
/** @ignore */
const SharedArrayBuf = (typeof SharedArrayBuffer !== 'undefined' ? SharedArrayBuffer : ArrayBuffer);
/** @ignore */
function collapseContiguousByteRanges(chunks) {
    let result = chunks[0] ? [chunks[0]] : [];
    let xOffset, yOffset, xLen, yLen;
    for (let x, y, i = 0, j = 0, n = chunks.length; ++i < n;) {
        x = result[j];
        y = chunks[i];
        // continue x and y don't share the same underlying ArrayBuffer
        if (!x || !y || x.buffer !== y.buffer) {
            y && (result[++j] = y);
            continue;
        }
        // swap if y starts before x
        if (y.byteOffset < x.byteOffset) {
            x = chunks[i];
            y = result[j];
        }
        ({ byteOffset: xOffset, byteLength: xLen } = x);
        ({ byteOffset: yOffset, byteLength: yLen } = y);
        // continue if the byte ranges of x and y aren't contiguous
        if ((xOffset + xLen) < yOffset || (yOffset + yLen) < xOffset) {
            y && (result[++j] = y);
            continue;
        }
        result[j] = new Uint8Array(x.buffer, xOffset, yOffset - xOffset + yLen);
    }
    return result;
}
/** @ignore */
function memcpy(target, source, targetByteOffset = 0, sourceByteLength = source.byteLength) {
    const targetByteLength = target.byteLength;
    const dst = new Uint8Array(target.buffer, target.byteOffset, targetByteLength);
    const src = new Uint8Array(source.buffer, source.byteOffset, Math.min(sourceByteLength, targetByteLength));
    dst.set(src, targetByteOffset);
    return target;
}
exports.memcpy = memcpy;
/** @ignore */
function joinUint8Arrays(chunks, size) {
    // collapse chunks that share the same underlying ArrayBuffer and whose byte ranges overlap,
    // to avoid unnecessarily copying the bytes to do this buffer join. This is a common case during
    // streaming, where we may be reading partial byte ranges out of the same underlying ArrayBuffer
    let result = collapseContiguousByteRanges(chunks);
    let byteLength = result.reduce((x, b) => x + b.byteLength, 0);
    let source, sliced, buffer;
    let offset = 0, index = -1, length = Math.min(size || Infinity, byteLength);
    for (let n = result.length; ++index < n;) {
        source = result[index];
        sliced = source.subarray(0, Math.min(source.length, length - offset));
        if (length <= (offset + sliced.length)) {
            if (sliced.length < source.length) {
                result[index] = source.subarray(sliced.length);
            }
            else if (sliced.length === source.length) {
                index++;
            }
            buffer ? memcpy(buffer, sliced, offset) : (buffer = sliced);
            break;
        }
        memcpy(buffer || (buffer = new Uint8Array(length)), sliced, offset);
        offset += sliced.length;
    }
    return [buffer || new Uint8Array(0), result.slice(index), byteLength - (buffer ? buffer.byteLength : 0)];
}
exports.joinUint8Arrays = joinUint8Arrays;
/** @ignore */
function toArrayBufferView(ArrayBufferViewCtor, input) {
    let value = compat_1.isIteratorResult(input) ? input.value : input;
    if (!value) {
        return new ArrayBufferViewCtor(0);
    }
    if (typeof value === 'string') {
        value = utf8_1.encodeUtf8(value);
    }
    if (value instanceof ArrayBufferViewCtor) {
        return value.constructor === ArrayBufferViewCtor ? value :
            // Node's `Buffer` class passes the `instanceof Uint8Array` check, but we need
            // a real Uint8Array, since Buffer#slice isn't the same as Uint8Array#slice :/
            new ArrayBufferViewCtor(value.buffer, value.byteOffset, value.byteLength / ArrayBufferViewCtor.BYTES_PER_ELEMENT);
    }
    if (value instanceof ArrayBuffer) {
        return new ArrayBufferViewCtor(value);
    }
    if (value instanceof SharedArrayBuf) {
        return new ArrayBufferViewCtor(value);
    }
    if (value instanceof ByteBuffer) {
        return toArrayBufferView(ArrayBufferViewCtor, value.bytes());
    }
    return !ArrayBuffer.isView(value) ? ArrayBufferViewCtor.from(value) : value.byteLength <= 0 ? new ArrayBufferViewCtor(0)
        : new ArrayBufferViewCtor(value.buffer, value.byteOffset, value.byteLength / ArrayBufferViewCtor.BYTES_PER_ELEMENT);
}
exports.toArrayBufferView = toArrayBufferView;
/** @ignore */ exports.toInt8Array = (input) => toArrayBufferView(Int8Array, input);
/** @ignore */ exports.toInt16Array = (input) => toArrayBufferView(Int16Array, input);
/** @ignore */ exports.toInt32Array = (input) => toArrayBufferView(Int32Array, input);
/** @ignore */ exports.toUint8Array = (input) => toArrayBufferView(Uint8Array, input);
/** @ignore */ exports.toUint16Array = (input) => toArrayBufferView(Uint16Array, input);
/** @ignore */ exports.toUint32Array = (input) => toArrayBufferView(Uint32Array, input);
/** @ignore */ exports.toFloat32Array = (input) => toArrayBufferView(Float32Array, input);
/** @ignore */ exports.toFloat64Array = (input) => toArrayBufferView(Float64Array, input);
/** @ignore */ exports.toUint8ClampedArray = (input) => toArrayBufferView(Uint8ClampedArray, input);
/** @ignore */
const pump = (iterator) => { iterator.next(); return iterator; };
/** @ignore */
function* toArrayBufferViewIterator(ArrayCtor, source) {
    const wrap = function* (x) { yield x; };
    const buffers = (typeof source === 'string') ? wrap(source)
        : (ArrayBuffer.isView(source)) ? wrap(source)
            : (source instanceof ArrayBuffer) ? wrap(source)
                : (source instanceof SharedArrayBuf) ? wrap(source)
                    : !compat_1.isIterable(source) ? wrap(source) : source;
    yield* pump((function* (it) {
        let r = null;
        do {
            r = it.next(yield toArrayBufferView(ArrayCtor, r));
        } while (!r.done);
    })(buffers[Symbol.iterator]()));
}
exports.toArrayBufferViewIterator = toArrayBufferViewIterator;
/** @ignore */ exports.toInt8ArrayIterator = (input) => toArrayBufferViewIterator(Int8Array, input);
/** @ignore */ exports.toInt16ArrayIterator = (input) => toArrayBufferViewIterator(Int16Array, input);
/** @ignore */ exports.toInt32ArrayIterator = (input) => toArrayBufferViewIterator(Int32Array, input);
/** @ignore */ exports.toUint8ArrayIterator = (input) => toArrayBufferViewIterator(Uint8Array, input);
/** @ignore */ exports.toUint16ArrayIterator = (input) => toArrayBufferViewIterator(Uint16Array, input);
/** @ignore */ exports.toUint32ArrayIterator = (input) => toArrayBufferViewIterator(Uint32Array, input);
/** @ignore */ exports.toFloat32ArrayIterator = (input) => toArrayBufferViewIterator(Float32Array, input);
/** @ignore */ exports.toFloat64ArrayIterator = (input) => toArrayBufferViewIterator(Float64Array, input);
/** @ignore */ exports.toUint8ClampedArrayIterator = (input) => toArrayBufferViewIterator(Uint8ClampedArray, input);
/** @ignore */
async function* toArrayBufferViewAsyncIterator(ArrayCtor, source) {
    // if a Promise, unwrap the Promise and iterate the resolved value
    if (compat_1.isPromise(source)) {
        return yield* toArrayBufferViewAsyncIterator(ArrayCtor, await source);
    }
    const wrap = async function* (x) { yield await x; };
    const emit = async function* (source) {
        yield* pump((function* (it) {
            let r = null;
            do {
                r = it.next(yield r && r.value);
            } while (!r.done);
        })(source[Symbol.iterator]()));
    };
    const buffers = (typeof source === 'string') ? wrap(source) // if string, wrap in an AsyncIterableIterator
        : (ArrayBuffer.isView(source)) ? wrap(source) // if TypedArray, wrap in an AsyncIterableIterator
            : (source instanceof ArrayBuffer) ? wrap(source) // if ArrayBuffer, wrap in an AsyncIterableIterator
                : (source instanceof SharedArrayBuf) ? wrap(source) // if SharedArrayBuffer, wrap in an AsyncIterableIterator
                    : compat_1.isIterable(source) ? emit(source) // If Iterable, wrap in an AsyncIterableIterator and compose the `next` values
                        : !compat_1.isAsyncIterable(source) ? wrap(source) // If not an AsyncIterable, treat as a sentinel and wrap in an AsyncIterableIterator
                            : source; // otherwise if AsyncIterable, use it
    yield* pump((async function* (it) {
        let r = null;
        do {
            r = await it.next(yield toArrayBufferView(ArrayCtor, r));
        } while (!r.done);
    })(buffers[Symbol.asyncIterator]()));
}
exports.toArrayBufferViewAsyncIterator = toArrayBufferViewAsyncIterator;
/** @ignore */ exports.toInt8ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Int8Array, input);
/** @ignore */ exports.toInt16ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Int16Array, input);
/** @ignore */ exports.toInt32ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Int32Array, input);
/** @ignore */ exports.toUint8ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint8Array, input);
/** @ignore */ exports.toUint16ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint16Array, input);
/** @ignore */ exports.toUint32ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint32Array, input);
/** @ignore */ exports.toFloat32ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Float32Array, input);
/** @ignore */ exports.toFloat64ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Float64Array, input);
/** @ignore */ exports.toUint8ClampedArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint8ClampedArray, input);
/** @ignore */
function rebaseValueOffsets(offset, length, valueOffsets) {
    // If we have a non-zero offset, create a new offsets array with the values
    // shifted by the start offset, such that the new start offset is 0
    if (offset !== 0) {
        valueOffsets = valueOffsets.slice(0, length + 1);
        for (let i = -1; ++i <= length;) {
            valueOffsets[i] += offset;
        }
    }
    return valueOffsets;
}
exports.rebaseValueOffsets = rebaseValueOffsets;
/** @ignore */
function compareArrayLike(a, b) {
    let i = 0, n = a.length;
    if (n !== b.length) {
        return false;
    }
    if (n > 0) {
        do {
            if (a[i] !== b[i]) {
                return false;
            }
        } while (++i < n);
    }
    return true;
}
exports.compareArrayLike = compareArrayLike;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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WSxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNqRCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLE1BQU0sR0FBRztZQUM3QixZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksTUFBTSxDQUFDO1NBQzdCO0tBQ0o7SUFDRCxPQUFPLFlBQVksQ0FBQztBQUN4QixDQUFDO0FBVkQsZ0RBVUM7QUFFRCxjQUFjO0FBQ2QsU0FBZ0IsZ0JBQWdCLENBQTJCLENBQUksRUFBRSxDQUFJO0lBQ2pFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQztJQUN4QixJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxFQUFFO1FBQUUsT0FBTyxLQUFLLENBQUM7S0FBRTtJQUNyQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDUCxHQUFHO1lBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUFFLE9BQU8sS0FBSyxDQUFDO2FBQUU7U0FBRSxRQUFRLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRTtLQUMvRDtJQUNELE9BQU8sSUFBSSxDQUFDO0FBQ2hCLENBQUM7QUFQRCw0Q0FPQyIsImZpbGUiOiJ1dGlsL2J1ZmZlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBmbGF0YnVmZmVycyB9IGZyb20gJ2ZsYXRidWZmZXJzJztcbmltcG9ydCB7IGVuY29kZVV0ZjggfSBmcm9tICcuLi91dGlsL3V0ZjgnO1xuaW1wb3J0IEJ5dGVCdWZmZXIgPSBmbGF0YnVmZmVycy5CeXRlQnVmZmVyO1xuaW1wb3J0IHsgQXJyYXlCdWZmZXJWaWV3Q29uc3RydWN0b3IgfSBmcm9tICcuLi9pbnRlcmZhY2VzJztcbmltcG9ydCB7IGlzUHJvbWlzZSwgaXNJdGVyYWJsZSwgaXNBc3luY0l0ZXJhYmxlLCBpc0l0ZXJhdG9yUmVzdWx0IH0gZnJvbSAnLi9jb21wYXQnO1xuXG4vKiogQGlnbm9yZSAqL1xuY29uc3QgU2hhcmVkQXJyYXlCdWYgPSAodHlwZW9mIFNoYXJlZEFycmF5QnVmZmVyICE9PSAndW5kZWZpbmVkJyA/IFNoYXJlZEFycmF5QnVmZmVyIDogQXJyYXlCdWZmZXIpO1xuXG4vKiogQGlnbm9yZSAqL1xuZnVuY3Rpb24gY29sbGFwc2VDb250aWd1b3VzQnl0ZVJhbmdlcyhjaHVua3M6IFVpbnQ4QXJyYXlbXSkge1xuICAgIGxldCByZXN1bHQgPSBjaHVua3NbMF0gPyBbY2h1bmtzWzBdXSA6IFtdO1xuICAgIGxldCB4T2Zmc2V0OiBudW1iZXIsIHlPZmZzZXQ6IG51bWJlciwgeExlbjogbnVtYmVyLCB5TGVuOiBudW1iZXI7XG4gICAgZm9yIChsZXQgeCwgeSwgaSA9IDAsIGogPSAwLCBuID0gY2h1bmtzLmxlbmd0aDsgKytpIDwgbjspIHtcbiAgICAgICAgeCA9IHJlc3VsdFtqXTtcbiAgICAgICAgeSA9IGNodW5rc1tpXTtcbiAgICAgICAgLy8gY29udGludWUgeCBhbmQgeSBkb24ndCBzaGFyZSB0aGUgc2FtZSB1bmRlcmx5aW5nIEFycmF5QnVmZmVyXG4gICAgICAgIGlmICgheCB8fCAheSB8fCB4LmJ1ZmZlciAhPT0geS5idWZmZXIpIHtcbiAgICAgICAgICAgIHkgJiYgKHJlc3VsdFsrK2pdID0geSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBzd2FwIGlmIHkgc3RhcnRzIGJlZm9yZSB4XG4gICAgICAgIGlmICh5LmJ5dGVPZmZzZXQgPCB4LmJ5dGVPZmZzZXQpIHtcbiAgICAgICAgICAgIHggPSBjaHVua3NbaV07IHkgPSByZXN1bHRbal07XG4gICAgICAgIH1cbiAgICAgICAgKHsgYnl0ZU9mZnNldDogeE9mZnNldCwgYnl0ZUxlbmd0aDogeExlbiB9ID0geCk7XG4gICAgICAgICh7IGJ5dGVPZmZzZXQ6IHlPZmZzZXQsIGJ5dGVMZW5ndGg6IHlMZW4gfSA9IHkpO1xuICAgICAgICAvLyBjb250aW51ZSBpZiB0aGUgYnl0ZSByYW5nZXMgb2YgeCBhbmQgeSBhcmVuJ3QgY29udGlndW91c1xuICAgICAgICBpZiAoKHhPZmZzZXQgKyB4TGVuKSA8IHlPZmZzZXQgfHwgKHlPZmZzZXQgKyB5TGVuKSA8IHhPZmZzZXQpIHtcbiAgICAgICAgICAgIHkgJiYgKHJlc3VsdFsrK2pdID0geSk7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHRbal0gPSBuZXcgVWludDhBcnJheSh4LmJ1ZmZlciwgeE9mZnNldCwgeU9mZnNldCAtIHhPZmZzZXQgKyB5TGVuKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBmdW5jdGlvbiBtZW1jcHk8VFRhcmdldCBleHRlbmRzIEFycmF5QnVmZmVyVmlldywgVFNvdXJjZSBleHRlbmRzIEFycmF5QnVmZmVyVmlldz4odGFyZ2V0OiBUVGFyZ2V0LCBzb3VyY2U6IFRTb3VyY2UsIHRhcmdldEJ5dGVPZmZzZXQgPSAwLCBzb3VyY2VCeXRlTGVuZ3RoID0gc291cmNlLmJ5dGVMZW5ndGgpIHtcbiAgICBjb25zdCB0YXJnZXRCeXRlTGVuZ3RoID0gdGFyZ2V0LmJ5dGVMZW5ndGg7XG4gICAgY29uc3QgZHN0ID0gbmV3IFVpbnQ4QXJyYXkodGFyZ2V0LmJ1ZmZlciwgdGFyZ2V0LmJ5dGVPZmZzZXQsIHRhcmdldEJ5dGVMZW5ndGgpO1xuICAgIGNvbnN0IHNyYyA9IG5ldyBVaW50OEFycmF5KHNvdXJjZS5idWZmZXIsIHNvdXJjZS5ieXRlT2Zmc2V0LCBNYXRoLm1pbihzb3VyY2VCeXRlTGVuZ3RoLCB0YXJnZXRCeXRlTGVuZ3RoKSk7XG4gICAgZHN0LnNldChzcmMsIHRhcmdldEJ5dGVPZmZzZXQpO1xuICAgIHJldHVybiB0YXJnZXQ7XG59XG5cbi8qKiBAaWdub3JlICovXG5leHBvcnQgZnVuY3Rpb24gam9pblVpbnQ4QXJyYXlzKGNodW5rczogVWludDhBcnJheVtdLCBzaXplPzogbnVtYmVyIHwgbnVsbCk6IFtVaW50OEFycmF5LCBVaW50OEFycmF5W10sIG51bWJlcl0ge1xuICAgIC8vIGNvbGxhcHNlIGNodW5rcyB0aGF0IHNoYXJlIHRoZSBzYW1lIHVuZGVybHlpbmcgQXJyYXlCdWZmZXIgYW5kIHdob3NlIGJ5dGUgcmFuZ2VzIG92ZXJsYXAsXG4gICAgLy8gdG8gYXZvaWQgdW5uZWNlc3NhcmlseSBjb3B5aW5nIHRoZSBieXRlcyB0byBkbyB0aGlzIGJ1ZmZlciBqb2luLiBUaGlzIGlzIGEgY29tbW9uIGNhc2UgZHVyaW5nXG4gICAgLy8gc3RyZWFtaW5nLCB3aGVyZSB3ZSBtYXkgYmUgcmVhZGluZyBwYXJ0aWFsIGJ5dGUgcmFuZ2VzIG91dCBvZiB0aGUgc2FtZSB1bmRlcmx5aW5nIEFycmF5QnVmZmVyXG4gICAgbGV0IHJlc3VsdCA9IGNvbGxhcHNlQ29udGlndW91c0J5dGVSYW5nZXMoY2h1bmtzKTtcbiAgICBsZXQgYnl0ZUxlbmd0aCA9IHJlc3VsdC5yZWR1Y2UoKHgsIGIpID0+IHggKyBiLmJ5dGVMZW5ndGgsIDApO1xuICAgIGxldCBzb3VyY2U6IFVpbnQ4QXJyYXksIHNsaWNlZDogVWludDhBcnJheSwgYnVmZmVyOiBVaW50OEFycmF5IHwgdm9pZDtcbiAgICBsZXQgb2Zmc2V0ID0gMCwgaW5kZXggPSAtMSwgbGVuZ3RoID0gTWF0aC5taW4oc2l6ZSB8fCBJbmZpbml0eSwgYnl0ZUxlbmd0aCk7XG4gICAgZm9yIChsZXQgbiA9IHJlc3VsdC5sZW5ndGg7ICsraW5kZXggPCBuOykge1xuICAgICAgICBzb3VyY2UgPSByZXN1bHRbaW5kZXhdO1xuICAgICAgICBzbGljZWQgPSBzb3VyY2Uuc3ViYXJyYXkoMCwgTWF0aC5taW4oc291cmNlLmxlbmd0aCwgbGVuZ3RoIC0gb2Zmc2V0KSk7XG4gICAgICAgIGlmIChsZW5ndGggPD0gKG9mZnNldCArIHNsaWNlZC5sZW5ndGgpKSB7XG4gICAgICAgICAgICBpZiAoc2xpY2VkLmxlbmd0aCA8IHNvdXJjZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRbaW5kZXhdID0gc291cmNlLnN1YmFycmF5KHNsaWNlZC5sZW5ndGgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzbGljZWQubGVuZ3RoID09PSBzb3VyY2UubGVuZ3RoKSB7IGluZGV4Kys7IH1cbiAgICAgICAgICAgIGJ1ZmZlciA/IG1lbWNweShidWZmZXIsIHNsaWNlZCwgb2Zmc2V0KSA6IChidWZmZXIgPSBzbGljZWQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgbWVtY3B5KGJ1ZmZlciB8fCAoYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKSksIHNsaWNlZCwgb2Zmc2V0KTtcbiAgICAgICAgb2Zmc2V0ICs9IHNsaWNlZC5sZW5ndGg7XG4gICAgfVxuICAgIHJldHVybiBbYnVmZmVyIHx8IG5ldyBVaW50OEFycmF5KDApLCByZXN1bHQuc2xpY2UoaW5kZXgpLCBieXRlTGVuZ3RoIC0gKGJ1ZmZlciA/IGJ1ZmZlci5ieXRlTGVuZ3RoIDogMCldO1xufVxuXG4vKiogQGlnbm9yZSAqL1xuZXhwb3J0IHR5cGUgQXJyYXlCdWZmZXJWaWV3SW5wdXQgPSBBcnJheUJ1ZmZlclZpZXcgfCBBcnJheUJ1ZmZlckxpa2UgfCBBcnJheUJ1ZmZlclZpZXcgfCBJdGVyYWJsZTxudW1iZXI+IHwgQXJyYXlMaWtlPG51bWJlcj4gfCBCeXRlQnVmZmVyIHwgc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCAgfFxuICAgICAgICAgICAgICAgICAgICBJdGVyYXRvclJlc3VsdDxBcnJheUJ1ZmZlclZpZXcgfCBBcnJheUJ1ZmZlckxpa2UgfCBBcnJheUJ1ZmZlclZpZXcgfCBJdGVyYWJsZTxudW1iZXI+IHwgQXJyYXlMaWtlPG51bWJlcj4gfCBCeXRlQnVmZmVyIHwgc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZD4gfFxuICAgICAgICAgIFJlYWRhYmxlU3RyZWFtUmVhZFJlc3VsdDxBcnJheUJ1ZmZlclZpZXcgfCBBcnJheUJ1ZmZlckxpa2UgfCBBcnJheUJ1ZmZlclZpZXcgfCBJdGVyYWJsZTxudW1iZXI+IHwgQXJyYXlMaWtlPG51bWJlcj4gfCBCeXRlQnVmZmVyIHwgc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZD4gO1xuXG4vKiogQGlnbm9yZSAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRvQXJyYXlCdWZmZXJWaWV3PFQgZXh0ZW5kcyBBcnJheUJ1ZmZlclZpZXc+KEFycmF5QnVmZmVyVmlld0N0b3I6IEFycmF5QnVmZmVyVmlld0NvbnN0cnVjdG9yPFQ+LCBpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpOiBUIHtcblxuICAgIGxldCB2YWx1ZTogYW55ID0gaXNJdGVyYXRvclJlc3VsdChpbnB1dCkgPyBpbnB1dC52YWx1ZSA6IGlucHV0O1xuXG4gICAgaWYgKCF2YWx1ZSkgeyByZXR1cm4gbmV3IEFycmF5QnVmZmVyVmlld0N0b3IoMCk7IH1cbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgeyB2YWx1ZSA9IGVuY29kZVV0ZjgodmFsdWUpOyB9XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXJWaWV3Q3Rvcikge1xuICAgICAgICByZXR1cm4gdmFsdWUuY29uc3RydWN0b3IgPT09IEFycmF5QnVmZmVyVmlld0N0b3IgPyB2YWx1ZSA6XG4gICAgICAgICAgICAvLyBOb2RlJ3MgYEJ1ZmZlcmAgY2xhc3MgcGFzc2VzIHRoZSBgaW5zdGFuY2VvZiBVaW50OEFycmF5YCBjaGVjaywgYnV0IHdlIG5lZWRcbiAgICAgICAgICAgIC8vIGEgcmVhbCBVaW50OEFycmF5LCBzaW5jZSBCdWZmZXIjc2xpY2UgaXNuJ3QgdGhlIHNhbWUgYXMgVWludDhBcnJheSNzbGljZSA6L1xuICAgICAgICAgICAgbmV3IEFycmF5QnVmZmVyVmlld0N0b3IodmFsdWUuYnVmZmVyLCB2YWx1ZS5ieXRlT2Zmc2V0LCB2YWx1ZS5ieXRlTGVuZ3RoIC8gQXJyYXlCdWZmZXJWaWV3Q3Rvci5CWVRFU19QRVJfRUxFTUVOVCk7XG4gICAgfVxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7IHJldHVybiBuZXcgQXJyYXlCdWZmZXJWaWV3Q3Rvcih2YWx1ZSk7IH1cbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBTaGFyZWRBcnJheUJ1ZikgeyByZXR1cm4gbmV3IEFycmF5QnVmZmVyVmlld0N0b3IodmFsdWUpOyB9XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQnl0ZUJ1ZmZlcikgeyByZXR1cm4gdG9BcnJheUJ1ZmZlclZpZXcoQXJyYXlCdWZmZXJWaWV3Q3RvciwgdmFsdWUuYnl0ZXMoKSk7IH1cbiAgICByZXR1cm4gIUFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZSkgPyBBcnJheUJ1ZmZlclZpZXdDdG9yLmZyb20odmFsdWUpIDogdmFsdWUuYnl0ZUxlbmd0aCA8PSAwID8gbmV3IEFycmF5QnVmZmVyVmlld0N0b3IoMClcbiAgICAgICAgOiBuZXcgQXJyYXlCdWZmZXJWaWV3Q3Rvcih2YWx1ZS5idWZmZXIsIHZhbHVlLmJ5dGVPZmZzZXQsIHZhbHVlLmJ5dGVMZW5ndGggLyBBcnJheUJ1ZmZlclZpZXdDdG9yLkJZVEVTX1BFUl9FTEVNRU5UKTtcbn1cblxuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvSW50OEFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoSW50OEFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQxNkFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoSW50MTZBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvSW50MzJBcnJheSA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3KEludDMyQXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQ4QXJyYXkgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50MTZBcnJheSA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQxNkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50MzJBcnJheSA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQzMkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9GbG9hdDMyQXJyYXkgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlldyhGbG9hdDMyQXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0Zsb2F0NjRBcnJheSA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3KEZsb2F0NjRBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDhDbGFtcGVkQXJyYXkgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlldyhVaW50OENsYW1wZWRBcnJheSwgaW5wdXQpO1xuXG4vKiogQGlnbm9yZSAqL1xudHlwZSBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0ID0gSXRlcmFibGU8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+IHwgQXJyYXlCdWZmZXJWaWV3SW5wdXQ7XG5cbi8qKiBAaWdub3JlICovXG5jb25zdCBwdW1wID0gPFQgZXh0ZW5kcyBJdGVyYXRvcjxhbnk+IHwgQXN5bmNJdGVyYXRvcjxhbnk+PihpdGVyYXRvcjogVCkgPT4geyBpdGVyYXRvci5uZXh0KCk7IHJldHVybiBpdGVyYXRvcjsgfTtcblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBmdW5jdGlvbiogdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcjxUIGV4dGVuZHMgQXJyYXlCdWZmZXJWaWV3PihBcnJheUN0b3I6IEFycmF5QnVmZmVyVmlld0NvbnN0cnVjdG9yPFQ+LCBzb3VyY2U6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpIHtcblxuICAgIGNvbnN0IHdyYXAgPSBmdW5jdGlvbio8VD4oeDogVCkgeyB5aWVsZCB4OyB9O1xuICAgIGNvbnN0IGJ1ZmZlcnM6IEl0ZXJhYmxlPEFycmF5QnVmZmVyVmlld0lucHV0PiA9XG4gICAgICAgICAgICAgICAgICAgKHR5cGVvZiBzb3VyY2UgPT09ICdzdHJpbmcnKSA/IHdyYXAoc291cmNlKVxuICAgICAgICAgICAgICAgICA6IChBcnJheUJ1ZmZlci5pc1ZpZXcoc291cmNlKSkgPyB3cmFwKHNvdXJjZSlcbiAgICAgICAgICAgICAgOiAoc291cmNlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpID8gd3JhcChzb3VyY2UpXG4gICAgICAgICAgIDogKHNvdXJjZSBpbnN0YW5jZW9mIFNoYXJlZEFycmF5QnVmKSA/IHdyYXAoc291cmNlKVxuICAgIDogIWlzSXRlcmFibGU8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+KHNvdXJjZSkgPyB3cmFwKHNvdXJjZSkgOiBzb3VyY2U7XG5cbiAgICB5aWVsZCogcHVtcCgoZnVuY3Rpb24qIChpdCkge1xuICAgICAgICBsZXQgcjogSXRlcmF0b3JSZXN1bHQ8YW55PiA9IDxhbnk+IG51bGw7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHIgPSBpdC5uZXh0KHlpZWxkIHRvQXJyYXlCdWZmZXJWaWV3KEFycmF5Q3RvciwgcikpO1xuICAgICAgICB9IHdoaWxlICghci5kb25lKTtcbiAgICB9KShidWZmZXJzW1N5bWJvbC5pdGVyYXRvcl0oKSkpO1xufVxuXG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQ4QXJyYXlJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcihJbnQ4QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDE2QXJyYXlJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcihJbnQxNkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQzMkFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoSW50MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDhBcnJheUl0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0l0ZXJhdG9yKFVpbnQ4QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQxNkFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoVWludDE2QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQzMkFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoVWludDMyQXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0Zsb2F0MzJBcnJheUl0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0l0ZXJhdG9yKEZsb2F0MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvRmxvYXQ2NEFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoRmxvYXQ2NEFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50OENsYW1wZWRBcnJheUl0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0l0ZXJhdG9yKFVpbnQ4Q2xhbXBlZEFycmF5LCBpbnB1dCk7XG5cbi8qKiBAaWdub3JlICovXG50eXBlIEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCA9IEFzeW5jSXRlcmFibGU8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+IHwgSXRlcmFibGU8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+IHwgUHJvbWlzZUxpa2U8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+IHwgQXJyYXlCdWZmZXJWaWV3SW5wdXQ7XG5cbi8qKiBAaWdub3JlICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24qIHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcjxUIGV4dGVuZHMgQXJyYXlCdWZmZXJWaWV3PihBcnJheUN0b3I6IEFycmF5QnVmZmVyVmlld0NvbnN0cnVjdG9yPFQ+LCBzb3VyY2U6IEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCk6IEFzeW5jSXRlcmFibGVJdGVyYXRvcjxUPiB7XG5cbiAgICAvLyBpZiBhIFByb21pc2UsIHVud3JhcCB0aGUgUHJvbWlzZSBhbmQgaXRlcmF0ZSB0aGUgcmVzb2x2ZWQgdmFsdWVcbiAgICBpZiAoaXNQcm9taXNlPEFycmF5QnVmZmVyVmlld0lucHV0Pihzb3VyY2UpKSB7XG4gICAgICAgIHJldHVybiB5aWVsZCogdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yKEFycmF5Q3RvciwgYXdhaXQgc291cmNlKTtcbiAgICB9XG5cbiAgICBjb25zdCB3cmFwID0gYXN5bmMgZnVuY3Rpb24qPFQ+KHg6IFQpIHsgeWllbGQgYXdhaXQgeDsgfTtcbiAgICBjb25zdCBlbWl0ID0gYXN5bmMgZnVuY3Rpb24qIDxUIGV4dGVuZHMgSXRlcmFibGU8YW55Pj4oc291cmNlOiBUKSB7XG4gICAgICAgIHlpZWxkKiBwdW1wKChmdW5jdGlvbiooaXQ6IEl0ZXJhdG9yPGFueT4pIHtcbiAgICAgICAgICAgIGxldCByOiBJdGVyYXRvclJlc3VsdDxhbnk+ID0gPGFueT4gbnVsbDtcbiAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICByID0gaXQubmV4dCh5aWVsZCByICYmIHIudmFsdWUpO1xuICAgICAgICAgICAgfSB3aGlsZSAoIXIuZG9uZSk7XG4gICAgICAgIH0pKHNvdXJjZVtTeW1ib2wuaXRlcmF0b3JdKCkpKTtcbiAgICB9O1xuXG4gICAgY29uc3QgYnVmZmVyczogQXN5bmNJdGVyYWJsZTxBcnJheUJ1ZmZlclZpZXdJbnB1dD4gPVxuICAgICAgICAgICAgICAgICAgICAgICAgKHR5cGVvZiBzb3VyY2UgPT09ICdzdHJpbmcnKSA/IHdyYXAoc291cmNlKSAvLyBpZiBzdHJpbmcsIHdyYXAgaW4gYW4gQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXG4gICAgICAgICAgICAgICAgICAgICAgOiAoQXJyYXlCdWZmZXIuaXNWaWV3KHNvdXJjZSkpID8gd3JhcChzb3VyY2UpIC8vIGlmIFR5cGVkQXJyYXksIHdyYXAgaW4gYW4gQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXG4gICAgICAgICAgICAgICAgICAgOiAoc291cmNlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpID8gd3JhcChzb3VyY2UpIC8vIGlmIEFycmF5QnVmZmVyLCB3cmFwIGluIGFuIEFzeW5jSXRlcmFibGVJdGVyYXRvclxuICAgICAgICAgICAgICAgIDogKHNvdXJjZSBpbnN0YW5jZW9mIFNoYXJlZEFycmF5QnVmKSA/IHdyYXAoc291cmNlKSAvLyBpZiBTaGFyZWRBcnJheUJ1ZmZlciwgd3JhcCBpbiBhbiBBc3luY0l0ZXJhYmxlSXRlcmF0b3JcbiAgICAgICAgICA6IGlzSXRlcmFibGU8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+KHNvdXJjZSkgPyBlbWl0KHNvdXJjZSkgLy8gSWYgSXRlcmFibGUsIHdyYXAgaW4gYW4gQXN5bmNJdGVyYWJsZUl0ZXJhdG9yIGFuZCBjb21wb3NlIHRoZSBgbmV4dGAgdmFsdWVzXG4gICAgOiAhaXNBc3luY0l0ZXJhYmxlPEFycmF5QnVmZmVyVmlld0lucHV0Pihzb3VyY2UpID8gd3JhcChzb3VyY2UpIC8vIElmIG5vdCBhbiBBc3luY0l0ZXJhYmxlLCB0cmVhdCBhcyBhIHNlbnRpbmVsIGFuZCB3cmFwIGluIGFuIEFzeW5jSXRlcmFibGVJdGVyYXRvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IHNvdXJjZTsgLy8gb3RoZXJ3aXNlIGlmIEFzeW5jSXRlcmFibGUsIHVzZSBpdFxuXG4gICAgeWllbGQqIHB1bXAoKGFzeW5jIGZ1bmN0aW9uKiAoaXQpIHtcbiAgICAgICAgbGV0IHI6IEl0ZXJhdG9yUmVzdWx0PGFueT4gPSA8YW55PiBudWxsO1xuICAgICAgICBkbyB7XG4gICAgICAgICAgICByID0gYXdhaXQgaXQubmV4dCh5aWVsZCB0b0FycmF5QnVmZmVyVmlldyhBcnJheUN0b3IsIHIpKTtcbiAgICAgICAgfSB3aGlsZSAoIXIuZG9uZSk7XG4gICAgfSkoYnVmZmVyc1tTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSkpO1xufVxuXG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQ4QXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihJbnQ4QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDE2QXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihJbnQxNkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQzMkFycmF5QXN5bmNJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoSW50MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDhBcnJheUFzeW5jSXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yKFVpbnQ4QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQxNkFycmF5QXN5bmNJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoVWludDE2QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQzMkFycmF5QXN5bmNJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoVWludDMyQXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0Zsb2F0MzJBcnJheUFzeW5jSXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yKEZsb2F0MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvRmxvYXQ2NEFycmF5QXN5bmNJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoRmxvYXQ2NEFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50OENsYW1wZWRBcnJheUFzeW5jSXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yKFVpbnQ4Q2xhbXBlZEFycmF5LCBpbnB1dCk7XG5cbi8qKiBAaWdub3JlICovXG5leHBvcnQgZnVuY3Rpb24gcmViYXNlVmFsdWVPZmZzZXRzKG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgdmFsdWVPZmZzZXRzOiBJbnQzMkFycmF5KSB7XG4gICAgLy8gSWYgd2UgaGF2ZSBhIG5vbi16ZXJvIG9mZnNldCwgY3JlYXRlIGEgbmV3IG9mZnNldHMgYXJyYXkgd2l0aCB0aGUgdmFsdWVzXG4gICAgLy8gc2hpZnRlZCBieSB0aGUgc3RhcnQgb2Zmc2V0LCBzdWNoIHRoYXQgdGhlIG5ldyBzdGFydCBvZmZzZXQgaXMgMFxuICAgIGlmIChvZmZzZXQgIT09IDApIHtcbiAgICAgICAgdmFsdWVPZmZzZXRzID0gdmFsdWVPZmZzZXRzLnNsaWNlKDAsIGxlbmd0aCArIDEpO1xuICAgICAgICBmb3IgKGxldCBpID0gLTE7ICsraSA8PSBsZW5ndGg7KSB7XG4gICAgICAgICAgICB2YWx1ZU9mZnNldHNbaV0gKz0gb2Zmc2V0O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZU9mZnNldHM7XG59XG5cbi8qKiBAaWdub3JlICovXG5leHBvcnQgZnVuY3Rpb24gY29tcGFyZUFycmF5TGlrZTxUIGV4dGVuZHMgQXJyYXlMaWtlPGFueT4+KGE6IFQsIGI6IFQpIHtcbiAgICBsZXQgaSA9IDAsIG4gPSBhLmxlbmd0aDtcbiAgICBpZiAobiAhPT0gYi5sZW5ndGgpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgaWYgKG4gPiAwKSB7XG4gICAgICAgIGRvIHsgaWYgKGFbaV0gIT09IGJbaV0pIHsgcmV0dXJuIGZhbHNlOyB9IH0gd2hpbGUgKCsraSA8IG4pO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbiJdfQ==
