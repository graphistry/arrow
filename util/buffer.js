"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const flatbuffers_1 = require("flatbuffers");
var ByteBuffer = flatbuffers_1.flatbuffers.ByteBuffer;
const compat_1 = require("./compat");
function collapseContiguousByteRanges(chunks) {
    for (let x, y, i = 0; ++i < chunks.length;) {
        x = chunks[i - 1];
        y = chunks[i - 0];
        // continue x and y don't share the same underlying ArrayBuffer
        if (!x || !y || x.buffer !== y.buffer) {
            continue;
        }
        const { byteOffset: xOffset, byteLength: xLen } = x;
        const { byteOffset: yOffset, byteLength: yLen } = y;
        // continue if the byte ranges of x and y aren't contiguous
        if ((xOffset + xLen) < yOffset || (yOffset + yLen) < xOffset) {
            continue;
        }
        chunks.splice(--i, 2, new Uint8Array(x.buffer, xOffset, yOffset - xOffset + yLen));
    }
    return chunks;
}
/**
 * @ignore
 */
function memcpy(target, source, targetByteOffset = 0, sourceByteLength = source.byteLength) {
    const targetByteLength = target.byteLength;
    const dst = new Uint8Array(target.buffer, target.byteOffset, targetByteLength);
    const src = new Uint8Array(source.buffer, source.byteOffset, Math.min(sourceByteLength, targetByteLength));
    dst.set(src, targetByteOffset);
    return target;
}
exports.memcpy = memcpy;
/**
 * @ignore
 */
function joinUint8Arrays(chunks, size) {
    // collapse chunks that share the same underlying ArrayBuffer and whose byte ranges overlap,
    // to avoid unnecessarily copying the bytes to do this buffer join. This is a common case during
    // streaming, where we may be reading partial byte ranges out of the same underlying ArrayBuffer
    chunks = collapseContiguousByteRanges(chunks);
    let offset = 0, index = -1, chunksLen = chunks.length;
    let source, sliced, buffer;
    let length = typeof size === 'number' ? size : chunks.reduce((x, y) => x + y.length, 0);
    while (++index < chunksLen) {
        source = chunks[index];
        sliced = source.subarray(0, Math.min(source.length, length - offset));
        if (length <= (offset + sliced.length)) {
            if (sliced.length < source.length) {
                chunks[index] = source.subarray(sliced.length);
            }
            else if (sliced.length === source.length) {
                index++;
            }
            buffer ? memcpy(buffer, sliced, offset) : (buffer = sliced);
            break;
        }
        (buffer || (buffer = new Uint8Array(length))).set(sliced, offset);
        offset += sliced.length;
    }
    return [buffer || new Uint8Array(0), chunks.slice(index)];
}
exports.joinUint8Arrays = joinUint8Arrays;
/**
 * @ignore
 */
function toArrayBufferView(ArrayBufferViewCtor, input) {
    let value = compat_1.isIteratorResult(input) ? input.value : input;
    if (!value) {
        return new ArrayBufferViewCtor(0);
    }
    if (typeof value === 'string') {
        value = decodeUtf8(value);
    }
    if (value instanceof ArrayBufferViewCtor) {
        return value;
    }
    if (value instanceof ArrayBuffer) {
        return new ArrayBufferViewCtor(value);
    }
    if (value instanceof SharedArrayBuffer) {
        return new ArrayBufferViewCtor(value);
    }
    if (value instanceof ByteBuffer) {
        return toArrayBufferView(ArrayBufferViewCtor, value.bytes());
    }
    return !ArrayBuffer.isView(value) ? ArrayBufferViewCtor.from(value) : value.byteLength <= 0 ? new ArrayBufferViewCtor(0)
        : new ArrayBufferViewCtor(value.buffer, value.byteOffset, value.byteLength / ArrayBufferViewCtor.BYTES_PER_ELEMENT);
}
exports.toArrayBufferView = toArrayBufferView;
/** @ignore */ exports.toInt8Array = (input) => toArrayBufferView(Int8Array, input);
/** @ignore */ exports.toInt16Array = (input) => toArrayBufferView(Int16Array, input);
/** @ignore */ exports.toInt32Array = (input) => toArrayBufferView(Int32Array, input);
/** @ignore */ exports.toUint8Array = (input) => toArrayBufferView(Uint8Array, input);
/** @ignore */ exports.toUint16Array = (input) => toArrayBufferView(Uint16Array, input);
/** @ignore */ exports.toUint32Array = (input) => toArrayBufferView(Uint32Array, input);
/** @ignore */ exports.toFloat32Array = (input) => toArrayBufferView(Float32Array, input);
/** @ignore */ exports.toFloat64Array = (input) => toArrayBufferView(Float64Array, input);
/** @ignore */ exports.toUint8ClampedArray = (input) => toArrayBufferView(Uint8ClampedArray, input);
const pump = (iterator) => { iterator.next(); return iterator; };
/** @ignore */
function* toArrayBufferViewIterator(ArrayCtor, source) {
    const wrap = function* (x) { yield x; };
    const buffers = (typeof source === 'string') ? wrap(source)
        : (ArrayBuffer.isView(source)) ? wrap(source)
            : (source instanceof ArrayBuffer) ? wrap(source)
                : (source instanceof SharedArrayBuffer) ? wrap(source)
                    : !compat_1.isIterable(source) ? wrap(source) : source;
    yield* pump((function* (it) {
        let r = null;
        do {
            r = it.next(yield toArrayBufferView(ArrayCtor, r));
        } while (!r.done);
    })(buffers[Symbol.iterator]()));
}
exports.toArrayBufferViewIterator = toArrayBufferViewIterator;
/** @ignore */ exports.toInt8ArrayIterator = (input) => toArrayBufferViewIterator(Int8Array, input);
/** @ignore */ exports.toInt16ArrayIterator = (input) => toArrayBufferViewIterator(Int16Array, input);
/** @ignore */ exports.toInt32ArrayIterator = (input) => toArrayBufferViewIterator(Int32Array, input);
/** @ignore */ exports.toUint8ArrayIterator = (input) => toArrayBufferViewIterator(Uint8Array, input);
/** @ignore */ exports.toUint16ArrayIterator = (input) => toArrayBufferViewIterator(Uint16Array, input);
/** @ignore */ exports.toUint32ArrayIterator = (input) => toArrayBufferViewIterator(Uint32Array, input);
/** @ignore */ exports.toFloat32ArrayIterator = (input) => toArrayBufferViewIterator(Float32Array, input);
/** @ignore */ exports.toFloat64ArrayIterator = (input) => toArrayBufferViewIterator(Float64Array, input);
/** @ignore */ exports.toUint8ClampedArrayIterator = (input) => toArrayBufferViewIterator(Uint8ClampedArray, input);
/** @ignore */
function toArrayBufferViewAsyncIterator(ArrayCtor, source) {
    return tslib_1.__asyncGenerator(this, arguments, function* toArrayBufferViewAsyncIterator_1() {
        // if a Promise, unwrap the Promise and iterate the resolved value
        if (compat_1.isPromise(source)) {
            return yield tslib_1.__await(yield tslib_1.__await(yield* tslib_1.__asyncDelegator(tslib_1.__asyncValues(toArrayBufferViewAsyncIterator(ArrayCtor, yield tslib_1.__await(source))))));
        }
        const wrap = function (x) { return tslib_1.__asyncGenerator(this, arguments, function* () { yield yield tslib_1.__await(yield tslib_1.__await(x)); }); };
        const emit = function (source) {
            return tslib_1.__asyncGenerator(this, arguments, function* () {
                yield tslib_1.__await(yield* tslib_1.__asyncDelegator(tslib_1.__asyncValues(pump((function* (it) {
                    let r = null;
                    do {
                        r = it.next(yield r && r.value);
                    } while (!r.done);
                })(source[Symbol.iterator]())))));
            });
        };
        const buffers = (typeof source === 'string') ? wrap(source) // if string, wrap in an AsyncIterableIterator
            : (ArrayBuffer.isView(source)) ? wrap(source) // if TypedArray, wrap in an AsyncIterableIterator
                : (source instanceof ArrayBuffer) ? wrap(source) // if ArrayBuffer, wrap in an AsyncIterableIterator
                    : (source instanceof SharedArrayBuffer) ? wrap(source) // if SharedArrayBuffer, wrap in an AsyncIterableIterator
                        : compat_1.isIterable(source) ? emit(source) // If Iterable, wrap in an AsyncIterableIterator and compose the `next` values
                            : !compat_1.isAsyncIterable(source) ? wrap(source) // If not an AsyncIterable, treat as a sentinel and wrap in an AsyncIterableIterator
                                : source; // otherwise if AsyncIterable, use it
        yield tslib_1.__await(// otherwise if AsyncIterable, use it
        yield* tslib_1.__asyncDelegator(tslib_1.__asyncValues(pump((function (it) {
            return tslib_1.__asyncGenerator(this, arguments, function* () {
                let r = null;
                do {
                    r = yield tslib_1.__await(it.next(yield yield tslib_1.__await(toArrayBufferView(ArrayCtor, r))));
                } while (!r.done);
            });
        })(buffers[Symbol.asyncIterator]())))));
    });
}
exports.toArrayBufferViewAsyncIterator = toArrayBufferViewAsyncIterator;
/** @ignore */ exports.toInt8ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Int8Array, input);
/** @ignore */ exports.toInt16ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Int16Array, input);
/** @ignore */ exports.toInt32ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Int32Array, input);
/** @ignore */ exports.toUint8ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint8Array, input);
/** @ignore */ exports.toUint16ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint16Array, input);
/** @ignore */ exports.toUint32ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint32Array, input);
/** @ignore */ exports.toFloat32ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Float32Array, input);
/** @ignore */ exports.toFloat64ArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Float64Array, input);
/** @ignore */ exports.toUint8ClampedArrayAsyncIterator = (input) => toArrayBufferViewAsyncIterator(Uint8ClampedArray, input);
/**
 * @ignore
 */
function decodeUtf8(chunk) {
    const bytes = new Uint8Array(chunk.length);
    for (let i = -1, n = chunk.length; ++i < n;) {
        bytes[i] = chunk.charCodeAt(i);
    }
    return bytes;
}
/**
 * @ignore
 */
function rebaseValueOffsets(offset, length, valueOffsets) {
    // If we have a non-zero offset, create a new offsets array with the values
    // shifted by the start offset, such that the new start offset is 0
    if (offset !== 0) {
        valueOffsets = valueOffsets.slice(0, length + 1);
        for (let i = -1; ++i <= length;) {
            valueOffsets[i] += offset;
        }
    }
    return valueOffsets;
}
exports.rebaseValueOffsets = rebaseValueOffsets;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUE4QixDQUFDLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxDQUFDO0FBRXRLOztHQUVHO0FBQ0gsU0FBUyxVQUFVLENBQUMsS0FBYTtJQUM3QixNQUFNLEtBQUssR0FBRyxJQUFJLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDM0MsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUc7UUFDekMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDbEM7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNqQixDQUFDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixrQkFBa0IsQ0FBQyxNQUFjLEVBQUUsTUFBYyxFQUFFLFlBQXdCO0lBQ3ZGLDJFQUEyRTtJQUMzRSxtRUFBbUU7SUFDbkUsSUFBSSxNQUFNLEtBQUssQ0FBQyxFQUFFO1FBQ2QsWUFBWSxHQUFHLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNqRCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLE1BQU0sR0FBRztZQUM3QixZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksTUFBTSxDQUFDO1NBQzdCO0tBQ0o7SUFDRCxPQUFPLFlBQVksQ0FBQztBQUN4QixDQUFDO0FBVkQsZ0RBVUMiLCJmaWxlIjoidXRpbC9idWZmZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4vLyBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbi8vIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4vLyByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4vLyB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4vLyBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Vcbi8vIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbi8vIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4vLyBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuLy8gS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4vLyBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4vLyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgZmxhdGJ1ZmZlcnMgfSBmcm9tICdmbGF0YnVmZmVycyc7XG5pbXBvcnQgQnl0ZUJ1ZmZlciA9IGZsYXRidWZmZXJzLkJ5dGVCdWZmZXI7XG5pbXBvcnQgeyBBcnJheUJ1ZmZlclZpZXdDb25zdHJ1Y3RvciB9IGZyb20gJy4uL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgaXNQcm9taXNlLCBpc0l0ZXJhYmxlLCBpc0FzeW5jSXRlcmFibGUsIGlzSXRlcmF0b3JSZXN1bHQgfSBmcm9tICcuL2NvbXBhdCc7XG5cbmZ1bmN0aW9uIGNvbGxhcHNlQ29udGlndW91c0J5dGVSYW5nZXMoY2h1bmtzOiBVaW50OEFycmF5W10pIHtcbiAgICBmb3IgKGxldCB4LCB5LCBpID0gMDsgKytpIDwgY2h1bmtzLmxlbmd0aDspIHtcbiAgICAgICAgeCA9IGNodW5rc1tpIC0gMV07XG4gICAgICAgIHkgPSBjaHVua3NbaSAtIDBdO1xuICAgICAgICAvLyBjb250aW51ZSB4IGFuZCB5IGRvbid0IHNoYXJlIHRoZSBzYW1lIHVuZGVybHlpbmcgQXJyYXlCdWZmZXJcbiAgICAgICAgaWYgKCF4IHx8ICF5IHx8IHguYnVmZmVyICE9PSB5LmJ1ZmZlcikgeyBjb250aW51ZTsgfVxuICAgICAgICBjb25zdCB7IGJ5dGVPZmZzZXQ6IHhPZmZzZXQsIGJ5dGVMZW5ndGg6IHhMZW4gfSA9IHg7XG4gICAgICAgIGNvbnN0IHsgYnl0ZU9mZnNldDogeU9mZnNldCwgYnl0ZUxlbmd0aDogeUxlbiB9ID0geTtcbiAgICAgICAgLy8gY29udGludWUgaWYgdGhlIGJ5dGUgcmFuZ2VzIG9mIHggYW5kIHkgYXJlbid0IGNvbnRpZ3VvdXNcbiAgICAgICAgaWYgKCh4T2Zmc2V0ICsgeExlbikgPCB5T2Zmc2V0IHx8ICh5T2Zmc2V0ICsgeUxlbikgPCB4T2Zmc2V0KSB7IGNvbnRpbnVlOyB9XG4gICAgICAgIGNodW5rcy5zcGxpY2UoLS1pLCAyLCBuZXcgVWludDhBcnJheSh4LmJ1ZmZlciwgeE9mZnNldCwgeU9mZnNldCAtIHhPZmZzZXQgKyB5TGVuKSk7XG4gICAgfVxuICAgIHJldHVybiBjaHVua3M7XG59XG5cbi8qKlxuICogQGlnbm9yZVxuICovXG5leHBvcnQgZnVuY3Rpb24gbWVtY3B5PFRUYXJnZXQgZXh0ZW5kcyBBcnJheUJ1ZmZlclZpZXcsIFRTb3VyY2UgZXh0ZW5kcyBBcnJheUJ1ZmZlclZpZXc+KHRhcmdldDogVFRhcmdldCwgc291cmNlOiBUU291cmNlLCB0YXJnZXRCeXRlT2Zmc2V0ID0gMCwgc291cmNlQnl0ZUxlbmd0aCA9IHNvdXJjZS5ieXRlTGVuZ3RoKSB7XG4gICAgY29uc3QgdGFyZ2V0Qnl0ZUxlbmd0aCA9IHRhcmdldC5ieXRlTGVuZ3RoO1xuICAgIGNvbnN0IGRzdCA9IG5ldyBVaW50OEFycmF5KHRhcmdldC5idWZmZXIsIHRhcmdldC5ieXRlT2Zmc2V0LCB0YXJnZXRCeXRlTGVuZ3RoKTtcbiAgICBjb25zdCBzcmMgPSBuZXcgVWludDhBcnJheShzb3VyY2UuYnVmZmVyLCBzb3VyY2UuYnl0ZU9mZnNldCwgTWF0aC5taW4oc291cmNlQnl0ZUxlbmd0aCwgdGFyZ2V0Qnl0ZUxlbmd0aCkpO1xuICAgIGRzdC5zZXQoc3JjLCB0YXJnZXRCeXRlT2Zmc2V0KTtcbiAgICByZXR1cm4gdGFyZ2V0O1xufVxuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGpvaW5VaW50OEFycmF5cyhjaHVua3M6IFVpbnQ4QXJyYXlbXSwgc2l6ZT86IG51bWJlciB8IG51bGwpOiBbVWludDhBcnJheSwgVWludDhBcnJheVtdXSB7XG4gICAgLy8gY29sbGFwc2UgY2h1bmtzIHRoYXQgc2hhcmUgdGhlIHNhbWUgdW5kZXJseWluZyBBcnJheUJ1ZmZlciBhbmQgd2hvc2UgYnl0ZSByYW5nZXMgb3ZlcmxhcCxcbiAgICAvLyB0byBhdm9pZCB1bm5lY2Vzc2FyaWx5IGNvcHlpbmcgdGhlIGJ5dGVzIHRvIGRvIHRoaXMgYnVmZmVyIGpvaW4uIFRoaXMgaXMgYSBjb21tb24gY2FzZSBkdXJpbmdcbiAgICAvLyBzdHJlYW1pbmcsIHdoZXJlIHdlIG1heSBiZSByZWFkaW5nIHBhcnRpYWwgYnl0ZSByYW5nZXMgb3V0IG9mIHRoZSBzYW1lIHVuZGVybHlpbmcgQXJyYXlCdWZmZXJcbiAgICBjaHVua3MgPSBjb2xsYXBzZUNvbnRpZ3VvdXNCeXRlUmFuZ2VzKGNodW5rcyk7XG4gICAgbGV0IG9mZnNldCA9IDAsIGluZGV4ID0gLTEsIGNodW5rc0xlbiA9IGNodW5rcy5sZW5ndGg7XG4gICAgbGV0IHNvdXJjZTogVWludDhBcnJheSwgc2xpY2VkOiBVaW50OEFycmF5LCBidWZmZXI6IFVpbnQ4QXJyYXkgfCB2b2lkO1xuICAgIGxldCBsZW5ndGggPSB0eXBlb2Ygc2l6ZSA9PT0gJ251bWJlcicgPyBzaXplIDogY2h1bmtzLnJlZHVjZSgoeCwgeSkgPT4geCArIHkubGVuZ3RoLCAwKTtcbiAgICB3aGlsZSAoKytpbmRleCA8IGNodW5rc0xlbikge1xuICAgICAgICBzb3VyY2UgPSBjaHVua3NbaW5kZXhdO1xuICAgICAgICBzbGljZWQgPSBzb3VyY2Uuc3ViYXJyYXkoMCwgTWF0aC5taW4oc291cmNlLmxlbmd0aCwgbGVuZ3RoIC0gb2Zmc2V0KSk7XG4gICAgICAgIGlmIChsZW5ndGggPD0gKG9mZnNldCArIHNsaWNlZC5sZW5ndGgpKSB7XG4gICAgICAgICAgICBpZiAoc2xpY2VkLmxlbmd0aCA8IHNvdXJjZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBjaHVua3NbaW5kZXhdID0gc291cmNlLnN1YmFycmF5KHNsaWNlZC5sZW5ndGgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzbGljZWQubGVuZ3RoID09PSBzb3VyY2UubGVuZ3RoKSB7IGluZGV4Kys7IH1cbiAgICAgICAgICAgIGJ1ZmZlciA/IG1lbWNweShidWZmZXIsIHNsaWNlZCwgb2Zmc2V0KSA6IChidWZmZXIgPSBzbGljZWQpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgKGJ1ZmZlciB8fCAoYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKSkpLnNldChzbGljZWQsIG9mZnNldCk7XG4gICAgICAgIG9mZnNldCArPSBzbGljZWQubGVuZ3RoO1xuICAgIH1cbiAgICByZXR1cm4gW2J1ZmZlciB8fCBuZXcgVWludDhBcnJheSgwKSwgY2h1bmtzLnNsaWNlKGluZGV4KV07XG59XG5cbmV4cG9ydCB0eXBlIEFycmF5QnVmZmVyVmlld0lucHV0ID0gQXJyYXlCdWZmZXJWaWV3IHwgQXJyYXlCdWZmZXJMaWtlIHwgQXJyYXlCdWZmZXJWaWV3IHwgSXRlcmFibGU8bnVtYmVyPiB8IEFycmF5TGlrZTxudW1iZXI+IHwgQnl0ZUJ1ZmZlciB8IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQgIHxcbiAgICAgICAgICAgICAgICAgICAgSXRlcmF0b3JSZXN1bHQ8QXJyYXlCdWZmZXJWaWV3IHwgQXJyYXlCdWZmZXJMaWtlIHwgQXJyYXlCdWZmZXJWaWV3IHwgSXRlcmFibGU8bnVtYmVyPiB8IEFycmF5TGlrZTxudW1iZXI+IHwgQnl0ZUJ1ZmZlciB8IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ+IHxcbiAgICAgICAgICBSZWFkYWJsZVN0cmVhbVJlYWRSZXN1bHQ8QXJyYXlCdWZmZXJWaWV3IHwgQXJyYXlCdWZmZXJMaWtlIHwgQXJyYXlCdWZmZXJWaWV3IHwgSXRlcmFibGU8bnVtYmVyPiB8IEFycmF5TGlrZTxudW1iZXI+IHwgQnl0ZUJ1ZmZlciB8IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ+IDtcblxuLyoqXG4gKiBAaWdub3JlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0b0FycmF5QnVmZmVyVmlldzxUIGV4dGVuZHMgQXJyYXlCdWZmZXJWaWV3PihBcnJheUJ1ZmZlclZpZXdDdG9yOiBBcnJheUJ1ZmZlclZpZXdDb25zdHJ1Y3RvcjxUPiwgaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KTogVCB7XG5cbiAgICBsZXQgdmFsdWU6IGFueSA9IGlzSXRlcmF0b3JSZXN1bHQoaW5wdXQpID8gaW5wdXQudmFsdWUgOiBpbnB1dDtcblxuICAgIGlmICghdmFsdWUpIHsgcmV0dXJuIG5ldyBBcnJheUJ1ZmZlclZpZXdDdG9yKDApOyB9XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsgdmFsdWUgPSBkZWNvZGVVdGY4KHZhbHVlKTsgfVxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyVmlld0N0b3IpIHsgcmV0dXJuIHZhbHVlOyB9XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHsgcmV0dXJuIG5ldyBBcnJheUJ1ZmZlclZpZXdDdG9yKHZhbHVlKTsgfVxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFNoYXJlZEFycmF5QnVmZmVyKSB7IHJldHVybiBuZXcgQXJyYXlCdWZmZXJWaWV3Q3Rvcih2YWx1ZSk7IH1cbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBCeXRlQnVmZmVyKSB7IHJldHVybiB0b0FycmF5QnVmZmVyVmlldyhBcnJheUJ1ZmZlclZpZXdDdG9yLCB2YWx1ZS5ieXRlcygpKTsgfVxuICAgIHJldHVybiAhQXJyYXlCdWZmZXIuaXNWaWV3KHZhbHVlKSA/IEFycmF5QnVmZmVyVmlld0N0b3IuZnJvbSh2YWx1ZSkgOiB2YWx1ZS5ieXRlTGVuZ3RoIDw9IDAgPyBuZXcgQXJyYXlCdWZmZXJWaWV3Q3RvcigwKVxuICAgICAgICA6IG5ldyBBcnJheUJ1ZmZlclZpZXdDdG9yKHZhbHVlLmJ1ZmZlciwgdmFsdWUuYnl0ZU9mZnNldCwgdmFsdWUuYnl0ZUxlbmd0aCAvIEFycmF5QnVmZmVyVmlld0N0b3IuQllURVNfUEVSX0VMRU1FTlQpO1xufVxuXG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQ4QXJyYXkgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlldyhJbnQ4QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDE2QXJyYXkgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlldyhJbnQxNkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQzMkFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoSW50MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDhBcnJheSA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQxNkFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoVWludDE2QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQzMkFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoVWludDMyQXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0Zsb2F0MzJBcnJheSA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3KEZsb2F0MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvRmxvYXQ2NEFycmF5ID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXcoRmxvYXQ2NEFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50OENsYW1wZWRBcnJheSA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4Q2xhbXBlZEFycmF5LCBpbnB1dCk7XG5cbnR5cGUgQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCA9IEl0ZXJhYmxlPEFycmF5QnVmZmVyVmlld0lucHV0PiB8IEFycmF5QnVmZmVyVmlld0lucHV0O1xuXG5jb25zdCBwdW1wID0gPFQgZXh0ZW5kcyBJdGVyYXRvcjxhbnk+IHwgQXN5bmNJdGVyYXRvcjxhbnk+PihpdGVyYXRvcjogVCkgPT4geyBpdGVyYXRvci5uZXh0KCk7IHJldHVybiBpdGVyYXRvcjsgfTtcblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBmdW5jdGlvbiogdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcjxUIGV4dGVuZHMgQXJyYXlCdWZmZXJWaWV3PihBcnJheUN0b3I6IEFycmF5QnVmZmVyVmlld0NvbnN0cnVjdG9yPFQ+LCBzb3VyY2U6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpIHtcblxuICAgIGNvbnN0IHdyYXAgPSBmdW5jdGlvbio8VD4oeDogVCkgeyB5aWVsZCB4OyB9O1xuICAgIGNvbnN0IGJ1ZmZlcnM6IEl0ZXJhYmxlPEFycmF5QnVmZmVyVmlld0lucHV0PiA9XG4gICAgICAgICAgICAgICAgICAgKHR5cGVvZiBzb3VyY2UgPT09ICdzdHJpbmcnKSA/IHdyYXAoc291cmNlKVxuICAgICAgICAgICAgICAgICA6IChBcnJheUJ1ZmZlci5pc1ZpZXcoc291cmNlKSkgPyB3cmFwKHNvdXJjZSlcbiAgICAgICAgICAgICAgOiAoc291cmNlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpID8gd3JhcChzb3VyY2UpXG4gICAgICAgIDogKHNvdXJjZSBpbnN0YW5jZW9mIFNoYXJlZEFycmF5QnVmZmVyKSA/IHdyYXAoc291cmNlKVxuICAgIDogIWlzSXRlcmFibGU8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+KHNvdXJjZSkgPyB3cmFwKHNvdXJjZSkgOiBzb3VyY2U7XG5cbiAgICB5aWVsZCogcHVtcCgoZnVuY3Rpb24qIChpdCkge1xuICAgICAgICBsZXQgcjogSXRlcmF0b3JSZXN1bHQ8YW55PiA9IDxhbnk+IG51bGw7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHIgPSBpdC5uZXh0KHlpZWxkIHRvQXJyYXlCdWZmZXJWaWV3KEFycmF5Q3RvciwgcikpO1xuICAgICAgICB9IHdoaWxlICghci5kb25lKTtcbiAgICB9KShidWZmZXJzW1N5bWJvbC5pdGVyYXRvcl0oKSkpO1xufVxuXG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQ4QXJyYXlJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcihJbnQ4QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDE2QXJyYXlJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdJdGVyYXRvcihJbnQxNkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9JbnQzMkFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoSW50MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDhBcnJheUl0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0l0ZXJhdG9yKFVpbnQ4QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQxNkFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoVWludDE2QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQzMkFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoVWludDMyQXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0Zsb2F0MzJBcnJheUl0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0l0ZXJhdG9yKEZsb2F0MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvRmxvYXQ2NEFycmF5SXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3SXRlcmF0b3IoRmxvYXQ2NEFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50OENsYW1wZWRBcnJheUl0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0l0ZXJhdG9yKFVpbnQ4Q2xhbXBlZEFycmF5LCBpbnB1dCk7XG5cbnR5cGUgQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0ID0gQXN5bmNJdGVyYWJsZTxBcnJheUJ1ZmZlclZpZXdJbnB1dD4gfCBJdGVyYWJsZTxBcnJheUJ1ZmZlclZpZXdJbnB1dD4gfCBQcm9taXNlTGlrZTxBcnJheUJ1ZmZlclZpZXdJbnB1dD4gfCBBcnJheUJ1ZmZlclZpZXdJbnB1dDtcblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiogdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yPFQgZXh0ZW5kcyBBcnJheUJ1ZmZlclZpZXc+KEFycmF5Q3RvcjogQXJyYXlCdWZmZXJWaWV3Q29uc3RydWN0b3I8VD4sIHNvdXJjZTogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KTogQXN5bmNJdGVyYWJsZUl0ZXJhdG9yPFQ+IHtcblxuICAgIC8vIGlmIGEgUHJvbWlzZSwgdW53cmFwIHRoZSBQcm9taXNlIGFuZCBpdGVyYXRlIHRoZSByZXNvbHZlZCB2YWx1ZVxuICAgIGlmIChpc1Byb21pc2U8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+KHNvdXJjZSkpIHtcbiAgICAgICAgcmV0dXJuIHlpZWxkKiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoQXJyYXlDdG9yLCBhd2FpdCBzb3VyY2UpO1xuICAgIH1cblxuICAgIGNvbnN0IHdyYXAgPSBhc3luYyBmdW5jdGlvbio8VD4oeDogVCkgeyB5aWVsZCBhd2FpdCB4OyB9O1xuICAgIGNvbnN0IGVtaXQgPSBhc3luYyBmdW5jdGlvbiogPFQgZXh0ZW5kcyBJdGVyYWJsZTxhbnk+Pihzb3VyY2U6IFQpIHtcbiAgICAgICAgeWllbGQqIHB1bXAoKGZ1bmN0aW9uKihpdDogSXRlcmF0b3I8YW55Pikge1xuICAgICAgICAgICAgbGV0IHI6IEl0ZXJhdG9yUmVzdWx0PGFueT4gPSA8YW55PiBudWxsO1xuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIHIgPSBpdC5uZXh0KHlpZWxkIHIgJiYgci52YWx1ZSk7XG4gICAgICAgICAgICB9IHdoaWxlICghci5kb25lKTtcbiAgICAgICAgfSkoc291cmNlW1N5bWJvbC5pdGVyYXRvcl0oKSkpO1xuICAgIH07XG5cbiAgICBjb25zdCBidWZmZXJzOiBBc3luY0l0ZXJhYmxlPEFycmF5QnVmZmVyVmlld0lucHV0PiA9XG4gICAgICAgICAgICAgICAgICAgICAgICAodHlwZW9mIHNvdXJjZSA9PT0gJ3N0cmluZycpID8gd3JhcChzb3VyY2UpIC8vIGlmIHN0cmluZywgd3JhcCBpbiBhbiBBc3luY0l0ZXJhYmxlSXRlcmF0b3JcbiAgICAgICAgICAgICAgICAgICAgICA6IChBcnJheUJ1ZmZlci5pc1ZpZXcoc291cmNlKSkgPyB3cmFwKHNvdXJjZSkgLy8gaWYgVHlwZWRBcnJheSwgd3JhcCBpbiBhbiBBc3luY0l0ZXJhYmxlSXRlcmF0b3JcbiAgICAgICAgICAgICAgICAgICA6IChzb3VyY2UgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgPyB3cmFwKHNvdXJjZSkgLy8gaWYgQXJyYXlCdWZmZXIsIHdyYXAgaW4gYW4gQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXG4gICAgICAgICAgICAgOiAoc291cmNlIGluc3RhbmNlb2YgU2hhcmVkQXJyYXlCdWZmZXIpID8gd3JhcChzb3VyY2UpIC8vIGlmIFNoYXJlZEFycmF5QnVmZmVyLCB3cmFwIGluIGFuIEFzeW5jSXRlcmFibGVJdGVyYXRvclxuICAgICAgICAgIDogaXNJdGVyYWJsZTxBcnJheUJ1ZmZlclZpZXdJbnB1dD4oc291cmNlKSA/IGVtaXQoc291cmNlKSAvLyBJZiBJdGVyYWJsZSwgd3JhcCBpbiBhbiBBc3luY0l0ZXJhYmxlSXRlcmF0b3IgYW5kIGNvbXBvc2UgdGhlIGBuZXh0YCB2YWx1ZXNcbiAgICA6ICFpc0FzeW5jSXRlcmFibGU8QXJyYXlCdWZmZXJWaWV3SW5wdXQ+KHNvdXJjZSkgPyB3cmFwKHNvdXJjZSkgLy8gSWYgbm90IGFuIEFzeW5jSXRlcmFibGUsIHRyZWF0IGFzIGEgc2VudGluZWwgYW5kIHdyYXAgaW4gYW4gQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogc291cmNlOyAvLyBvdGhlcndpc2UgaWYgQXN5bmNJdGVyYWJsZSwgdXNlIGl0XG5cbiAgICB5aWVsZCogcHVtcCgoYXN5bmMgZnVuY3Rpb24qIChpdCkge1xuICAgICAgICBsZXQgcjogSXRlcmF0b3JSZXN1bHQ8YW55PiA9IDxhbnk+IG51bGw7XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHIgPSBhd2FpdCBpdC5uZXh0KHlpZWxkIHRvQXJyYXlCdWZmZXJWaWV3KEFycmF5Q3RvciwgcikpO1xuICAgICAgICB9IHdoaWxlICghci5kb25lKTtcbiAgICB9KShidWZmZXJzW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpKSk7XG59XG5cbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDhBcnJheUFzeW5jSXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yKEludDhBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvSW50MTZBcnJheUFzeW5jSXRlcmF0b3IgPSAoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3JJbnB1dCkgPT4gdG9BcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9yKEludDE2QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b0ludDMyQXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihJbnQzMkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9VaW50OEFycmF5QXN5bmNJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoVWludDhBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDE2QXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihVaW50MTZBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvVWludDMyQXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihVaW50MzJBcnJheSwgaW5wdXQpO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IGNvbnN0IHRvRmxvYXQzMkFycmF5QXN5bmNJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoRmxvYXQzMkFycmF5LCBpbnB1dCk7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3QgdG9GbG9hdDY0QXJyYXlBc3luY0l0ZXJhdG9yID0gKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdBc3luY0l0ZXJhdG9ySW5wdXQpID0+IHRvQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcihGbG9hdDY0QXJyYXksIGlucHV0KTtcbi8qKiBAaWdub3JlICovIGV4cG9ydCBjb25zdCB0b1VpbnQ4Q2xhbXBlZEFycmF5QXN5bmNJdGVyYXRvciA9IChpbnB1dDogQXJyYXlCdWZmZXJWaWV3QXN5bmNJdGVyYXRvcklucHV0KSA9PiB0b0FycmF5QnVmZmVyVmlld0FzeW5jSXRlcmF0b3IoVWludDhDbGFtcGVkQXJyYXksIGlucHV0KTtcblxuLyoqXG4gKiBAaWdub3JlXG4gKi9cbmZ1bmN0aW9uIGRlY29kZVV0ZjgoY2h1bms6IHN0cmluZykge1xuICAgIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoY2h1bmsubGVuZ3RoKTtcbiAgICBmb3IgKGxldCBpID0gLTEsIG4gPSBjaHVuay5sZW5ndGg7ICsraSA8IG47KSB7XG4gICAgICAgIGJ5dGVzW2ldID0gY2h1bmsuY2hhckNvZGVBdChpKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ5dGVzO1xufVxuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlYmFzZVZhbHVlT2Zmc2V0cyhvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIHZhbHVlT2Zmc2V0czogSW50MzJBcnJheSkge1xuICAgIC8vIElmIHdlIGhhdmUgYSBub24temVybyBvZmZzZXQsIGNyZWF0ZSBhIG5ldyBvZmZzZXRzIGFycmF5IHdpdGggdGhlIHZhbHVlc1xuICAgIC8vIHNoaWZ0ZWQgYnkgdGhlIHN0YXJ0IG9mZnNldCwgc3VjaCB0aGF0IHRoZSBuZXcgc3RhcnQgb2Zmc2V0IGlzIDBcbiAgICBpZiAob2Zmc2V0ICE9PSAwKSB7XG4gICAgICAgIHZhbHVlT2Zmc2V0cyA9IHZhbHVlT2Zmc2V0cy5zbGljZSgwLCBsZW5ndGggKyAxKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IC0xOyArK2kgPD0gbGVuZ3RoOykge1xuICAgICAgICAgICAgdmFsdWVPZmZzZXRzW2ldICs9IG9mZnNldDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdmFsdWVPZmZzZXRzO1xufVxuIl19
