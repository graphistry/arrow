"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const bit_1 = require("./bit");
const text_encoding_utf_8_1 = require("text-encoding-utf-8");
const writeNumeric64Value = writeFixedWidthValue.bind(null, 64);
const writeNumeric128Value = writeFixedWidthValue.bind(null, 128);
const utf8Encoder = new text_encoding_utf_8_1.TextEncoder();
const stride1Encode = writeValidityLayout.bind(null, writeFixedWidthLayoutWithStride.bind(null, 1));
const stride1FixedWidth = writeFixedWidthLayout.bind(null, writeValidityLayout.bind(null, stride1Encode));
const stride2FixedWidth = writeFixedWidthLayout.bind(null, writeValidityLayout.bind(null, writeFixedWidthLayoutWithStride.bind(null, 2)));
const stride4FixedWidth = writeFixedWidthLayout.bind(null, writeValidityLayout.bind(null, writeFixedWidthLayoutWithStride.bind(null, 4)));
exports.writeBools = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeBooleanValue), Uint8Array);
exports.writeInt8s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Int8Array);
exports.writeInt16s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Int16Array);
exports.writeInt32s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Int32Array);
exports.writeInt64s = writeTypedLayout.bind(null, stride2FixedWidth.bind(null, writeNumeric64Value), Int32Array);
exports.writeUint8s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Uint8Array);
exports.writeUint16s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Uint16Array);
exports.writeUint32s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Uint32Array);
exports.writeUint64s = writeTypedLayout.bind(null, stride2FixedWidth.bind(null, writeNumeric64Value), Uint32Array);
exports.writeDecimals = writeTypedLayout.bind(null, stride4FixedWidth.bind(null, writeNumeric128Value), Uint32Array);
exports.writeFloat32s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Float32Array);
exports.writeFloat64s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Float64Array);
exports.writeVariableWidth = writeVariableWidthLayout.bind(null, stride1Encode);
exports.writeBinary = writeTypedLayout.bind(null, exports.writeVariableWidth.bind(null, writeBinaryValue));
exports.writeUtf8s = writeTypedLayout.bind(null, exports.writeVariableWidth.bind(null, writeUtf8Value), Uint8Array);
exports.writeDictionaryEncoded = writeDictionaryLayout.bind(null, stride1Encode);
exports.writeDictionaryEncodedBools = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeBooleanValue), Uint8Array);
exports.writeDictionaryEncodedInt8s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Int8Array);
exports.writeDictionaryEncodedInt16s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Int16Array);
exports.writeDictionaryEncodedInt32s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Int32Array);
exports.writeDictionaryEncodedInt64s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride2FixedWidth, writeNumeric64Value), Int32Array);
exports.writeDictionaryEncodedUint8s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Uint8Array);
exports.writeDictionaryEncodedUint16s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Uint16Array);
exports.writeDictionaryEncodedUint32s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Uint32Array);
exports.writeDictionaryEncodedUint64s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride2FixedWidth, writeNumeric64Value), Uint32Array);
exports.writeDictionaryEncodedDecimals = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride4FixedWidth, writeNumeric128Value), Uint32Array);
exports.writeDictionaryEncodedFloat32s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Float32Array);
exports.writeDictionaryEncodedFloat64s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Float64Array);
exports.writeDictionaryEncodedVariableWidth = writeDictionaryLayout.bind(null, exports.writeVariableWidth);
exports.writeDictionaryEncodedBinary = writeTypedLayout.bind(null, exports.writeDictionaryEncodedVariableWidth.bind(null, writeBinaryValue));
exports.writeDictionaryEncodedUtf8s = writeTypedLayout.bind(null, exports.writeDictionaryEncodedVariableWidth.bind(null, writeUtf8Value), Uint8Array);
function writeFixedWidthLayoutWithStride(stride, writeValue, values) {
    let index = -stride;
    const data = [];
    const length = values.length;
    while ((index += stride) < length) {
        writeValue(values, data, index);
    }
    return { data: data };
}
function writeFixedWidthLayout(writeLayout, writeValue, values, nulls) {
    return writeLayout(writeValue, values, nulls);
}
function writeValidityLayout(writeLayout, writeValue, values, nulls) {
    let nullCount = 0;
    let nullsLength = nulls && nulls.length || 0;
    let validity = new Uint8Array(bit_1.align(values.length >>> 3, 8)).fill(255);
    return Object.assign({}, writeLayout(writeValueOrValidity, values), { nullCount, validity: (nullCount > 0 && validity) || new Uint8Array(0) });
    function writeValueOrValidity(src, dst, index) {
        writeValue(src, dst, index);
        let i = -1, x = src[index];
        let isNull = x === null || x === undefined;
        while (!isNull && ++i < nullsLength) {
            isNull = x === nulls[i];
        }
        if (isNull) {
            nullCount++;
            validity[index >> 3] &= ~(1 << (index % 8));
        }
    }
}
function writeVariableWidthLayout(writeLayout, writeValue, values, nulls) {
    let offsets = [0], offsetsIndex = 0;
    return Object.assign({}, writeLayout(writeValueAndOffset, values, nulls), { offsets });
    function writeValueAndOffset(src, dst, index) {
        if (!writeValue(src, dst, index)) {
            offsets[++offsetsIndex] = dst.length;
        }
    }
}
function writeDictionaryLayout(writeLayout, writeValue, values, nulls) {
    let keys = [], keysIndex = 0, keysMap = Object.create(null);
    return Object.assign({}, writeLayout(writeKeysOrValues, values, nulls), { keys });
    function writeKeysOrValues(src, dst, index) {
        const x = src[index];
        if (x in keysMap) {
            return (keys[index] = keysMap[x]) || true;
        }
        else if (!writeValue(src, dst, index)) {
            keys[index] = keysMap[x] = keysIndex++;
        }
    }
}
function writeTypedLayout(writeBuffers, ArrayBufferView, values, nulls) {
    const result = writeBuffers(values, nulls);
    result.data = new ArrayBufferView(result.data);
    return result;
}
function writeBooleanValue(src, dst, index) {
    if (src[index]) {
        let i = index >>> 3;
        let b = dst[i] || 0;
        dst[i] = b | 1 << (index % 8);
    }
}
function writeNumericValue(src, dst, index) {
    dst[index] = +src[index];
}
function writeFixedWidthValue(bitWidth, src, dst, index) {
    const bytesLen = bitWidth / 32;
    for (let i = -1; ++i < bytesLen;) {
        dst[index + i] = src[index + i];
    }
}
function writeUtf8Value(src, dst, index) {
    dst.push(...utf8Encoder.encode(src[index]));
}
function writeBinaryValue(src, dst, index) {
    dst.push(...src[index]);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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O0FBQ2hELENBQUM7QUFFRCwwQkFBMEIsR0FBZ0MsRUFBRSxHQUFhLEVBQUUsS0FBYTtJQUNwRixHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDNUIsQ0FBQyIsImZpbGUiOiJ1dGlsL2xheW91dC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBhbGlnbiB9IGZyb20gJy4vYml0JztcbmltcG9ydCB7IFRleHRFbmNvZGVyIH0gZnJvbSAndGV4dC1lbmNvZGluZy11dGYtOCc7XG5pbXBvcnQgeyBUeXBlZEFycmF5Q29uc3RydWN0b3IsIFR5cGVkQXJyYXkgfSBmcm9tICcuLi90eXBlJztcblxuZXhwb3J0IHR5cGUgTnVsbGFibGVMYXlvdXQgPSB7IG51bGxDb3VudDogbnVtYmVyLCB2YWxpZGl0eTogVWludDhBcnJheSB9O1xuZXhwb3J0IHR5cGUgQnVmZmVyTGF5b3V0PFRBcnJheSA9IEFycmF5TGlrZTxudW1iZXI+PiA9IHsgZGF0YTogVEFycmF5IH07XG5leHBvcnQgdHlwZSBEaWN0aW9uYXJ5TGF5b3V0PFRBcnJheSA9IEFycmF5TGlrZTxudW1iZXI+PiA9IHsgZGF0YTogVEFycmF5LCBrZXlzOiBudW1iZXJbXSB9O1xuZXhwb3J0IHR5cGUgVmFyaWFibGVXaWR0aExheW91dDxUQXJyYXkgPSBBcnJheUxpa2U8bnVtYmVyPj4gPSB7IGRhdGE6IFRBcnJheSwgb2Zmc2V0czogbnVtYmVyW10gfTtcbmV4cG9ydCB0eXBlIFZhcmlhYmxlV2lkdGhEaWN0aW9uYXJ5TGF5b3V0PFRBcnJheSA9IEFycmF5TGlrZTxudW1iZXI+PiA9IHsgZGF0YTogVEFycmF5LCBrZXlzOiBudW1iZXJbXSwgb2Zmc2V0czogbnVtYmVyW10gfTtcblxuZXhwb3J0IHR5cGUgdmFsdWVzPFQsIFROdWxsPiA9IEFycmF5TGlrZTxUIHwgVE51bGwgfCBudWxsIHwgdW5kZWZpbmVkPjtcbmV4cG9ydCB0eXBlIEJ1ZmZlclZhbHVlV3JpdGVyPFQ+ID0gKHNyYzogQXJyYXlMaWtlPFQ+LCBkc3Q6IG51bWJlcltdLCBpbmRleDogbnVtYmVyKSA9PiBib29sZWFuIHwgdm9pZDtcbmV4cG9ydCB0eXBlIEJ1ZmZlcldyaXRlcjxULCBUTnVsbD4gPSAodmFsdWVzOiB2YWx1ZXM8VCwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDtcbmV4cG9ydCB0eXBlIEJ1ZmZlckxheW91dFdyaXRlcjxULCBUTnVsbD4gPSAod3JpdGU6IEJ1ZmZlclZhbHVlV3JpdGVyPFQ+LCB2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gQnVmZmVyTGF5b3V0O1xuXG5jb25zdCB3cml0ZU51bWVyaWM2NFZhbHVlID0gd3JpdGVGaXhlZFdpZHRoVmFsdWUuYmluZChudWxsLCA2NCk7XG5jb25zdCB3cml0ZU51bWVyaWMxMjhWYWx1ZSA9IHdyaXRlRml4ZWRXaWR0aFZhbHVlLmJpbmQobnVsbCwgMTI4KTtcbmNvbnN0IHV0ZjhFbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCkgYXMgeyBlbmNvZGU6IChzOiBzdHJpbmcpID0+IFVpbnQ4QXJyYXkgfTtcblxuY29uc3Qgc3RyaWRlMUVuY29kZSA9IHdyaXRlVmFsaWRpdHlMYXlvdXQuYmluZChudWxsLCB3cml0ZUZpeGVkV2lkdGhMYXlvdXRXaXRoU3RyaWRlLmJpbmQobnVsbCwgMSkpO1xuY29uc3Qgc3RyaWRlMUZpeGVkV2lkdGggPSB3cml0ZUZpeGVkV2lkdGhMYXlvdXQuYmluZChudWxsLCB3cml0ZVZhbGlkaXR5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUVuY29kZSkpO1xuY29uc3Qgc3RyaWRlMkZpeGVkV2lkdGggPSB3cml0ZUZpeGVkV2lkdGhMYXlvdXQuYmluZChudWxsLCB3cml0ZVZhbGlkaXR5TGF5b3V0LmJpbmQobnVsbCwgd3JpdGVGaXhlZFdpZHRoTGF5b3V0V2l0aFN0cmlkZS5iaW5kKG51bGwsIDIpKSk7XG5jb25zdCBzdHJpZGU0Rml4ZWRXaWR0aCA9IHdyaXRlRml4ZWRXaWR0aExheW91dC5iaW5kKG51bGwsIHdyaXRlVmFsaWRpdHlMYXlvdXQuYmluZChudWxsLCB3cml0ZUZpeGVkV2lkdGhMYXlvdXRXaXRoU3RyaWRlLmJpbmQobnVsbCwgNCkpKTtcblxuZXhwb3J0IGNvbnN0IHdyaXRlQm9vbHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGguYmluZChudWxsLCB3cml0ZUJvb2xlYW5WYWx1ZSksIFVpbnQ4QXJyYXkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxib29sZWFuIHwgbnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gQnVmZmVyTGF5b3V0PFVpbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlSW50OHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGguYmluZChudWxsLCB3cml0ZU51bWVyaWNWYWx1ZSksIEludDhBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8SW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZUludDE2cyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgSW50MTZBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gQnVmZmVyTGF5b3V0PEludDE2QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlSW50MzJzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLmJpbmQobnVsbCwgd3JpdGVOdW1lcmljVmFsdWUpLCBJbnQzMkFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8SW50MzJBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVJbnQ2NHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMkZpeGVkV2lkdGguYmluZChudWxsLCB3cml0ZU51bWVyaWM2NFZhbHVlKSwgSW50MzJBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxJbnQzMkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZVVpbnQ4cyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgVWludDhBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gQnVmZmVyTGF5b3V0PFVpbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlVWludDE2cyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgVWludDE2QXJyYXkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8VWludDE2QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlVWludDMycyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgVWludDMyQXJyYXkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8VWludDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlVWludDY0cyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUyRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpYzY0VmFsdWUpLCBVaW50MzJBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8VWludDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGVjaW1hbHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlNEZpeGVkV2lkdGguYmluZChudWxsLCB3cml0ZU51bWVyaWMxMjhWYWx1ZSksIFVpbnQzMkFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8VWludDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRmxvYXQzMnMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGguYmluZChudWxsLCB3cml0ZU51bWVyaWNWYWx1ZSksIEZsb2F0MzJBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8RmxvYXQzMkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZUZsb2F0NjRzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLmJpbmQobnVsbCwgd3JpdGVOdW1lcmljVmFsdWUpLCBGbG9hdDY0QXJyYXkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gQnVmZmVyTGF5b3V0PEZsb2F0NjRBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVWYXJpYWJsZVdpZHRoID0gd3JpdGVWYXJpYWJsZVdpZHRoTGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUVuY29kZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VCwgVE51bGw+KHdyaXRlVmFsdWU6IEJ1ZmZlclZhbHVlV3JpdGVyPFQ+LCB2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gVmFyaWFibGVXaWR0aExheW91dDxVaW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZUJpbmFyeSA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZVZhcmlhYmxlV2lkdGguYmluZChudWxsLCB3cml0ZUJpbmFyeVZhbHVlKSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8SXRlcmFibGU8bnVtYmVyPiwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IFZhcmlhYmxlV2lkdGhMYXlvdXQ8VWludDhBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVVdGY4cyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZVZhcmlhYmxlV2lkdGguYmluZChudWxsLCB3cml0ZVV0ZjhWYWx1ZSksIFVpbnQ4QXJyYXkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPHN0cmluZywgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IFZhcmlhYmxlV2lkdGhMYXlvdXQ8VWludDhBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZCA9IHdyaXRlRGljdGlvbmFyeUxheW91dC5iaW5kKG51bGwsIHN0cmlkZTFFbmNvZGUpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VCwgVE51bGw+KHdyaXRlVmFsdWU6IEJ1ZmZlclZhbHVlV3JpdGVyPFQ+LCB2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxVaW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkQm9vbHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlQm9vbGVhblZhbHVlKSwgVWludDhBcnJheSkgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8Ym9vbGVhbiB8IG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IERpY3Rpb25hcnlMYXlvdXQ8VWludDhBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZEludDhzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlRGljdGlvbmFyeUxheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLCB3cml0ZU51bWVyaWNWYWx1ZSksIEludDhBcnJheSkgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IERpY3Rpb25hcnlMYXlvdXQ8SW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkSW50MTZzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlRGljdGlvbmFyeUxheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLCB3cml0ZU51bWVyaWNWYWx1ZSksIEludDE2QXJyYXkpICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxJbnQxNkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkSW50MzJzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlRGljdGlvbmFyeUxheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLCB3cml0ZU51bWVyaWNWYWx1ZSksIEludDMyQXJyYXkpICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxJbnQzMkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkSW50NjRzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlRGljdGlvbmFyeUxheW91dC5iaW5kKG51bGwsIHN0cmlkZTJGaXhlZFdpZHRoLCB3cml0ZU51bWVyaWM2NFZhbHVlKSwgSW50MzJBcnJheSkgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxJbnQzMkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkVWludDhzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlRGljdGlvbmFyeUxheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLCB3cml0ZU51bWVyaWNWYWx1ZSksIFVpbnQ4QXJyYXkpICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxVaW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkVWludDE2cyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZURpY3Rpb25hcnlMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aCwgd3JpdGVOdW1lcmljVmFsdWUpLCBVaW50MTZBcnJheSkgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxVaW50MTZBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZFVpbnQzMnMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgVWludDMyQXJyYXkpICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IERpY3Rpb25hcnlMYXlvdXQ8VWludDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRVaW50NjRzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlRGljdGlvbmFyeUxheW91dC5iaW5kKG51bGwsIHN0cmlkZTJGaXhlZFdpZHRoLCB3cml0ZU51bWVyaWM2NFZhbHVlKSwgVWludDMyQXJyYXkpICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PFVpbnQzMkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkRGVjaW1hbHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlNEZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpYzEyOFZhbHVlKSwgVWludDMyQXJyYXkpIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxVaW50MzJBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZEZsb2F0MzJzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlRGljdGlvbmFyeUxheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLCB3cml0ZU51bWVyaWNWYWx1ZSksIEZsb2F0MzJBcnJheSkgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IERpY3Rpb25hcnlMYXlvdXQ8RmxvYXQzMkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkRmxvYXQ2NHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgRmxvYXQ2NEFycmF5KSAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxGbG9hdDY0QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRWYXJpYWJsZVdpZHRoID0gd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgd3JpdGVWYXJpYWJsZVdpZHRoKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFQsIFROdWxsPih3cml0ZVZhbHVlOiBCdWZmZXJWYWx1ZVdyaXRlcjxUPiwgdmFsdWVzOiB2YWx1ZXM8VCwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IFZhcmlhYmxlV2lkdGhEaWN0aW9uYXJ5TGF5b3V0PFVpbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRCaW5hcnkgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZFZhcmlhYmxlV2lkdGguYmluZChudWxsLCB3cml0ZUJpbmFyeVZhbHVlKSkgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxJdGVyYWJsZTxudW1iZXI+LCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gVmFyaWFibGVXaWR0aERpY3Rpb25hcnlMYXlvdXQ8VWludDhBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZFV0ZjhzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlRGljdGlvbmFyeUVuY29kZWRWYXJpYWJsZVdpZHRoLmJpbmQobnVsbCwgd3JpdGVVdGY4VmFsdWUpLCBVaW50OEFycmF5KSAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPHN0cmluZywgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IFZhcmlhYmxlV2lkdGhEaWN0aW9uYXJ5TGF5b3V0PFVpbnQ4QXJyYXk+O1xuXG5mdW5jdGlvbiB3cml0ZUZpeGVkV2lkdGhMYXlvdXRXaXRoU3RyaWRlPFQsIFROdWxsPihcbiAgICBzdHJpZGU6IG51bWJlcixcbiAgICB3cml0ZVZhbHVlOiBCdWZmZXJWYWx1ZVdyaXRlcjxUPixcbiAgICB2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD5cbikge1xuICAgIGxldCBpbmRleCA9IC1zdHJpZGU7XG4gICAgY29uc3QgZGF0YSA9IFtdIGFzIG51bWJlcltdO1xuICAgIGNvbnN0IGxlbmd0aCA9IHZhbHVlcy5sZW5ndGg7XG4gICAgd2hpbGUgKChpbmRleCArPSBzdHJpZGUpIDwgbGVuZ3RoKSB7XG4gICAgICAgIHdyaXRlVmFsdWUodmFsdWVzIGFzIEFycmF5TGlrZTxUPiwgZGF0YSwgaW5kZXgpO1xuICAgIH1cbiAgICByZXR1cm4geyBkYXRhOiBkYXRhIGFzIEFycmF5TGlrZTxudW1iZXI+IH07XG59XG5cbmZ1bmN0aW9uIHdyaXRlRml4ZWRXaWR0aExheW91dDxULCBUTnVsbD4oXG4gICAgd3JpdGVMYXlvdXQ6IEJ1ZmZlckxheW91dFdyaXRlcjxULCBUTnVsbD4sXG4gICAgd3JpdGVWYWx1ZTogQnVmZmVyVmFsdWVXcml0ZXI8VD4sXG4gICAgdmFsdWVzOiB2YWx1ZXM8VCwgVE51bGw+LFxuICAgIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPlxuKSB7XG4gICAgcmV0dXJuIHdyaXRlTGF5b3V0KHdyaXRlVmFsdWUsIHZhbHVlcywgbnVsbHMpO1xufVxuXG5mdW5jdGlvbiB3cml0ZVZhbGlkaXR5TGF5b3V0PFQsIFROdWxsPihcbiAgICB3cml0ZUxheW91dDogQnVmZmVyTGF5b3V0V3JpdGVyPFQsIFROdWxsPixcbiAgICB3cml0ZVZhbHVlOiBCdWZmZXJWYWx1ZVdyaXRlcjxUPixcbiAgICB2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD4sXG4gICAgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+XG4pIHtcbiAgICBsZXQgbnVsbENvdW50ID0gMDtcbiAgICBsZXQgbnVsbHNMZW5ndGggPSBudWxscyAmJiBudWxscy5sZW5ndGggfHwgMDtcbiAgICBsZXQgdmFsaWRpdHkgPSBuZXcgVWludDhBcnJheShhbGlnbih2YWx1ZXMubGVuZ3RoID4+PiAzLCA4KSkuZmlsbCgyNTUpO1xuICAgIHJldHVybiB7XG4gICAgICAgIC4uLndyaXRlTGF5b3V0KHdyaXRlVmFsdWVPclZhbGlkaXR5LCB2YWx1ZXMpLFxuICAgICAgICBudWxsQ291bnQsIHZhbGlkaXR5OiAobnVsbENvdW50ID4gMCAmJiB2YWxpZGl0eSkgfHwgbmV3IFVpbnQ4QXJyYXkoMClcbiAgICB9IGFzIEJ1ZmZlckxheW91dCAmIE51bGxhYmxlTGF5b3V0O1xuICAgIGZ1bmN0aW9uIHdyaXRlVmFsdWVPclZhbGlkaXR5KHNyYzogQXJyYXlMaWtlPFQ+LCBkc3Q6IG51bWJlcltdLCBpbmRleDogbnVtYmVyKSB7XG4gICAgICAgIHdyaXRlVmFsdWUoc3JjLCBkc3QsIGluZGV4KTtcbiAgICAgICAgbGV0IGkgPSAtMSwgeCA9IHNyY1tpbmRleF0gYXMgVCB8IFROdWxsO1xuICAgICAgICBsZXQgaXNOdWxsID0geCA9PT0gbnVsbCB8fCB4ID09PSB1bmRlZmluZWQ7XG4gICAgICAgIHdoaWxlICghaXNOdWxsICYmICsraSA8IG51bGxzTGVuZ3RoKSB7XG4gICAgICAgICAgICBpc051bGwgPSB4ID09PSBudWxscyFbaV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzTnVsbCkge1xuICAgICAgICAgICAgbnVsbENvdW50Kys7XG4gICAgICAgICAgICB2YWxpZGl0eVtpbmRleCA+PiAzXSAmPSB+KDEgPDwgKGluZGV4ICUgOCkpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiB3cml0ZVZhcmlhYmxlV2lkdGhMYXlvdXQ8VCwgVE51bGw+KFxuICAgIHdyaXRlTGF5b3V0OiBCdWZmZXJMYXlvdXRXcml0ZXI8VCwgVE51bGw+LFxuICAgIHdyaXRlVmFsdWU6IEJ1ZmZlclZhbHVlV3JpdGVyPFQ+LFxuICAgIHZhbHVlczogdmFsdWVzPFQsIFROdWxsPixcbiAgICBudWxscz86IEFycmF5TGlrZTxUTnVsbD5cbikge1xuICAgIGxldCBvZmZzZXRzID0gWzBdLCBvZmZzZXRzSW5kZXggPSAwO1xuICAgIHJldHVybiB7IC4uLndyaXRlTGF5b3V0KHdyaXRlVmFsdWVBbmRPZmZzZXQsIHZhbHVlcywgbnVsbHMpLCBvZmZzZXRzIH0gYXMgVmFyaWFibGVXaWR0aExheW91dDtcbiAgICBmdW5jdGlvbiB3cml0ZVZhbHVlQW5kT2Zmc2V0KHNyYzogQXJyYXlMaWtlPFQ+LCBkc3Q6IG51bWJlcltdLCBpbmRleDogbnVtYmVyKSB7XG4gICAgICAgIGlmICghd3JpdGVWYWx1ZShzcmMsIGRzdCwgaW5kZXgpKSB7XG4gICAgICAgICAgICBvZmZzZXRzWysrb2Zmc2V0c0luZGV4XSA9IGRzdC5sZW5ndGg7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIHdyaXRlRGljdGlvbmFyeUxheW91dDxULCBUTnVsbD4oXG4gICAgd3JpdGVMYXlvdXQ6IEJ1ZmZlckxheW91dFdyaXRlcjxULCBUTnVsbD4sXG4gICAgd3JpdGVWYWx1ZTogQnVmZmVyVmFsdWVXcml0ZXI8VD4sXG4gICAgdmFsdWVzOiB2YWx1ZXM8VCwgVE51bGw+LFxuICAgIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPlxuKSB7XG4gICAgbGV0IGtleXMgPSBbXSBhcyBudW1iZXJbXSwga2V5c0luZGV4ID0gMCwga2V5c01hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgcmV0dXJuIHsgLi4ud3JpdGVMYXlvdXQod3JpdGVLZXlzT3JWYWx1ZXMsIHZhbHVlcywgbnVsbHMpLCBrZXlzIH07XG4gICAgZnVuY3Rpb24gd3JpdGVLZXlzT3JWYWx1ZXMoc3JjOiBBcnJheUxpa2U8VD4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgeDogYW55ID0gc3JjW2luZGV4XTtcbiAgICAgICAgaWYgKHggaW4ga2V5c01hcCkge1xuICAgICAgICAgICAgcmV0dXJuIChrZXlzW2luZGV4XSA9IGtleXNNYXBbeF0pIHx8IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoIXdyaXRlVmFsdWUoc3JjLCBkc3QsIGluZGV4KSkge1xuICAgICAgICAgICAga2V5c1tpbmRleF0gPSBrZXlzTWFwW3hdID0ga2V5c0luZGV4Kys7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIHdyaXRlVHlwZWRMYXlvdXQ8VCwgVE51bGwsIFRBcnJheSBleHRlbmRzIFR5cGVkQXJyYXk+KFxuICAgIHdyaXRlQnVmZmVyczogQnVmZmVyV3JpdGVyPFQsIFROdWxsPixcbiAgICBBcnJheUJ1ZmZlclZpZXc6IFR5cGVkQXJyYXlDb25zdHJ1Y3RvcjxUQXJyYXk+LFxuICAgIHZhbHVlczogdmFsdWVzPFQsIFROdWxsPixcbiAgICBudWxscz86IEFycmF5TGlrZTxUTnVsbD5cbikge1xuICAgIGNvbnN0IHJlc3VsdCA9IHdyaXRlQnVmZmVycyh2YWx1ZXMsIG51bGxzKTtcbiAgICByZXN1bHQuZGF0YSA9IG5ldyBBcnJheUJ1ZmZlclZpZXcocmVzdWx0LmRhdGEpO1xuICAgIHJldHVybiByZXN1bHQgYXMgQnVmZmVyTGF5b3V0PFRBcnJheT47XG59XG5cbmZ1bmN0aW9uIHdyaXRlQm9vbGVhblZhbHVlKHNyYzogQXJyYXlMaWtlPGJvb2xlYW4+LCBkc3Q6IG51bWJlcltdLCBpbmRleDogbnVtYmVyKSB7XG4gICAgaWYgKHNyY1tpbmRleF0pIHtcbiAgICAgICAgbGV0IGkgPSBpbmRleCA+Pj4gMztcbiAgICAgICAgbGV0IGIgPSBkc3RbaV0gfHwgMDtcbiAgICAgICAgZHN0W2ldID0gYiB8IDEgPDwgKGluZGV4ICUgOCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiB3cml0ZU51bWVyaWNWYWx1ZShzcmM6IEFycmF5TGlrZTxudW1iZXI+LCBkc3Q6IG51bWJlcltdLCBpbmRleDogbnVtYmVyKSB7XG4gICAgZHN0W2luZGV4XSA9ICtzcmNbaW5kZXhdO1xufVxuXG5mdW5jdGlvbiB3cml0ZUZpeGVkV2lkdGhWYWx1ZShiaXRXaWR0aDogbnVtYmVyLCBzcmM6IEFycmF5TGlrZTxudW1iZXI+LCBkc3Q6IG51bWJlcltdLCBpbmRleDogbnVtYmVyKSB7XG4gICAgY29uc3QgYnl0ZXNMZW4gPSBiaXRXaWR0aCAvIDMyO1xuICAgIGZvciAobGV0IGkgPSAtMTsgKytpIDwgYnl0ZXNMZW47KSB7XG4gICAgICAgIGRzdFtpbmRleCArIGldID0gc3JjW2luZGV4ICsgaV07XG4gICAgfVxufVxuXG5mdW5jdGlvbiB3cml0ZVV0ZjhWYWx1ZShzcmM6IEFycmF5TGlrZTxzdHJpbmc+LCBkc3Q6IG51bWJlcltdLCBpbmRleDogbnVtYmVyKSB7XG4gICAgZHN0LnB1c2goLi4udXRmOEVuY29kZXIuZW5jb2RlKHNyY1tpbmRleF0pKTtcbn1cblxuZnVuY3Rpb24gd3JpdGVCaW5hcnlWYWx1ZShzcmM6IEFycmF5TGlrZTxJdGVyYWJsZTxudW1iZXI+PiwgZHN0OiBudW1iZXJbXSwgaW5kZXg6IG51bWJlcikge1xuICAgIGRzdC5wdXNoKC4uLnNyY1tpbmRleF0pO1xufVxuIl19
