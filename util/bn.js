"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const buffer_1 = require("./buffer");
/** @ignore */
const BigNumNMixin = {
    toJSON() { return `"${bignumToString(this)}"`; },
    valueOf() { return bignumToNumber(this); },
    toString() { return bignumToString(this); },
    [Symbol.toPrimitive](hint) {
        if (hint === 'number') {
            return bignumToNumber(this);
        }
        /** @suppress {missingRequire} */
        return hint === 'string' || typeof BigInt !== 'function' ?
            bignumToString(this) : BigInt(bignumToString(this));
    }
};
/** @ignore */
const SignedBigNumNMixin = Object.assign({}, BigNumNMixin, { signed: true });
/** @ignore */
const UnsignedBigNumNMixin = Object.assign({}, BigNumNMixin, { signed: false });
/** @ignore */
class BN {
    constructor(input, signed = input instanceof Int32Array) {
        return BN.new(input, signed);
    }
    /** @nocollapse */
    static new(input, signed = (input instanceof Int8Array || input instanceof Int16Array || input instanceof Int32Array)) {
        return (signed === true) ? BN.signed(input) : BN.unsigned(input);
    }
    /** @nocollapse */
    static signed(input) {
        const Ctor = ArrayBuffer.isView(input) ? input.constructor : Int32Array;
        const { buffer, byteOffset, length } = buffer_1.toArrayBufferView(Ctor, input);
        const bn = new Ctor(buffer, byteOffset, length);
        return Object.assign(bn, SignedBigNumNMixin);
    }
    /** @nocollapse */
    static unsigned(input) {
        const Ctor = ArrayBuffer.isView(input) ? input.constructor : Uint32Array;
        const { buffer, byteOffset, length } = buffer_1.toArrayBufferView(Ctor, input);
        const bn = new Ctor(buffer, byteOffset, length);
        return Object.assign(bn, UnsignedBigNumNMixin);
    }
}
exports.BN = BN;
/** @ignore */
function bignumToNumber({ buffer, byteOffset, length }) {
    let int64 = 0;
    let words = new Uint32Array(buffer, byteOffset, length);
    for (let i = 0, n = words.length; i < n;) {
        int64 += words[i++] + (words[i++] * (i ** 32));
        // int64 += (words[i++] >>> 0) + (words[i++] * (i ** 32));
    }
    return int64;
}
/** @ignore */
function bignumToString({ buffer, byteOffset, length }) {
    let string = '', i = -1;
    let base64 = new Uint32Array(2);
    let base32 = new Uint16Array(buffer, byteOffset, length * 2);
    let checks = new Uint32Array((base32 = new Uint16Array(base32).reverse()).buffer);
    let n = base32.length - 1;
    do {
        for (base64[0] = base32[i = 0]; i < n;) {
            base32[i++] = base64[1] = base64[0] / 10;
            base64[0] = ((base64[0] - base64[1] * 10) << 16) + base32[i];
        }
        base32[i] = base64[1] = base64[0] / 10;
        base64[0] = base64[0] - base64[1] * 10;
        string = `${base64[0]}${string}`;
    } while (checks[0] || checks[1] || checks[2] || checks[3]);
    return string ? string : `0`;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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RyxDQUFDLENBQUMsQ0FBQztJQUN4QixJQUFJLE1BQU0sR0FBRyxJQUFJLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNoQyxJQUFJLE1BQU0sR0FBRyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztJQUM3RCxJQUFJLE1BQU0sR0FBRyxJQUFJLFdBQVcsQ0FBQyxDQUFDLE1BQU0sR0FBRyxJQUFJLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2xGLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBRTFCLEdBQUc7UUFDQyxLQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUc7WUFDcEMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDekMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNoRTtRQUNELE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUN2QyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDdkMsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sRUFBRSxDQUFDO0tBQ3BDLFFBQVEsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFO0lBRTNELE9BQU8sTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztBQUNqQyxDQUFDIiwiZmlsZSI6InV0aWwvYm4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4vLyBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbi8vIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4vLyByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4vLyB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4vLyBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Vcbi8vIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbi8vIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4vLyBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuLy8gS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4vLyBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4vLyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgdG9BcnJheUJ1ZmZlclZpZXcsIEFycmF5QnVmZmVyVmlld0lucHV0IH0gZnJvbSAnLi9idWZmZXInO1xuXG4vKiogQGlnbm9yZSAqL1xudHlwZSBCaWdOdW1BcnJheSA9IEludEFycmF5IHwgVWludEFycmF5O1xuLyoqIEBpZ25vcmUgKi9cbnR5cGUgSW50QXJyYXkgPSBJbnQ4QXJyYXkgfCBJbnQxNkFycmF5IHwgSW50MzJBcnJheTtcbi8qKiBAaWdub3JlICovXG50eXBlIFVpbnRBcnJheSA9IFVpbnQ4QXJyYXkgfCBVaW50MTZBcnJheSB8IFVpbnQzMkFycmF5IHwgVWludDhDbGFtcGVkQXJyYXk7XG5cbi8qKiBAaWdub3JlICovXG5jb25zdCBCaWdOdW1OTWl4aW4gPSB7XG4gICAgdG9KU09OKHRoaXM6IEJOPEJpZ051bUFycmF5PiwgKSB7IHJldHVybiBgXCIke2JpZ251bVRvU3RyaW5nKHRoaXMpfVwiYDsgfSxcbiAgICB2YWx1ZU9mKHRoaXM6IEJOPEJpZ051bUFycmF5PiwgKSB7IHJldHVybiBiaWdudW1Ub051bWJlcih0aGlzKTsgfSxcbiAgICB0b1N0cmluZyh0aGlzOiBCTjxCaWdOdW1BcnJheT4sICkgeyByZXR1cm4gYmlnbnVtVG9TdHJpbmcodGhpcyk7IH0sXG4gICAgW1N5bWJvbC50b1ByaW1pdGl2ZV08VCBleHRlbmRzIEJOPEJpZ051bUFycmF5Pj4odGhpczogVCwgaGludDogJ3N0cmluZycgfCAnbnVtYmVyJyB8ICdkZWZhdWx0Jykge1xuICAgICAgICBpZiAoaGludCA9PT0gJ251bWJlcicpIHsgcmV0dXJuIGJpZ251bVRvTnVtYmVyKHRoaXMpOyB9XG4gICAgICAgIC8qKiBAc3VwcHJlc3Mge21pc3NpbmdSZXF1aXJlfSAqL1xuICAgICAgICByZXR1cm4gaGludCA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIEJpZ0ludCAhPT0gJ2Z1bmN0aW9uJyA/XG4gICAgICAgICAgICBiaWdudW1Ub1N0cmluZyh0aGlzKSA6IEJpZ0ludChiaWdudW1Ub1N0cmluZyh0aGlzKSk7XG4gICAgfVxufTtcblxuLyoqIEBpZ25vcmUgKi9cbmNvbnN0IFNpZ25lZEJpZ051bU5NaXhpbjogYW55ID0gT2JqZWN0LmFzc2lnbih7fSwgQmlnTnVtTk1peGluLCB7IHNpZ25lZDogdHJ1ZSB9KTtcbi8qKiBAaWdub3JlICovXG5jb25zdCBVbnNpZ25lZEJpZ051bU5NaXhpbjogYW55ID0gT2JqZWN0LmFzc2lnbih7fSwgQmlnTnVtTk1peGluLCB7IHNpZ25lZDogZmFsc2UgfSk7XG5cbi8qKiBAaWdub3JlICovXG5leHBvcnQgY2xhc3MgQk48VCBleHRlbmRzIEJpZ051bUFycmF5PiB7XG4gICAgcHVibGljIHN0YXRpYyBuZXc8VCBleHRlbmRzIEJpZ051bUFycmF5PihpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQsIHNpZ25lZD86IGJvb2xlYW4pOiBUO1xuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgbmV3PFQgZXh0ZW5kcyBCaWdOdW1BcnJheT4oaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0LCBzaWduZWQgPSAoaW5wdXQgaW5zdGFuY2VvZiBJbnQ4QXJyYXkgfHwgaW5wdXQgaW5zdGFuY2VvZiBJbnQxNkFycmF5IHx8IGlucHV0IGluc3RhbmNlb2YgSW50MzJBcnJheSkpOiBUIHtcbiAgICAgICAgcmV0dXJuIChzaWduZWQgPT09IHRydWUpID8gQk4uc2lnbmVkKGlucHV0KSBhcyBUIDogQk4udW5zaWduZWQoaW5wdXQpIGFzIFQ7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgc2lnbmVkPFQgZXh0ZW5kcyBJbnRBcnJheT4oaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KTogVCB7XG4gICAgICAgIGNvbnN0IEN0b3I6IGFueSA9IEFycmF5QnVmZmVyLmlzVmlldyhpbnB1dCkgPyA8YW55PiBpbnB1dC5jb25zdHJ1Y3RvciA6IEludDMyQXJyYXk7XG4gICAgICAgIGNvbnN0IHsgYnVmZmVyLCBieXRlT2Zmc2V0LCBsZW5ndGggfSA9IHRvQXJyYXlCdWZmZXJWaWV3PFQ+KDxhbnk+IEN0b3IsIGlucHV0KSBhcyBUO1xuICAgICAgICBjb25zdCBibiA9IG5ldyBDdG9yKGJ1ZmZlciwgYnl0ZU9mZnNldCwgbGVuZ3RoKTtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oYm4sIFNpZ25lZEJpZ051bU5NaXhpbik7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgdW5zaWduZWQ8VCBleHRlbmRzIFVpbnRBcnJheT4oaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0KTogVCB7XG4gICAgICAgIGNvbnN0IEN0b3I6IGFueSA9IEFycmF5QnVmZmVyLmlzVmlldyhpbnB1dCkgPyA8YW55PiBpbnB1dC5jb25zdHJ1Y3RvciA6IFVpbnQzMkFycmF5O1xuICAgICAgICBjb25zdCB7IGJ1ZmZlciwgYnl0ZU9mZnNldCwgbGVuZ3RoIH0gPSB0b0FycmF5QnVmZmVyVmlldzxUPig8YW55PiBDdG9yLCBpbnB1dCkgYXMgVDtcbiAgICAgICAgY29uc3QgYm4gPSBuZXcgQ3RvcihidWZmZXIsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKGJuLCBVbnNpZ25lZEJpZ051bU5NaXhpbik7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCwgc2lnbmVkID0gaW5wdXQgaW5zdGFuY2VvZiBJbnQzMkFycmF5KSB7XG4gICAgICAgIHJldHVybiBCTi5uZXcoaW5wdXQsIHNpZ25lZCkgYXMgYW55O1xuICAgIH1cbn1cblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBpbnRlcmZhY2UgQk48VCBleHRlbmRzIEJpZ051bUFycmF5PiBleHRlbmRzIFR5cGVkQXJyYXlMaWtlPFQ+IHtcblxuICAgIG5ldzxUIGV4dGVuZHMgQXJyYXlCdWZmZXJWaWV3SW5wdXQ+KGJ1ZmZlcjogVCwgc2lnbmVkPzogYm9vbGVhbik6IFQ7XG5cbiAgICByZWFkb25seSBzaWduZWQ6IGJvb2xlYW47XG5cbiAgICBbU3ltYm9sLnRvU3RyaW5nVGFnXTpcbiAgICAgICAgJ0ludDhBcnJheScgICAgICAgICB8XG4gICAgICAgICdJbnQxNkFycmF5JyAgICAgICAgfFxuICAgICAgICAnSW50MzJBcnJheScgICAgICAgIHxcbiAgICAgICAgJ1VpbnQ4QXJyYXknICAgICAgICB8XG4gICAgICAgICdVaW50MTZBcnJheScgICAgICAgfFxuICAgICAgICAnVWludDMyQXJyYXknICAgICAgIHxcbiAgICAgICAgJ1VpbnQ4Q2xhbXBlZEFycmF5JztcblxuICAgIC8qKlxuICAgICAqIENvbnZlcnQgdGhlIGJ5dGVzIHRvIHRoZWlyIChwb3NpdGl2ZSkgZGVjaW1hbCByZXByZXNlbnRhdGlvbiBmb3IgcHJpbnRpbmdcbiAgICAgKi9cbiAgICB0b1N0cmluZygpOiBzdHJpbmc7XG4gICAgLyoqXG4gICAgICogRG93bi1jb252ZXJ0IHRoZSBieXRlcyB0byBhIDUzLWJpdCBwcmVjaXNpb24gaW50ZWdlci4gSW52b2tlZCBieSBKUyBmb3JcbiAgICAgKiBhcml0aG1hdGljIG9wZXJhdG9ycywgbGlrZSBgK2AuIEVhc3kgKGFuZCB1bnNhZmUpIHdheSB0byBjb252ZXJ0IEJOIHRvXG4gICAgICogbnVtYmVyIHZpYSBgK2JuX2luc3RgXG4gICAgICovXG4gICAgdmFsdWVPZigpOiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBieXRlcy4gTXVzdCBiZSB3cmFwcGVkIGluIGRvdWJsZS1xdW90ZXMsXG4gICAgICogc28gaXQncyBjb21wYXRpYmxlIHdpdGggSlNPTi5zdHJpbmdpZnkoKS5cbiAgICAgKi9cbiAgICB0b0pTT04oKTogc3RyaW5nO1xuICAgIFtTeW1ib2wudG9QcmltaXRpdmVdKGhpbnQ6IGFueSk6IG51bWJlciB8IHN0cmluZyB8IGJpZ2ludDtcbn1cblxuLyoqIEBpZ25vcmUgKi9cbmZ1bmN0aW9uIGJpZ251bVRvTnVtYmVyPFQgZXh0ZW5kcyBCTjxCaWdOdW1BcnJheT4+KHsgYnVmZmVyLCBieXRlT2Zmc2V0LCBsZW5ndGggfTogVCkge1xuICAgIGxldCBpbnQ2NCA9IDA7XG4gICAgbGV0IHdvcmRzID0gbmV3IFVpbnQzMkFycmF5KGJ1ZmZlciwgYnl0ZU9mZnNldCwgbGVuZ3RoKTtcbiAgICBmb3IgKGxldCBpID0gMCwgbiA9IHdvcmRzLmxlbmd0aDsgaSA8IG47KSB7XG4gICAgICAgIGludDY0ICs9IHdvcmRzW2krK10gKyAod29yZHNbaSsrXSAqIChpICoqIDMyKSk7XG4gICAgICAgIC8vIGludDY0ICs9ICh3b3Jkc1tpKytdID4+PiAwKSArICh3b3Jkc1tpKytdICogKGkgKiogMzIpKTtcbiAgICB9XG4gICAgcmV0dXJuIGludDY0O1xufVxuXG4vKiogQGlnbm9yZSAqL1xuZnVuY3Rpb24gYmlnbnVtVG9TdHJpbmc8VCBleHRlbmRzIEJOPEJpZ051bUFycmF5Pj4oeyBidWZmZXIsIGJ5dGVPZmZzZXQsIGxlbmd0aCB9OiBUKSB7XG5cbiAgICBsZXQgc3RyaW5nID0gJycsIGkgPSAtMTtcbiAgICBsZXQgYmFzZTY0ID0gbmV3IFVpbnQzMkFycmF5KDIpO1xuICAgIGxldCBiYXNlMzIgPSBuZXcgVWludDE2QXJyYXkoYnVmZmVyLCBieXRlT2Zmc2V0LCBsZW5ndGggKiAyKTtcbiAgICBsZXQgY2hlY2tzID0gbmV3IFVpbnQzMkFycmF5KChiYXNlMzIgPSBuZXcgVWludDE2QXJyYXkoYmFzZTMyKS5yZXZlcnNlKCkpLmJ1ZmZlcik7XG4gICAgbGV0IG4gPSBiYXNlMzIubGVuZ3RoIC0gMTtcblxuICAgIGRvIHtcbiAgICAgICAgZm9yIChiYXNlNjRbMF0gPSBiYXNlMzJbaSA9IDBdOyBpIDwgbjspIHtcbiAgICAgICAgICAgIGJhc2UzMltpKytdID0gYmFzZTY0WzFdID0gYmFzZTY0WzBdIC8gMTA7XG4gICAgICAgICAgICBiYXNlNjRbMF0gPSAoKGJhc2U2NFswXSAtIGJhc2U2NFsxXSAqIDEwKSA8PCAxNikgKyBiYXNlMzJbaV07XG4gICAgICAgIH1cbiAgICAgICAgYmFzZTMyW2ldID0gYmFzZTY0WzFdID0gYmFzZTY0WzBdIC8gMTA7XG4gICAgICAgIGJhc2U2NFswXSA9IGJhc2U2NFswXSAtIGJhc2U2NFsxXSAqIDEwO1xuICAgICAgICBzdHJpbmcgPSBgJHtiYXNlNjRbMF19JHtzdHJpbmd9YDtcbiAgICB9IHdoaWxlIChjaGVja3NbMF0gfHwgY2hlY2tzWzFdIHx8IGNoZWNrc1syXSB8fCBjaGVja3NbM10pO1xuXG4gICAgcmV0dXJuIHN0cmluZyA/IHN0cmluZyA6IGAwYDtcbn1cblxuLyoqIEBpZ25vcmUgKi9cbmludGVyZmFjZSBUeXBlZEFycmF5TGlrZTxUIGV4dGVuZHMgQmlnTnVtQXJyYXk+IHtcblxuICAgIHJlYWRvbmx5IGxlbmd0aDogbnVtYmVyO1xuICAgIHJlYWRvbmx5IGJ1ZmZlcjogQXJyYXlCdWZmZXI7XG4gICAgcmVhZG9ubHkgYnl0ZUxlbmd0aDogbnVtYmVyO1xuICAgIHJlYWRvbmx5IGJ5dGVPZmZzZXQ6IG51bWJlcjtcbiAgICByZWFkb25seSBCWVRFU19QRVJfRUxFTUVOVDogbnVtYmVyO1xuXG4gICAgaW5jbHVkZXMoc2VhcmNoRWxlbWVudDogbnVtYmVyLCBmcm9tSW5kZXg/OiBudW1iZXIgfCB1bmRlZmluZWQpOiBib29sZWFuO1xuICAgIGNvcHlXaXRoaW4odGFyZ2V0OiBudW1iZXIsIHN0YXJ0OiBudW1iZXIsIGVuZD86IG51bWJlciB8IHVuZGVmaW5lZCk6IHRoaXM7XG4gICAgZXZlcnkoY2FsbGJhY2tmbjogKHZhbHVlOiBudW1iZXIsIGluZGV4OiBudW1iZXIsIGFycmF5OiBUKSA9PiBib29sZWFuLCB0aGlzQXJnPzogYW55KTogYm9vbGVhbjtcbiAgICBmaWxsKHZhbHVlOiBudW1iZXIsIHN0YXJ0PzogbnVtYmVyIHwgdW5kZWZpbmVkLCBlbmQ/OiBudW1iZXIgfCB1bmRlZmluZWQpOiB0aGlzO1xuICAgIGZpbHRlcihjYWxsYmFja2ZuOiAodmFsdWU6IG51bWJlciwgaW5kZXg6IG51bWJlciwgYXJyYXk6IFQpID0+IGJvb2xlYW4sIHRoaXNBcmc/OiBhbnkpOiBUO1xuICAgIGZpbmQocHJlZGljYXRlOiAodmFsdWU6IG51bWJlciwgaW5kZXg6IG51bWJlciwgb2JqOiBUKSA9PiBib29sZWFuLCB0aGlzQXJnPzogYW55KTogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICAgIGZpbmRJbmRleChwcmVkaWNhdGU6ICh2YWx1ZTogbnVtYmVyLCBpbmRleDogbnVtYmVyLCBvYmo6IFQpID0+IGJvb2xlYW4sIHRoaXNBcmc/OiBhbnkpOiBudW1iZXI7XG4gICAgZm9yRWFjaChjYWxsYmFja2ZuOiAodmFsdWU6IG51bWJlciwgaW5kZXg6IG51bWJlciwgYXJyYXk6IFQpID0+IHZvaWQsIHRoaXNBcmc/OiBhbnkpOiB2b2lkO1xuICAgIGluZGV4T2Yoc2VhcmNoRWxlbWVudDogbnVtYmVyLCBmcm9tSW5kZXg/OiBudW1iZXIgfCB1bmRlZmluZWQpOiBudW1iZXI7XG4gICAgam9pbihzZXBhcmF0b3I/OiBzdHJpbmcgfCB1bmRlZmluZWQpOiBzdHJpbmc7XG4gICAgbGFzdEluZGV4T2Yoc2VhcmNoRWxlbWVudDogbnVtYmVyLCBmcm9tSW5kZXg/OiBudW1iZXIgfCB1bmRlZmluZWQpOiBudW1iZXI7XG4gICAgbWFwKGNhbGxiYWNrZm46ICh2YWx1ZTogbnVtYmVyLCBpbmRleDogbnVtYmVyLCBhcnJheTogVCkgPT4gbnVtYmVyLCB0aGlzQXJnPzogYW55KTogVDtcbiAgICByZWR1Y2UoY2FsbGJhY2tmbjogKHByZXZpb3VzVmFsdWU6IG51bWJlciwgY3VycmVudFZhbHVlOiBudW1iZXIsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVCkgPT4gbnVtYmVyKTogbnVtYmVyO1xuICAgIHJlZHVjZShjYWxsYmFja2ZuOiAocHJldmlvdXNWYWx1ZTogbnVtYmVyLCBjdXJyZW50VmFsdWU6IG51bWJlciwgY3VycmVudEluZGV4OiBudW1iZXIsIGFycmF5OiBUKSA9PiBudW1iZXIsIGluaXRpYWxWYWx1ZTogbnVtYmVyKTogbnVtYmVyO1xuICAgIHJlZHVjZTxVPihjYWxsYmFja2ZuOiAocHJldmlvdXNWYWx1ZTogVSwgY3VycmVudFZhbHVlOiBudW1iZXIsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVCkgPT4gVSwgaW5pdGlhbFZhbHVlOiBVKTogVTtcbiAgICByZWR1Y2VSaWdodChjYWxsYmFja2ZuOiAocHJldmlvdXNWYWx1ZTogbnVtYmVyLCBjdXJyZW50VmFsdWU6IG51bWJlciwgY3VycmVudEluZGV4OiBudW1iZXIsIGFycmF5OiBUKSA9PiBudW1iZXIpOiBudW1iZXI7XG4gICAgcmVkdWNlUmlnaHQoY2FsbGJhY2tmbjogKHByZXZpb3VzVmFsdWU6IG51bWJlciwgY3VycmVudFZhbHVlOiBudW1iZXIsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVCkgPT4gbnVtYmVyLCBpbml0aWFsVmFsdWU6IG51bWJlcik6IG51bWJlcjtcbiAgICByZWR1Y2VSaWdodDxVPihjYWxsYmFja2ZuOiAocHJldmlvdXNWYWx1ZTogVSwgY3VycmVudFZhbHVlOiBudW1iZXIsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVCkgPT4gVSwgaW5pdGlhbFZhbHVlOiBVKTogVTtcbiAgICByZXZlcnNlKCk6IFQ7XG4gICAgc2V0KGFycmF5OiBBcnJheUxpa2U8bnVtYmVyPiwgb2Zmc2V0PzogbnVtYmVyIHwgdW5kZWZpbmVkKTogdm9pZDtcbiAgICBzbGljZShzdGFydD86IG51bWJlciB8IHVuZGVmaW5lZCwgZW5kPzogbnVtYmVyIHwgdW5kZWZpbmVkKTogVDtcbiAgICBzb21lKGNhbGxiYWNrZm46ICh2YWx1ZTogbnVtYmVyLCBpbmRleDogbnVtYmVyLCBhcnJheTogVCkgPT4gYm9vbGVhbiwgdGhpc0FyZz86IGFueSk6IGJvb2xlYW47XG4gICAgc29ydChjb21wYXJlRm4/OiAoKGE6IG51bWJlciwgYjogbnVtYmVyKSA9PiBudW1iZXIpIHwgdW5kZWZpbmVkKTogdGhpcztcbiAgICBzdWJhcnJheShiZWdpbjogbnVtYmVyLCBlbmQ/OiBudW1iZXIgfCB1bmRlZmluZWQpOiBUO1xuICAgIHRvTG9jYWxlU3RyaW5nKCk6IHN0cmluZztcbiAgICBlbnRyaWVzKCk6IEl0ZXJhYmxlSXRlcmF0b3I8W251bWJlciwgbnVtYmVyXT47XG4gICAga2V5cygpOiBJdGVyYWJsZUl0ZXJhdG9yPG51bWJlcj47XG4gICAgdmFsdWVzKCk6IEl0ZXJhYmxlSXRlcmF0b3I8bnVtYmVyPjtcbn1cbiJdfQ==
