"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const buffer_1 = require("./buffer");
const compat_1 = require("./compat");
/** @ignore */
const BigNumNMixin = {
    toJSON() { return `"${bignumToString(this)}"`; },
    valueOf() { return bignumToNumber(this); },
    toString() { return bignumToString(this); },
    [Symbol.toPrimitive](hint) {
        switch (hint) {
            case 'number': return bignumToNumber(this);
            case 'string': return bignumToString(this);
            case 'default': return bignumToBigInt(this);
        }
        return bignumToString(this);
    }
};
/** @ignore */
const SignedBigNumNMixin = Object.assign({}, BigNumNMixin, { signed: true, BigIntArray: compat_1.BigInt64Array });
/** @ignore */
const UnsignedBigNumNMixin = Object.assign({}, BigNumNMixin, { signed: false, BigIntArray: compat_1.BigUint64Array });
/** @ignore */
class BN {
    constructor(input, signed = input instanceof Int32Array) {
        return BN.new(input, signed);
    }
    /** @nocollapse */
    static new(input, signed = (input instanceof Int8Array || input instanceof Int16Array || input instanceof Int32Array)) {
        return (signed === true) ? BN.signed(input) : BN.unsigned(input);
    }
    /** @nocollapse */
    static signed(input) {
        const Ctor = ArrayBuffer.isView(input) ? input.constructor : Int32Array;
        const { buffer, byteOffset, length } = buffer_1.toArrayBufferView(Ctor, input);
        const bn = new Ctor(buffer, byteOffset, length);
        return Object.assign(bn, SignedBigNumNMixin);
    }
    /** @nocollapse */
    static unsigned(input) {
        const Ctor = ArrayBuffer.isView(input) ? input.constructor : Uint32Array;
        const { buffer, byteOffset, length } = buffer_1.toArrayBufferView(Ctor, input);
        const bn = new Ctor(buffer, byteOffset, length);
        return Object.assign(bn, UnsignedBigNumNMixin);
    }
}
exports.BN = BN;
/** @ignore */
function bignumToNumber({ buffer, byteOffset, length }) {
    let int64 = 0;
    let words = new Uint32Array(buffer, byteOffset, length);
    for (let i = 0, n = words.length; i < n;) {
        int64 += words[i++] + (words[i++] * (i ** 32));
    }
    return int64;
}
/** @ignore */
let bignumToString;
/** @ignore */
let bignumToBigInt;
if (!compat_1.BigIntAvailable) {
    bignumToString = decimalToString;
    bignumToBigInt = bignumToString;
}
else {
    bignumToBigInt = ((a) => a.length === 2 ? new a.BigIntArray(a.buffer, a.byteOffset, 1)[0] : decimalToString(a));
    bignumToString = ((a) => a.length === 2 ? `${new a.BigIntArray(a.buffer, a.byteOffset, 1)[0]}` : decimalToString(a));
}
function decimalToString(a) {
    let digits = '';
    let base64 = new Uint32Array(2);
    let base32 = new Uint16Array(a.buffer, a.byteOffset, a.length * 2);
    let checks = new Uint32Array((base32 = new Uint16Array(base32).reverse()).buffer);
    let i = -1, n = base32.length - 1;
    do {
        for (base64[0] = base32[i = 0]; i < n;) {
            base32[i++] = base64[1] = base64[0] / 10;
            base64[0] = ((base64[0] - base64[1] * 10) << 16) + base32[i];
        }
        base32[i] = base64[1] = base64[0] / 10;
        base64[0] = base64[0] - base64[1] * 10;
        digits = `${base64[0]}${digits}`;
    } while (checks[0] || checks[1] || checks[2] || checks[3]);
    return digits ? digits : `0`;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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aGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBCaWdJbnRBcnJheSwgQmlnSW50QXJyYXlDb25zdHJ1Y3RvciB9IGZyb20gJy4uL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgdG9BcnJheUJ1ZmZlclZpZXcsIEFycmF5QnVmZmVyVmlld0lucHV0IH0gZnJvbSAnLi9idWZmZXInO1xuaW1wb3J0IHsgQmlnSW50QXZhaWxhYmxlLCBCaWdJbnQ2NEFycmF5LCBCaWdVaW50NjRBcnJheSB9IGZyb20gJy4vY29tcGF0JztcblxuLyoqIEBpZ25vcmUgKi9cbnR5cGUgQmlnTnVtQXJyYXkgPSBJbnRBcnJheSB8IFVpbnRBcnJheTtcbi8qKiBAaWdub3JlICovXG50eXBlIEludEFycmF5ID0gSW50OEFycmF5IHwgSW50MTZBcnJheSB8IEludDMyQXJyYXk7XG4vKiogQGlnbm9yZSAqL1xudHlwZSBVaW50QXJyYXkgPSBVaW50OEFycmF5IHwgVWludDE2QXJyYXkgfCBVaW50MzJBcnJheSB8IFVpbnQ4Q2xhbXBlZEFycmF5O1xuXG4vKiogQGlnbm9yZSAqL1xuY29uc3QgQmlnTnVtTk1peGluID0ge1xuICAgIHRvSlNPTih0aGlzOiBCTjxCaWdOdW1BcnJheT4pIHsgcmV0dXJuIGBcIiR7YmlnbnVtVG9TdHJpbmcodGhpcyl9XCJgOyB9LFxuICAgIHZhbHVlT2YodGhpczogQk48QmlnTnVtQXJyYXk+KSB7IHJldHVybiBiaWdudW1Ub051bWJlcih0aGlzKTsgfSxcbiAgICB0b1N0cmluZyh0aGlzOiBCTjxCaWdOdW1BcnJheT4pIHsgcmV0dXJuIGJpZ251bVRvU3RyaW5nKHRoaXMpOyB9LFxuICAgIFtTeW1ib2wudG9QcmltaXRpdmVdPFQgZXh0ZW5kcyBCTjxCaWdOdW1BcnJheT4+KHRoaXM6IFQsIGhpbnQ6ICdzdHJpbmcnIHwgJ251bWJlcicgfCAnZGVmYXVsdCcpIHtcbiAgICAgICAgc3dpdGNoIChoaW50KSB7XG4gICAgICAgICAgICBjYXNlICdudW1iZXInOiByZXR1cm4gYmlnbnVtVG9OdW1iZXIodGhpcyk7XG4gICAgICAgICAgICBjYXNlICdzdHJpbmcnOiByZXR1cm4gYmlnbnVtVG9TdHJpbmcodGhpcyk7XG4gICAgICAgICAgICBjYXNlICdkZWZhdWx0JzogcmV0dXJuIGJpZ251bVRvQmlnSW50KHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBiaWdudW1Ub1N0cmluZyh0aGlzKTtcbiAgICB9XG59O1xuXG4vKiogQGlnbm9yZSAqL1xuY29uc3QgU2lnbmVkQmlnTnVtTk1peGluOiBhbnkgPSBPYmplY3QuYXNzaWduKHt9LCBCaWdOdW1OTWl4aW4sIHsgc2lnbmVkOiB0cnVlLCBCaWdJbnRBcnJheTogQmlnSW50NjRBcnJheSB9KTtcbi8qKiBAaWdub3JlICovXG5jb25zdCBVbnNpZ25lZEJpZ051bU5NaXhpbjogYW55ID0gT2JqZWN0LmFzc2lnbih7fSwgQmlnTnVtTk1peGluLCB7IHNpZ25lZDogZmFsc2UsIEJpZ0ludEFycmF5OiBCaWdVaW50NjRBcnJheSB9KTtcblxuLyoqIEBpZ25vcmUgKi9cbmV4cG9ydCBjbGFzcyBCTjxUIGV4dGVuZHMgQmlnTnVtQXJyYXk+IHtcbiAgICBwdWJsaWMgc3RhdGljIG5ldzxUIGV4dGVuZHMgQmlnTnVtQXJyYXk+KGlucHV0OiBBcnJheUJ1ZmZlclZpZXdJbnB1dCwgc2lnbmVkPzogYm9vbGVhbik6IFQ7XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBuZXc8VCBleHRlbmRzIEJpZ051bUFycmF5PihpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQsIHNpZ25lZCA9IChpbnB1dCBpbnN0YW5jZW9mIEludDhBcnJheSB8fCBpbnB1dCBpbnN0YW5jZW9mIEludDE2QXJyYXkgfHwgaW5wdXQgaW5zdGFuY2VvZiBJbnQzMkFycmF5KSk6IFQge1xuICAgICAgICByZXR1cm4gKHNpZ25lZCA9PT0gdHJ1ZSkgPyBCTi5zaWduZWQoaW5wdXQpIGFzIFQgOiBCTi51bnNpZ25lZChpbnB1dCkgYXMgVDtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBzaWduZWQ8VCBleHRlbmRzIEludEFycmF5PihpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpOiBUIHtcbiAgICAgICAgY29uc3QgQ3RvcjogYW55ID0gQXJyYXlCdWZmZXIuaXNWaWV3KGlucHV0KSA/IDxhbnk+IGlucHV0LmNvbnN0cnVjdG9yIDogSW50MzJBcnJheTtcbiAgICAgICAgY29uc3QgeyBidWZmZXIsIGJ5dGVPZmZzZXQsIGxlbmd0aCB9ID0gdG9BcnJheUJ1ZmZlclZpZXc8VD4oPGFueT4gQ3RvciwgaW5wdXQpIGFzIFQ7XG4gICAgICAgIGNvbnN0IGJuID0gbmV3IEN0b3IoYnVmZmVyLCBieXRlT2Zmc2V0LCBsZW5ndGgpO1xuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihibiwgU2lnbmVkQmlnTnVtTk1peGluKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyB1bnNpZ25lZDxUIGV4dGVuZHMgVWludEFycmF5PihpbnB1dDogQXJyYXlCdWZmZXJWaWV3SW5wdXQpOiBUIHtcbiAgICAgICAgY29uc3QgQ3RvcjogYW55ID0gQXJyYXlCdWZmZXIuaXNWaWV3KGlucHV0KSA/IDxhbnk+IGlucHV0LmNvbnN0cnVjdG9yIDogVWludDMyQXJyYXk7XG4gICAgICAgIGNvbnN0IHsgYnVmZmVyLCBieXRlT2Zmc2V0LCBsZW5ndGggfSA9IHRvQXJyYXlCdWZmZXJWaWV3PFQ+KDxhbnk+IEN0b3IsIGlucHV0KSBhcyBUO1xuICAgICAgICBjb25zdCBibiA9IG5ldyBDdG9yKGJ1ZmZlciwgYnl0ZU9mZnNldCwgbGVuZ3RoKTtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oYm4sIFVuc2lnbmVkQmlnTnVtTk1peGluKTtcbiAgICB9XG4gICAgY29uc3RydWN0b3IoaW5wdXQ6IEFycmF5QnVmZmVyVmlld0lucHV0LCBzaWduZWQgPSBpbnB1dCBpbnN0YW5jZW9mIEludDMyQXJyYXkpIHtcbiAgICAgICAgcmV0dXJuIEJOLm5ldyhpbnB1dCwgc2lnbmVkKSBhcyBhbnk7XG4gICAgfVxufVxuXG4vKiogQGlnbm9yZSAqL1xuZXhwb3J0IGludGVyZmFjZSBCTjxUIGV4dGVuZHMgQmlnTnVtQXJyYXk+IGV4dGVuZHMgVHlwZWRBcnJheUxpa2U8VD4ge1xuXG4gICAgbmV3PFQgZXh0ZW5kcyBBcnJheUJ1ZmZlclZpZXdJbnB1dD4oYnVmZmVyOiBULCBzaWduZWQ/OiBib29sZWFuKTogVDtcblxuICAgIHJlYWRvbmx5IHNpZ25lZDogYm9vbGVhbjtcbiAgICByZWFkb25seSBCaWdJbnRBcnJheTogQmlnSW50QXJyYXlDb25zdHJ1Y3RvcjxCaWdJbnRBcnJheT47XG5cbiAgICBbU3ltYm9sLnRvU3RyaW5nVGFnXTpcbiAgICAgICAgJ0ludDhBcnJheScgICAgICAgICB8XG4gICAgICAgICdJbnQxNkFycmF5JyAgICAgICAgfFxuICAgICAgICAnSW50MzJBcnJheScgICAgICAgIHxcbiAgICAgICAgJ1VpbnQ4QXJyYXknICAgICAgICB8XG4gICAgICAgICdVaW50MTZBcnJheScgICAgICAgfFxuICAgICAgICAnVWludDMyQXJyYXknICAgICAgIHxcbiAgICAgICAgJ1VpbnQ4Q2xhbXBlZEFycmF5JztcblxuICAgIC8qKlxuICAgICAqIENvbnZlcnQgdGhlIGJ5dGVzIHRvIHRoZWlyIChwb3NpdGl2ZSkgZGVjaW1hbCByZXByZXNlbnRhdGlvbiBmb3IgcHJpbnRpbmdcbiAgICAgKi9cbiAgICB0b1N0cmluZygpOiBzdHJpbmc7XG4gICAgLyoqXG4gICAgICogRG93bi1jb252ZXJ0IHRoZSBieXRlcyB0byBhIDUzLWJpdCBwcmVjaXNpb24gaW50ZWdlci4gSW52b2tlZCBieSBKUyBmb3JcbiAgICAgKiBhcml0aG1hdGljIG9wZXJhdG9ycywgbGlrZSBgK2AuIEVhc3kgKGFuZCB1bnNhZmUpIHdheSB0byBjb252ZXJ0IEJOIHRvXG4gICAgICogbnVtYmVyIHZpYSBgK2JuX2luc3RgXG4gICAgICovXG4gICAgdmFsdWVPZigpOiBudW1iZXI7XG4gICAgLyoqXG4gICAgICogUmV0dXJuIHRoZSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBieXRlcy4gTXVzdCBiZSB3cmFwcGVkIGluIGRvdWJsZS1xdW90ZXMsXG4gICAgICogc28gaXQncyBjb21wYXRpYmxlIHdpdGggSlNPTi5zdHJpbmdpZnkoKS5cbiAgICAgKi9cbiAgICB0b0pTT04oKTogc3RyaW5nO1xuICAgIFtTeW1ib2wudG9QcmltaXRpdmVdKGhpbnQ6IGFueSk6IG51bWJlciB8IHN0cmluZyB8IGJpZ2ludDtcbn1cblxuLyoqIEBpZ25vcmUgKi9cbmZ1bmN0aW9uIGJpZ251bVRvTnVtYmVyPFQgZXh0ZW5kcyBCTjxCaWdOdW1BcnJheT4+KHsgYnVmZmVyLCBieXRlT2Zmc2V0LCBsZW5ndGggfTogVCkge1xuICAgIGxldCBpbnQ2NCA9IDA7XG4gICAgbGV0IHdvcmRzID0gbmV3IFVpbnQzMkFycmF5KGJ1ZmZlciwgYnl0ZU9mZnNldCwgbGVuZ3RoKTtcbiAgICBmb3IgKGxldCBpID0gMCwgbiA9IHdvcmRzLmxlbmd0aDsgaSA8IG47KSB7XG4gICAgICAgIGludDY0ICs9IHdvcmRzW2krK10gKyAod29yZHNbaSsrXSAqIChpICoqIDMyKSk7XG4gICAgfVxuICAgIHJldHVybiBpbnQ2NDtcbn1cblxuLyoqIEBpZ25vcmUgKi9cbmxldCBiaWdudW1Ub1N0cmluZzogeyA8VCBleHRlbmRzIEJOPEJpZ051bUFycmF5Pj4oYTogVCk6IHN0cmluZzsgfTtcbi8qKiBAaWdub3JlICovXG5sZXQgYmlnbnVtVG9CaWdJbnQ6IHsgPFQgZXh0ZW5kcyBCTjxCaWdOdW1BcnJheT4+KGE6IFQpOiBiaWdpbnQ7IH07XG5cbmlmICghQmlnSW50QXZhaWxhYmxlKSB7XG4gICAgYmlnbnVtVG9TdHJpbmcgPSBkZWNpbWFsVG9TdHJpbmc7XG4gICAgYmlnbnVtVG9CaWdJbnQgPSA8YW55PiBiaWdudW1Ub1N0cmluZztcbn0gZWxzZSB7XG4gICAgYmlnbnVtVG9CaWdJbnQgPSAoPFQgZXh0ZW5kcyBCTjxCaWdOdW1BcnJheT4+KGE6IFQpID0+IGEubGVuZ3RoID09PSAyID8gbmV3IGEuQmlnSW50QXJyYXkoYS5idWZmZXIsIGEuYnl0ZU9mZnNldCwgMSlbMF0gOiA8YW55PmRlY2ltYWxUb1N0cmluZyhhKSk7XG4gICAgYmlnbnVtVG9TdHJpbmcgPSAoPFQgZXh0ZW5kcyBCTjxCaWdOdW1BcnJheT4+KGE6IFQpID0+IGEubGVuZ3RoID09PSAyID8gYCR7bmV3IGEuQmlnSW50QXJyYXkoYS5idWZmZXIsIGEuYnl0ZU9mZnNldCwgMSlbMF19YCA6IGRlY2ltYWxUb1N0cmluZyhhKSk7XG59XG5cbmZ1bmN0aW9uIGRlY2ltYWxUb1N0cmluZzxUIGV4dGVuZHMgQk48QmlnTnVtQXJyYXk+PihhOiBUKSB7XG4gICAgbGV0IGRpZ2l0cyA9ICcnO1xuICAgIGxldCBiYXNlNjQgPSBuZXcgVWludDMyQXJyYXkoMik7XG4gICAgbGV0IGJhc2UzMiA9IG5ldyBVaW50MTZBcnJheShhLmJ1ZmZlciwgYS5ieXRlT2Zmc2V0LCBhLmxlbmd0aCAqIDIpO1xuICAgIGxldCBjaGVja3MgPSBuZXcgVWludDMyQXJyYXkoKGJhc2UzMiA9IG5ldyBVaW50MTZBcnJheShiYXNlMzIpLnJldmVyc2UoKSkuYnVmZmVyKTtcbiAgICBsZXQgaSA9IC0xLCBuID0gYmFzZTMyLmxlbmd0aCAtIDE7XG4gICAgZG8ge1xuICAgICAgICBmb3IgKGJhc2U2NFswXSA9IGJhc2UzMltpID0gMF07IGkgPCBuOykge1xuICAgICAgICAgICAgYmFzZTMyW2krK10gPSBiYXNlNjRbMV0gPSBiYXNlNjRbMF0gLyAxMDtcbiAgICAgICAgICAgIGJhc2U2NFswXSA9ICgoYmFzZTY0WzBdIC0gYmFzZTY0WzFdICogMTApIDw8IDE2KSArIGJhc2UzMltpXTtcbiAgICAgICAgfVxuICAgICAgICBiYXNlMzJbaV0gPSBiYXNlNjRbMV0gPSBiYXNlNjRbMF0gLyAxMDtcbiAgICAgICAgYmFzZTY0WzBdID0gYmFzZTY0WzBdIC0gYmFzZTY0WzFdICogMTA7XG4gICAgICAgIGRpZ2l0cyA9IGAke2Jhc2U2NFswXX0ke2RpZ2l0c31gO1xuICAgIH0gd2hpbGUgKGNoZWNrc1swXSB8fCBjaGVja3NbMV0gfHwgY2hlY2tzWzJdIHx8IGNoZWNrc1szXSk7XG4gICAgcmV0dXJuIGRpZ2l0cyA/IGRpZ2l0cyA6IGAwYDtcbn1cblxuLyoqIEBpZ25vcmUgKi9cbmludGVyZmFjZSBUeXBlZEFycmF5TGlrZTxUIGV4dGVuZHMgQmlnTnVtQXJyYXk+IHtcblxuICAgIHJlYWRvbmx5IGxlbmd0aDogbnVtYmVyO1xuICAgIHJlYWRvbmx5IGJ1ZmZlcjogQXJyYXlCdWZmZXI7XG4gICAgcmVhZG9ubHkgYnl0ZUxlbmd0aDogbnVtYmVyO1xuICAgIHJlYWRvbmx5IGJ5dGVPZmZzZXQ6IG51bWJlcjtcbiAgICByZWFkb25seSBCWVRFU19QRVJfRUxFTUVOVDogbnVtYmVyO1xuXG4gICAgaW5jbHVkZXMoc2VhcmNoRWxlbWVudDogbnVtYmVyLCBmcm9tSW5kZXg/OiBudW1iZXIgfCB1bmRlZmluZWQpOiBib29sZWFuO1xuICAgIGNvcHlXaXRoaW4odGFyZ2V0OiBudW1iZXIsIHN0YXJ0OiBudW1iZXIsIGVuZD86IG51bWJlciB8IHVuZGVmaW5lZCk6IHRoaXM7XG4gICAgZXZlcnkoY2FsbGJhY2tmbjogKHZhbHVlOiBudW1iZXIsIGluZGV4OiBudW1iZXIsIGFycmF5OiBUKSA9PiBib29sZWFuLCB0aGlzQXJnPzogYW55KTogYm9vbGVhbjtcbiAgICBmaWxsKHZhbHVlOiBudW1iZXIsIHN0YXJ0PzogbnVtYmVyIHwgdW5kZWZpbmVkLCBlbmQ/OiBudW1iZXIgfCB1bmRlZmluZWQpOiB0aGlzO1xuICAgIGZpbHRlcihjYWxsYmFja2ZuOiAodmFsdWU6IG51bWJlciwgaW5kZXg6IG51bWJlciwgYXJyYXk6IFQpID0+IGJvb2xlYW4sIHRoaXNBcmc/OiBhbnkpOiBUO1xuICAgIGZpbmQocHJlZGljYXRlOiAodmFsdWU6IG51bWJlciwgaW5kZXg6IG51bWJlciwgb2JqOiBUKSA9PiBib29sZWFuLCB0aGlzQXJnPzogYW55KTogbnVtYmVyIHwgdW5kZWZpbmVkO1xuICAgIGZpbmRJbmRleChwcmVkaWNhdGU6ICh2YWx1ZTogbnVtYmVyLCBpbmRleDogbnVtYmVyLCBvYmo6IFQpID0+IGJvb2xlYW4sIHRoaXNBcmc/OiBhbnkpOiBudW1iZXI7XG4gICAgZm9yRWFjaChjYWxsYmFja2ZuOiAodmFsdWU6IG51bWJlciwgaW5kZXg6IG51bWJlciwgYXJyYXk6IFQpID0+IHZvaWQsIHRoaXNBcmc/OiBhbnkpOiB2b2lkO1xuICAgIGluZGV4T2Yoc2VhcmNoRWxlbWVudDogbnVtYmVyLCBmcm9tSW5kZXg/OiBudW1iZXIgfCB1bmRlZmluZWQpOiBudW1iZXI7XG4gICAgam9pbihzZXBhcmF0b3I/OiBzdHJpbmcgfCB1bmRlZmluZWQpOiBzdHJpbmc7XG4gICAgbGFzdEluZGV4T2Yoc2VhcmNoRWxlbWVudDogbnVtYmVyLCBmcm9tSW5kZXg/OiBudW1iZXIgfCB1bmRlZmluZWQpOiBudW1iZXI7XG4gICAgbWFwKGNhbGxiYWNrZm46ICh2YWx1ZTogbnVtYmVyLCBpbmRleDogbnVtYmVyLCBhcnJheTogVCkgPT4gbnVtYmVyLCB0aGlzQXJnPzogYW55KTogVDtcbiAgICByZWR1Y2UoY2FsbGJhY2tmbjogKHByZXZpb3VzVmFsdWU6IG51bWJlciwgY3VycmVudFZhbHVlOiBudW1iZXIsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVCkgPT4gbnVtYmVyKTogbnVtYmVyO1xuICAgIHJlZHVjZShjYWxsYmFja2ZuOiAocHJldmlvdXNWYWx1ZTogbnVtYmVyLCBjdXJyZW50VmFsdWU6IG51bWJlciwgY3VycmVudEluZGV4OiBudW1iZXIsIGFycmF5OiBUKSA9PiBudW1iZXIsIGluaXRpYWxWYWx1ZTogbnVtYmVyKTogbnVtYmVyO1xuICAgIHJlZHVjZTxVPihjYWxsYmFja2ZuOiAocHJldmlvdXNWYWx1ZTogVSwgY3VycmVudFZhbHVlOiBudW1iZXIsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVCkgPT4gVSwgaW5pdGlhbFZhbHVlOiBVKTogVTtcbiAgICByZWR1Y2VSaWdodChjYWxsYmFja2ZuOiAocHJldmlvdXNWYWx1ZTogbnVtYmVyLCBjdXJyZW50VmFsdWU6IG51bWJlciwgY3VycmVudEluZGV4OiBudW1iZXIsIGFycmF5OiBUKSA9PiBudW1iZXIpOiBudW1iZXI7XG4gICAgcmVkdWNlUmlnaHQoY2FsbGJhY2tmbjogKHByZXZpb3VzVmFsdWU6IG51bWJlciwgY3VycmVudFZhbHVlOiBudW1iZXIsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVCkgPT4gbnVtYmVyLCBpbml0aWFsVmFsdWU6IG51bWJlcik6IG51bWJlcjtcbiAgICByZWR1Y2VSaWdodDxVPihjYWxsYmFja2ZuOiAocHJldmlvdXNWYWx1ZTogVSwgY3VycmVudFZhbHVlOiBudW1iZXIsIGN1cnJlbnRJbmRleDogbnVtYmVyLCBhcnJheTogVCkgPT4gVSwgaW5pdGlhbFZhbHVlOiBVKTogVTtcbiAgICByZXZlcnNlKCk6IFQ7XG4gICAgc2V0KGFycmF5OiBBcnJheUxpa2U8bnVtYmVyPiwgb2Zmc2V0PzogbnVtYmVyIHwgdW5kZWZpbmVkKTogdm9pZDtcbiAgICBzbGljZShzdGFydD86IG51bWJlciB8IHVuZGVmaW5lZCwgZW5kPzogbnVtYmVyIHwgdW5kZWZpbmVkKTogVDtcbiAgICBzb21lKGNhbGxiYWNrZm46ICh2YWx1ZTogbnVtYmVyLCBpbmRleDogbnVtYmVyLCBhcnJheTogVCkgPT4gYm9vbGVhbiwgdGhpc0FyZz86IGFueSk6IGJvb2xlYW47XG4gICAgc29ydChjb21wYXJlRm4/OiAoKGE6IG51bWJlciwgYjogbnVtYmVyKSA9PiBudW1iZXIpIHwgdW5kZWZpbmVkKTogdGhpcztcbiAgICBzdWJhcnJheShiZWdpbjogbnVtYmVyLCBlbmQ/OiBudW1iZXIgfCB1bmRlZmluZWQpOiBUO1xuICAgIHRvTG9jYWxlU3RyaW5nKCk6IHN0cmluZztcbiAgICBlbnRyaWVzKCk6IEl0ZXJhYmxlSXRlcmF0b3I8W251bWJlciwgbnVtYmVyXT47XG4gICAga2V5cygpOiBJdGVyYWJsZUl0ZXJhdG9yPG51bWJlcj47XG4gICAgdmFsdWVzKCk6IEl0ZXJhYmxlSXRlcmF0b3I8bnVtYmVyPjtcbn1cbiJdfQ==
