import * as tslib_1 from "tslib";
export class PipeIterator {
    constructor(iterator, encoding) {
        this.iterator = iterator;
        this.encoding = encoding;
    }
    [Symbol.iterator]() { return this.iterator; }
    next(value) { return this.iterator.next(value); }
    throw(error) {
        if (typeof this.iterator.throw === 'function') {
            return this.iterator.throw(error);
        }
        return { done: true, value: null };
    }
    return(value) {
        if (typeof this.iterator.return === 'function') {
            return this.iterator.return(value);
        }
        return { done: true, value: null };
    }
    pipe(stream) {
        let { encoding } = this;
        let res;
        let write = (err) => {
            stream['removeListener']('error', write);
            stream['removeListener']('drain', write);
            if (err) {
                return this.throw(err);
            }
            if (stream['writable']) {
                do {
                    if ((res = this.next()).done) {
                        break;
                    }
                } while (emit(stream, encoding, res.value));
            }
            return wait(stream, res && res.done, write);
        };
        write();
        return stream;
    }
}
export class AsyncPipeIterator {
    constructor(iterator, encoding) {
        this.iterator = iterator;
        this.encoding = encoding;
    }
    [Symbol.asyncIterator]() { return this.iterator; }
    next(value) { return this.iterator.next(value); }
    throw(error) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            if (typeof this.iterator.throw === 'function') {
                return this.iterator.throw(error);
            }
            return { done: true, value: null };
        });
    }
    return(value) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            if (typeof this.iterator.return === 'function') {
                return this.iterator.return(value);
            }
            return { done: true, value: null };
        });
    }
    pipe(stream) {
        let { encoding } = this;
        let res;
        let write = (err) => tslib_1.__awaiter(this, void 0, void 0, function* () {
            stream['removeListener']('error', write);
            stream['removeListener']('drain', write);
            if (err) {
                return this.throw(err);
            }
            if (stream['writable']) {
                do {
                    if ((res = yield this.next()).done) {
                        break;
                    }
                } while (emit(stream, encoding, res.value));
            }
            return wait(stream, res && res.done, write);
        });
        write();
        return stream;
    }
}
const toBufferOrUint8Array = (() => {
    // If in node, convert Uint8Arrays to Buffer instances. This is necessary
    // because some node APIs ('http' etc.) don't work unless you give them Buffers.
    // This eval also defeats closure-compiler, which doesn't recognize the Buffer constructor.
    const BufferCtor = eval('typeof Buffer !== "undefined" ? Buffer : null');
    return !BufferCtor ? (arr) => arr :
        (arr) => BufferCtor.from(arr.buffer, arr.byteOffset, arr.byteLength);
})();
function emit(stream, encoding, value) {
    return stream['write']((encoding === 'utf8' ? value + '\n' : toBufferOrUint8Array(value)), encoding);
}
function wait(stream, done, write) {
    const p = eval('process'); // defeat closure compiler
    if (!done) {
        stream['once']('error', write);
        stream['once']('drain', write);
    }
    else if (!(!p || stream === p.stdout) && !stream['isTTY']) {
        stream['end']();
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFDLENBQUMsQ0FBQyxJQUFJLE1BQU0sS0FBSyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBRSxNQUFjLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDbEUsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7S0FDbkI7QUFDTCxDQUFDIiwiZmlsZSI6InV0aWwvbm9kZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuZXhwb3J0IGNsYXNzIFBpcGVJdGVyYXRvcjxUPiBpbXBsZW1lbnRzIEl0ZXJhYmxlSXRlcmF0b3I8VD4ge1xuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCBpdGVyYXRvcjogSXRlcmFibGVJdGVyYXRvcjxUPiwgcHJvdGVjdGVkIGVuY29kaW5nPzogYW55KSB7fVxuICAgIFtTeW1ib2wuaXRlcmF0b3JdKCkgeyByZXR1cm4gdGhpcy5pdGVyYXRvcjsgfVxuICAgIG5leHQodmFsdWU/OiBhbnkpIHsgcmV0dXJuIHRoaXMuaXRlcmF0b3IubmV4dCh2YWx1ZSk7IH1cbiAgICB0aHJvdyhlcnJvcj86IGFueSkge1xuICAgICAgICBpZiAodHlwZW9mIHRoaXMuaXRlcmF0b3IudGhyb3cgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLml0ZXJhdG9yLnRocm93KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBkb25lOiB0cnVlLCB2YWx1ZTogbnVsbCBhcyBhbnkgfTtcbiAgICB9XG4gICAgcmV0dXJuKHZhbHVlPzogYW55KSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5pdGVyYXRvci5yZXR1cm4gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLml0ZXJhdG9yLnJldHVybih2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgZG9uZTogdHJ1ZSwgdmFsdWU6IG51bGwgYXMgYW55IH07XG4gICAgfVxuICAgIHBpcGUoc3RyZWFtOiBOb2RlSlMuV3JpdGFibGVTdHJlYW0pIHtcbiAgICAgICAgbGV0IHsgZW5jb2RpbmcgfSA9IHRoaXM7XG4gICAgICAgIGxldCByZXM6IEl0ZXJhdG9yUmVzdWx0PFQ+O1xuICAgICAgICBsZXQgd3JpdGUgPSAoZXJyPzogYW55KSA9PiB7XG4gICAgICAgICAgICBzdHJlYW1bJ3JlbW92ZUxpc3RlbmVyJ10oJ2Vycm9yJywgd3JpdGUpO1xuICAgICAgICAgICAgc3RyZWFtWydyZW1vdmVMaXN0ZW5lciddKCdkcmFpbicsIHdyaXRlKTtcbiAgICAgICAgICAgIGlmIChlcnIpIHsgcmV0dXJuIHRoaXMudGhyb3coZXJyKTsgfVxuICAgICAgICAgICAgaWYgKHN0cmVhbVsnd3JpdGFibGUnXSkge1xuICAgICAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKChyZXMgPSB0aGlzLm5leHQoKSkuZG9uZSkgeyBicmVhazsgfVxuICAgICAgICAgICAgICAgIH0gd2hpbGUgKGVtaXQoc3RyZWFtLCBlbmNvZGluZywgcmVzLnZhbHVlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gd2FpdChzdHJlYW0sIHJlcyAmJiByZXMuZG9uZSwgd3JpdGUpO1xuICAgICAgICB9O1xuICAgICAgICB3cml0ZSgpO1xuICAgICAgICByZXR1cm4gc3RyZWFtO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEFzeW5jUGlwZUl0ZXJhdG9yPFQ+IGltcGxlbWVudHMgQXN5bmNJdGVyYWJsZUl0ZXJhdG9yPFQ+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaXRlcmF0b3I6IEFzeW5jSXRlcmFibGVJdGVyYXRvcjxUPiwgcHJvdGVjdGVkIGVuY29kaW5nPzogYW55KSB7fVxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7IHJldHVybiB0aGlzLml0ZXJhdG9yOyB9XG4gICAgbmV4dCh2YWx1ZT86IGFueSkgeyByZXR1cm4gdGhpcy5pdGVyYXRvci5uZXh0KHZhbHVlKTsgfVxuICAgIGFzeW5jIHRocm93KGVycm9yPzogYW55KSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5pdGVyYXRvci50aHJvdyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXRlcmF0b3IudGhyb3coZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGRvbmU6IHRydWUsIHZhbHVlOiBudWxsIGFzIGFueSB9O1xuICAgIH1cbiAgICBhc3luYyByZXR1cm4odmFsdWU/OiBhbnkpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLml0ZXJhdG9yLnJldHVybiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXRlcmF0b3IucmV0dXJuKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBkb25lOiB0cnVlLCB2YWx1ZTogbnVsbCBhcyBhbnkgfTtcbiAgICB9XG4gICAgcGlwZShzdHJlYW06IE5vZGVKUy5Xcml0YWJsZVN0cmVhbSkge1xuICAgICAgICBsZXQgeyBlbmNvZGluZyB9ID0gdGhpcztcbiAgICAgICAgbGV0IHJlczogSXRlcmF0b3JSZXN1bHQ8VD47XG4gICAgICAgIGxldCB3cml0ZSA9IGFzeW5jIChlcnI/OiBhbnkpID0+IHtcbiAgICAgICAgICAgIHN0cmVhbVsncmVtb3ZlTGlzdGVuZXInXSgnZXJyb3InLCB3cml0ZSk7XG4gICAgICAgICAgICBzdHJlYW1bJ3JlbW92ZUxpc3RlbmVyJ10oJ2RyYWluJywgd3JpdGUpO1xuICAgICAgICAgICAgaWYgKGVycikgeyByZXR1cm4gdGhpcy50aHJvdyhlcnIpOyB9XG4gICAgICAgICAgICBpZiAoc3RyZWFtWyd3cml0YWJsZSddKSB7XG4gICAgICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoKHJlcyA9IGF3YWl0IHRoaXMubmV4dCgpKS5kb25lKSB7IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgfSB3aGlsZSAoZW1pdChzdHJlYW0sIGVuY29kaW5nLCByZXMudmFsdWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB3YWl0KHN0cmVhbSwgcmVzICYmIHJlcy5kb25lLCB3cml0ZSk7XG4gICAgICAgIH07XG4gICAgICAgIHdyaXRlKCk7XG4gICAgICAgIHJldHVybiBzdHJlYW07XG4gICAgfVxufVxuXG5jb25zdCB0b0J1ZmZlck9yVWludDhBcnJheSA9ICgoKSA9PiB7XG4gICAgLy8gSWYgaW4gbm9kZSwgY29udmVydCBVaW50OEFycmF5cyB0byBCdWZmZXIgaW5zdGFuY2VzLiBUaGlzIGlzIG5lY2Vzc2FyeVxuICAgIC8vIGJlY2F1c2Ugc29tZSBub2RlIEFQSXMgKCdodHRwJyBldGMuKSBkb24ndCB3b3JrIHVubGVzcyB5b3UgZ2l2ZSB0aGVtIEJ1ZmZlcnMuXG4gICAgLy8gVGhpcyBldmFsIGFsc28gZGVmZWF0cyBjbG9zdXJlLWNvbXBpbGVyLCB3aGljaCBkb2Vzbid0IHJlY29nbml6ZSB0aGUgQnVmZmVyIGNvbnN0cnVjdG9yLlxuICAgIGNvbnN0IEJ1ZmZlckN0b3IgPSBldmFsKCd0eXBlb2YgQnVmZmVyICE9PSBcInVuZGVmaW5lZFwiID8gQnVmZmVyIDogbnVsbCcpO1xuICAgIHJldHVybiAhQnVmZmVyQ3RvciA/IChhcnI6IFVpbnQ4QXJyYXkpID0+IGFyciA6XG4gICAgICAgIChhcnI6IFVpbnQ4QXJyYXkpID0+IEJ1ZmZlckN0b3IuZnJvbShhcnIuYnVmZmVyLCBhcnIuYnl0ZU9mZnNldCwgYXJyLmJ5dGVMZW5ndGgpO1xufSkoKTtcblxuZnVuY3Rpb24gZW1pdChzdHJlYW06IE5vZGVKUy5Xcml0YWJsZVN0cmVhbSwgZW5jb2Rpbmc6IHN0cmluZywgdmFsdWU6IGFueSkge1xuICAgIHJldHVybiBzdHJlYW1bJ3dyaXRlJ10oKGVuY29kaW5nID09PSAndXRmOCcgPyB2YWx1ZSArICdcXG4nIDogdG9CdWZmZXJPclVpbnQ4QXJyYXkodmFsdWUpKSBhcyBhbnksIGVuY29kaW5nKTtcbn1cblxuZnVuY3Rpb24gd2FpdChzdHJlYW06IE5vZGVKUy5Xcml0YWJsZVN0cmVhbSwgZG9uZTogYm9vbGVhbiwgd3JpdGU6ICh4PzogYW55KSA9PiB2b2lkKSB7XG4gICAgY29uc3QgcCA9IGV2YWwoJ3Byb2Nlc3MnKTsgLy8gZGVmZWF0IGNsb3N1cmUgY29tcGlsZXJcbiAgICBpZiAoIWRvbmUpIHtcbiAgICAgICAgc3RyZWFtWydvbmNlJ10oJ2Vycm9yJywgd3JpdGUpO1xuICAgICAgICBzdHJlYW1bJ29uY2UnXSgnZHJhaW4nLCB3cml0ZSk7XG4gICAgfSBlbHNlIGlmICghKCFwIHx8IHN0cmVhbSA9PT0gcC5zdGRvdXQpICYmICEoc3RyZWFtIGFzIGFueSlbJ2lzVFRZJ10pIHtcbiAgICAgICAgc3RyZWFtWydlbmQnXSgpO1xuICAgIH1cbn1cbiJdfQ==
