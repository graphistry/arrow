// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import { align } from './bit';
import { TextEncoder } from 'text-encoding-utf-8';
const writeNumeric64Value = writeFixedWidthValue.bind(null, 64);
const writeNumeric128Value = writeFixedWidthValue.bind(null, 128);
const utf8Encoder = new TextEncoder();
const stride1Encode = writeValidityLayout.bind(null, writeFixedWidthLayoutWithStride.bind(null, 1));
const stride1FixedWidth = writeFixedWidthLayout.bind(null, writeValidityLayout.bind(null, stride1Encode));
const stride2FixedWidth = writeFixedWidthLayout.bind(null, writeValidityLayout.bind(null, writeFixedWidthLayoutWithStride.bind(null, 2)));
const stride4FixedWidth = writeFixedWidthLayout.bind(null, writeValidityLayout.bind(null, writeFixedWidthLayoutWithStride.bind(null, 4)));
export const writeBools = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeBooleanValue), Uint8Array);
export const writeInt8s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Int8Array);
export const writeInt16s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Int16Array);
export const writeInt32s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Int32Array);
export const writeInt64s = writeTypedLayout.bind(null, stride2FixedWidth.bind(null, writeNumeric64Value), Int32Array);
export const writeUint8s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Uint8Array);
export const writeUint16s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Uint16Array);
export const writeUint32s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Uint32Array);
export const writeUint64s = writeTypedLayout.bind(null, stride2FixedWidth.bind(null, writeNumeric64Value), Uint32Array);
export const writeDecimals = writeTypedLayout.bind(null, stride4FixedWidth.bind(null, writeNumeric128Value), Uint32Array);
export const writeFloat32s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Float32Array);
export const writeFloat64s = writeTypedLayout.bind(null, stride1FixedWidth.bind(null, writeNumericValue), Float64Array);
export const writeVariableWidth = writeVariableWidthLayout.bind(null, stride1Encode);
export const writeBinary = writeTypedLayout.bind(null, writeVariableWidth.bind(null, writeBinaryValue));
export const writeUtf8s = writeTypedLayout.bind(null, writeVariableWidth.bind(null, writeUtf8Value), Uint8Array);
export const writeDictionaryEncoded = writeDictionaryLayout.bind(null, stride1Encode);
export const writeDictionaryEncodedBools = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeBooleanValue), Uint8Array);
export const writeDictionaryEncodedInt8s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Int8Array);
export const writeDictionaryEncodedInt16s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Int16Array);
export const writeDictionaryEncodedInt32s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Int32Array);
export const writeDictionaryEncodedInt64s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride2FixedWidth, writeNumeric64Value), Int32Array);
export const writeDictionaryEncodedUint8s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Uint8Array);
export const writeDictionaryEncodedUint16s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Uint16Array);
export const writeDictionaryEncodedUint32s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Uint32Array);
export const writeDictionaryEncodedUint64s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride2FixedWidth, writeNumeric64Value), Uint32Array);
export const writeDictionaryEncodedDecimals = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride4FixedWidth, writeNumeric128Value), Uint32Array);
export const writeDictionaryEncodedFloat32s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Float32Array);
export const writeDictionaryEncodedFloat64s = writeTypedLayout.bind(null, writeDictionaryLayout.bind(null, stride1FixedWidth, writeNumericValue), Float64Array);
export const writeDictionaryEncodedVariableWidth = writeDictionaryLayout.bind(null, writeVariableWidth);
export const writeDictionaryEncodedBinary = writeTypedLayout.bind(null, writeDictionaryEncodedVariableWidth.bind(null, writeBinaryValue));
export const writeDictionaryEncodedUtf8s = writeTypedLayout.bind(null, writeDictionaryEncodedVariableWidth.bind(null, writeUtf8Value), Uint8Array);
function writeFixedWidthLayoutWithStride(stride, writeValue, values) {
    let index = -stride;
    const data = [];
    const length = values.length;
    while ((index += stride) < length) {
        writeValue(values, data, index);
    }
    return { data: data };
}
function writeFixedWidthLayout(writeLayout, writeValue, values, nulls) {
    return writeLayout(writeValue, values, nulls);
}
function writeValidityLayout(writeLayout, writeValue, values, nulls) {
    let nullCount = 0;
    let nullsLength = nulls && nulls.length || 0;
    let validity = new Uint8Array(align(values.length >>> 3, 8)).fill(255);
    return Object.assign({}, writeLayout(writeValueOrValidity, values), { nullCount, validity: (nullCount > 0 && validity) || new Uint8Array(0) });
    function writeValueOrValidity(src, dst, index) {
        writeValue(src, dst, index);
        let i = -1, x = src[index];
        let isNull = x === null || x === undefined;
        while (!isNull && ++i < nullsLength) {
            isNull = x === nulls[i];
        }
        if (isNull) {
            nullCount++;
            validity[index >> 3] &= ~(1 << (index % 8));
        }
    }
}
function writeVariableWidthLayout(writeLayout, writeValue, values, nulls) {
    let offsets = [0], offsetsIndex = 0;
    return Object.assign({}, writeLayout(writeValueAndOffset, values, nulls), { offsets });
    function writeValueAndOffset(src, dst, index) {
        if (!writeValue(src, dst, index)) {
            offsets[++offsetsIndex] = dst.length;
        }
    }
}
function writeDictionaryLayout(writeLayout, writeValue, values, nulls) {
    let keys = [], keysIndex = 0, keysMap = Object.create(null);
    return Object.assign({}, writeLayout(writeKeysOrValues, values, nulls), { keys });
    function writeKeysOrValues(src, dst, index) {
        const x = src[index];
        if (x in keysMap) {
            return (keys[index] = keysMap[x]) || true;
        }
        else if (!writeValue(src, dst, index)) {
            keys[index] = keysMap[x] = keysIndex++;
        }
    }
}
function writeTypedLayout(writeBuffers, ArrayBufferView, values, nulls) {
    const result = writeBuffers(values, nulls);
    result.data = new ArrayBufferView(result.data);
    return result;
}
function writeBooleanValue(src, dst, index) {
    if (src[index]) {
        let i = index >>> 3;
        let b = dst[i] || 0;
        dst[i] = b | 1 << (index % 8);
    }
}
function writeNumericValue(src, dst, index) {
    dst[index] = +src[index];
}
function writeFixedWidthValue(bitWidth, src, dst, index) {
    const bytesLen = bitWidth / 32;
    for (let i = -1; ++i < bytesLen;) {
        dst[index + i] = src[index + i];
    }
}
function writeUtf8Value(src, dst, index) {
    dst.push(...utf8Encoder.encode(src[index]));
}
function writeBinaryValue(src, dst, index) {
    dst.push(...src[index]);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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c0IsRUFBRSxHQUFhLEVBQUUsS0FBYTtJQUNoRyxNQUFNLFFBQVEsR0FBRyxRQUFRLEdBQUcsRUFBRSxDQUFDO0lBQy9CLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLFFBQVEsR0FBRyxDQUFDO1FBQy9CLEdBQUcsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNwQyxDQUFDO0FBQ0wsQ0FBQztBQUVELHdCQUF3QixHQUFzQixFQUFFLEdBQWEsRUFBRSxLQUFhO0lBQ3hFLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEQsQ0FBQztBQUVELDBCQUEwQixHQUFnQyxFQUFFLEdBQWEsRUFBRSxLQUFhO0lBQ3BGLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztBQUM1QixDQUFDIiwiZmlsZSI6InV0aWwvbGF5b3V0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IGFsaWduIH0gZnJvbSAnLi9iaXQnO1xuaW1wb3J0IHsgVGV4dEVuY29kZXIgfSBmcm9tICd0ZXh0LWVuY29kaW5nLXV0Zi04JztcbmltcG9ydCB7IFR5cGVkQXJyYXlDb25zdHJ1Y3RvciwgVHlwZWRBcnJheSB9IGZyb20gJy4uL3R5cGUnO1xuXG5leHBvcnQgdHlwZSBOdWxsYWJsZUxheW91dCA9IHsgbnVsbENvdW50OiBudW1iZXIsIHZhbGlkaXR5OiBVaW50OEFycmF5IH07XG5leHBvcnQgdHlwZSBCdWZmZXJMYXlvdXQ8VEFycmF5ID0gQXJyYXlMaWtlPG51bWJlcj4+ID0geyBkYXRhOiBUQXJyYXkgfTtcbmV4cG9ydCB0eXBlIERpY3Rpb25hcnlMYXlvdXQ8VEFycmF5ID0gQXJyYXlMaWtlPG51bWJlcj4+ID0geyBkYXRhOiBUQXJyYXksIGtleXM6IG51bWJlcltdIH07XG5leHBvcnQgdHlwZSBWYXJpYWJsZVdpZHRoTGF5b3V0PFRBcnJheSA9IEFycmF5TGlrZTxudW1iZXI+PiA9IHsgZGF0YTogVEFycmF5LCBvZmZzZXRzOiBudW1iZXJbXSB9O1xuZXhwb3J0IHR5cGUgVmFyaWFibGVXaWR0aERpY3Rpb25hcnlMYXlvdXQ8VEFycmF5ID0gQXJyYXlMaWtlPG51bWJlcj4+ID0geyBkYXRhOiBUQXJyYXksIGtleXM6IG51bWJlcltdLCBvZmZzZXRzOiBudW1iZXJbXSB9O1xuXG5leHBvcnQgdHlwZSB2YWx1ZXM8VCwgVE51bGw+ID0gQXJyYXlMaWtlPFQgfCBUTnVsbCB8IG51bGwgfCB1bmRlZmluZWQ+O1xuZXhwb3J0IHR5cGUgQnVmZmVyVmFsdWVXcml0ZXI8VD4gPSAoc3JjOiBBcnJheUxpa2U8VD4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpID0+IGJvb2xlYW4gfCB2b2lkO1xuZXhwb3J0IHR5cGUgQnVmZmVyV3JpdGVyPFQsIFROdWxsPiA9ICh2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gQnVmZmVyTGF5b3V0O1xuZXhwb3J0IHR5cGUgQnVmZmVyTGF5b3V0V3JpdGVyPFQsIFROdWxsPiA9ICh3cml0ZTogQnVmZmVyVmFsdWVXcml0ZXI8VD4sIHZhbHVlczogdmFsdWVzPFQsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ7XG5cbmNvbnN0IHdyaXRlTnVtZXJpYzY0VmFsdWUgPSB3cml0ZUZpeGVkV2lkdGhWYWx1ZS5iaW5kKG51bGwsIDY0KTtcbmNvbnN0IHdyaXRlTnVtZXJpYzEyOFZhbHVlID0gd3JpdGVGaXhlZFdpZHRoVmFsdWUuYmluZChudWxsLCAxMjgpO1xuY29uc3QgdXRmOEVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKSBhcyB7IGVuY29kZTogKHM6IHN0cmluZykgPT4gVWludDhBcnJheSB9O1xuXG5jb25zdCBzdHJpZGUxRW5jb2RlID0gd3JpdGVWYWxpZGl0eUxheW91dC5iaW5kKG51bGwsIHdyaXRlRml4ZWRXaWR0aExheW91dFdpdGhTdHJpZGUuYmluZChudWxsLCAxKSk7XG5jb25zdCBzdHJpZGUxRml4ZWRXaWR0aCA9IHdyaXRlRml4ZWRXaWR0aExheW91dC5iaW5kKG51bGwsIHdyaXRlVmFsaWRpdHlMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRW5jb2RlKSk7XG5jb25zdCBzdHJpZGUyRml4ZWRXaWR0aCA9IHdyaXRlRml4ZWRXaWR0aExheW91dC5iaW5kKG51bGwsIHdyaXRlVmFsaWRpdHlMYXlvdXQuYmluZChudWxsLCB3cml0ZUZpeGVkV2lkdGhMYXlvdXRXaXRoU3RyaWRlLmJpbmQobnVsbCwgMikpKTtcbmNvbnN0IHN0cmlkZTRGaXhlZFdpZHRoID0gd3JpdGVGaXhlZFdpZHRoTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVWYWxpZGl0eUxheW91dC5iaW5kKG51bGwsIHdyaXRlRml4ZWRXaWR0aExheW91dFdpdGhTdHJpZGUuYmluZChudWxsLCA0KSkpO1xuXG5leHBvcnQgY29uc3Qgd3JpdGVCb29scyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlQm9vbGVhblZhbHVlKSwgVWludDhBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPGJvb2xlYW4gfCBudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8VWludDhBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVJbnQ4cyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgSW50OEFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxJbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlSW50MTZzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLmJpbmQobnVsbCwgd3JpdGVOdW1lcmljVmFsdWUpLCBJbnQxNkFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8SW50MTZBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVJbnQzMnMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGguYmluZChudWxsLCB3cml0ZU51bWVyaWNWYWx1ZSksIEludDMyQXJyYXkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxJbnQzMkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZUludDY0cyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUyRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpYzY0VmFsdWUpLCBJbnQzMkFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gQnVmZmVyTGF5b3V0PEludDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlVWludDhzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLmJpbmQobnVsbCwgd3JpdGVOdW1lcmljVmFsdWUpLCBVaW50OEFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8VWludDhBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVVaW50MTZzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLmJpbmQobnVsbCwgd3JpdGVOdW1lcmljVmFsdWUpLCBVaW50MTZBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxVaW50MTZBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVVaW50MzJzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLmJpbmQobnVsbCwgd3JpdGVOdW1lcmljVmFsdWUpLCBVaW50MzJBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxVaW50MzJBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVVaW50NjRzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHN0cmlkZTJGaXhlZFdpZHRoLmJpbmQobnVsbCwgd3JpdGVOdW1lcmljNjRWYWx1ZSksIFVpbnQzMkFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxVaW50MzJBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEZWNpbWFscyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGU0Rml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpYzEyOFZhbHVlKSwgVWludDMyQXJyYXkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxVaW50MzJBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVGbG9hdDMycyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aC5iaW5kKG51bGwsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgRmxvYXQzMkFycmF5KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IEJ1ZmZlckxheW91dDxGbG9hdDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRmxvYXQ2NHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGguYmluZChudWxsLCB3cml0ZU51bWVyaWNWYWx1ZSksIEZsb2F0NjRBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBCdWZmZXJMYXlvdXQ8RmxvYXQ2NEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZVZhcmlhYmxlV2lkdGggPSB3cml0ZVZhcmlhYmxlV2lkdGhMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRW5jb2RlKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIDxULCBUTnVsbD4od3JpdGVWYWx1ZTogQnVmZmVyVmFsdWVXcml0ZXI8VD4sIHZhbHVlczogdmFsdWVzPFQsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBWYXJpYWJsZVdpZHRoTGF5b3V0PFVpbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlQmluYXJ5ID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlVmFyaWFibGVXaWR0aC5iaW5kKG51bGwsIHdyaXRlQmluYXJ5VmFsdWUpKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxJdGVyYWJsZTxudW1iZXI+LCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gVmFyaWFibGVXaWR0aExheW91dDxVaW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZVV0ZjhzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlVmFyaWFibGVXaWR0aC5iaW5kKG51bGwsIHdyaXRlVXRmOFZhbHVlKSwgVWludDhBcnJheSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8c3RyaW5nLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gVmFyaWFibGVXaWR0aExheW91dDxVaW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkID0gd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUVuY29kZSkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzIDxULCBUTnVsbD4od3JpdGVWYWx1ZTogQnVmZmVyVmFsdWVXcml0ZXI8VD4sIHZhbHVlczogdmFsdWVzPFQsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PFVpbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRCb29scyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZURpY3Rpb25hcnlMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aCwgd3JpdGVCb29sZWFuVmFsdWUpLCBVaW50OEFycmF5KSAgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxib29sZWFuIHwgbnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxVaW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkSW50OHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgSW50OEFycmF5KSAgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxJbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRJbnQxNnMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgSW50MTZBcnJheSkgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PEludDE2QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRJbnQzMnMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgSW50MzJBcnJheSkgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PEludDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRJbnQ2NHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMkZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpYzY0VmFsdWUpLCBJbnQzMkFycmF5KSAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PEludDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRVaW50OHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgVWludDhBcnJheSkgICAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PFVpbnQ4QXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRVaW50MTZzID0gd3JpdGVUeXBlZExheW91dC5iaW5kKG51bGwsIHdyaXRlRGljdGlvbmFyeUxheW91dC5iaW5kKG51bGwsIHN0cmlkZTFGaXhlZFdpZHRoLCB3cml0ZU51bWVyaWNWYWx1ZSksIFVpbnQxNkFycmF5KSAgICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PFVpbnQxNkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkVWludDMycyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZURpY3Rpb25hcnlMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aCwgd3JpdGVOdW1lcmljVmFsdWUpLCBVaW50MzJBcnJheSkgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxVaW50MzJBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZFVpbnQ2NHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMkZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpYzY0VmFsdWUpLCBVaW50MzJBcnJheSkgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPG51bWJlciwgVE51bGw+LCBudWxscz86IEFycmF5TGlrZTxUTnVsbD4pID0+IERpY3Rpb25hcnlMYXlvdXQ8VWludDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWREZWNpbWFscyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZURpY3Rpb25hcnlMYXlvdXQuYmluZChudWxsLCBzdHJpZGU0Rml4ZWRXaWR0aCwgd3JpdGVOdW1lcmljMTI4VmFsdWUpLCBVaW50MzJBcnJheSkgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PFVpbnQzMkFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkRmxvYXQzMnMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5TGF5b3V0LmJpbmQobnVsbCwgc3RyaWRlMUZpeGVkV2lkdGgsIHdyaXRlTnVtZXJpY1ZhbHVlKSwgRmxvYXQzMkFycmF5KSAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8bnVtYmVyLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gRGljdGlvbmFyeUxheW91dDxGbG9hdDMyQXJyYXk+O1xuZXhwb3J0IGNvbnN0IHdyaXRlRGljdGlvbmFyeUVuY29kZWRGbG9hdDY0cyA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZURpY3Rpb25hcnlMYXlvdXQuYmluZChudWxsLCBzdHJpZGUxRml4ZWRXaWR0aCwgd3JpdGVOdW1lcmljVmFsdWUpLCBGbG9hdDY0QXJyYXkpICAgYXMgPFROdWxsPih2YWx1ZXM6IHZhbHVlczxudW1iZXIsIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBEaWN0aW9uYXJ5TGF5b3V0PEZsb2F0NjRBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZFZhcmlhYmxlV2lkdGggPSB3cml0ZURpY3Rpb25hcnlMYXlvdXQuYmluZChudWxsLCB3cml0ZVZhcmlhYmxlV2lkdGgpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VCwgVE51bGw+KHdyaXRlVmFsdWU6IEJ1ZmZlclZhbHVlV3JpdGVyPFQ+LCB2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gVmFyaWFibGVXaWR0aERpY3Rpb25hcnlMYXlvdXQ8VWludDhBcnJheT47XG5leHBvcnQgY29uc3Qgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZEJpbmFyeSA9IHdyaXRlVHlwZWRMYXlvdXQuYmluZChudWxsLCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkVmFyaWFibGVXaWR0aC5iaW5kKG51bGwsIHdyaXRlQmluYXJ5VmFsdWUpKSAgICAgICAgICAgICAgICAgICAgICAgICBhcyA8VE51bGw+KHZhbHVlczogdmFsdWVzPEl0ZXJhYmxlPG51bWJlcj4sIFROdWxsPiwgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+KSA9PiBWYXJpYWJsZVdpZHRoRGljdGlvbmFyeUxheW91dDxVaW50OEFycmF5PjtcbmV4cG9ydCBjb25zdCB3cml0ZURpY3Rpb25hcnlFbmNvZGVkVXRmOHMgPSB3cml0ZVR5cGVkTGF5b3V0LmJpbmQobnVsbCwgd3JpdGVEaWN0aW9uYXJ5RW5jb2RlZFZhcmlhYmxlV2lkdGguYmluZChudWxsLCB3cml0ZVV0ZjhWYWx1ZSksIFVpbnQ4QXJyYXkpICAgICAgICAgICAgICAgIGFzIDxUTnVsbD4odmFsdWVzOiB2YWx1ZXM8c3RyaW5nLCBUTnVsbD4sIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPikgPT4gVmFyaWFibGVXaWR0aERpY3Rpb25hcnlMYXlvdXQ8VWludDhBcnJheT47XG5cbmZ1bmN0aW9uIHdyaXRlRml4ZWRXaWR0aExheW91dFdpdGhTdHJpZGU8VCwgVE51bGw+KFxuICAgIHN0cmlkZTogbnVtYmVyLFxuICAgIHdyaXRlVmFsdWU6IEJ1ZmZlclZhbHVlV3JpdGVyPFQ+LFxuICAgIHZhbHVlczogdmFsdWVzPFQsIFROdWxsPlxuKSB7XG4gICAgbGV0IGluZGV4ID0gLXN0cmlkZTtcbiAgICBjb25zdCBkYXRhID0gW10gYXMgbnVtYmVyW107XG4gICAgY29uc3QgbGVuZ3RoID0gdmFsdWVzLmxlbmd0aDtcbiAgICB3aGlsZSAoKGluZGV4ICs9IHN0cmlkZSkgPCBsZW5ndGgpIHtcbiAgICAgICAgd3JpdGVWYWx1ZSh2YWx1ZXMgYXMgQXJyYXlMaWtlPFQ+LCBkYXRhLCBpbmRleCk7XG4gICAgfVxuICAgIHJldHVybiB7IGRhdGE6IGRhdGEgYXMgQXJyYXlMaWtlPG51bWJlcj4gfTtcbn1cblxuZnVuY3Rpb24gd3JpdGVGaXhlZFdpZHRoTGF5b3V0PFQsIFROdWxsPihcbiAgICB3cml0ZUxheW91dDogQnVmZmVyTGF5b3V0V3JpdGVyPFQsIFROdWxsPixcbiAgICB3cml0ZVZhbHVlOiBCdWZmZXJWYWx1ZVdyaXRlcjxUPixcbiAgICB2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD4sXG4gICAgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+XG4pIHtcbiAgICByZXR1cm4gd3JpdGVMYXlvdXQod3JpdGVWYWx1ZSwgdmFsdWVzLCBudWxscyk7XG59XG5cbmZ1bmN0aW9uIHdyaXRlVmFsaWRpdHlMYXlvdXQ8VCwgVE51bGw+KFxuICAgIHdyaXRlTGF5b3V0OiBCdWZmZXJMYXlvdXRXcml0ZXI8VCwgVE51bGw+LFxuICAgIHdyaXRlVmFsdWU6IEJ1ZmZlclZhbHVlV3JpdGVyPFQ+LFxuICAgIHZhbHVlczogdmFsdWVzPFQsIFROdWxsPixcbiAgICBudWxscz86IEFycmF5TGlrZTxUTnVsbD5cbikge1xuICAgIGxldCBudWxsQ291bnQgPSAwO1xuICAgIGxldCBudWxsc0xlbmd0aCA9IG51bGxzICYmIG51bGxzLmxlbmd0aCB8fCAwO1xuICAgIGxldCB2YWxpZGl0eSA9IG5ldyBVaW50OEFycmF5KGFsaWduKHZhbHVlcy5sZW5ndGggPj4+IDMsIDgpKS5maWxsKDI1NSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgLi4ud3JpdGVMYXlvdXQod3JpdGVWYWx1ZU9yVmFsaWRpdHksIHZhbHVlcyksXG4gICAgICAgIG51bGxDb3VudCwgdmFsaWRpdHk6IChudWxsQ291bnQgPiAwICYmIHZhbGlkaXR5KSB8fCBuZXcgVWludDhBcnJheSgwKVxuICAgIH0gYXMgQnVmZmVyTGF5b3V0ICYgTnVsbGFibGVMYXlvdXQ7XG4gICAgZnVuY3Rpb24gd3JpdGVWYWx1ZU9yVmFsaWRpdHkoc3JjOiBBcnJheUxpa2U8VD4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgd3JpdGVWYWx1ZShzcmMsIGRzdCwgaW5kZXgpO1xuICAgICAgICBsZXQgaSA9IC0xLCB4ID0gc3JjW2luZGV4XSBhcyBUIHwgVE51bGw7XG4gICAgICAgIGxldCBpc051bGwgPSB4ID09PSBudWxsIHx8IHggPT09IHVuZGVmaW5lZDtcbiAgICAgICAgd2hpbGUgKCFpc051bGwgJiYgKytpIDwgbnVsbHNMZW5ndGgpIHtcbiAgICAgICAgICAgIGlzTnVsbCA9IHggPT09IG51bGxzIVtpXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNOdWxsKSB7XG4gICAgICAgICAgICBudWxsQ291bnQrKztcbiAgICAgICAgICAgIHZhbGlkaXR5W2luZGV4ID4+IDNdICY9IH4oMSA8PCAoaW5kZXggJSA4KSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIHdyaXRlVmFyaWFibGVXaWR0aExheW91dDxULCBUTnVsbD4oXG4gICAgd3JpdGVMYXlvdXQ6IEJ1ZmZlckxheW91dFdyaXRlcjxULCBUTnVsbD4sXG4gICAgd3JpdGVWYWx1ZTogQnVmZmVyVmFsdWVXcml0ZXI8VD4sXG4gICAgdmFsdWVzOiB2YWx1ZXM8VCwgVE51bGw+LFxuICAgIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPlxuKSB7XG4gICAgbGV0IG9mZnNldHMgPSBbMF0sIG9mZnNldHNJbmRleCA9IDA7XG4gICAgcmV0dXJuIHsgLi4ud3JpdGVMYXlvdXQod3JpdGVWYWx1ZUFuZE9mZnNldCwgdmFsdWVzLCBudWxscyksIG9mZnNldHMgfSBhcyBWYXJpYWJsZVdpZHRoTGF5b3V0O1xuICAgIGZ1bmN0aW9uIHdyaXRlVmFsdWVBbmRPZmZzZXQoc3JjOiBBcnJheUxpa2U8VD4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgaWYgKCF3cml0ZVZhbHVlKHNyYywgZHN0LCBpbmRleCkpIHtcbiAgICAgICAgICAgIG9mZnNldHNbKytvZmZzZXRzSW5kZXhdID0gZHN0Lmxlbmd0aDtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gd3JpdGVEaWN0aW9uYXJ5TGF5b3V0PFQsIFROdWxsPihcbiAgICB3cml0ZUxheW91dDogQnVmZmVyTGF5b3V0V3JpdGVyPFQsIFROdWxsPixcbiAgICB3cml0ZVZhbHVlOiBCdWZmZXJWYWx1ZVdyaXRlcjxUPixcbiAgICB2YWx1ZXM6IHZhbHVlczxULCBUTnVsbD4sXG4gICAgbnVsbHM/OiBBcnJheUxpa2U8VE51bGw+XG4pIHtcbiAgICBsZXQga2V5cyA9IFtdIGFzIG51bWJlcltdLCBrZXlzSW5kZXggPSAwLCBrZXlzTWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICByZXR1cm4geyAuLi53cml0ZUxheW91dCh3cml0ZUtleXNPclZhbHVlcywgdmFsdWVzLCBudWxscyksIGtleXMgfTtcbiAgICBmdW5jdGlvbiB3cml0ZUtleXNPclZhbHVlcyhzcmM6IEFycmF5TGlrZTxUPiwgZHN0OiBudW1iZXJbXSwgaW5kZXg6IG51bWJlcikge1xuICAgICAgICBjb25zdCB4OiBhbnkgPSBzcmNbaW5kZXhdO1xuICAgICAgICBpZiAoeCBpbiBrZXlzTWFwKSB7XG4gICAgICAgICAgICByZXR1cm4gKGtleXNbaW5kZXhdID0ga2V5c01hcFt4XSkgfHwgdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmICghd3JpdGVWYWx1ZShzcmMsIGRzdCwgaW5kZXgpKSB7XG4gICAgICAgICAgICBrZXlzW2luZGV4XSA9IGtleXNNYXBbeF0gPSBrZXlzSW5kZXgrKztcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gd3JpdGVUeXBlZExheW91dDxULCBUTnVsbCwgVEFycmF5IGV4dGVuZHMgVHlwZWRBcnJheT4oXG4gICAgd3JpdGVCdWZmZXJzOiBCdWZmZXJXcml0ZXI8VCwgVE51bGw+LFxuICAgIEFycmF5QnVmZmVyVmlldzogVHlwZWRBcnJheUNvbnN0cnVjdG9yPFRBcnJheT4sXG4gICAgdmFsdWVzOiB2YWx1ZXM8VCwgVE51bGw+LFxuICAgIG51bGxzPzogQXJyYXlMaWtlPFROdWxsPlxuKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gd3JpdGVCdWZmZXJzKHZhbHVlcywgbnVsbHMpO1xuICAgIHJlc3VsdC5kYXRhID0gbmV3IEFycmF5QnVmZmVyVmlldyhyZXN1bHQuZGF0YSk7XG4gICAgcmV0dXJuIHJlc3VsdCBhcyBCdWZmZXJMYXlvdXQ8VEFycmF5Pjtcbn1cblxuZnVuY3Rpb24gd3JpdGVCb29sZWFuVmFsdWUoc3JjOiBBcnJheUxpa2U8Ym9vbGVhbj4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICBpZiAoc3JjW2luZGV4XSkge1xuICAgICAgICBsZXQgaSA9IGluZGV4ID4+PiAzO1xuICAgICAgICBsZXQgYiA9IGRzdFtpXSB8fCAwO1xuICAgICAgICBkc3RbaV0gPSBiIHwgMSA8PCAoaW5kZXggJSA4KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHdyaXRlTnVtZXJpY1ZhbHVlKHNyYzogQXJyYXlMaWtlPG51bWJlcj4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICBkc3RbaW5kZXhdID0gK3NyY1tpbmRleF07XG59XG5cbmZ1bmN0aW9uIHdyaXRlRml4ZWRXaWR0aFZhbHVlKGJpdFdpZHRoOiBudW1iZXIsIHNyYzogQXJyYXlMaWtlPG51bWJlcj4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBieXRlc0xlbiA9IGJpdFdpZHRoIC8gMzI7XG4gICAgZm9yIChsZXQgaSA9IC0xOyArK2kgPCBieXRlc0xlbjspIHtcbiAgICAgICAgZHN0W2luZGV4ICsgaV0gPSBzcmNbaW5kZXggKyBpXTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHdyaXRlVXRmOFZhbHVlKHNyYzogQXJyYXlMaWtlPHN0cmluZz4sIGRzdDogbnVtYmVyW10sIGluZGV4OiBudW1iZXIpIHtcbiAgICBkc3QucHVzaCguLi51dGY4RW5jb2Rlci5lbmNvZGUoc3JjW2luZGV4XSkpO1xufVxuXG5mdW5jdGlvbiB3cml0ZUJpbmFyeVZhbHVlKHNyYzogQXJyYXlMaWtlPEl0ZXJhYmxlPG51bWJlcj4+LCBkc3Q6IG51bWJlcltdLCBpbmRleDogbnVtYmVyKSB7XG4gICAgZHN0LnB1c2goLi4uc3JjW2luZGV4XSk7XG59XG4iXX0=
