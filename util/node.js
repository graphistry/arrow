"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
class PipeIterator {
    constructor(iterator, encoding) {
        this.iterator = iterator;
        this.encoding = encoding;
    }
    [Symbol.iterator]() { return this.iterator; }
    next(value) { return this.iterator.next(value); }
    throw(error) {
        if (typeof this.iterator.throw === 'function') {
            return this.iterator.throw(error);
        }
        return { done: true, value: null };
    }
    return(value) {
        if (typeof this.iterator.return === 'function') {
            return this.iterator.return(value);
        }
        return { done: true, value: null };
    }
    pipe(stream) {
        let { encoding } = this;
        let res;
        let write = (err) => {
            stream['removeListener']('error', write);
            stream['removeListener']('drain', write);
            if (err)
                return this.throw(err);
            if (stream['writable']) {
                do {
                    if ((res = this.next()).done)
                        break;
                } while (emit(stream, encoding, res.value));
            }
            return wait(stream, res && res.done, write);
        };
        write();
        return stream;
    }
}
exports.PipeIterator = PipeIterator;
class AsyncPipeIterator {
    constructor(iterator, encoding) {
        this.iterator = iterator;
        this.encoding = encoding;
    }
    [Symbol.asyncIterator]() { return this.iterator; }
    next(value) { return this.iterator.next(value); }
    throw(error) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            if (typeof this.iterator.throw === 'function') {
                return this.iterator.throw(error);
            }
            return { done: true, value: null };
        });
    }
    return(value) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            if (typeof this.iterator.return === 'function') {
                return this.iterator.return(value);
            }
            return { done: true, value: null };
        });
    }
    pipe(stream) {
        let { encoding } = this;
        let res;
        let write = (err) => tslib_1.__awaiter(this, void 0, void 0, function* () {
            stream['removeListener']('error', write);
            stream['removeListener']('drain', write);
            if (err)
                return this.throw(err);
            if (stream['writable']) {
                do {
                    if ((res = yield this.next()).done)
                        break;
                } while (emit(stream, encoding, res.value));
            }
            return wait(stream, res && res.done, write);
        });
        write();
        return stream;
    }
}
exports.AsyncPipeIterator = AsyncPipeIterator;
const toBufferOrUint8Array = (() => {
    // If in node, convert Uint8Arrays to Buffer instances. This is necessary
    // because some node APIs ('http' etc.) don't work unless you give them Buffers.
    // This eval also defeats closure-compiler, which doesn't recognize the Buffer constructor.
    const BufferCtor = eval('typeof Buffer !== "undefined" ? Buffer : null');
    return !BufferCtor ? (arr) => arr :
        (arr) => BufferCtor.from(arr.buffer, arr.byteOffset, arr.byteLength);
})();
function emit(stream, encoding, value) {
    return stream['write']((encoding === 'utf8' ? value + '\n' : toBufferOrUint8Array(value)), encoding);
}
function wait(stream, done, write) {
    const p = eval('process'); // defeat closure compiler
    if (!done) {
        stream['once']('error', write);
        stream['once']('drain', write);
    }
    else if (!(!p || stream === p.stdout) && !stream['isTTY']) {
        stream['end'](null);
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWwvbm9kZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQTtJQUNJLFlBQXNCLFFBQTZCLEVBQVksUUFBYztRQUF2RCxhQUFRLEdBQVIsUUFBUSxDQUFxQjtRQUFZLGFBQVEsR0FBUixRQUFRLENBQU07SUFBRyxDQUFDO0lBQ2pGLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDN0MsSUFBSSxDQUFDLEtBQVcsSUFBSSxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN2RCxLQUFLLENBQUMsS0FBVztRQUNiLElBQUksT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssS0FBSyxVQUFVLEVBQUU7WUFDM0MsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNyQztRQUNELE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFXLEVBQUUsQ0FBQztJQUM5QyxDQUFDO0lBQ0QsTUFBTSxDQUFDLEtBQVc7UUFDZCxJQUFJLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEtBQUssVUFBVSxFQUFFO1lBQzVDLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDdEM7UUFDRCxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBVyxFQUFFLENBQUM7SUFDOUMsQ0FBQztJQUNELElBQUksQ0FBQyxNQUE2QjtRQUM5QixJQUFJLEVBQUUsUUFBUSxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQ3hCLElBQUksR0FBc0IsQ0FBQztRQUMzQixJQUFJLEtBQUssR0FBRyxDQUFDLEdBQVMsRUFBRSxFQUFFO1lBQ3RCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztZQUN6QyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDekMsSUFBSSxHQUFHO2dCQUFFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNoQyxJQUFJLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRTtnQkFDcEIsR0FBRztvQkFDQyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUk7d0JBQUUsTUFBTTtpQkFDdkMsUUFBUSxJQUFJLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7YUFDL0M7WUFDRCxPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDO1FBQ0YsS0FBSyxFQUFFLENBQUM7UUFDUixPQUFPLE1BQU0sQ0FBQztJQUNsQixDQUFDO0NBQ0o7QUFqQ0Qsb0NBaUNDO0FBRUQ7SUFDSSxZQUFzQixRQUFrQyxFQUFZLFFBQWM7UUFBNUQsYUFBUSxHQUFSLFFBQVEsQ0FBMEI7UUFBWSxhQUFRLEdBQVIsUUFBUSxDQUFNO0lBQUcsQ0FBQztJQUN0RixDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsS0FBSyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO0lBQ2xELElBQUksQ0FBQyxLQUFXLElBQUksT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDakQsS0FBSyxDQUFDLEtBQVc7O1lBQ25CLElBQUksT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssS0FBSyxVQUFVLEVBQUU7Z0JBQzNDLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDckM7WUFDRCxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBVyxFQUFFLENBQUM7UUFDOUMsQ0FBQztLQUFBO0lBQ0ssTUFBTSxDQUFDLEtBQVc7O1lBQ3BCLElBQUksT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxVQUFVLEVBQUU7Z0JBQzVDLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDdEM7WUFDRCxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBVyxFQUFFLENBQUM7UUFDOUMsQ0FBQztLQUFBO0lBQ0QsSUFBSSxDQUFDLE1BQTZCO1FBQzlCLElBQUksRUFBRSxRQUFRLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDeEIsSUFBSSxHQUFzQixDQUFDO1FBQzNCLElBQUksS0FBSyxHQUFHLENBQU8sR0FBUyxFQUFFLEVBQUU7WUFDNUIsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3pDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztZQUN6QyxJQUFJLEdBQUc7Z0JBQUUsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2hDLElBQUksTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFO2dCQUNwQixHQUFHO29CQUNDLElBQUksQ0FBQyxHQUFHLEdBQUcsTUFBTSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJO3dCQUFFLE1BQU07aUJBQzdDLFFBQVEsSUFBSSxDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFO2FBQy9DO1lBQ0QsT0FBTyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ2hELENBQUMsQ0FBQSxDQUFDO1FBQ0YsS0FBSyxFQUFFLENBQUM7UUFDUixPQUFPLE1BQU0sQ0FBQztJQUNsQixDQUFDO0NBQ0o7QUFqQ0QsOENBaUNDO0FBRUQsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLEdBQUcsRUFBRTtJQUMvQix5RUFBeUU7SUFDekUsZ0ZBQWdGO0lBQ2hGLDJGQUEyRjtJQUMzRixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsK0NBQStDLENBQUMsQ0FBQztJQUN6RSxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQWUsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDM0MsQ0FBQyxHQUFlLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUN6RixDQUFDLENBQUMsRUFBRSxDQUFDO0FBRUwsY0FBYyxNQUE2QixFQUFFLFFBQWdCLEVBQUUsS0FBVTtJQUNyRSxPQUFPLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFFBQVEsS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxDQUFRLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDaEgsQ0FBQztBQUVELGNBQWMsTUFBNkIsRUFBRSxJQUFhLEVBQUUsS0FBd0I7SUFDaEYsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsMEJBQTBCO0lBQ3JELElBQUksQ0FBQyxJQUFJLEVBQUU7UUFDUCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQy9CLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7S0FDbEM7U0FBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxNQUFNLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUUsTUFBYyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ2xFLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBTyxJQUFJLENBQUMsQ0FBQztLQUM3QjtBQUNMLENBQUMiLCJmaWxlIjoidXRpbC9ub2RlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG5leHBvcnQgY2xhc3MgUGlwZUl0ZXJhdG9yPFQ+IGltcGxlbWVudHMgSXRlcmFibGVJdGVyYXRvcjxUPiB7XG4gICAgY29uc3RydWN0b3IocHJvdGVjdGVkIGl0ZXJhdG9yOiBJdGVyYWJsZUl0ZXJhdG9yPFQ+LCBwcm90ZWN0ZWQgZW5jb2Rpbmc/OiBhbnkpIHt9XG4gICAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7IHJldHVybiB0aGlzLml0ZXJhdG9yOyB9XG4gICAgbmV4dCh2YWx1ZT86IGFueSkgeyByZXR1cm4gdGhpcy5pdGVyYXRvci5uZXh0KHZhbHVlKTsgfVxuICAgIHRocm93KGVycm9yPzogYW55KSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5pdGVyYXRvci50aHJvdyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXRlcmF0b3IudGhyb3coZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGRvbmU6IHRydWUsIHZhbHVlOiBudWxsIGFzIGFueSB9O1xuICAgIH1cbiAgICByZXR1cm4odmFsdWU/OiBhbnkpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLml0ZXJhdG9yLnJldHVybiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXRlcmF0b3IucmV0dXJuKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBkb25lOiB0cnVlLCB2YWx1ZTogbnVsbCBhcyBhbnkgfTtcbiAgICB9XG4gICAgcGlwZShzdHJlYW06IE5vZGVKUy5Xcml0YWJsZVN0cmVhbSkge1xuICAgICAgICBsZXQgeyBlbmNvZGluZyB9ID0gdGhpcztcbiAgICAgICAgbGV0IHJlczogSXRlcmF0b3JSZXN1bHQ8VD47XG4gICAgICAgIGxldCB3cml0ZSA9IChlcnI/OiBhbnkpID0+IHtcbiAgICAgICAgICAgIHN0cmVhbVsncmVtb3ZlTGlzdGVuZXInXSgnZXJyb3InLCB3cml0ZSk7XG4gICAgICAgICAgICBzdHJlYW1bJ3JlbW92ZUxpc3RlbmVyJ10oJ2RyYWluJywgd3JpdGUpO1xuICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIHRoaXMudGhyb3coZXJyKTtcbiAgICAgICAgICAgIGlmIChzdHJlYW1bJ3dyaXRhYmxlJ10pIHtcbiAgICAgICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgocmVzID0gdGhpcy5uZXh0KCkpLmRvbmUpIGJyZWFrO1xuICAgICAgICAgICAgICAgIH0gd2hpbGUgKGVtaXQoc3RyZWFtLCBlbmNvZGluZywgcmVzLnZhbHVlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gd2FpdChzdHJlYW0sIHJlcyAmJiByZXMuZG9uZSwgd3JpdGUpO1xuICAgICAgICB9O1xuICAgICAgICB3cml0ZSgpO1xuICAgICAgICByZXR1cm4gc3RyZWFtO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEFzeW5jUGlwZUl0ZXJhdG9yPFQ+IGltcGxlbWVudHMgQXN5bmNJdGVyYWJsZUl0ZXJhdG9yPFQ+IHtcbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaXRlcmF0b3I6IEFzeW5jSXRlcmFibGVJdGVyYXRvcjxUPiwgcHJvdGVjdGVkIGVuY29kaW5nPzogYW55KSB7fVxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7IHJldHVybiB0aGlzLml0ZXJhdG9yOyB9XG4gICAgbmV4dCh2YWx1ZT86IGFueSkgeyByZXR1cm4gdGhpcy5pdGVyYXRvci5uZXh0KHZhbHVlKTsgfVxuICAgIGFzeW5jIHRocm93KGVycm9yPzogYW55KSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5pdGVyYXRvci50aHJvdyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXRlcmF0b3IudGhyb3coZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IGRvbmU6IHRydWUsIHZhbHVlOiBudWxsIGFzIGFueSB9O1xuICAgIH1cbiAgICBhc3luYyByZXR1cm4odmFsdWU/OiBhbnkpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLml0ZXJhdG9yLnJldHVybiA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXRlcmF0b3IucmV0dXJuKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBkb25lOiB0cnVlLCB2YWx1ZTogbnVsbCBhcyBhbnkgfTtcbiAgICB9XG4gICAgcGlwZShzdHJlYW06IE5vZGVKUy5Xcml0YWJsZVN0cmVhbSkge1xuICAgICAgICBsZXQgeyBlbmNvZGluZyB9ID0gdGhpcztcbiAgICAgICAgbGV0IHJlczogSXRlcmF0b3JSZXN1bHQ8VD47XG4gICAgICAgIGxldCB3cml0ZSA9IGFzeW5jIChlcnI/OiBhbnkpID0+IHtcbiAgICAgICAgICAgIHN0cmVhbVsncmVtb3ZlTGlzdGVuZXInXSgnZXJyb3InLCB3cml0ZSk7XG4gICAgICAgICAgICBzdHJlYW1bJ3JlbW92ZUxpc3RlbmVyJ10oJ2RyYWluJywgd3JpdGUpO1xuICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIHRoaXMudGhyb3coZXJyKTtcbiAgICAgICAgICAgIGlmIChzdHJlYW1bJ3dyaXRhYmxlJ10pIHtcbiAgICAgICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgocmVzID0gYXdhaXQgdGhpcy5uZXh0KCkpLmRvbmUpIGJyZWFrO1xuICAgICAgICAgICAgICAgIH0gd2hpbGUgKGVtaXQoc3RyZWFtLCBlbmNvZGluZywgcmVzLnZhbHVlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gd2FpdChzdHJlYW0sIHJlcyAmJiByZXMuZG9uZSwgd3JpdGUpO1xuICAgICAgICB9O1xuICAgICAgICB3cml0ZSgpO1xuICAgICAgICByZXR1cm4gc3RyZWFtO1xuICAgIH1cbn1cblxuY29uc3QgdG9CdWZmZXJPclVpbnQ4QXJyYXkgPSAoKCkgPT4ge1xuICAgIC8vIElmIGluIG5vZGUsIGNvbnZlcnQgVWludDhBcnJheXMgdG8gQnVmZmVyIGluc3RhbmNlcy4gVGhpcyBpcyBuZWNlc3NhcnlcbiAgICAvLyBiZWNhdXNlIHNvbWUgbm9kZSBBUElzICgnaHR0cCcgZXRjLikgZG9uJ3Qgd29yayB1bmxlc3MgeW91IGdpdmUgdGhlbSBCdWZmZXJzLlxuICAgIC8vIFRoaXMgZXZhbCBhbHNvIGRlZmVhdHMgY2xvc3VyZS1jb21waWxlciwgd2hpY2ggZG9lc24ndCByZWNvZ25pemUgdGhlIEJ1ZmZlciBjb25zdHJ1Y3Rvci5cbiAgICBjb25zdCBCdWZmZXJDdG9yID0gZXZhbCgndHlwZW9mIEJ1ZmZlciAhPT0gXCJ1bmRlZmluZWRcIiA/IEJ1ZmZlciA6IG51bGwnKTtcbiAgICByZXR1cm4gIUJ1ZmZlckN0b3IgPyAoYXJyOiBVaW50OEFycmF5KSA9PiBhcnIgOlxuICAgICAgICAoYXJyOiBVaW50OEFycmF5KSA9PiBCdWZmZXJDdG9yLmZyb20oYXJyLmJ1ZmZlciwgYXJyLmJ5dGVPZmZzZXQsIGFyci5ieXRlTGVuZ3RoKTtcbn0pKCk7XG5cbmZ1bmN0aW9uIGVtaXQoc3RyZWFtOiBOb2RlSlMuV3JpdGFibGVTdHJlYW0sIGVuY29kaW5nOiBzdHJpbmcsIHZhbHVlOiBhbnkpIHtcbiAgICByZXR1cm4gc3RyZWFtWyd3cml0ZSddKChlbmNvZGluZyA9PT0gJ3V0ZjgnID8gdmFsdWUgKyAnXFxuJyA6IHRvQnVmZmVyT3JVaW50OEFycmF5KHZhbHVlKSkgYXMgYW55LCBlbmNvZGluZyk7XG59XG5cbmZ1bmN0aW9uIHdhaXQoc3RyZWFtOiBOb2RlSlMuV3JpdGFibGVTdHJlYW0sIGRvbmU6IGJvb2xlYW4sIHdyaXRlOiAoeD86IGFueSkgPT4gdm9pZCkge1xuICAgIGNvbnN0IHAgPSBldmFsKCdwcm9jZXNzJyk7IC8vIGRlZmVhdCBjbG9zdXJlIGNvbXBpbGVyXG4gICAgaWYgKCFkb25lKSB7XG4gICAgICAgIHN0cmVhbVsnb25jZSddKCdlcnJvcicsIHdyaXRlKTtcbiAgICAgICAgc3RyZWFtWydvbmNlJ10oJ2RyYWluJywgd3JpdGUpO1xuICAgIH0gZWxzZSBpZiAoISghcCB8fCBzdHJlYW0gPT09IHAuc3Rkb3V0KSAmJiAhKHN0cmVhbSBhcyBhbnkpWydpc1RUWSddKSB7XG4gICAgICAgIHN0cmVhbVsnZW5kJ10oPGFueT4gbnVsbCk7XG4gICAgfVxufVxuIl19
