// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
export function align(value, alignment) {
    return value + padding(value, alignment);
}
export function padding(value, alignment) {
    return (value % alignment === 0 ? 0 : alignment - value % alignment);
}
export function getBool(_data, _index, byte, bit) {
    return (byte & 1 << bit) !== 0;
}
export function getBit(_data, _index, byte, bit) {
    return (byte & 1 << bit) >> bit;
}
export function setBool(bytes, index, value) {
    return value ?
        !!(bytes[index >> 3] |= (1 << (index % 8))) || true :
        !(bytes[index >> 3] &= ~(1 << (index % 8))) && false;
}
export function packBools(values) {
    let n = 0, i = 0;
    let xs = [];
    let bit = 0, byte = 0;
    for (const value of values) {
        value && (byte |= 1 << bit);
        if (++bit === 8) {
            xs[i++] = byte;
            byte = bit = 0;
        }
    }
    if (i === 0 || bit > 0) {
        xs[i++] = byte;
    }
    if (i % 8 && (n = i + 8 - i % 8)) {
        do {
            xs[i] = 0;
        } while (++i < n);
    }
    return new Uint8Array(xs);
}
export function* iterateBits(bytes, begin, length, context, get) {
    let bit = begin % 8;
    let byteIndex = begin >> 3;
    let index = 0, remaining = length;
    for (; remaining > 0; bit = 0) {
        let byte = bytes[byteIndex++];
        do {
            yield get(context, index++, byte, bit);
        } while (--remaining > 0 && ++bit < 8);
    }
}
/**
 * Compute the population count (the number of bits set to 1) for a range of bits in a Uint8Array.
 * @param vector The Uint8Array of bits for which to compute the population count.
 * @param lhs The range's left-hand side (or start) bit
 * @param rhs The range's right-hand side (or end) bit
 */
export function popcnt_bit_range(data, lhs, rhs) {
    if (rhs - lhs <= 0) {
        return 0;
    }
    // If the bit range is less than one byte, sum the 1 bits in the bit range
    if (rhs - lhs < 8) {
        let sum = 0;
        for (const bit of iterateBits(data, lhs, rhs - lhs, data, getBit)) {
            sum += bit;
        }
        return sum;
    }
    // Get the next lowest multiple of 8 from the right hand side
    const rhsInside = rhs >> 3 << 3;
    // Get the next highest multiple of 8 from the left hand side
    const lhsInside = lhs + (lhs % 8 === 0 ? 0 : 8 - lhs % 8);
    return (
    // Get the popcnt of bits between the left hand side, and the next highest multiple of 8
    popcnt_bit_range(data, lhs, lhsInside) +
        // Get the popcnt of bits between the right hand side, and the next lowest multiple of 8
        popcnt_bit_range(data, rhsInside, rhs) +
        // Get the popcnt of all bits between the left and right hand sides' multiples of 8
        popcnt_array(data, lhsInside >> 3, (rhsInside - lhsInside) >> 3));
}
export function popcnt_array(arr, byteOffset, byteLength) {
    let cnt = 0, pos = byteOffset | 0;
    const view = new DataView(arr.buffer, arr.byteOffset, arr.byteLength);
    const len = byteLength === void 0 ? arr.byteLength : pos + byteLength;
    while (len - pos >= 4) {
        cnt += popcnt_uint32(view.getUint32(pos));
        pos += 4;
    }
    while (len - pos >= 2) {
        cnt += popcnt_uint32(view.getUint16(pos));
        pos += 2;
    }
    while (len - pos >= 1) {
        cnt += popcnt_uint32(view.getUint8(pos));
        pos += 1;
    }
    return cnt;
}
export function popcnt_uint32(uint32) {
    let i = uint32 | 0;
    i = i - ((i >>> 1) & 0x55555555);
    i = (i & 0x33333333) + ((i >>> 2) & 0x33333333);
    return (((i + (i >>> 4)) & 0x0F0F0F0F) * 0x01010101) >>> 24;
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWwvYml0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDZEQUE2RDtBQUM3RCwrREFBK0Q7QUFDL0Qsd0RBQXdEO0FBQ3hELDZEQUE2RDtBQUM3RCxvREFBb0Q7QUFDcEQsNkRBQTZEO0FBQzdELDZEQUE2RDtBQUM3RCxFQUFFO0FBQ0YsK0NBQStDO0FBQy9DLEVBQUU7QUFDRiw2REFBNkQ7QUFDN0QsOERBQThEO0FBQzlELHlEQUF5RDtBQUN6RCw0REFBNEQ7QUFDNUQsMERBQTBEO0FBQzFELHFCQUFxQjtBQUlyQixNQUFNLFVBQVUsS0FBSyxDQUFDLEtBQWEsRUFBRSxTQUFpQjtJQUNsRCxPQUFPLEtBQUssR0FBRyxPQUFPLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQzdDLENBQUM7QUFFRCxNQUFNLFVBQVUsT0FBTyxDQUFDLEtBQWEsRUFBRSxTQUFpQjtJQUNwRCxPQUFPLENBQUMsS0FBSyxHQUFHLFNBQVMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLEtBQUssR0FBRyxTQUFTLENBQUMsQ0FBQztBQUN6RSxDQUFDO0FBRUQsTUFBTSxVQUFVLE9BQU8sQ0FBQyxLQUFVLEVBQUUsTUFBYyxFQUFFLElBQVksRUFBRSxHQUFXO0lBQ3pFLE9BQU8sQ0FBQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNuQyxDQUFDO0FBRUQsTUFBTSxVQUFVLE1BQU0sQ0FBQyxLQUFVLEVBQUUsTUFBYyxFQUFFLElBQVksRUFBRSxHQUFXO0lBQ3hFLE9BQU8sQ0FBQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEdBQWMsQ0FBQztBQUMvQyxDQUFDO0FBRUQsTUFBTSxVQUFVLE9BQU8sQ0FBQyxLQUFpQixFQUFFLEtBQWEsRUFBRSxLQUFVO0lBQ2hFLE9BQU8sS0FBSyxDQUFDLENBQUM7UUFDVixDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxJQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQztRQUN0RCxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLENBQUU7QUFDOUQsQ0FBQztBQUVELE1BQU0sVUFBVSxTQUFTLENBQUMsTUFBcUI7SUFDM0MsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakIsSUFBSSxFQUFFLEdBQWEsRUFBRSxDQUFDO0lBQ3RCLElBQUksR0FBRyxHQUFHLENBQUMsRUFBRSxJQUFJLEdBQUcsQ0FBQyxDQUFDO0lBQ3RCLEtBQUssTUFBTSxLQUFLLElBQUksTUFBTSxFQUFFO1FBQ3hCLEtBQUssSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7UUFDNUIsSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLEVBQUU7WUFDYixFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDZixJQUFJLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQztTQUNsQjtLQUNKO0lBQ0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLEVBQUU7UUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUM7S0FBRTtJQUMzQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7UUFDOUIsR0FBRztZQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7U0FBRSxRQUFRLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRTtLQUNyQztJQUNELE9BQU8sSUFBSSxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDOUIsQ0FBQztBQUVELE1BQU0sU0FBUyxDQUFDLENBQUMsV0FBVyxDQUFJLEtBQWlCLEVBQUUsS0FBYSxFQUFFLE1BQWMsRUFBRSxPQUFZLEVBQzlELEdBQWtFO0lBQzlGLElBQUksR0FBRyxHQUFHLEtBQUssR0FBRyxDQUFDLENBQUM7SUFDcEIsSUFBSSxTQUFTLEdBQUcsS0FBSyxJQUFJLENBQUMsQ0FBQztJQUMzQixJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsU0FBUyxHQUFHLE1BQU0sQ0FBQztJQUNsQyxPQUFPLFNBQVMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUMsRUFBRTtRQUMzQixJQUFJLElBQUksR0FBRyxLQUFLLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztRQUM5QixHQUFHO1lBQ0MsTUFBTSxHQUFHLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztTQUMxQyxRQUFRLEVBQUUsU0FBUyxHQUFHLENBQUMsSUFBSSxFQUFFLEdBQUcsR0FBRyxDQUFDLEVBQUU7S0FDMUM7QUFDTCxDQUFDO0FBRUQ7Ozs7O0dBS0c7QUFDSCxNQUFNLFVBQVUsZ0JBQWdCLENBQUMsSUFBZ0IsRUFBRSxHQUFXLEVBQUUsR0FBVztJQUN2RSxJQUFJLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxFQUFFO1FBQUUsT0FBTyxDQUFDLENBQUM7S0FBRTtJQUNqQywwRUFBMEU7SUFDMUUsSUFBSSxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsRUFBRTtRQUNmLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztRQUNaLEtBQUssTUFBTSxHQUFHLElBQUksV0FBVyxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxHQUFHLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLEVBQUU7WUFDL0QsR0FBRyxJQUFJLEdBQUcsQ0FBQztTQUNkO1FBQ0QsT0FBTyxHQUFHLENBQUM7S0FDZDtJQUNELDZEQUE2RDtJQUM3RCxNQUFNLFNBQVMsR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoQyw2REFBNkQ7SUFDN0QsTUFBTSxTQUFTLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUMxRCxPQUFPO0lBQ0gsd0ZBQXdGO0lBQ3hGLGdCQUFnQixDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsU0FBUyxDQUFDO1FBQ3RDLHdGQUF3RjtRQUN4RixnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLEdBQUcsQ0FBQztRQUN0QyxtRkFBbUY7UUFDbkYsWUFBWSxDQUFDLElBQUksRUFBRSxTQUFTLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUNuRSxDQUFDO0FBQ04sQ0FBQztBQUVELE1BQU0sVUFBVSxZQUFZLENBQUMsR0FBZSxFQUFFLFVBQW1CLEVBQUUsVUFBbUI7SUFDbEYsSUFBSSxHQUFHLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxVQUFXLEdBQUcsQ0FBQyxDQUFDO0lBQ25DLE1BQU0sSUFBSSxHQUFHLElBQUksUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLFVBQVUsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDdEUsTUFBTSxHQUFHLEdBQUksVUFBVSxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsVUFBVSxDQUFDO0lBQ3ZFLE9BQU8sR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEVBQUU7UUFDbkIsR0FBRyxJQUFJLGFBQWEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDMUMsR0FBRyxJQUFJLENBQUMsQ0FBQztLQUNaO0lBQ0QsT0FBTyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsRUFBRTtRQUNuQixHQUFHLElBQUksYUFBYSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMxQyxHQUFHLElBQUksQ0FBQyxDQUFDO0tBQ1o7SUFDRCxPQUFPLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxFQUFFO1FBQ25CLEdBQUcsSUFBSSxhQUFhLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3pDLEdBQUcsSUFBSSxDQUFDLENBQUM7S0FDWjtJQUNELE9BQU8sR0FBRyxDQUFDO0FBQ2YsQ0FBQztBQUVELE1BQU0sVUFBVSxhQUFhLENBQUMsTUFBYztJQUN4QyxJQUFJLENBQUMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ25CLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxVQUFVLENBQUMsQ0FBQztJQUNqQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxVQUFVLENBQUMsQ0FBQztJQUNoRCxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztBQUNoRSxDQUFDIiwiZmlsZSI6InV0aWwvYml0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IFR5cGVkQXJyYXkgfSBmcm9tICcuLi90eXBlJztcblxuZXhwb3J0IGZ1bmN0aW9uIGFsaWduKHZhbHVlOiBudW1iZXIsIGFsaWdubWVudDogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHZhbHVlICsgcGFkZGluZyh2YWx1ZSwgYWxpZ25tZW50KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhZGRpbmcodmFsdWU6IG51bWJlciwgYWxpZ25tZW50OiBudW1iZXIpIHtcbiAgICByZXR1cm4gKHZhbHVlICUgYWxpZ25tZW50ID09PSAwID8gMCA6IGFsaWdubWVudCAtIHZhbHVlICUgYWxpZ25tZW50KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEJvb2woX2RhdGE6IGFueSwgX2luZGV4OiBudW1iZXIsIGJ5dGU6IG51bWJlciwgYml0OiBudW1iZXIpIHtcbiAgICByZXR1cm4gKGJ5dGUgJiAxIDw8IGJpdCkgIT09IDA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRCaXQoX2RhdGE6IGFueSwgX2luZGV4OiBudW1iZXIsIGJ5dGU6IG51bWJlciwgYml0OiBudW1iZXIpOiAwIHwgMSB7XG4gICAgcmV0dXJuIChieXRlICYgMSA8PCBiaXQpID4+IGJpdCBhcyAoMCB8IDEpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0Qm9vbChieXRlczogVWludDhBcnJheSwgaW5kZXg6IG51bWJlciwgdmFsdWU6IGFueSkge1xuICAgIHJldHVybiB2YWx1ZSA/XG4gICAgICAgICEhKGJ5dGVzW2luZGV4ID4+IDNdIHw9ICAoMSA8PCAoaW5kZXggJSA4KSkpIHx8IHRydWUgOlxuICAgICAgICAhKGJ5dGVzW2luZGV4ID4+IDNdICY9IH4oMSA8PCAoaW5kZXggJSA4KSkpICYmIGZhbHNlIDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhY2tCb29scyh2YWx1ZXM6IEl0ZXJhYmxlPGFueT4pIHtcbiAgICBsZXQgbiA9IDAsIGkgPSAwO1xuICAgIGxldCB4czogbnVtYmVyW10gPSBbXTtcbiAgICBsZXQgYml0ID0gMCwgYnl0ZSA9IDA7XG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiB2YWx1ZXMpIHtcbiAgICAgICAgdmFsdWUgJiYgKGJ5dGUgfD0gMSA8PCBiaXQpO1xuICAgICAgICBpZiAoKytiaXQgPT09IDgpIHtcbiAgICAgICAgICAgIHhzW2krK10gPSBieXRlO1xuICAgICAgICAgICAgYnl0ZSA9IGJpdCA9IDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGkgPT09IDAgfHwgYml0ID4gMCkgeyB4c1tpKytdID0gYnl0ZTsgfVxuICAgIGlmIChpICUgOCAmJiAobiA9IGkgKyA4IC0gaSAlIDgpKSB7XG4gICAgICAgIGRvIHsgeHNbaV0gPSAwOyB9IHdoaWxlICgrK2kgPCBuKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KHhzKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uKiBpdGVyYXRlQml0czxUPihieXRlczogVWludDhBcnJheSwgYmVnaW46IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIGNvbnRleHQ6IGFueSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0OiAoY29udGV4dDogYW55LCBpbmRleDogbnVtYmVyLCBieXRlOiBudW1iZXIsIGJpdDogbnVtYmVyKSA9PiBUKSB7XG4gICAgbGV0IGJpdCA9IGJlZ2luICUgODtcbiAgICBsZXQgYnl0ZUluZGV4ID0gYmVnaW4gPj4gMztcbiAgICBsZXQgaW5kZXggPSAwLCByZW1haW5pbmcgPSBsZW5ndGg7XG4gICAgZm9yICg7IHJlbWFpbmluZyA+IDA7IGJpdCA9IDApIHtcbiAgICAgICAgbGV0IGJ5dGUgPSBieXRlc1tieXRlSW5kZXgrK107XG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIHlpZWxkIGdldChjb250ZXh0LCBpbmRleCsrLCBieXRlLCBiaXQpO1xuICAgICAgICB9IHdoaWxlICgtLXJlbWFpbmluZyA+IDAgJiYgKytiaXQgPCA4KTtcbiAgICB9XG59XG5cbi8qKlxuICogQ29tcHV0ZSB0aGUgcG9wdWxhdGlvbiBjb3VudCAodGhlIG51bWJlciBvZiBiaXRzIHNldCB0byAxKSBmb3IgYSByYW5nZSBvZiBiaXRzIGluIGEgVWludDhBcnJheS5cbiAqIEBwYXJhbSB2ZWN0b3IgVGhlIFVpbnQ4QXJyYXkgb2YgYml0cyBmb3Igd2hpY2ggdG8gY29tcHV0ZSB0aGUgcG9wdWxhdGlvbiBjb3VudC5cbiAqIEBwYXJhbSBsaHMgVGhlIHJhbmdlJ3MgbGVmdC1oYW5kIHNpZGUgKG9yIHN0YXJ0KSBiaXRcbiAqIEBwYXJhbSByaHMgVGhlIHJhbmdlJ3MgcmlnaHQtaGFuZCBzaWRlIChvciBlbmQpIGJpdFxuICovXG5leHBvcnQgZnVuY3Rpb24gcG9wY250X2JpdF9yYW5nZShkYXRhOiBVaW50OEFycmF5LCBsaHM6IG51bWJlciwgcmhzOiBudW1iZXIpOiBudW1iZXIge1xuICAgIGlmIChyaHMgLSBsaHMgPD0gMCkgeyByZXR1cm4gMDsgfVxuICAgIC8vIElmIHRoZSBiaXQgcmFuZ2UgaXMgbGVzcyB0aGFuIG9uZSBieXRlLCBzdW0gdGhlIDEgYml0cyBpbiB0aGUgYml0IHJhbmdlXG4gICAgaWYgKHJocyAtIGxocyA8IDgpIHtcbiAgICAgICAgbGV0IHN1bSA9IDA7XG4gICAgICAgIGZvciAoY29uc3QgYml0IG9mIGl0ZXJhdGVCaXRzKGRhdGEsIGxocywgcmhzIC0gbGhzLCBkYXRhLCBnZXRCaXQpKSB7XG4gICAgICAgICAgICBzdW0gKz0gYml0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdW07XG4gICAgfVxuICAgIC8vIEdldCB0aGUgbmV4dCBsb3dlc3QgbXVsdGlwbGUgb2YgOCBmcm9tIHRoZSByaWdodCBoYW5kIHNpZGVcbiAgICBjb25zdCByaHNJbnNpZGUgPSByaHMgPj4gMyA8PCAzO1xuICAgIC8vIEdldCB0aGUgbmV4dCBoaWdoZXN0IG11bHRpcGxlIG9mIDggZnJvbSB0aGUgbGVmdCBoYW5kIHNpZGVcbiAgICBjb25zdCBsaHNJbnNpZGUgPSBsaHMgKyAobGhzICUgOCA9PT0gMCA/IDAgOiA4IC0gbGhzICUgOCk7XG4gICAgcmV0dXJuIChcbiAgICAgICAgLy8gR2V0IHRoZSBwb3BjbnQgb2YgYml0cyBiZXR3ZWVuIHRoZSBsZWZ0IGhhbmQgc2lkZSwgYW5kIHRoZSBuZXh0IGhpZ2hlc3QgbXVsdGlwbGUgb2YgOFxuICAgICAgICBwb3BjbnRfYml0X3JhbmdlKGRhdGEsIGxocywgbGhzSW5zaWRlKSArXG4gICAgICAgIC8vIEdldCB0aGUgcG9wY250IG9mIGJpdHMgYmV0d2VlbiB0aGUgcmlnaHQgaGFuZCBzaWRlLCBhbmQgdGhlIG5leHQgbG93ZXN0IG11bHRpcGxlIG9mIDhcbiAgICAgICAgcG9wY250X2JpdF9yYW5nZShkYXRhLCByaHNJbnNpZGUsIHJocykgK1xuICAgICAgICAvLyBHZXQgdGhlIHBvcGNudCBvZiBhbGwgYml0cyBiZXR3ZWVuIHRoZSBsZWZ0IGFuZCByaWdodCBoYW5kIHNpZGVzJyBtdWx0aXBsZXMgb2YgOFxuICAgICAgICBwb3BjbnRfYXJyYXkoZGF0YSwgbGhzSW5zaWRlID4+IDMsIChyaHNJbnNpZGUgLSBsaHNJbnNpZGUpID4+IDMpXG4gICAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBvcGNudF9hcnJheShhcnI6IFR5cGVkQXJyYXksIGJ5dGVPZmZzZXQ/OiBudW1iZXIsIGJ5dGVMZW5ndGg/OiBudW1iZXIpIHtcbiAgICBsZXQgY250ID0gMCwgcG9zID0gYnl0ZU9mZnNldCEgfCAwO1xuICAgIGNvbnN0IHZpZXcgPSBuZXcgRGF0YVZpZXcoYXJyLmJ1ZmZlciwgYXJyLmJ5dGVPZmZzZXQsIGFyci5ieXRlTGVuZ3RoKTtcbiAgICBjb25zdCBsZW4gPSAgYnl0ZUxlbmd0aCA9PT0gdm9pZCAwID8gYXJyLmJ5dGVMZW5ndGggOiBwb3MgKyBieXRlTGVuZ3RoO1xuICAgIHdoaWxlIChsZW4gLSBwb3MgPj0gNCkge1xuICAgICAgICBjbnQgKz0gcG9wY250X3VpbnQzMih2aWV3LmdldFVpbnQzMihwb3MpKTtcbiAgICAgICAgcG9zICs9IDQ7XG4gICAgfVxuICAgIHdoaWxlIChsZW4gLSBwb3MgPj0gMikge1xuICAgICAgICBjbnQgKz0gcG9wY250X3VpbnQzMih2aWV3LmdldFVpbnQxNihwb3MpKTtcbiAgICAgICAgcG9zICs9IDI7XG4gICAgfVxuICAgIHdoaWxlIChsZW4gLSBwb3MgPj0gMSkge1xuICAgICAgICBjbnQgKz0gcG9wY250X3VpbnQzMih2aWV3LmdldFVpbnQ4KHBvcykpO1xuICAgICAgICBwb3MgKz0gMTtcbiAgICB9XG4gICAgcmV0dXJuIGNudDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBvcGNudF91aW50MzIodWludDMyOiBudW1iZXIpOiBudW1iZXIge1xuICAgIGxldCBpID0gdWludDMyIHwgMDtcbiAgICBpID0gaSAtICgoaSA+Pj4gMSkgJiAweDU1NTU1NTU1KTtcbiAgICBpID0gKGkgJiAweDMzMzMzMzMzKSArICgoaSA+Pj4gMikgJiAweDMzMzMzMzMzKTtcbiAgICByZXR1cm4gKCgoaSArIChpID4+PiA0KSkgJiAweDBGMEYwRjBGKSAqIDB4MDEwMTAxMDEpID4+PiAyNDtcbn1cbiJdfQ==
