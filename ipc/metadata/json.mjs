// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import { Schema, Field } from '../../schema';
import { DataType, Dictionary, Utf8, Binary, Decimal, FixedSizeBinary, List, FixedSizeList, Map_, Struct, Union, Bool, Null, Int, Float, Date_, Time, Interval, Timestamp, Int32, } from '../../type';
import { DictionaryBatch, RecordBatch, FieldNode, BufferRegion } from './message';
import { TimeUnit, Precision, IntervalUnit, UnionMode, DateUnit } from '../../enum';
export function schemaFromJSON(_schema, dictionaries = new Map(), dictionaryFields = new Map()) {
    return new Schema(schemaFieldsFromJSON(_schema, dictionaries, dictionaryFields), customMetadataFromJSON(_schema['customMetadata']), dictionaries, dictionaryFields);
}
export function recordBatchFromJSON(b) {
    return new RecordBatch(b['count'], fieldNodesFromJSON(b['columns']), buffersFromJSON(b['columns']));
}
export function dictionaryBatchFromJSON(b) {
    return new DictionaryBatch(recordBatchFromJSON(b['data']), b['id'], b['isDelta']);
}
function schemaFieldsFromJSON(_schema, dictionaries, dictionaryFields) {
    return (_schema['fields'] || []).filter(Boolean).map((f) => Field.fromJSON(f, dictionaries, dictionaryFields));
}
function fieldChildrenFromJSON(_field, dictionaries, dictionaryFields) {
    return (_field['children'] || []).filter(Boolean).map((f) => Field.fromJSON(f, dictionaries, dictionaryFields));
}
function fieldNodesFromJSON(xs) {
    return (xs || []).reduce((fieldNodes, column) => [
        ...fieldNodes,
        new FieldNode(column['count'], nullCountFromJSON(column['VALIDITY'])),
        ...fieldNodesFromJSON(column['children'])
    ], []);
}
function buffersFromJSON(xs, buffers = []) {
    for (let i = -1, n = (xs || []).length; ++i < n;) {
        const column = xs[i];
        column['VALIDITY'] && buffers.push(new BufferRegion(buffers.length, column['VALIDITY'].length));
        column['OFFSET'] && buffers.push(new BufferRegion(buffers.length, column['OFFSET'].length));
        column['TYPE'] && buffers.push(new BufferRegion(buffers.length, column['TYPE'].length));
        column['DATA'] && buffers.push(new BufferRegion(buffers.length, column['DATA'].length));
        buffers = buffersFromJSON(column['children'], buffers);
    }
    return buffers;
}
function nullCountFromJSON(validity) {
    return (validity || []).reduce((sum, val) => sum + +(val === 0), 0);
}
export function fieldFromJSON(_field, dictionaries, dictionaryFields) {
    let id;
    let keys;
    let field;
    let dictMeta;
    let type;
    let dictType;
    let dictField;
    // If no dictionary encoding, or in the process of decoding the children of a dictionary-encoded field
    if (!dictionaries || !dictionaryFields || !(dictMeta = _field['dictionary'])) {
        type = typeFromJSON(_field, fieldChildrenFromJSON(_field, dictionaries, dictionaryFields));
        field = new Field(_field['name'], type, _field['nullable'], customMetadataFromJSON(_field['customMetadata']));
    }
    // tslint:disable
    // If dictionary encoded and the first time we've seen this dictionary id, decode
    // the data type and child fields, then wrap in a Dictionary type and insert the
    // data type into the dictionary types map.
    else if (!dictionaries.has(id = dictMeta['id'])) {
        // a dictionary index defaults to signed 32 bit int if unspecified
        keys = (keys = dictMeta['indexType']) ? indexTypeFromJSON(keys) : new Int32();
        dictionaries.set(id, type = typeFromJSON(_field, fieldChildrenFromJSON(_field)));
        dictType = new Dictionary(type, keys, id, dictMeta['isOrdered']);
        dictField = new Field(_field['name'], dictType, _field['nullable'], customMetadataFromJSON(_field['customMetadata']));
        dictionaryFields.set(id, [field = dictField]);
    }
    // If dictionary encoded, and have already seen this dictionary Id in the schema, then reuse the
    // data type and wrap in a new Dictionary type and field.
    else {
        // a dictionary index defaults to signed 32 bit int if unspecified
        keys = (keys = dictMeta['indexType']) ? indexTypeFromJSON(keys) : new Int32();
        dictType = new Dictionary(dictionaries.get(id), keys, id, dictMeta['isOrdered']);
        dictField = new Field(_field['name'], dictType, _field['nullable'], customMetadataFromJSON(_field['customMetadata']));
        dictionaryFields.get(id).push(field = dictField);
    }
    return field || null;
}
function customMetadataFromJSON(_metadata) {
    return new Map(Object.entries(_metadata || {}));
}
function indexTypeFromJSON(_type) {
    return new Int(_type['isSigned'], _type['bitWidth']);
}
function typeFromJSON(f, children) {
    const typeId = f['type']['name'];
    switch (typeId) {
        case 'NONE': return new DataType();
        case 'null': return new Null();
        case 'binary': return new Binary();
        case 'utf8': return new Utf8();
        case 'bool': return new Bool();
        case 'list': return new List(children || []);
        case 'struct': return new Struct(children || []);
    }
    switch (typeId) {
        case 'int': {
            const t = f['type'];
            return new Int(t['isSigned'], t['bitWidth']);
        }
        case 'floatingpoint': {
            const t = f['type'];
            return new Float(Precision[t['precision']]);
        }
        case 'decimal': {
            const t = f['type'];
            return new Decimal(t['scale'], t['precision']);
        }
        case 'date': {
            const t = f['type'];
            return new Date_(DateUnit[t['unit']]);
        }
        case 'time': {
            const t = f['type'];
            return new Time(TimeUnit[t['unit']], t['bitWidth']);
        }
        case 'timestamp': {
            const t = f['type'];
            return new Timestamp(TimeUnit[t['unit']], t['timezone']);
        }
        case 'interval': {
            const t = f['type'];
            return new Interval(IntervalUnit[t['unit']]);
        }
        case 'union': {
            const t = f['type'];
            return new Union(UnionMode[t['mode']], (t['typeIds'] || []), children || []);
        }
        case 'fixedsizebinary': {
            const t = f['type'];
            return new FixedSizeBinary(t['byteWidth']);
        }
        case 'fixedsizelist': {
            const t = f['type'];
            return new FixedSizeList(t['listSize'], children || []);
        }
        case 'map': {
            const t = f['type'];
            return new Map_(children || [], t['keysSorted']);
        }
    }
    throw new Error(`Unrecognized type: "${typeId}"`);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFDLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBUSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1NBQzNEO1FBQ0QsS0FBSyxLQUFLLENBQUMsQ0FBQztZQUNSLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNwQixPQUFPLElBQUksSUFBSSxDQUFDLFFBQVEsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7U0FDcEQ7S0FDSjtJQUNELE1BQU0sSUFBSSxLQUFLLENBQUMsdUJBQXVCLE1BQU0sR0FBRyxDQUFDLENBQUM7QUFDdEQsQ0FBQyIsImZpbGUiOiJpcGMvbWV0YWRhdGEvanNvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgKiBhcyBTY2hlbWFfIGZyb20gJy4uLy4uL2ZiL1NjaGVtYSc7XG5pbXBvcnQgeyBTY2hlbWEsIEZpZWxkIH0gZnJvbSAnLi4vLi4vc2NoZW1hJztcbmltcG9ydCB7XG4gICAgRGF0YVR5cGUsIERpY3Rpb25hcnksIFRpbWVCaXRXaWR0aCxcbiAgICBVdGY4LCBCaW5hcnksIERlY2ltYWwsIEZpeGVkU2l6ZUJpbmFyeSxcbiAgICBMaXN0LCBGaXhlZFNpemVMaXN0LCBNYXBfLCBTdHJ1Y3QsIFVuaW9uLFxuICAgIEJvb2wsIE51bGwsIEludCwgRmxvYXQsIERhdGVfLCBUaW1lLCBJbnRlcnZhbCwgVGltZXN0YW1wLCBJbnRCaXRXaWR0aCwgSW50MzIsIFRLZXlzLFxufSBmcm9tICcuLi8uLi90eXBlJztcblxuaW1wb3J0IFR5cGUgPSBTY2hlbWFfLm9yZy5hcGFjaGUuYXJyb3cuZmxhdGJ1Zi5UeXBlO1xuaW1wb3J0IHsgRGljdGlvbmFyeUJhdGNoLCBSZWNvcmRCYXRjaCwgRmllbGROb2RlLCBCdWZmZXJSZWdpb24gfSBmcm9tICcuL21lc3NhZ2UnO1xuaW1wb3J0IHsgVGltZVVuaXQsIFByZWNpc2lvbiwgSW50ZXJ2YWxVbml0LCBVbmlvbk1vZGUsIERhdGVVbml0IH0gZnJvbSAnLi4vLi4vZW51bSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBzY2hlbWFGcm9tSlNPTihfc2NoZW1hOiBhbnksIGRpY3Rpb25hcmllczogTWFwPG51bWJlciwgRGF0YVR5cGU+ID0gbmV3IE1hcCgpLCBkaWN0aW9uYXJ5RmllbGRzOiBNYXA8bnVtYmVyLCBGaWVsZDxEaWN0aW9uYXJ5PltdPiA9IG5ldyBNYXAoKSkge1xuICAgIHJldHVybiBuZXcgU2NoZW1hKFxuICAgICAgICBzY2hlbWFGaWVsZHNGcm9tSlNPTihfc2NoZW1hLCBkaWN0aW9uYXJpZXMsIGRpY3Rpb25hcnlGaWVsZHMpLFxuICAgICAgICBjdXN0b21NZXRhZGF0YUZyb21KU09OKF9zY2hlbWFbJ2N1c3RvbU1ldGFkYXRhJ10pLFxuICAgICAgICBkaWN0aW9uYXJpZXMsIGRpY3Rpb25hcnlGaWVsZHNcbiAgICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVjb3JkQmF0Y2hGcm9tSlNPTihiOiBhbnkpIHtcbiAgICByZXR1cm4gbmV3IFJlY29yZEJhdGNoKFxuICAgICAgICBiWydjb3VudCddLFxuICAgICAgICBmaWVsZE5vZGVzRnJvbUpTT04oYlsnY29sdW1ucyddKSxcbiAgICAgICAgYnVmZmVyc0Zyb21KU09OKGJbJ2NvbHVtbnMnXSlcbiAgICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGljdGlvbmFyeUJhdGNoRnJvbUpTT04oYjogYW55KSB7XG4gICAgcmV0dXJuIG5ldyBEaWN0aW9uYXJ5QmF0Y2goXG4gICAgICAgIHJlY29yZEJhdGNoRnJvbUpTT04oYlsnZGF0YSddKSxcbiAgICAgICAgYlsnaWQnXSwgYlsnaXNEZWx0YSddXG4gICAgKTtcbn1cblxuZnVuY3Rpb24gc2NoZW1hRmllbGRzRnJvbUpTT04oX3NjaGVtYTogYW55LCBkaWN0aW9uYXJpZXM/OiBNYXA8bnVtYmVyLCBEYXRhVHlwZT4sIGRpY3Rpb25hcnlGaWVsZHM/OiBNYXA8bnVtYmVyLCBGaWVsZDxEaWN0aW9uYXJ5PltdPikge1xuICAgIHJldHVybiAoX3NjaGVtYVsnZmllbGRzJ10gfHwgW10pLmZpbHRlcihCb29sZWFuKS5tYXAoKGY6IGFueSkgPT4gRmllbGQuZnJvbUpTT04oZiwgZGljdGlvbmFyaWVzLCBkaWN0aW9uYXJ5RmllbGRzKSk7XG59XG5cbmZ1bmN0aW9uIGZpZWxkQ2hpbGRyZW5Gcm9tSlNPTihfZmllbGQ6IGFueSwgZGljdGlvbmFyaWVzPzogTWFwPG51bWJlciwgRGF0YVR5cGU+LCBkaWN0aW9uYXJ5RmllbGRzPzogTWFwPG51bWJlciwgRmllbGQ8RGljdGlvbmFyeT5bXT4pOiBGaWVsZFtdIHtcbiAgICByZXR1cm4gKF9maWVsZFsnY2hpbGRyZW4nXSB8fCBbXSkuZmlsdGVyKEJvb2xlYW4pLm1hcCgoZjogYW55KSA9PiBGaWVsZC5mcm9tSlNPTihmLCBkaWN0aW9uYXJpZXMsIGRpY3Rpb25hcnlGaWVsZHMpKTtcbn1cblxuZnVuY3Rpb24gZmllbGROb2Rlc0Zyb21KU09OKHhzOiBhbnlbXSk6IEZpZWxkTm9kZVtdIHtcbiAgICByZXR1cm4gKHhzIHx8IFtdKS5yZWR1Y2U8RmllbGROb2RlW10+KChmaWVsZE5vZGVzLCBjb2x1bW46IGFueSkgPT4gW1xuICAgICAgICAuLi5maWVsZE5vZGVzLFxuICAgICAgICBuZXcgRmllbGROb2RlKFxuICAgICAgICAgICAgY29sdW1uWydjb3VudCddLFxuICAgICAgICAgICAgbnVsbENvdW50RnJvbUpTT04oY29sdW1uWydWQUxJRElUWSddKVxuICAgICAgICApLFxuICAgICAgICAuLi5maWVsZE5vZGVzRnJvbUpTT04oY29sdW1uWydjaGlsZHJlbiddKVxuICAgIF0sIFtdIGFzIEZpZWxkTm9kZVtdKTtcbn1cblxuZnVuY3Rpb24gYnVmZmVyc0Zyb21KU09OKHhzOiBhbnlbXSwgYnVmZmVyczogQnVmZmVyUmVnaW9uW10gPSBbXSk6IEJ1ZmZlclJlZ2lvbltdIHtcbiAgICBmb3IgKGxldCBpID0gLTEsIG4gPSAoeHMgfHwgW10pLmxlbmd0aDsgKytpIDwgbjspIHtcbiAgICAgICAgY29uc3QgY29sdW1uID0geHNbaV07XG4gICAgICAgIGNvbHVtblsnVkFMSURJVFknXSAmJiBidWZmZXJzLnB1c2gobmV3IEJ1ZmZlclJlZ2lvbihidWZmZXJzLmxlbmd0aCwgY29sdW1uWydWQUxJRElUWSddLmxlbmd0aCkpO1xuICAgICAgICBjb2x1bW5bJ09GRlNFVCddICYmIGJ1ZmZlcnMucHVzaChuZXcgQnVmZmVyUmVnaW9uKGJ1ZmZlcnMubGVuZ3RoLCBjb2x1bW5bJ09GRlNFVCddLmxlbmd0aCkpO1xuICAgICAgICBjb2x1bW5bJ1RZUEUnXSAmJiBidWZmZXJzLnB1c2gobmV3IEJ1ZmZlclJlZ2lvbihidWZmZXJzLmxlbmd0aCwgY29sdW1uWydUWVBFJ10ubGVuZ3RoKSk7XG4gICAgICAgIGNvbHVtblsnREFUQSddICYmIGJ1ZmZlcnMucHVzaChuZXcgQnVmZmVyUmVnaW9uKGJ1ZmZlcnMubGVuZ3RoLCBjb2x1bW5bJ0RBVEEnXS5sZW5ndGgpKTtcbiAgICAgICAgYnVmZmVycyA9IGJ1ZmZlcnNGcm9tSlNPTihjb2x1bW5bJ2NoaWxkcmVuJ10sIGJ1ZmZlcnMpO1xuICAgIH1cbiAgICByZXR1cm4gYnVmZmVycztcbn1cblxuZnVuY3Rpb24gbnVsbENvdW50RnJvbUpTT04odmFsaWRpdHk6IG51bWJlcltdKSB7XG4gICAgcmV0dXJuICh2YWxpZGl0eSB8fCBbXSkucmVkdWNlKChzdW0sIHZhbCkgPT4gc3VtICsgKyh2YWwgPT09IDApLCAwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpZWxkRnJvbUpTT04oX2ZpZWxkOiBhbnksIGRpY3Rpb25hcmllcz86IE1hcDxudW1iZXIsIERhdGFUeXBlPiwgZGljdGlvbmFyeUZpZWxkcz86IE1hcDxudW1iZXIsIEZpZWxkPERpY3Rpb25hcnk+W10+KSB7XG5cbiAgICBsZXQgaWQ6IG51bWJlcjtcbiAgICBsZXQga2V5czogVEtleXMgfCBudWxsO1xuICAgIGxldCBmaWVsZDogRmllbGQgfCB2b2lkO1xuICAgIGxldCBkaWN0TWV0YTogYW55O1xuICAgIGxldCB0eXBlOiBEYXRhVHlwZTxhbnk+O1xuICAgIGxldCBkaWN0VHlwZTogRGljdGlvbmFyeTtcbiAgICBsZXQgZGljdEZpZWxkOiBGaWVsZDxEaWN0aW9uYXJ5PjtcblxuICAgIC8vIElmIG5vIGRpY3Rpb25hcnkgZW5jb2RpbmcsIG9yIGluIHRoZSBwcm9jZXNzIG9mIGRlY29kaW5nIHRoZSBjaGlsZHJlbiBvZiBhIGRpY3Rpb25hcnktZW5jb2RlZCBmaWVsZFxuICAgIGlmICghZGljdGlvbmFyaWVzIHx8ICFkaWN0aW9uYXJ5RmllbGRzIHx8ICEoZGljdE1ldGEgPSBfZmllbGRbJ2RpY3Rpb25hcnknXSkpIHtcbiAgICAgICAgdHlwZSA9IHR5cGVGcm9tSlNPTihfZmllbGQsIGZpZWxkQ2hpbGRyZW5Gcm9tSlNPTihfZmllbGQsIGRpY3Rpb25hcmllcywgZGljdGlvbmFyeUZpZWxkcykpO1xuICAgICAgICBmaWVsZCA9IG5ldyBGaWVsZChfZmllbGRbJ25hbWUnXSwgdHlwZSwgX2ZpZWxkWydudWxsYWJsZSddLCBjdXN0b21NZXRhZGF0YUZyb21KU09OKF9maWVsZFsnY3VzdG9tTWV0YWRhdGEnXSkpO1xuICAgIH1cbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZVxuICAgIC8vIElmIGRpY3Rpb25hcnkgZW5jb2RlZCBhbmQgdGhlIGZpcnN0IHRpbWUgd2UndmUgc2VlbiB0aGlzIGRpY3Rpb25hcnkgaWQsIGRlY29kZVxuICAgIC8vIHRoZSBkYXRhIHR5cGUgYW5kIGNoaWxkIGZpZWxkcywgdGhlbiB3cmFwIGluIGEgRGljdGlvbmFyeSB0eXBlIGFuZCBpbnNlcnQgdGhlXG4gICAgLy8gZGF0YSB0eXBlIGludG8gdGhlIGRpY3Rpb25hcnkgdHlwZXMgbWFwLlxuICAgIGVsc2UgaWYgKCFkaWN0aW9uYXJpZXMuaGFzKGlkID0gZGljdE1ldGFbJ2lkJ10pKSB7XG4gICAgICAgIC8vIGEgZGljdGlvbmFyeSBpbmRleCBkZWZhdWx0cyB0byBzaWduZWQgMzIgYml0IGludCBpZiB1bnNwZWNpZmllZFxuICAgICAgICBrZXlzID0gKGtleXMgPSBkaWN0TWV0YVsnaW5kZXhUeXBlJ10pID8gaW5kZXhUeXBlRnJvbUpTT04oa2V5cykgYXMgVEtleXMgOiBuZXcgSW50MzIoKTtcbiAgICAgICAgZGljdGlvbmFyaWVzLnNldChpZCwgdHlwZSA9IHR5cGVGcm9tSlNPTihfZmllbGQsIGZpZWxkQ2hpbGRyZW5Gcm9tSlNPTihfZmllbGQpKSk7XG4gICAgICAgIGRpY3RUeXBlID0gbmV3IERpY3Rpb25hcnkodHlwZSwga2V5cywgaWQsIGRpY3RNZXRhWydpc09yZGVyZWQnXSk7XG4gICAgICAgIGRpY3RGaWVsZCA9IG5ldyBGaWVsZChfZmllbGRbJ25hbWUnXSwgZGljdFR5cGUsIF9maWVsZFsnbnVsbGFibGUnXSwgY3VzdG9tTWV0YWRhdGFGcm9tSlNPTihfZmllbGRbJ2N1c3RvbU1ldGFkYXRhJ10pKTtcbiAgICAgICAgZGljdGlvbmFyeUZpZWxkcy5zZXQoaWQsIFtmaWVsZCA9IGRpY3RGaWVsZF0pO1xuICAgIH1cbiAgICAvLyBJZiBkaWN0aW9uYXJ5IGVuY29kZWQsIGFuZCBoYXZlIGFscmVhZHkgc2VlbiB0aGlzIGRpY3Rpb25hcnkgSWQgaW4gdGhlIHNjaGVtYSwgdGhlbiByZXVzZSB0aGVcbiAgICAvLyBkYXRhIHR5cGUgYW5kIHdyYXAgaW4gYSBuZXcgRGljdGlvbmFyeSB0eXBlIGFuZCBmaWVsZC5cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gYSBkaWN0aW9uYXJ5IGluZGV4IGRlZmF1bHRzIHRvIHNpZ25lZCAzMiBiaXQgaW50IGlmIHVuc3BlY2lmaWVkXG4gICAgICAgIGtleXMgPSAoa2V5cyA9IGRpY3RNZXRhWydpbmRleFR5cGUnXSkgPyBpbmRleFR5cGVGcm9tSlNPTihrZXlzKSBhcyBUS2V5cyA6IG5ldyBJbnQzMigpO1xuICAgICAgICBkaWN0VHlwZSA9IG5ldyBEaWN0aW9uYXJ5KGRpY3Rpb25hcmllcy5nZXQoaWQpISwga2V5cywgaWQsIGRpY3RNZXRhWydpc09yZGVyZWQnXSk7XG4gICAgICAgIGRpY3RGaWVsZCA9IG5ldyBGaWVsZChfZmllbGRbJ25hbWUnXSwgZGljdFR5cGUsIF9maWVsZFsnbnVsbGFibGUnXSwgY3VzdG9tTWV0YWRhdGFGcm9tSlNPTihfZmllbGRbJ2N1c3RvbU1ldGFkYXRhJ10pKTtcbiAgICAgICAgZGljdGlvbmFyeUZpZWxkcy5nZXQoaWQpIS5wdXNoKGZpZWxkID0gZGljdEZpZWxkKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpZWxkIHx8IG51bGw7XG59XG5cbmZ1bmN0aW9uIGN1c3RvbU1ldGFkYXRhRnJvbUpTT04oX21ldGFkYXRhPzogb2JqZWN0KSB7XG4gICAgcmV0dXJuIG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KE9iamVjdC5lbnRyaWVzKF9tZXRhZGF0YSB8fCB7fSkpO1xufVxuXG5mdW5jdGlvbiBpbmRleFR5cGVGcm9tSlNPTihfdHlwZTogYW55KSB7XG4gICAgcmV0dXJuIG5ldyBJbnQoX3R5cGVbJ2lzU2lnbmVkJ10sIF90eXBlWydiaXRXaWR0aCddKTtcbn1cblxuZnVuY3Rpb24gdHlwZUZyb21KU09OKGY6IGFueSwgY2hpbGRyZW4/OiBGaWVsZFtdKTogRGF0YVR5cGU8YW55PiB7XG5cbiAgICBjb25zdCB0eXBlSWQgPSBmWyd0eXBlJ11bJ25hbWUnXTtcblxuICAgIHN3aXRjaCAodHlwZUlkKSB7XG4gICAgICAgIGNhc2UgJ05PTkUnOiAgICByZXR1cm4gbmV3IERhdGFUeXBlKCk7XG4gICAgICAgIGNhc2UgJ251bGwnOiAgICByZXR1cm4gbmV3IE51bGwoKTtcbiAgICAgICAgY2FzZSAnYmluYXJ5JzogIHJldHVybiBuZXcgQmluYXJ5KCk7XG4gICAgICAgIGNhc2UgJ3V0ZjgnOiAgICByZXR1cm4gbmV3IFV0ZjgoKTtcbiAgICAgICAgY2FzZSAnYm9vbCc6ICAgIHJldHVybiBuZXcgQm9vbCgpO1xuICAgICAgICBjYXNlICdsaXN0JzogICAgcmV0dXJuIG5ldyBMaXN0KGNoaWxkcmVuIHx8IFtdKTtcbiAgICAgICAgY2FzZSAnc3RydWN0JzogcmV0dXJuIG5ldyBTdHJ1Y3QoY2hpbGRyZW4gfHwgW10pO1xuICAgIH1cblxuICAgIHN3aXRjaCAodHlwZUlkKSB7XG4gICAgICAgIGNhc2UgJ2ludCc6IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBmWyd0eXBlJ107XG4gICAgICAgICAgICByZXR1cm4gbmV3IEludCh0Wydpc1NpZ25lZCddLCB0WydiaXRXaWR0aCddIGFzIEludEJpdFdpZHRoKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlICdmbG9hdGluZ3BvaW50Jzoge1xuICAgICAgICAgICAgY29uc3QgdCA9IGZbJ3R5cGUnXTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmxvYXQoUHJlY2lzaW9uW3RbJ3ByZWNpc2lvbiddXSBhcyBhbnkpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgJ2RlY2ltYWwnOiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZlsndHlwZSddO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBEZWNpbWFsKHRbJ3NjYWxlJ10sIHRbJ3ByZWNpc2lvbiddKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlICdkYXRlJzoge1xuICAgICAgICAgICAgY29uc3QgdCA9IGZbJ3R5cGUnXTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZV8oRGF0ZVVuaXRbdFsndW5pdCddXSBhcyBhbnkpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgJ3RpbWUnOiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZlsndHlwZSddO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBUaW1lKFRpbWVVbml0W3RbJ3VuaXQnXV0gYXMgYW55LCB0WydiaXRXaWR0aCddIGFzIFRpbWVCaXRXaWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAndGltZXN0YW1wJzoge1xuICAgICAgICAgICAgY29uc3QgdCA9IGZbJ3R5cGUnXTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVGltZXN0YW1wKFRpbWVVbml0W3RbJ3VuaXQnXV0gYXMgYW55LCB0Wyd0aW1lem9uZSddKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlICdpbnRlcnZhbCc6IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBmWyd0eXBlJ107XG4gICAgICAgICAgICByZXR1cm4gbmV3IEludGVydmFsKEludGVydmFsVW5pdFt0Wyd1bml0J11dIGFzIGFueSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAndW5pb24nOiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZlsndHlwZSddO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVbmlvbihVbmlvbk1vZGVbdFsnbW9kZSddXSBhcyBhbnksICh0Wyd0eXBlSWRzJ10gfHwgW10pIGFzIFR5cGVbXSwgY2hpbGRyZW4gfHwgW10pO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgJ2ZpeGVkc2l6ZWJpbmFyeSc6IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBmWyd0eXBlJ107XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZpeGVkU2l6ZUJpbmFyeSh0WydieXRlV2lkdGgnXSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnZml4ZWRzaXplbGlzdCc6IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBmWyd0eXBlJ107XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZpeGVkU2l6ZUxpc3QodFsnbGlzdFNpemUnXSwgY2hpbGRyZW4gfHwgW10pO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgJ21hcCc6IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBmWyd0eXBlJ107XG4gICAgICAgICAgICByZXR1cm4gbmV3IE1hcF8oY2hpbGRyZW4gfHwgW10sIHRbJ2tleXNTb3J0ZWQnXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKGBVbnJlY29nbml6ZWQgdHlwZTogXCIke3R5cGVJZH1cImApO1xufVxuIl19
