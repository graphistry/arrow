"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const schema_1 = require("../../schema");
const type_1 = require("../../type");
const message_1 = require("./message");
const enum_1 = require("../../enum");
function schemaFromJSON(_schema, dictionaries = new Map(), dictionaryFields = new Map()) {
    return new schema_1.Schema(schemaFieldsFromJSON(_schema, dictionaries, dictionaryFields), customMetadataFromJSON(_schema['customMetadata']), dictionaries, dictionaryFields);
}
exports.schemaFromJSON = schemaFromJSON;
function recordBatchFromJSON(b) {
    return new message_1.RecordBatch(b['count'], fieldNodesFromJSON(b['columns']), buffersFromJSON(b['columns']));
}
exports.recordBatchFromJSON = recordBatchFromJSON;
function dictionaryBatchFromJSON(b) {
    return new message_1.DictionaryBatch(recordBatchFromJSON(b['data']), b['id'], b['isDelta']);
}
exports.dictionaryBatchFromJSON = dictionaryBatchFromJSON;
function schemaFieldsFromJSON(_schema, dictionaries, dictionaryFields) {
    return (_schema['fields'] || []).filter(Boolean).map((f) => schema_1.Field.fromJSON(f, dictionaries, dictionaryFields));
}
function fieldChildrenFromJSON(_field, dictionaries, dictionaryFields) {
    return (_field['children'] || []).filter(Boolean).map((f) => schema_1.Field.fromJSON(f, dictionaries, dictionaryFields));
}
function fieldNodesFromJSON(xs) {
    return (xs || []).reduce((fieldNodes, column) => [
        ...fieldNodes,
        new message_1.FieldNode(column['count'], nullCountFromJSON(column['VALIDITY'])),
        ...fieldNodesFromJSON(column['children'])
    ], []);
}
function buffersFromJSON(xs, buffers = []) {
    for (let i = -1, n = (xs || []).length; ++i < n;) {
        const column = xs[i];
        column['VALIDITY'] && buffers.push(new message_1.BufferRegion(buffers.length, column['VALIDITY'].length));
        column['OFFSET'] && buffers.push(new message_1.BufferRegion(buffers.length, column['OFFSET'].length));
        column['TYPE'] && buffers.push(new message_1.BufferRegion(buffers.length, column['TYPE'].length));
        column['DATA'] && buffers.push(new message_1.BufferRegion(buffers.length, column['DATA'].length));
        buffers = buffersFromJSON(column['children'], buffers);
    }
    return buffers;
}
function nullCountFromJSON(validity) {
    return (validity || []).reduce((sum, val) => sum + +(val === 0), 0);
}
function fieldFromJSON(_field, dictionaries, dictionaryFields) {
    let id;
    let keys;
    let field;
    let dictMeta;
    let type;
    let dictType;
    let dictField;
    // If no dictionary encoding, or in the process of decoding the children of a dictionary-encoded field
    if (!dictionaries || !dictionaryFields || !(dictMeta = _field['dictionary'])) {
        type = typeFromJSON(_field, fieldChildrenFromJSON(_field, dictionaries, dictionaryFields));
        field = new schema_1.Field(_field['name'], type, _field['nullable'], customMetadataFromJSON(_field['customMetadata']));
    }
    // tslint:disable
    // If dictionary encoded and the first time we've seen this dictionary id, decode
    // the data type and child fields, then wrap in a Dictionary type and insert the
    // data type into the dictionary types map.
    else if (!dictionaries.has(id = dictMeta['id'])) {
        // a dictionary index defaults to signed 32 bit int if unspecified
        keys = (keys = dictMeta['indexType']) ? indexTypeFromJSON(keys) : new type_1.Int32();
        dictionaries.set(id, type = typeFromJSON(_field, fieldChildrenFromJSON(_field)));
        dictType = new type_1.Dictionary(type, keys, id, dictMeta['isOrdered']);
        dictField = new schema_1.Field(_field['name'], dictType, _field['nullable'], customMetadataFromJSON(_field['customMetadata']));
        dictionaryFields.set(id, [field = dictField]);
    }
    // If dictionary encoded, and have already seen this dictionary Id in the schema, then reuse the
    // data type and wrap in a new Dictionary type and field.
    else {
        // a dictionary index defaults to signed 32 bit int if unspecified
        keys = (keys = dictMeta['indexType']) ? indexTypeFromJSON(keys) : new type_1.Int32();
        dictType = new type_1.Dictionary(dictionaries.get(id), keys, id, dictMeta['isOrdered']);
        dictField = new schema_1.Field(_field['name'], dictType, _field['nullable'], customMetadataFromJSON(_field['customMetadata']));
        dictionaryFields.get(id).push(field = dictField);
    }
    return field || null;
}
exports.fieldFromJSON = fieldFromJSON;
function customMetadataFromJSON(_metadata) {
    return new Map(Object.entries(_metadata || {}));
}
function indexTypeFromJSON(_type) {
    return new type_1.Int(_type['isSigned'], _type['bitWidth']);
}
function typeFromJSON(f, children) {
    const typeId = f['type']['name'];
    switch (typeId) {
        case 'NONE': return new type_1.DataType();
        case 'null': return new type_1.Null();
        case 'binary': return new type_1.Binary();
        case 'utf8': return new type_1.Utf8();
        case 'bool': return new type_1.Bool();
        case 'list': return new type_1.List((children || [])[0]);
        case 'struct': return new type_1.Struct(children || []);
    }
    switch (typeId) {
        case 'int': {
            const t = f['type'];
            return new type_1.Int(t['isSigned'], t['bitWidth']);
        }
        case 'floatingpoint': {
            const t = f['type'];
            return new type_1.Float(enum_1.Precision[t['precision']]);
        }
        case 'decimal': {
            const t = f['type'];
            return new type_1.Decimal(t['scale'], t['precision']);
        }
        case 'date': {
            const t = f['type'];
            return new type_1.Date_(enum_1.DateUnit[t['unit']]);
        }
        case 'time': {
            const t = f['type'];
            return new type_1.Time(enum_1.TimeUnit[t['unit']], t['bitWidth']);
        }
        case 'timestamp': {
            const t = f['type'];
            return new type_1.Timestamp(enum_1.TimeUnit[t['unit']], t['timezone']);
        }
        case 'interval': {
            const t = f['type'];
            return new type_1.Interval(enum_1.IntervalUnit[t['unit']]);
        }
        case 'union': {
            const t = f['type'];
            return new type_1.Union(enum_1.UnionMode[t['mode']], (t['typeIds'] || []), children || []);
        }
        case 'fixedsizebinary': {
            const t = f['type'];
            return new type_1.FixedSizeBinary(t['byteWidth']);
        }
        case 'fixedsizelist': {
            const t = f['type'];
            return new type_1.FixedSizeList(t['listSize'], (children || [])[0]);
        }
        case 'map': {
            const t = f['type'];
            return new type_1.Map_(children || [], t['keysSorted']);
        }
    }
    throw new Error(`Unrecognized type: "${typeId}"`);
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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ZXRhZGF0YS9qc29uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IFNjaGVtYSwgRmllbGQgfSBmcm9tICcuLi8uLi9zY2hlbWEnO1xuaW1wb3J0IHtcbiAgICBEYXRhVHlwZSwgRGljdGlvbmFyeSwgVGltZUJpdFdpZHRoLFxuICAgIFV0ZjgsIEJpbmFyeSwgRGVjaW1hbCwgRml4ZWRTaXplQmluYXJ5LFxuICAgIExpc3QsIEZpeGVkU2l6ZUxpc3QsIE1hcF8sIFN0cnVjdCwgVW5pb24sXG4gICAgQm9vbCwgTnVsbCwgSW50LCBGbG9hdCwgRGF0ZV8sIFRpbWUsIEludGVydmFsLCBUaW1lc3RhbXAsIEludEJpdFdpZHRoLCBJbnQzMiwgVEtleXMsXG59IGZyb20gJy4uLy4uL3R5cGUnO1xuXG5pbXBvcnQgeyBEaWN0aW9uYXJ5QmF0Y2gsIFJlY29yZEJhdGNoLCBGaWVsZE5vZGUsIEJ1ZmZlclJlZ2lvbiB9IGZyb20gJy4vbWVzc2FnZSc7XG5pbXBvcnQgeyBUaW1lVW5pdCwgUHJlY2lzaW9uLCBJbnRlcnZhbFVuaXQsIFVuaW9uTW9kZSwgRGF0ZVVuaXQgfSBmcm9tICcuLi8uLi9lbnVtJztcblxuZXhwb3J0IGZ1bmN0aW9uIHNjaGVtYUZyb21KU09OKF9zY2hlbWE6IGFueSwgZGljdGlvbmFyaWVzOiBNYXA8bnVtYmVyLCBEYXRhVHlwZT4gPSBuZXcgTWFwKCksIGRpY3Rpb25hcnlGaWVsZHM6IE1hcDxudW1iZXIsIEZpZWxkPERpY3Rpb25hcnk+W10+ID0gbmV3IE1hcCgpKSB7XG4gICAgcmV0dXJuIG5ldyBTY2hlbWEoXG4gICAgICAgIHNjaGVtYUZpZWxkc0Zyb21KU09OKF9zY2hlbWEsIGRpY3Rpb25hcmllcywgZGljdGlvbmFyeUZpZWxkcyksXG4gICAgICAgIGN1c3RvbU1ldGFkYXRhRnJvbUpTT04oX3NjaGVtYVsnY3VzdG9tTWV0YWRhdGEnXSksXG4gICAgICAgIGRpY3Rpb25hcmllcywgZGljdGlvbmFyeUZpZWxkc1xuICAgICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWNvcmRCYXRjaEZyb21KU09OKGI6IGFueSkge1xuICAgIHJldHVybiBuZXcgUmVjb3JkQmF0Y2goXG4gICAgICAgIGJbJ2NvdW50J10sXG4gICAgICAgIGZpZWxkTm9kZXNGcm9tSlNPTihiWydjb2x1bW5zJ10pLFxuICAgICAgICBidWZmZXJzRnJvbUpTT04oYlsnY29sdW1ucyddKVxuICAgICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkaWN0aW9uYXJ5QmF0Y2hGcm9tSlNPTihiOiBhbnkpIHtcbiAgICByZXR1cm4gbmV3IERpY3Rpb25hcnlCYXRjaChcbiAgICAgICAgcmVjb3JkQmF0Y2hGcm9tSlNPTihiWydkYXRhJ10pLFxuICAgICAgICBiWydpZCddLCBiWydpc0RlbHRhJ11cbiAgICApO1xufVxuXG5mdW5jdGlvbiBzY2hlbWFGaWVsZHNGcm9tSlNPTihfc2NoZW1hOiBhbnksIGRpY3Rpb25hcmllcz86IE1hcDxudW1iZXIsIERhdGFUeXBlPiwgZGljdGlvbmFyeUZpZWxkcz86IE1hcDxudW1iZXIsIEZpZWxkPERpY3Rpb25hcnk+W10+KSB7XG4gICAgcmV0dXJuIChfc2NoZW1hWydmaWVsZHMnXSB8fCBbXSkuZmlsdGVyKEJvb2xlYW4pLm1hcCgoZjogYW55KSA9PiBGaWVsZC5mcm9tSlNPTihmLCBkaWN0aW9uYXJpZXMsIGRpY3Rpb25hcnlGaWVsZHMpKTtcbn1cblxuZnVuY3Rpb24gZmllbGRDaGlsZHJlbkZyb21KU09OKF9maWVsZDogYW55LCBkaWN0aW9uYXJpZXM/OiBNYXA8bnVtYmVyLCBEYXRhVHlwZT4sIGRpY3Rpb25hcnlGaWVsZHM/OiBNYXA8bnVtYmVyLCBGaWVsZDxEaWN0aW9uYXJ5PltdPik6IEZpZWxkW10ge1xuICAgIHJldHVybiAoX2ZpZWxkWydjaGlsZHJlbiddIHx8IFtdKS5maWx0ZXIoQm9vbGVhbikubWFwKChmOiBhbnkpID0+IEZpZWxkLmZyb21KU09OKGYsIGRpY3Rpb25hcmllcywgZGljdGlvbmFyeUZpZWxkcykpO1xufVxuXG5mdW5jdGlvbiBmaWVsZE5vZGVzRnJvbUpTT04oeHM6IGFueVtdKTogRmllbGROb2RlW10ge1xuICAgIHJldHVybiAoeHMgfHwgW10pLnJlZHVjZTxGaWVsZE5vZGVbXT4oKGZpZWxkTm9kZXMsIGNvbHVtbjogYW55KSA9PiBbXG4gICAgICAgIC4uLmZpZWxkTm9kZXMsXG4gICAgICAgIG5ldyBGaWVsZE5vZGUoXG4gICAgICAgICAgICBjb2x1bW5bJ2NvdW50J10sXG4gICAgICAgICAgICBudWxsQ291bnRGcm9tSlNPTihjb2x1bW5bJ1ZBTElESVRZJ10pXG4gICAgICAgICksXG4gICAgICAgIC4uLmZpZWxkTm9kZXNGcm9tSlNPTihjb2x1bW5bJ2NoaWxkcmVuJ10pXG4gICAgXSwgW10gYXMgRmllbGROb2RlW10pO1xufVxuXG5mdW5jdGlvbiBidWZmZXJzRnJvbUpTT04oeHM6IGFueVtdLCBidWZmZXJzOiBCdWZmZXJSZWdpb25bXSA9IFtdKTogQnVmZmVyUmVnaW9uW10ge1xuICAgIGZvciAobGV0IGkgPSAtMSwgbiA9ICh4cyB8fCBbXSkubGVuZ3RoOyArK2kgPCBuOykge1xuICAgICAgICBjb25zdCBjb2x1bW4gPSB4c1tpXTtcbiAgICAgICAgY29sdW1uWydWQUxJRElUWSddICYmIGJ1ZmZlcnMucHVzaChuZXcgQnVmZmVyUmVnaW9uKGJ1ZmZlcnMubGVuZ3RoLCBjb2x1bW5bJ1ZBTElESVRZJ10ubGVuZ3RoKSk7XG4gICAgICAgIGNvbHVtblsnT0ZGU0VUJ10gJiYgYnVmZmVycy5wdXNoKG5ldyBCdWZmZXJSZWdpb24oYnVmZmVycy5sZW5ndGgsIGNvbHVtblsnT0ZGU0VUJ10ubGVuZ3RoKSk7XG4gICAgICAgIGNvbHVtblsnVFlQRSddICYmIGJ1ZmZlcnMucHVzaChuZXcgQnVmZmVyUmVnaW9uKGJ1ZmZlcnMubGVuZ3RoLCBjb2x1bW5bJ1RZUEUnXS5sZW5ndGgpKTtcbiAgICAgICAgY29sdW1uWydEQVRBJ10gJiYgYnVmZmVycy5wdXNoKG5ldyBCdWZmZXJSZWdpb24oYnVmZmVycy5sZW5ndGgsIGNvbHVtblsnREFUQSddLmxlbmd0aCkpO1xuICAgICAgICBidWZmZXJzID0gYnVmZmVyc0Zyb21KU09OKGNvbHVtblsnY2hpbGRyZW4nXSwgYnVmZmVycyk7XG4gICAgfVxuICAgIHJldHVybiBidWZmZXJzO1xufVxuXG5mdW5jdGlvbiBudWxsQ291bnRGcm9tSlNPTih2YWxpZGl0eTogbnVtYmVyW10pIHtcbiAgICByZXR1cm4gKHZhbGlkaXR5IHx8IFtdKS5yZWR1Y2UoKHN1bSwgdmFsKSA9PiBzdW0gKyArKHZhbCA9PT0gMCksIDApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZmllbGRGcm9tSlNPTihfZmllbGQ6IGFueSwgZGljdGlvbmFyaWVzPzogTWFwPG51bWJlciwgRGF0YVR5cGU+LCBkaWN0aW9uYXJ5RmllbGRzPzogTWFwPG51bWJlciwgRmllbGQ8RGljdGlvbmFyeT5bXT4pIHtcblxuICAgIGxldCBpZDogbnVtYmVyO1xuICAgIGxldCBrZXlzOiBUS2V5cyB8IG51bGw7XG4gICAgbGV0IGZpZWxkOiBGaWVsZCB8IHZvaWQ7XG4gICAgbGV0IGRpY3RNZXRhOiBhbnk7XG4gICAgbGV0IHR5cGU6IERhdGFUeXBlPGFueT47XG4gICAgbGV0IGRpY3RUeXBlOiBEaWN0aW9uYXJ5O1xuICAgIGxldCBkaWN0RmllbGQ6IEZpZWxkPERpY3Rpb25hcnk+O1xuXG4gICAgLy8gSWYgbm8gZGljdGlvbmFyeSBlbmNvZGluZywgb3IgaW4gdGhlIHByb2Nlc3Mgb2YgZGVjb2RpbmcgdGhlIGNoaWxkcmVuIG9mIGEgZGljdGlvbmFyeS1lbmNvZGVkIGZpZWxkXG4gICAgaWYgKCFkaWN0aW9uYXJpZXMgfHwgIWRpY3Rpb25hcnlGaWVsZHMgfHwgIShkaWN0TWV0YSA9IF9maWVsZFsnZGljdGlvbmFyeSddKSkge1xuICAgICAgICB0eXBlID0gdHlwZUZyb21KU09OKF9maWVsZCwgZmllbGRDaGlsZHJlbkZyb21KU09OKF9maWVsZCwgZGljdGlvbmFyaWVzLCBkaWN0aW9uYXJ5RmllbGRzKSk7XG4gICAgICAgIGZpZWxkID0gbmV3IEZpZWxkKF9maWVsZFsnbmFtZSddLCB0eXBlLCBfZmllbGRbJ251bGxhYmxlJ10sIGN1c3RvbU1ldGFkYXRhRnJvbUpTT04oX2ZpZWxkWydjdXN0b21NZXRhZGF0YSddKSk7XG4gICAgfVxuICAgIC8vIHRzbGludDpkaXNhYmxlXG4gICAgLy8gSWYgZGljdGlvbmFyeSBlbmNvZGVkIGFuZCB0aGUgZmlyc3QgdGltZSB3ZSd2ZSBzZWVuIHRoaXMgZGljdGlvbmFyeSBpZCwgZGVjb2RlXG4gICAgLy8gdGhlIGRhdGEgdHlwZSBhbmQgY2hpbGQgZmllbGRzLCB0aGVuIHdyYXAgaW4gYSBEaWN0aW9uYXJ5IHR5cGUgYW5kIGluc2VydCB0aGVcbiAgICAvLyBkYXRhIHR5cGUgaW50byB0aGUgZGljdGlvbmFyeSB0eXBlcyBtYXAuXG4gICAgZWxzZSBpZiAoIWRpY3Rpb25hcmllcy5oYXMoaWQgPSBkaWN0TWV0YVsnaWQnXSkpIHtcbiAgICAgICAgLy8gYSBkaWN0aW9uYXJ5IGluZGV4IGRlZmF1bHRzIHRvIHNpZ25lZCAzMiBiaXQgaW50IGlmIHVuc3BlY2lmaWVkXG4gICAgICAgIGtleXMgPSAoa2V5cyA9IGRpY3RNZXRhWydpbmRleFR5cGUnXSkgPyBpbmRleFR5cGVGcm9tSlNPTihrZXlzKSBhcyBUS2V5cyA6IG5ldyBJbnQzMigpO1xuICAgICAgICBkaWN0aW9uYXJpZXMuc2V0KGlkLCB0eXBlID0gdHlwZUZyb21KU09OKF9maWVsZCwgZmllbGRDaGlsZHJlbkZyb21KU09OKF9maWVsZCkpKTtcbiAgICAgICAgZGljdFR5cGUgPSBuZXcgRGljdGlvbmFyeSh0eXBlLCBrZXlzLCBpZCwgZGljdE1ldGFbJ2lzT3JkZXJlZCddKTtcbiAgICAgICAgZGljdEZpZWxkID0gbmV3IEZpZWxkKF9maWVsZFsnbmFtZSddLCBkaWN0VHlwZSwgX2ZpZWxkWydudWxsYWJsZSddLCBjdXN0b21NZXRhZGF0YUZyb21KU09OKF9maWVsZFsnY3VzdG9tTWV0YWRhdGEnXSkpO1xuICAgICAgICBkaWN0aW9uYXJ5RmllbGRzLnNldChpZCwgW2ZpZWxkID0gZGljdEZpZWxkXSk7XG4gICAgfVxuICAgIC8vIElmIGRpY3Rpb25hcnkgZW5jb2RlZCwgYW5kIGhhdmUgYWxyZWFkeSBzZWVuIHRoaXMgZGljdGlvbmFyeSBJZCBpbiB0aGUgc2NoZW1hLCB0aGVuIHJldXNlIHRoZVxuICAgIC8vIGRhdGEgdHlwZSBhbmQgd3JhcCBpbiBhIG5ldyBEaWN0aW9uYXJ5IHR5cGUgYW5kIGZpZWxkLlxuICAgIGVsc2Uge1xuICAgICAgICAvLyBhIGRpY3Rpb25hcnkgaW5kZXggZGVmYXVsdHMgdG8gc2lnbmVkIDMyIGJpdCBpbnQgaWYgdW5zcGVjaWZpZWRcbiAgICAgICAga2V5cyA9IChrZXlzID0gZGljdE1ldGFbJ2luZGV4VHlwZSddKSA/IGluZGV4VHlwZUZyb21KU09OKGtleXMpIGFzIFRLZXlzIDogbmV3IEludDMyKCk7XG4gICAgICAgIGRpY3RUeXBlID0gbmV3IERpY3Rpb25hcnkoZGljdGlvbmFyaWVzLmdldChpZCkhLCBrZXlzLCBpZCwgZGljdE1ldGFbJ2lzT3JkZXJlZCddKTtcbiAgICAgICAgZGljdEZpZWxkID0gbmV3IEZpZWxkKF9maWVsZFsnbmFtZSddLCBkaWN0VHlwZSwgX2ZpZWxkWydudWxsYWJsZSddLCBjdXN0b21NZXRhZGF0YUZyb21KU09OKF9maWVsZFsnY3VzdG9tTWV0YWRhdGEnXSkpO1xuICAgICAgICBkaWN0aW9uYXJ5RmllbGRzLmdldChpZCkhLnB1c2goZmllbGQgPSBkaWN0RmllbGQpO1xuICAgIH1cbiAgICByZXR1cm4gZmllbGQgfHwgbnVsbDtcbn1cblxuZnVuY3Rpb24gY3VzdG9tTWV0YWRhdGFGcm9tSlNPTihfbWV0YWRhdGE/OiBvYmplY3QpIHtcbiAgICByZXR1cm4gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oT2JqZWN0LmVudHJpZXMoX21ldGFkYXRhIHx8IHt9KSk7XG59XG5cbmZ1bmN0aW9uIGluZGV4VHlwZUZyb21KU09OKF90eXBlOiBhbnkpIHtcbiAgICByZXR1cm4gbmV3IEludChfdHlwZVsnaXNTaWduZWQnXSwgX3R5cGVbJ2JpdFdpZHRoJ10pO1xufVxuXG5mdW5jdGlvbiB0eXBlRnJvbUpTT04oZjogYW55LCBjaGlsZHJlbj86IEZpZWxkW10pOiBEYXRhVHlwZTxhbnk+IHtcblxuICAgIGNvbnN0IHR5cGVJZCA9IGZbJ3R5cGUnXVsnbmFtZSddO1xuXG4gICAgc3dpdGNoICh0eXBlSWQpIHtcbiAgICAgICAgY2FzZSAnTk9ORSc6ICAgcmV0dXJuIG5ldyBEYXRhVHlwZSgpO1xuICAgICAgICBjYXNlICdudWxsJzogICByZXR1cm4gbmV3IE51bGwoKTtcbiAgICAgICAgY2FzZSAnYmluYXJ5JzogcmV0dXJuIG5ldyBCaW5hcnkoKTtcbiAgICAgICAgY2FzZSAndXRmOCc6ICAgcmV0dXJuIG5ldyBVdGY4KCk7XG4gICAgICAgIGNhc2UgJ2Jvb2wnOiAgIHJldHVybiBuZXcgQm9vbCgpO1xuICAgICAgICBjYXNlICdsaXN0JzogICByZXR1cm4gbmV3IExpc3QoKGNoaWxkcmVuIHx8IFtdKVswXSk7XG4gICAgICAgIGNhc2UgJ3N0cnVjdCc6IHJldHVybiBuZXcgU3RydWN0KGNoaWxkcmVuIHx8IFtdKTtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKHR5cGVJZCkge1xuICAgICAgICBjYXNlICdpbnQnOiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZlsndHlwZSddO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBJbnQodFsnaXNTaWduZWQnXSwgdFsnYml0V2lkdGgnXSBhcyBJbnRCaXRXaWR0aCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnZmxvYXRpbmdwb2ludCc6IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBmWyd0eXBlJ107XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZsb2F0KFByZWNpc2lvblt0WydwcmVjaXNpb24nXV0gYXMgYW55KTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlICdkZWNpbWFsJzoge1xuICAgICAgICAgICAgY29uc3QgdCA9IGZbJ3R5cGUnXTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRGVjaW1hbCh0WydzY2FsZSddLCB0WydwcmVjaXNpb24nXSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnZGF0ZSc6IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBmWyd0eXBlJ107XG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGVfKERhdGVVbml0W3RbJ3VuaXQnXV0gYXMgYW55KTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlICd0aW1lJzoge1xuICAgICAgICAgICAgY29uc3QgdCA9IGZbJ3R5cGUnXTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVGltZShUaW1lVW5pdFt0Wyd1bml0J11dIGFzIGFueSwgdFsnYml0V2lkdGgnXSBhcyBUaW1lQml0V2lkdGgpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgJ3RpbWVzdGFtcCc6IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBmWyd0eXBlJ107XG4gICAgICAgICAgICByZXR1cm4gbmV3IFRpbWVzdGFtcChUaW1lVW5pdFt0Wyd1bml0J11dIGFzIGFueSwgdFsndGltZXpvbmUnXSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnaW50ZXJ2YWwnOiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZlsndHlwZSddO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBJbnRlcnZhbChJbnRlcnZhbFVuaXRbdFsndW5pdCddXSBhcyBhbnkpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgJ3VuaW9uJzoge1xuICAgICAgICAgICAgY29uc3QgdCA9IGZbJ3R5cGUnXTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVW5pb24oVW5pb25Nb2RlW3RbJ21vZGUnXV0gYXMgYW55LCAodFsndHlwZUlkcyddIHx8IFtdKSwgY2hpbGRyZW4gfHwgW10pO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgJ2ZpeGVkc2l6ZWJpbmFyeSc6IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBmWyd0eXBlJ107XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZpeGVkU2l6ZUJpbmFyeSh0WydieXRlV2lkdGgnXSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnZml4ZWRzaXplbGlzdCc6IHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBmWyd0eXBlJ107XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZpeGVkU2l6ZUxpc3QodFsnbGlzdFNpemUnXSwgKGNoaWxkcmVuIHx8IFtdKVswXSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnbWFwJzoge1xuICAgICAgICAgICAgY29uc3QgdCA9IGZbJ3R5cGUnXTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgTWFwXyhjaGlsZHJlbiB8fCBbXSwgdFsna2V5c1NvcnRlZCddKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVucmVjb2duaXplZCB0eXBlOiBcIiR7dHlwZUlkfVwiYCk7XG59XG4iXX0=
