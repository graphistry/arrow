"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const flatbuffers_1 = require("flatbuffers");
const vector_1 = require("./vector");
const bit_1 = require("../../util/bit");
const IntUtil = require("../../util/int");
const text_encoding_utf_8_1 = require("text-encoding-utf-8");
const metadata_1 = require("../metadata");
const type_1 = require("../../type");
const type_2 = require("../../type");
var Long = flatbuffers_1.flatbuffers.Long;
function* readJSON(json) {
    const schema = schemaFromJSON(json['schema']);
    const dictionaries = new Map();
    for (const batch of (json['dictionaries'] || [])) {
        const message = dictionaryBatchFromJSON(batch);
        yield {
            schema, message,
            loader: new JSONDataLoader(flattenDataSources(batch['data']['columns']), arrayIterator(message.nodes), arrayIterator(message.buffers), dictionaries)
        };
    }
    for (const batch of (json['batches'] || [])) {
        const message = recordBatchFromJSON(batch);
        yield {
            schema, message,
            loader: new JSONDataLoader(flattenDataSources(batch['columns']), arrayIterator(message.nodes), arrayIterator(message.buffers), dictionaries)
        };
    }
}
exports.readJSON = readJSON;
function* arrayIterator(arr) { yield* arr; }
function flattenDataSources(xs) {
    return (xs || []).reduce((buffers, column) => [
        ...buffers,
        ...(column['VALIDITY'] && [column['VALIDITY']] || []),
        ...(column['OFFSET'] && [column['OFFSET']] || []),
        ...(column['TYPE'] && [column['TYPE']] || []),
        ...(column['DATA'] && [column['DATA']] || []),
        ...flattenDataSources(column['children'])
    ], []);
}
const utf8Encoder = new text_encoding_utf_8_1.TextEncoder('utf-8');
class JSONDataLoader extends vector_1.TypeDataLoader {
    constructor(sources, nodes, buffers, dictionaries) {
        super(nodes, buffers, dictionaries);
        this.sources = sources;
    }
    readNullBitmap(_type, nullCount, { offset } = this.getBufferMetadata()) {
        return nullCount <= 0 ? new Uint8Array(0) : bit_1.packBools(this.sources[offset]);
    }
    readOffsets(_type, { offset } = this.getBufferMetadata()) {
        return new Int32Array(this.sources[offset]);
    }
    readTypeIds(_type, { offset } = this.getBufferMetadata()) {
        return new Int8Array(this.sources[offset]);
    }
    readData(type, { offset } = this.getBufferMetadata()) {
        const { sources } = this;
        if (type_1.DataType.isTimestamp(type) === true) {
            return new Uint8Array(int64DataFromJSON(sources[offset]));
        }
        else if ((type_1.DataType.isInt(type) || type_1.DataType.isTime(type)) && type.bitWidth === 64) {
            return new Uint8Array(int64DataFromJSON(sources[offset]));
        }
        else if (type_1.DataType.isDate(type) && type.unit === DateUnit.MILLISECOND) {
            return new Uint8Array(int64DataFromJSON(sources[offset]));
        }
        else if (type_1.DataType.isDecimal(type) === true) {
            return new Uint8Array(decimalDataFromJSON(sources[offset]));
        }
        else if (type_1.DataType.isBinary(type) === true || type_1.DataType.isFixedSizeBinary(type) === true) {
            return new Uint8Array(binaryDataFromJSON(sources[offset]));
        }
        else if (type_1.DataType.isBool(type) === true) {
            return new Uint8Array(bit_1.packBools(sources[offset]).buffer);
        }
        else if (type_1.DataType.isUtf8(type) === true) {
            return utf8Encoder.encode(sources[offset].join(''));
        }
        else {
            return data_1.toTypedArray(type.ArrayType, sources[offset].map((x) => +x));
        }
    }
}
exports.JSONDataLoader = JSONDataLoader;
function int64DataFromJSON(values) {
    const data = new Uint32Array(values.length * 2);
    for (let i = -1, n = values.length; ++i < n;) {
        // Force all values (even numbers) to be parsed as strings since
        // pulling out high and low bits seems to lose precision sometimes
        // For example:
        //     > -4613034156400212000 >>> 0
        //     721782784
        // The correct lower 32-bits are 721782752
        IntUtil.Int64.fromString(values[i].toString(), new Uint32Array(data.buffer, data.byteOffset + 2 * i * 4, 2));
    }
    return data.buffer;
}
function decimalDataFromJSON(values) {
    const data = new Uint32Array(values.length * 4);
    for (let i = -1, n = values.length; ++i < n;) {
        IntUtil.Int128.fromString(values[i], new Uint32Array(data.buffer, data.byteOffset + 4 * 4 * i, 4));
    }
    return data.buffer;
}
function binaryDataFromJSON(values) {
    // "DATA": ["49BC7D5B6C47D2","3F5FB6D9322026"]
    // There are definitely more efficient ways to do this... but it gets the
    // job done.
    const joined = values.join('');
    const data = new Uint8Array(joined.length / 2);
    for (let i = 0; i < joined.length; i += 2) {
        data[i >> 1] = parseInt(joined.substr(i, 2), 16);
    }
    return data.buffer;
}
const Schema_ = require("../../fb/Schema");
var Type = Schema_.org.apache.arrow.flatbuf.Type;
var DateUnit = Schema_.org.apache.arrow.flatbuf.DateUnit;
var TimeUnit = Schema_.org.apache.arrow.flatbuf.TimeUnit;
var UnionMode = Schema_.org.apache.arrow.flatbuf.UnionMode;
var Precision = Schema_.org.apache.arrow.flatbuf.Precision;
var IntervalUnit = Schema_.org.apache.arrow.flatbuf.IntervalUnit;
var MetadataVersion = Schema_.org.apache.arrow.flatbuf.MetadataVersion;
const data_1 = require("../../data");
function schemaFromJSON(s) {
    const dictionaryFields = new Map();
    return new type_1.Schema(fieldsFromJSON(s['fields'], dictionaryFields), customMetadata(s['customMetadata']), MetadataVersion.V4, dictionaryFields);
}
function recordBatchFromJSON(b) {
    return new metadata_1.RecordBatchMetadata(MetadataVersion.V4, b['count'], fieldNodesFromJSON(b['columns']), buffersFromJSON(b['columns']));
}
function dictionaryBatchFromJSON(b) {
    return new metadata_1.DictionaryBatch(MetadataVersion.V4, recordBatchFromJSON(b['data']), b['id'], b['isDelta']);
}
function fieldsFromJSON(fs, dictionaryFields) {
    return (fs || [])
        .map((f) => fieldFromJSON(f, dictionaryFields))
        .filter((f) => f != null);
}
function fieldNodesFromJSON(xs) {
    return (xs || []).reduce((fieldNodes, column) => [
        ...fieldNodes,
        new metadata_1.FieldMetadata(new Long(column['count'], 0), new Long(nullCountFromJSON(column['VALIDITY']), 0)),
        ...fieldNodesFromJSON(column['children'])
    ], []);
}
function buffersFromJSON(xs, buffers = []) {
    for (let i = -1, n = (xs || []).length; ++i < n;) {
        const column = xs[i];
        column['VALIDITY'] && buffers.push(new metadata_1.BufferMetadata(new Long(buffers.length, 0), new Long(column['VALIDITY'].length, 0)));
        column['OFFSET'] && buffers.push(new metadata_1.BufferMetadata(new Long(buffers.length, 0), new Long(column['OFFSET'].length, 0)));
        column['TYPE'] && buffers.push(new metadata_1.BufferMetadata(new Long(buffers.length, 0), new Long(column['TYPE'].length, 0)));
        column['DATA'] && buffers.push(new metadata_1.BufferMetadata(new Long(buffers.length, 0), new Long(column['DATA'].length, 0)));
        buffers = buffersFromJSON(column['children'], buffers);
    }
    return buffers;
}
function nullCountFromJSON(validity) {
    return (validity || []).reduce((sum, val) => sum + +(val === 0), 0);
}
function fieldFromJSON(f, dictionaryFields) {
    let name = f['name'];
    let field;
    let nullable = f['nullable'];
    let dataType;
    let id, keysMeta, dictMeta;
    let metadata = customMetadata(f['customMetadata']);
    if (!dictionaryFields || !(dictMeta = f['dictionary'])) {
        if (dataType = typeFromJSON(f['type'], fieldsFromJSON(f['children'], dictionaryFields))) {
            field = new type_1.Field(name, dataType, nullable, metadata);
        }
    }
    else if (dataType = dictionaryFields.has(id = dictMeta['id'])
        ? dictionaryFields.get(id).type.dictionary
        : typeFromJSON(f['type'], fieldsFromJSON(f['children'], null))) {
        dataType = new type_1.Dictionary(dataType, 
        // a dictionary index defaults to signed 32 bit int if unspecified
        (keysMeta = dictMeta['indexType']) ? intFromJSON(keysMeta) : new type_2.Int32(), id, dictMeta['isOrdered']);
        field = new type_1.Field(name, dataType, nullable, metadata);
        dictionaryFields.has(id) || dictionaryFields.set(id, field);
    }
    return field || null;
}
function customMetadata(metadata) {
    return new Map(Object.entries(metadata || {}));
}
const namesToTypeMap = {
    'NONE': Type.NONE,
    'null': Type.Null,
    'int': Type.Int,
    'floatingpoint': Type.FloatingPoint,
    'binary': Type.Binary,
    'bool': Type.Bool,
    'utf8': Type.Utf8,
    'decimal': Type.Decimal,
    'date': Type.Date,
    'time': Type.Time,
    'timestamp': Type.Timestamp,
    'interval': Type.Interval,
    'list': Type.List,
    'struct': Type.Struct_,
    'union': Type.Union,
    'fixedsizebinary': Type.FixedSizeBinary,
    'fixedsizelist': Type.FixedSizeList,
    'map': Type.Map,
};
function typeFromJSON(t, children) {
    switch (namesToTypeMap[t['name']]) {
        case Type.NONE: return null;
        case Type.Null: return nullFromJSON(t);
        case Type.Int: return intFromJSON(t);
        case Type.FloatingPoint: return floatingPointFromJSON(t);
        case Type.Binary: return binaryFromJSON(t);
        case Type.Utf8: return utf8FromJSON(t);
        case Type.Bool: return boolFromJSON(t);
        case Type.Decimal: return decimalFromJSON(t);
        case Type.Date: return dateFromJSON(t);
        case Type.Time: return timeFromJSON(t);
        case Type.Timestamp: return timestampFromJSON(t);
        case Type.Interval: return intervalFromJSON(t);
        case Type.List: return listFromJSON(t, children || []);
        case Type.Struct_: return structFromJSON(t, children || []);
        case Type.Union: return unionFromJSON(t, children || []);
        case Type.FixedSizeBinary: return fixedSizeBinaryFromJSON(t);
        case Type.FixedSizeList: return fixedSizeListFromJSON(t, children || []);
        case Type.Map: return mapFromJSON(t, children || []);
    }
    throw new Error(`Unrecognized type ${t['name']}`);
}
function nullFromJSON(_type) { return new type_1.Null(); }
function intFromJSON(_type) {
    switch (_type['bitWidth']) {
        case 8: return _type['isSigned'] ? new type_2.Int8() : new type_2.Uint8();
        case 16: return _type['isSigned'] ? new type_2.Int16() : new type_2.Uint16();
        case 32: return _type['isSigned'] ? new type_2.Int32() : new type_2.Uint32();
        case 64: return _type['isSigned'] ? new type_2.Int64() : new type_2.Uint64();
    }
    return null;
}
function floatingPointFromJSON(_type) {
    switch (Precision[_type['precision']]) {
        case Precision.HALF: return new type_2.Float16();
        case Precision.SINGLE: return new type_2.Float32();
        case Precision.DOUBLE: return new type_2.Float64();
    }
    return null;
}
function binaryFromJSON(_type) { return new type_1.Binary(); }
function utf8FromJSON(_type) { return new type_1.Utf8(); }
function boolFromJSON(_type) { return new type_1.Bool(); }
function decimalFromJSON(_type) { return new type_1.Decimal(_type['scale'], _type['precision']); }
function dateFromJSON(_type) { return new type_1.Date_(DateUnit[_type['unit']]); }
function timeFromJSON(_type) { return new type_1.Time(TimeUnit[_type['unit']], _type['bitWidth']); }
function timestampFromJSON(_type) { return new type_1.Timestamp(TimeUnit[_type['unit']], _type['timezone']); }
function intervalFromJSON(_type) { return new type_1.Interval(IntervalUnit[_type['unit']]); }
function listFromJSON(_type, children) { return new type_1.List(children); }
function structFromJSON(_type, children) { return new type_1.Struct(children); }
function unionFromJSON(_type, children) { return new type_1.Union(UnionMode[_type['mode']], (_type['typeIds'] || []), children); }
function fixedSizeBinaryFromJSON(_type) { return new type_1.FixedSizeBinary(_type['byteWidth']); }
function fixedSizeListFromJSON(_type, children) { return new type_1.FixedSizeList(_type['listSize'], children); }
function mapFromJSON(_type, children) { return new type_1.Map_(_type['keysSorted'], children); }

//# sourceMappingURL=data:application/json;charset=utf8;base64,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Q0FBQyxDQUFDO0lBQy9DLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDeEMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO0FBQ3ZCLENBQUM7QUFFRCwyQ0FBMkM7QUFDM0MsSUFBTyxJQUFJLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7QUFDcEQsSUFBTyxRQUFRLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDNUQsSUFBTyxRQUFRLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDNUQsSUFBTyxTQUFTLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDOUQsSUFBTyxTQUFTLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDOUQsSUFBTyxZQUFZLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUM7QUFDcEUsSUFBTyxlQUFlLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUM7QUFDMUUscUNBQTBDO0FBRTFDLHdCQUF3QixDQUFNO0lBQzFCLE1BQU0s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QUNwSywrQkFBaUMsS0FBVSxFQUFFLFFBQWlCLElBQUksTUFBTSxDQUFDLElBQUksb0JBQWEsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBMkMsQ0FBQztBQUNwSyxxQkFBaUMsS0FBVSxFQUFFLFFBQWlCLElBQUksTUFBTSxDQUFDLElBQUksV0FBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFrRCxDQUFDIiwiZmlsZSI6ImlwYy9yZWFkZXIvanNvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBWZWN0b3IgfSBmcm9tICcuLi8uLi92ZWN0b3InO1xuaW1wb3J0IHsgZmxhdGJ1ZmZlcnMgfSBmcm9tICdmbGF0YnVmZmVycyc7XG5pbXBvcnQgeyBUeXBlRGF0YUxvYWRlciB9IGZyb20gJy4vdmVjdG9yJztcbmltcG9ydCB7IHBhY2tCb29scyB9IGZyb20gJy4uLy4uL3V0aWwvYml0JztcbmltcG9ydCAqIGFzIEludFV0aWwgZnJvbSAnLi4vLi4vdXRpbC9pbnQnO1xuaW1wb3J0IHsgVGV4dEVuY29kZXIgfSBmcm9tICd0ZXh0LWVuY29kaW5nLXV0Zi04JztcbmltcG9ydCB7IFJlY29yZEJhdGNoTWV0YWRhdGEsIERpY3Rpb25hcnlCYXRjaCwgQnVmZmVyTWV0YWRhdGEsIEZpZWxkTWV0YWRhdGEgfSBmcm9tICcuLi9tZXRhZGF0YSc7XG5pbXBvcnQge1xuICAgIFNjaGVtYSwgRmllbGQsXG4gICAgRGF0YVR5cGUsIERpY3Rpb25hcnksXG4gICAgTnVsbCwgVGltZUJpdFdpZHRoLFxuICAgIEJpbmFyeSwgQm9vbCwgVXRmOCwgRGVjaW1hbCxcbiAgICBEYXRlXywgVGltZSwgVGltZXN0YW1wLCBJbnRlcnZhbCxcbiAgICBMaXN0LCBTdHJ1Y3QsIFVuaW9uLCBGaXhlZFNpemVCaW5hcnksIEZpeGVkU2l6ZUxpc3QsIE1hcF8sXG59IGZyb20gJy4uLy4uL3R5cGUnO1xuXG5pbXBvcnQge1xuICAgIEludDgsICBVaW50OCxcbiAgICBJbnQxNiwgVWludDE2LFxuICAgIEludDMyLCBVaW50MzIsXG4gICAgSW50NjQsIFVpbnQ2NCxcbiAgICBGbG9hdDE2LCBGbG9hdDY0LCBGbG9hdDMyLFxufSBmcm9tICcuLi8uLi90eXBlJztcblxuaW1wb3J0IExvbmcgPSBmbGF0YnVmZmVycy5Mb25nO1xuXG5leHBvcnQgZnVuY3Rpb24qIHJlYWRKU09OKGpzb246IGFueSkge1xuICAgIGNvbnN0IHNjaGVtYSA9IHNjaGVtYUZyb21KU09OKGpzb25bJ3NjaGVtYSddKTtcbiAgICBjb25zdCBkaWN0aW9uYXJpZXMgPSBuZXcgTWFwPG51bWJlciwgVmVjdG9yPigpO1xuICAgIGZvciAoY29uc3QgYmF0Y2ggb2YgKGpzb25bJ2RpY3Rpb25hcmllcyddIHx8IFtdKSkge1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gZGljdGlvbmFyeUJhdGNoRnJvbUpTT04oYmF0Y2gpO1xuICAgICAgICB5aWVsZCB7XG4gICAgICAgICAgICBzY2hlbWEsIG1lc3NhZ2UsXG4gICAgICAgICAgICBsb2FkZXI6IG5ldyBKU09ORGF0YUxvYWRlcihcbiAgICAgICAgICAgICAgICBmbGF0dGVuRGF0YVNvdXJjZXMoYmF0Y2hbJ2RhdGEnXVsnY29sdW1ucyddKSxcbiAgICAgICAgICAgICAgICBhcnJheUl0ZXJhdG9yKG1lc3NhZ2Uubm9kZXMpLFxuICAgICAgICAgICAgICAgIGFycmF5SXRlcmF0b3IobWVzc2FnZS5idWZmZXJzKSxcbiAgICAgICAgICAgICAgICBkaWN0aW9uYXJpZXNcbiAgICAgICAgICAgIClcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBiYXRjaCBvZiAoanNvblsnYmF0Y2hlcyddIHx8IFtdKSkge1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gcmVjb3JkQmF0Y2hGcm9tSlNPTihiYXRjaCk7XG4gICAgICAgIHlpZWxkIHtcbiAgICAgICAgICAgIHNjaGVtYSwgbWVzc2FnZSxcbiAgICAgICAgICAgIGxvYWRlcjogbmV3IEpTT05EYXRhTG9hZGVyKFxuICAgICAgICAgICAgICAgIGZsYXR0ZW5EYXRhU291cmNlcyhiYXRjaFsnY29sdW1ucyddKSxcbiAgICAgICAgICAgICAgICBhcnJheUl0ZXJhdG9yKG1lc3NhZ2Uubm9kZXMpLFxuICAgICAgICAgICAgICAgIGFycmF5SXRlcmF0b3IobWVzc2FnZS5idWZmZXJzKSxcbiAgICAgICAgICAgICAgICBkaWN0aW9uYXJpZXNcbiAgICAgICAgICAgIClcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uKiBhcnJheUl0ZXJhdG9yKGFycjogQXJyYXk8YW55PikgeyB5aWVsZCogYXJyOyB9XG5mdW5jdGlvbiBmbGF0dGVuRGF0YVNvdXJjZXMoeHM6IGFueVtdKTogYW55W11bXSB7XG4gICAgcmV0dXJuICh4cyB8fCBbXSkucmVkdWNlPGFueVtdW10+KChidWZmZXJzLCBjb2x1bW46IGFueSkgPT4gW1xuICAgICAgICAuLi5idWZmZXJzLFxuICAgICAgICAuLi4oY29sdW1uWydWQUxJRElUWSddICYmIFtjb2x1bW5bJ1ZBTElESVRZJ11dIHx8IFtdKSxcbiAgICAgICAgLi4uKGNvbHVtblsnT0ZGU0VUJ10gJiYgW2NvbHVtblsnT0ZGU0VUJ11dIHx8IFtdKSxcbiAgICAgICAgLi4uKGNvbHVtblsnVFlQRSddICYmIFtjb2x1bW5bJ1RZUEUnXV0gfHwgW10pLFxuICAgICAgICAuLi4oY29sdW1uWydEQVRBJ10gJiYgW2NvbHVtblsnREFUQSddXSB8fCBbXSksXG4gICAgICAgIC4uLmZsYXR0ZW5EYXRhU291cmNlcyhjb2x1bW5bJ2NoaWxkcmVuJ10pXG4gICAgXSwgW10gYXMgYW55W11bXSk7XG59XG5cbmNvbnN0IHV0ZjhFbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCd1dGYtOCcpO1xuXG5leHBvcnQgY2xhc3MgSlNPTkRhdGFMb2FkZXIgZXh0ZW5kcyBUeXBlRGF0YUxvYWRlciB7XG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzb3VyY2VzOiBhbnlbXVtdLCBub2RlczogSXRlcmF0b3I8RmllbGRNZXRhZGF0YT4sIGJ1ZmZlcnM6IEl0ZXJhdG9yPEJ1ZmZlck1ldGFkYXRhPiwgZGljdGlvbmFyaWVzOiBNYXA8bnVtYmVyLCBWZWN0b3I+KSB7XG4gICAgICAgIHN1cGVyKG5vZGVzLCBidWZmZXJzLCBkaWN0aW9uYXJpZXMpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgcmVhZE51bGxCaXRtYXA8VCBleHRlbmRzIERhdGFUeXBlPihfdHlwZTogVCwgbnVsbENvdW50OiBudW1iZXIsIHsgb2Zmc2V0IH0gPSB0aGlzLmdldEJ1ZmZlck1ldGFkYXRhKCkpIHtcbiAgICAgICAgcmV0dXJuIG51bGxDb3VudCA8PSAwID8gbmV3IFVpbnQ4QXJyYXkoMCkgOiBwYWNrQm9vbHModGhpcy5zb3VyY2VzW29mZnNldF0pO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgcmVhZE9mZnNldHM8VCBleHRlbmRzIERhdGFUeXBlPihfdHlwZTogVCwgeyBvZmZzZXQgfTogQnVmZmVyTWV0YWRhdGEgPSB0aGlzLmdldEJ1ZmZlck1ldGFkYXRhKCkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJbnQzMkFycmF5KHRoaXMuc291cmNlc1tvZmZzZXRdKTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHJlYWRUeXBlSWRzPFQgZXh0ZW5kcyBEYXRhVHlwZT4oX3R5cGU6IFQsIHsgb2Zmc2V0IH06IEJ1ZmZlck1ldGFkYXRhID0gdGhpcy5nZXRCdWZmZXJNZXRhZGF0YSgpKSB7XG4gICAgICAgIHJldHVybiBuZXcgSW50OEFycmF5KHRoaXMuc291cmNlc1tvZmZzZXRdKTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHJlYWREYXRhPFQgZXh0ZW5kcyBEYXRhVHlwZT4odHlwZTogVCwgeyBvZmZzZXQgfTogQnVmZmVyTWV0YWRhdGEgPSB0aGlzLmdldEJ1ZmZlck1ldGFkYXRhKCkpIHtcbiAgICAgICAgY29uc3QgeyBzb3VyY2VzIH0gPSB0aGlzO1xuICAgICAgICBpZiAoRGF0YVR5cGUuaXNUaW1lc3RhbXAodHlwZSkgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShpbnQ2NERhdGFGcm9tSlNPTihzb3VyY2VzW29mZnNldF0gYXMgc3RyaW5nW10pKTtcbiAgICAgICAgfSBlbHNlIGlmICgoRGF0YVR5cGUuaXNJbnQodHlwZSkgfHwgRGF0YVR5cGUuaXNUaW1lKHR5cGUpKSAmJiB0eXBlLmJpdFdpZHRoID09PSA2NCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGludDY0RGF0YUZyb21KU09OKHNvdXJjZXNbb2Zmc2V0XSBhcyBzdHJpbmdbXSkpO1xuICAgICAgICB9IGVsc2UgaWYgKERhdGFUeXBlLmlzRGF0ZSh0eXBlKSAmJiB0eXBlLnVuaXQgPT09IERhdGVVbml0Lk1JTExJU0VDT05EKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaW50NjREYXRhRnJvbUpTT04oc291cmNlc1tvZmZzZXRdIGFzIHN0cmluZ1tdKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoRGF0YVR5cGUuaXNEZWNpbWFsKHR5cGUpID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoZGVjaW1hbERhdGFGcm9tSlNPTihzb3VyY2VzW29mZnNldF0gYXMgc3RyaW5nW10pKTtcbiAgICAgICAgfSBlbHNlIGlmIChEYXRhVHlwZS5pc0JpbmFyeSh0eXBlKSA9PT0gdHJ1ZSB8fCBEYXRhVHlwZS5pc0ZpeGVkU2l6ZUJpbmFyeSh0eXBlKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGJpbmFyeURhdGFGcm9tSlNPTihzb3VyY2VzW29mZnNldF0gYXMgc3RyaW5nW10pKTtcbiAgICAgICAgfSBlbHNlIGlmIChEYXRhVHlwZS5pc0Jvb2wodHlwZSkgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShwYWNrQm9vbHMoc291cmNlc1tvZmZzZXRdIGFzIG51bWJlcltdKS5idWZmZXIpO1xuICAgICAgICB9IGVsc2UgaWYgKERhdGFUeXBlLmlzVXRmOCh0eXBlKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIHV0ZjhFbmNvZGVyLmVuY29kZSgoc291cmNlc1tvZmZzZXRdIGFzIHN0cmluZ1tdKS5qb2luKCcnKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdG9UeXBlZEFycmF5KHR5cGUuQXJyYXlUeXBlLCBzb3VyY2VzW29mZnNldF0ubWFwKCh4KSA9PiAreCkpIGFzIGFueTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gaW50NjREYXRhRnJvbUpTT04odmFsdWVzOiBzdHJpbmdbXSkge1xuICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDMyQXJyYXkodmFsdWVzLmxlbmd0aCAqIDIpO1xuICAgIGZvciAobGV0IGkgPSAtMSwgbiA9IHZhbHVlcy5sZW5ndGg7ICsraSA8IG47KSB7XG4gICAgICAgIC8vIEZvcmNlIGFsbCB2YWx1ZXMgKGV2ZW4gbnVtYmVycykgdG8gYmUgcGFyc2VkIGFzIHN0cmluZ3Mgc2luY2VcbiAgICAgICAgLy8gcHVsbGluZyBvdXQgaGlnaCBhbmQgbG93IGJpdHMgc2VlbXMgdG8gbG9zZSBwcmVjaXNpb24gc29tZXRpbWVzXG4gICAgICAgIC8vIEZvciBleGFtcGxlOlxuICAgICAgICAvLyAgICAgPiAtNDYxMzAzNDE1NjQwMDIxMjAwMCA+Pj4gMFxuICAgICAgICAvLyAgICAgNzIxNzgyNzg0XG4gICAgICAgIC8vIFRoZSBjb3JyZWN0IGxvd2VyIDMyLWJpdHMgYXJlIDcyMTc4Mjc1MlxuICAgICAgICBJbnRVdGlsLkludDY0LmZyb21TdHJpbmcodmFsdWVzW2ldLnRvU3RyaW5nKCksIG5ldyBVaW50MzJBcnJheShkYXRhLmJ1ZmZlciwgZGF0YS5ieXRlT2Zmc2V0ICsgMiAqIGkgKiA0LCAyKSk7XG4gICAgfVxuICAgIHJldHVybiBkYXRhLmJ1ZmZlcjtcbn1cblxuZnVuY3Rpb24gZGVjaW1hbERhdGFGcm9tSlNPTih2YWx1ZXM6IHN0cmluZ1tdKSB7XG4gICAgY29uc3QgZGF0YSA9IG5ldyBVaW50MzJBcnJheSh2YWx1ZXMubGVuZ3RoICogNCk7XG4gICAgZm9yIChsZXQgaSA9IC0xLCBuID0gdmFsdWVzLmxlbmd0aDsgKytpIDwgbjspIHtcbiAgICAgICAgSW50VXRpbC5JbnQxMjguZnJvbVN0cmluZyh2YWx1ZXNbaV0sIG5ldyBVaW50MzJBcnJheShkYXRhLmJ1ZmZlciwgZGF0YS5ieXRlT2Zmc2V0ICsgNCAqIDQgKiBpLCA0KSk7XG4gICAgfVxuICAgIHJldHVybiBkYXRhLmJ1ZmZlcjtcbn1cblxuZnVuY3Rpb24gYmluYXJ5RGF0YUZyb21KU09OKHZhbHVlczogc3RyaW5nW10pIHtcbiAgICAvLyBcIkRBVEFcIjogW1wiNDlCQzdENUI2QzQ3RDJcIixcIjNGNUZCNkQ5MzIyMDI2XCJdXG4gICAgLy8gVGhlcmUgYXJlIGRlZmluaXRlbHkgbW9yZSBlZmZpY2llbnQgd2F5cyB0byBkbyB0aGlzLi4uIGJ1dCBpdCBnZXRzIHRoZVxuICAgIC8vIGpvYiBkb25lLlxuICAgIGNvbnN0IGpvaW5lZCA9IHZhbHVlcy5qb2luKCcnKTtcbiAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoam9pbmVkLmxlbmd0aCAvIDIpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgam9pbmVkLmxlbmd0aDsgaSArPSAyKSB7XG4gICAgICAgIGRhdGFbaSA+PiAxXSA9IHBhcnNlSW50KGpvaW5lZC5zdWJzdHIoaSwgMiksIDE2KTtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGEuYnVmZmVyO1xufVxuXG5pbXBvcnQgKiBhcyBTY2hlbWFfIGZyb20gJy4uLy4uL2ZiL1NjaGVtYSc7XG5pbXBvcnQgVHlwZSA9IFNjaGVtYV8ub3JnLmFwYWNoZS5hcnJvdy5mbGF0YnVmLlR5cGU7XG5pbXBvcnQgRGF0ZVVuaXQgPSBTY2hlbWFfLm9yZy5hcGFjaGUuYXJyb3cuZmxhdGJ1Zi5EYXRlVW5pdDtcbmltcG9ydCBUaW1lVW5pdCA9IFNjaGVtYV8ub3JnLmFwYWNoZS5hcnJvdy5mbGF0YnVmLlRpbWVVbml0O1xuaW1wb3J0IFVuaW9uTW9kZSA9IFNjaGVtYV8ub3JnLmFwYWNoZS5hcnJvdy5mbGF0YnVmLlVuaW9uTW9kZTtcbmltcG9ydCBQcmVjaXNpb24gPSBTY2hlbWFfLm9yZy5hcGFjaGUuYXJyb3cuZmxhdGJ1Zi5QcmVjaXNpb247XG5pbXBvcnQgSW50ZXJ2YWxVbml0ID0gU2NoZW1hXy5vcmcuYXBhY2hlLmFycm93LmZsYXRidWYuSW50ZXJ2YWxVbml0O1xuaW1wb3J0IE1ldGFkYXRhVmVyc2lvbiA9IFNjaGVtYV8ub3JnLmFwYWNoZS5hcnJvdy5mbGF0YnVmLk1ldGFkYXRhVmVyc2lvbjtcbmltcG9ydCB7IHRvVHlwZWRBcnJheSB9IGZyb20gJy4uLy4uL2RhdGEnO1xuXG5mdW5jdGlvbiBzY2hlbWFGcm9tSlNPTihzOiBhbnkpOiBTY2hlbWEge1xuICAgIGNvbnN0IGRpY3Rpb25hcnlGaWVsZHMgPSBuZXcgTWFwPG51bWJlciwgRmllbGQ8RGljdGlvbmFyeT4+KCk7XG4gICAgcmV0dXJuIG5ldyBTY2hlbWEoXG4gICAgICAgIGZpZWxkc0Zyb21KU09OKHNbJ2ZpZWxkcyddLCBkaWN0aW9uYXJ5RmllbGRzKSxcbiAgICAgICAgY3VzdG9tTWV0YWRhdGEoc1snY3VzdG9tTWV0YWRhdGEnXSksXG4gICAgICAgIE1ldGFkYXRhVmVyc2lvbi5WNCwgZGljdGlvbmFyeUZpZWxkc1xuICAgICk7XG59XG5cbmZ1bmN0aW9uIHJlY29yZEJhdGNoRnJvbUpTT04oYjogYW55KTogUmVjb3JkQmF0Y2hNZXRhZGF0YSB7XG4gICAgcmV0dXJuIG5ldyBSZWNvcmRCYXRjaE1ldGFkYXRhKFxuICAgICAgICBNZXRhZGF0YVZlcnNpb24uVjQsXG4gICAgICAgIGJbJ2NvdW50J10sXG4gICAgICAgIGZpZWxkTm9kZXNGcm9tSlNPTihiWydjb2x1bW5zJ10pLFxuICAgICAgICBidWZmZXJzRnJvbUpTT04oYlsnY29sdW1ucyddKVxuICAgICk7XG59XG5cbmZ1bmN0aW9uIGRpY3Rpb25hcnlCYXRjaEZyb21KU09OKGI6IGFueSk6IERpY3Rpb25hcnlCYXRjaCB7XG4gICAgcmV0dXJuIG5ldyBEaWN0aW9uYXJ5QmF0Y2goXG4gICAgICAgIE1ldGFkYXRhVmVyc2lvbi5WNCxcbiAgICAgICAgcmVjb3JkQmF0Y2hGcm9tSlNPTihiWydkYXRhJ10pLFxuICAgICAgICBiWydpZCddLCBiWydpc0RlbHRhJ11cbiAgICApO1xufVxuXG5mdW5jdGlvbiBmaWVsZHNGcm9tSlNPTihmczogYW55W10sIGRpY3Rpb25hcnlGaWVsZHM6IE1hcDxudW1iZXIsIEZpZWxkPERpY3Rpb25hcnk+PiB8IG51bGwpOiBGaWVsZFtdIHtcbiAgICByZXR1cm4gKGZzIHx8IFtdKVxuICAgICAgICAubWFwKChmKSA9PiBmaWVsZEZyb21KU09OKGYsIGRpY3Rpb25hcnlGaWVsZHMpKVxuICAgICAgICAuZmlsdGVyKChmKSA9PiBmICE9IG51bGwpIGFzIEZpZWxkW107XG59XG5cbmZ1bmN0aW9uIGZpZWxkTm9kZXNGcm9tSlNPTih4czogYW55W10pOiBGaWVsZE1ldGFkYXRhW10ge1xuICAgIHJldHVybiAoeHMgfHwgW10pLnJlZHVjZTxGaWVsZE1ldGFkYXRhW10+KChmaWVsZE5vZGVzLCBjb2x1bW46IGFueSkgPT4gW1xuICAgICAgICAuLi5maWVsZE5vZGVzLFxuICAgICAgICBuZXcgRmllbGRNZXRhZGF0YShcbiAgICAgICAgICAgIG5ldyBMb25nKGNvbHVtblsnY291bnQnXSwgMCksXG4gICAgICAgICAgICBuZXcgTG9uZyhudWxsQ291bnRGcm9tSlNPTihjb2x1bW5bJ1ZBTElESVRZJ10pLCAwKVxuICAgICAgICApLFxuICAgICAgICAuLi5maWVsZE5vZGVzRnJvbUpTT04oY29sdW1uWydjaGlsZHJlbiddKVxuICAgIF0sIFtdIGFzIEZpZWxkTWV0YWRhdGFbXSk7XG59XG5cbmZ1bmN0aW9uIGJ1ZmZlcnNGcm9tSlNPTih4czogYW55W10sIGJ1ZmZlcnM6IEJ1ZmZlck1ldGFkYXRhW10gPSBbXSk6IEJ1ZmZlck1ldGFkYXRhW10ge1xuICAgIGZvciAobGV0IGkgPSAtMSwgbiA9ICh4cyB8fCBbXSkubGVuZ3RoOyArK2kgPCBuOykge1xuICAgICAgICBjb25zdCBjb2x1bW4gPSB4c1tpXTtcbiAgICAgICAgY29sdW1uWydWQUxJRElUWSddICYmIGJ1ZmZlcnMucHVzaChuZXcgQnVmZmVyTWV0YWRhdGEobmV3IExvbmcoYnVmZmVycy5sZW5ndGgsIDApLCBuZXcgTG9uZyhjb2x1bW5bJ1ZBTElESVRZJ10ubGVuZ3RoLCAwKSkpO1xuICAgICAgICBjb2x1bW5bJ09GRlNFVCddICYmIGJ1ZmZlcnMucHVzaChuZXcgQnVmZmVyTWV0YWRhdGEobmV3IExvbmcoYnVmZmVycy5sZW5ndGgsIDApLCBuZXcgTG9uZyhjb2x1bW5bJ09GRlNFVCddLmxlbmd0aCwgMCkpKTtcbiAgICAgICAgY29sdW1uWydUWVBFJ10gJiYgYnVmZmVycy5wdXNoKG5ldyBCdWZmZXJNZXRhZGF0YShuZXcgTG9uZyhidWZmZXJzLmxlbmd0aCwgMCksIG5ldyBMb25nKGNvbHVtblsnVFlQRSddLmxlbmd0aCwgMCkpKTtcbiAgICAgICAgY29sdW1uWydEQVRBJ10gJiYgYnVmZmVycy5wdXNoKG5ldyBCdWZmZXJNZXRhZGF0YShuZXcgTG9uZyhidWZmZXJzLmxlbmd0aCwgMCksIG5ldyBMb25nKGNvbHVtblsnREFUQSddLmxlbmd0aCwgMCkpKTtcbiAgICAgICAgYnVmZmVycyA9IGJ1ZmZlcnNGcm9tSlNPTihjb2x1bW5bJ2NoaWxkcmVuJ10sIGJ1ZmZlcnMpO1xuICAgIH1cbiAgICByZXR1cm4gYnVmZmVycztcbn1cblxuZnVuY3Rpb24gbnVsbENvdW50RnJvbUpTT04odmFsaWRpdHk6IG51bWJlcltdKSB7XG4gICAgcmV0dXJuICh2YWxpZGl0eSB8fCBbXSkucmVkdWNlKChzdW0sIHZhbCkgPT4gc3VtICsgKyh2YWwgPT09IDApLCAwKTtcbn1cblxuZnVuY3Rpb24gZmllbGRGcm9tSlNPTihmOiBhbnksIGRpY3Rpb25hcnlGaWVsZHM6IE1hcDxudW1iZXIsIEZpZWxkPERpY3Rpb25hcnk+PiB8IG51bGwpIHtcbiAgICBsZXQgbmFtZSA9IGZbJ25hbWUnXTtcbiAgICBsZXQgZmllbGQ6IEZpZWxkIHwgdm9pZDtcbiAgICBsZXQgbnVsbGFibGUgPSBmWydudWxsYWJsZSddO1xuICAgIGxldCBkYXRhVHlwZTogRGF0YVR5cGU8YW55PiB8IG51bGw7XG4gICAgbGV0IGlkOiBudW1iZXIsIGtleXNNZXRhOiBhbnksIGRpY3RNZXRhOiBhbnk7XG4gICAgbGV0IG1ldGFkYXRhID0gY3VzdG9tTWV0YWRhdGEoZlsnY3VzdG9tTWV0YWRhdGEnXSk7XG4gICAgaWYgKCFkaWN0aW9uYXJ5RmllbGRzIHx8ICEoZGljdE1ldGEgPSBmWydkaWN0aW9uYXJ5J10pKSB7XG4gICAgICAgIGlmIChkYXRhVHlwZSA9IHR5cGVGcm9tSlNPTihmWyd0eXBlJ10sIGZpZWxkc0Zyb21KU09OKGZbJ2NoaWxkcmVuJ10sIGRpY3Rpb25hcnlGaWVsZHMpKSkge1xuICAgICAgICAgICAgZmllbGQgPSBuZXcgRmllbGQobmFtZSwgZGF0YVR5cGUsIG51bGxhYmxlLCBtZXRhZGF0YSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGRhdGFUeXBlID0gZGljdGlvbmFyeUZpZWxkcy5oYXMoaWQgPSBkaWN0TWV0YVsnaWQnXSlcbiAgICAgICAgICAgICAgICAgICAgICAgID8gZGljdGlvbmFyeUZpZWxkcy5nZXQoaWQpIS50eXBlLmRpY3Rpb25hcnlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogdHlwZUZyb21KU09OKGZbJ3R5cGUnXSwgZmllbGRzRnJvbUpTT04oZlsnY2hpbGRyZW4nXSwgbnVsbCkpKSB7XG4gICAgICAgIGRhdGFUeXBlID0gbmV3IERpY3Rpb25hcnkoZGF0YVR5cGUsXG4gICAgICAgICAgICAvLyBhIGRpY3Rpb25hcnkgaW5kZXggZGVmYXVsdHMgdG8gc2lnbmVkIDMyIGJpdCBpbnQgaWYgdW5zcGVjaWZpZWRcbiAgICAgICAgICAgIChrZXlzTWV0YSA9IGRpY3RNZXRhWydpbmRleFR5cGUnXSkgPyBpbnRGcm9tSlNPTihrZXlzTWV0YSkhIDogbmV3IEludDMyKCksXG4gICAgICAgICAgICBpZCwgZGljdE1ldGFbJ2lzT3JkZXJlZCddXG4gICAgICAgICk7XG4gICAgICAgIGZpZWxkID0gbmV3IEZpZWxkKG5hbWUsIGRhdGFUeXBlLCBudWxsYWJsZSwgbWV0YWRhdGEpO1xuICAgICAgICBkaWN0aW9uYXJ5RmllbGRzLmhhcyhpZCkgfHwgZGljdGlvbmFyeUZpZWxkcy5zZXQoaWQsIGZpZWxkIGFzIEZpZWxkPERpY3Rpb25hcnk+KTtcbiAgICB9XG4gICAgcmV0dXJuIGZpZWxkIHx8IG51bGw7XG59XG5cbmZ1bmN0aW9uIGN1c3RvbU1ldGFkYXRhKG1ldGFkYXRhPzogYW55KSB7XG4gICAgcmV0dXJuIG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KE9iamVjdC5lbnRyaWVzKG1ldGFkYXRhIHx8IHt9KSk7XG59XG5cbmNvbnN0IG5hbWVzVG9UeXBlTWFwOiB7IFtuOiBzdHJpbmddOiBUeXBlIH0gID0ge1xuICAgICdOT05FJzogVHlwZS5OT05FLFxuICAgICdudWxsJzogVHlwZS5OdWxsLFxuICAgICdpbnQnOiBUeXBlLkludCxcbiAgICAnZmxvYXRpbmdwb2ludCc6IFR5cGUuRmxvYXRpbmdQb2ludCxcbiAgICAnYmluYXJ5JzogVHlwZS5CaW5hcnksXG4gICAgJ2Jvb2wnOiBUeXBlLkJvb2wsXG4gICAgJ3V0ZjgnOiBUeXBlLlV0ZjgsXG4gICAgJ2RlY2ltYWwnOiBUeXBlLkRlY2ltYWwsXG4gICAgJ2RhdGUnOiBUeXBlLkRhdGUsXG4gICAgJ3RpbWUnOiBUeXBlLlRpbWUsXG4gICAgJ3RpbWVzdGFtcCc6IFR5cGUuVGltZXN0YW1wLFxuICAgICdpbnRlcnZhbCc6IFR5cGUuSW50ZXJ2YWwsXG4gICAgJ2xpc3QnOiBUeXBlLkxpc3QsXG4gICAgJ3N0cnVjdCc6IFR5cGUuU3RydWN0XyxcbiAgICAndW5pb24nOiBUeXBlLlVuaW9uLFxuICAgICdmaXhlZHNpemViaW5hcnknOiBUeXBlLkZpeGVkU2l6ZUJpbmFyeSxcbiAgICAnZml4ZWRzaXplbGlzdCc6IFR5cGUuRml4ZWRTaXplTGlzdCxcbiAgICAnbWFwJzogVHlwZS5NYXAsXG59O1xuXG5mdW5jdGlvbiB0eXBlRnJvbUpTT04odDogYW55LCBjaGlsZHJlbj86IEZpZWxkW10pIHtcbiAgICBzd2l0Y2ggKG5hbWVzVG9UeXBlTWFwW3RbJ25hbWUnXV0pIHtcbiAgICAgICAgY2FzZSBUeXBlLk5PTkU6IHJldHVybiBudWxsO1xuICAgICAgICBjYXNlIFR5cGUuTnVsbDogcmV0dXJuIG51bGxGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkludDogcmV0dXJuIGludEZyb21KU09OKHQpO1xuICAgICAgICBjYXNlIFR5cGUuRmxvYXRpbmdQb2ludDogcmV0dXJuIGZsb2F0aW5nUG9pbnRGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkJpbmFyeTogcmV0dXJuIGJpbmFyeUZyb21KU09OKHQpO1xuICAgICAgICBjYXNlIFR5cGUuVXRmODogcmV0dXJuIHV0ZjhGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkJvb2w6IHJldHVybiBib29sRnJvbUpTT04odCk7XG4gICAgICAgIGNhc2UgVHlwZS5EZWNpbWFsOiByZXR1cm4gZGVjaW1hbEZyb21KU09OKHQpO1xuICAgICAgICBjYXNlIFR5cGUuRGF0ZTogcmV0dXJuIGRhdGVGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLlRpbWU6IHJldHVybiB0aW1lRnJvbUpTT04odCk7XG4gICAgICAgIGNhc2UgVHlwZS5UaW1lc3RhbXA6IHJldHVybiB0aW1lc3RhbXBGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkludGVydmFsOiByZXR1cm4gaW50ZXJ2YWxGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkxpc3Q6IHJldHVybiBsaXN0RnJvbUpTT04odCwgY2hpbGRyZW4gfHwgW10pO1xuICAgICAgICBjYXNlIFR5cGUuU3RydWN0XzogcmV0dXJuIHN0cnVjdEZyb21KU09OKHQsIGNoaWxkcmVuIHx8IFtdKTtcbiAgICAgICAgY2FzZSBUeXBlLlVuaW9uOiByZXR1cm4gdW5pb25Gcm9tSlNPTih0LCBjaGlsZHJlbiB8fCBbXSk7XG4gICAgICAgIGNhc2UgVHlwZS5GaXhlZFNpemVCaW5hcnk6IHJldHVybiBmaXhlZFNpemVCaW5hcnlGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkZpeGVkU2l6ZUxpc3Q6IHJldHVybiBmaXhlZFNpemVMaXN0RnJvbUpTT04odCwgY2hpbGRyZW4gfHwgW10pO1xuICAgICAgICBjYXNlIFR5cGUuTWFwOiByZXR1cm4gbWFwRnJvbUpTT04odCwgY2hpbGRyZW4gfHwgW10pO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVucmVjb2duaXplZCB0eXBlICR7dFsnbmFtZSddfWApO1xufVxuXG5mdW5jdGlvbiBudWxsRnJvbUpTT04gICAgICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IE51bGwoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuZnVuY3Rpb24gaW50RnJvbUpTT04gICAgICAgICAgICAoX3R5cGU6IGFueSkgICAgICAgICAgICAgICAgICAgIHsgc3dpdGNoIChfdHlwZVsnYml0V2lkdGgnXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIDg6IHJldHVybiBfdHlwZVsnaXNTaWduZWQnXSA/IG5ldyAgSW50OCgpIDogbmV3ICBVaW50OCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTY6IHJldHVybiBfdHlwZVsnaXNTaWduZWQnXSA/IG5ldyBJbnQxNigpIDogbmV3IFVpbnQxNigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzI6IHJldHVybiBfdHlwZVsnaXNTaWduZWQnXSA/IG5ldyBJbnQzMigpIDogbmV3IFVpbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNjQ6IHJldHVybiBfdHlwZVsnaXNTaWduZWQnXSA/IG5ldyBJbnQ2NCgpIDogbmV3IFVpbnQ2NCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIGZsb2F0aW5nUG9pbnRGcm9tSlNPTiAgKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHN3aXRjaCAoUHJlY2lzaW9uW190eXBlWydwcmVjaXNpb24nXV0gYXMgYW55KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBQcmVjaXNpb24uSEFMRjogcmV0dXJuIG5ldyBGbG9hdDE2KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBQcmVjaXNpb24uU0lOR0xFOiByZXR1cm4gbmV3IEZsb2F0MzIoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFByZWNpc2lvbi5ET1VCTEU6IHJldHVybiBuZXcgRmxvYXQ2NCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIGJpbmFyeUZyb21KU09OICAgICAgICAgKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBuZXcgQmluYXJ5KCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiB1dGY4RnJvbUpTT04gICAgICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IFV0ZjgoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuZnVuY3Rpb24gYm9vbEZyb21KU09OICAgICAgICAgICAoX3R5cGU6IGFueSkgICAgICAgICAgICAgICAgICAgIHsgcmV0dXJuIG5ldyBCb29sKCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIGRlY2ltYWxGcm9tSlNPTiAgICAgICAgKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBuZXcgRGVjaW1hbChfdHlwZVsnc2NhbGUnXSwgX3R5cGVbJ3ByZWNpc2lvbiddKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBkYXRlRnJvbUpTT04gICAgICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IERhdGVfKERhdGVVbml0W190eXBlWyd1bml0J11dIGFzIGFueSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuZnVuY3Rpb24gdGltZUZyb21KU09OICAgICAgICAgICAoX3R5cGU6IGFueSkgICAgICAgICAgICAgICAgICAgIHsgcmV0dXJuIG5ldyBUaW1lKFRpbWVVbml0W190eXBlWyd1bml0J11dIGFzIGFueSwgX3R5cGVbJ2JpdFdpZHRoJ10gYXMgVGltZUJpdFdpZHRoKTsgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIHRpbWVzdGFtcEZyb21KU09OICAgICAgKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBuZXcgVGltZXN0YW1wKFRpbWVVbml0W190eXBlWyd1bml0J11dIGFzIGFueSwgX3R5cGVbJ3RpbWV6b25lJ10pOyAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBpbnRlcnZhbEZyb21KU09OICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IEludGVydmFsKEludGVydmFsVW5pdFtfdHlwZVsndW5pdCddXSBhcyBhbnkpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuZnVuY3Rpb24gbGlzdEZyb21KU09OICAgICAgICAgICAoX3R5cGU6IGFueSwgY2hpbGRyZW46IEZpZWxkW10pIHsgcmV0dXJuIG5ldyBMaXN0KGNoaWxkcmVuKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIHN0cnVjdEZyb21KU09OICAgICAgICAgKF90eXBlOiBhbnksIGNoaWxkcmVuOiBGaWVsZFtdKSB7IHJldHVybiBuZXcgU3RydWN0KGNoaWxkcmVuKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiB1bmlvbkZyb21KU09OICAgICAgICAgIChfdHlwZTogYW55LCBjaGlsZHJlbjogRmllbGRbXSkgeyByZXR1cm4gbmV3IFVuaW9uKFVuaW9uTW9kZVtfdHlwZVsnbW9kZSddXSBhcyBhbnksIChfdHlwZVsndHlwZUlkcyddIHx8IFtdKSBhcyBUeXBlW10sIGNoaWxkcmVuKTsgfVxuZnVuY3Rpb24gZml4ZWRTaXplQmluYXJ5RnJvbUpTT04oX3R5cGU6IGFueSkgICAgICAgICAgICAgICAgICAgIHsgcmV0dXJuIG5ldyBGaXhlZFNpemVCaW5hcnkoX3R5cGVbJ2J5dGVXaWR0aCddKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIGZpeGVkU2l6ZUxpc3RGcm9tSlNPTiAgKF90eXBlOiBhbnksIGNoaWxkcmVuOiBGaWVsZFtdKSB7IHJldHVybiBuZXcgRml4ZWRTaXplTGlzdChfdHlwZVsnbGlzdFNpemUnXSwgY2hpbGRyZW4pOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBtYXBGcm9tSlNPTiAgICAgICAgICAgIChfdHlwZTogYW55LCBjaGlsZHJlbjogRmllbGRbXSkgeyByZXR1cm4gbmV3IE1hcF8oX3R5cGVbJ2tleXNTb3J0ZWQnXSwgY2hpbGRyZW4pOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuIl19
