// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import { flatbuffers } from 'flatbuffers';
import { TypeDataLoader } from './vector';
import { packBools } from '../../util/bit';
import * as IntUtil from '../../util/int';
import { TextEncoder } from 'text-encoding-utf-8';
import { RecordBatchMetadata, DictionaryBatch, BufferMetadata, FieldMetadata } from '../metadata';
import { Schema, Field, DataType, Dictionary, Null, Binary, Bool, Utf8, Decimal, Date_, Time, Timestamp, Interval, List, Struct, Union, FixedSizeBinary, FixedSizeList, Map_, } from '../../type';
import { Int8, Uint8, Int16, Uint16, Int32, Uint32, Int64, Uint64, Float16, Float64, Float32, } from '../../type';
var Long = flatbuffers.Long;
export function* readJSON(json) {
    const schema = schemaFromJSON(json['schema']);
    const dictionaries = new Map();
    for (const batch of (json['dictionaries'] || [])) {
        const message = dictionaryBatchFromJSON(batch);
        yield {
            schema, message,
            loader: new JSONDataLoader(flattenDataSources(batch['data']['columns']), arrayIterator(message.nodes), arrayIterator(message.buffers), dictionaries)
        };
    }
    for (const batch of (json['batches'] || [])) {
        const message = recordBatchFromJSON(batch);
        yield {
            schema, message,
            loader: new JSONDataLoader(flattenDataSources(batch['columns']), arrayIterator(message.nodes), arrayIterator(message.buffers), dictionaries)
        };
    }
}
function* arrayIterator(arr) { yield* arr; }
function flattenDataSources(xs) {
    return (xs || []).reduce((buffers, column) => [
        ...buffers,
        ...(column['VALIDITY'] && [column['VALIDITY']] || []),
        ...(column['OFFSET'] && [column['OFFSET']] || []),
        ...(column['DATA'] && [column['DATA']] || []),
        ...flattenDataSources(column['children'])
    ], []);
}
const utf8Encoder = new TextEncoder('utf-8');
export class JSONDataLoader extends TypeDataLoader {
    constructor(sources, nodes, buffers, dictionaries) {
        super(nodes, buffers, dictionaries);
        this.sources = sources;
    }
    readNullBitmap(_type, nullCount, { offset } = this.getBufferMetadata()) {
        return nullCount <= 0 ? new Uint8Array(0) : packBools(this.sources[offset]);
    }
    readOffsets(_type, { offset } = this.getBufferMetadata()) {
        return new Int32Array(this.sources[offset]);
    }
    readTypeIds(_type, { offset } = this.getBufferMetadata()) {
        return new Int8Array(this.sources[offset]);
    }
    readData(type, { offset } = this.getBufferMetadata()) {
        const { sources } = this;
        if (DataType.isTimestamp(type) === true) {
            return new Uint8Array(int64DataFromJSON(sources[offset]));
        }
        else if ((DataType.isInt(type) || DataType.isTime(type)) && type.bitWidth === 64) {
            return new Uint8Array(int64DataFromJSON(sources[offset]));
        }
        else if (DataType.isDate(type) && type.unit === DateUnit.MILLISECOND) {
            return new Uint8Array(int64DataFromJSON(sources[offset]));
        }
        else if (DataType.isDecimal(type) === true) {
            return new Uint8Array(decimalDataFromJSON(sources[offset]));
        }
        else if (DataType.isBinary(type) === true) {
            return new Uint8Array(binaryDataFromJSON(sources[offset]));
        }
        else if (DataType.isBool(type) === true) {
            return new Uint8Array(packBools(sources[offset]).buffer);
        }
        else if (DataType.isUtf8(type) === true) {
            return utf8Encoder.encode(sources[offset].join(''));
        }
        else {
            return toTypedArray(type.ArrayType, sources[offset].map((x) => +x));
        }
    }
}
function int64DataFromJSON(values) {
    const data = new Uint32Array(values.length * 2);
    for (let i = -1, n = values.length; ++i < n;) {
        // Force all values (even numbers) to be parsed as strings since
        // pulling out high and low bits seems to lose precision sometimes
        // For example:
        //     > -4613034156400212000 >>> 0
        //     721782784
        // The correct lower 32-bits are 721782752
        IntUtil.Int64.fromString(values[i].toString(), new Uint32Array(data.buffer, data.byteOffset + 2 * i * 4, 2));
    }
    return data.buffer;
}
function decimalDataFromJSON(values) {
    const data = new Uint32Array(values.length * 4);
    for (let i = -1, n = values.length; ++i < n;) {
        IntUtil.Int128.fromString(values[i], new Uint32Array(data.buffer, data.byteOffset + 4 * 4 * i, 4));
    }
    return data.buffer;
}
function binaryDataFromJSON(values) {
    // "DATA": ["49BC7D5B6C47D2","3F5FB6D9322026"]
    // There are definitely more efficient ways to do this... but it gets the
    // job done.
    const joined = values.join('');
    const data = new Uint8Array(joined.length / 2);
    for (let i = 0; i < joined.length; i += 2) {
        data[i >> 1] = parseInt(joined.substr(i, 2), 16);
    }
    return data.buffer;
}
import * as Schema_ from '../../fb/Schema';
var Type = Schema_.org.apache.arrow.flatbuf.Type;
var DateUnit = Schema_.org.apache.arrow.flatbuf.DateUnit;
var TimeUnit = Schema_.org.apache.arrow.flatbuf.TimeUnit;
var Precision = Schema_.org.apache.arrow.flatbuf.Precision;
var IntervalUnit = Schema_.org.apache.arrow.flatbuf.IntervalUnit;
var MetadataVersion = Schema_.org.apache.arrow.flatbuf.MetadataVersion;
import { toTypedArray } from '../../data';
function schemaFromJSON(s) {
    const dictionaryFields = new Map();
    return new Schema(fieldsFromJSON(s['fields'], dictionaryFields), customMetadata(s['customMetadata']), MetadataVersion.V4, dictionaryFields);
}
function recordBatchFromJSON(b) {
    return new RecordBatchMetadata(MetadataVersion.V4, b['count'], fieldNodesFromJSON(b['columns']), buffersFromJSON(b['columns']));
}
function dictionaryBatchFromJSON(b) {
    return new DictionaryBatch(MetadataVersion.V4, recordBatchFromJSON(b['data']), b['id'], b['isDelta']);
}
function fieldsFromJSON(fs, dictionaryFields) {
    return (fs || [])
        .map((f) => fieldFromJSON(f, dictionaryFields))
        .filter((f) => f != null);
}
function fieldNodesFromJSON(xs) {
    return (xs || []).reduce((fieldNodes, column) => [
        ...fieldNodes,
        new FieldMetadata(new Long(column['count'], 0), new Long(nullCountFromJSON(column['VALIDITY']), 0)),
        ...fieldNodesFromJSON(column['children'])
    ], []);
}
function buffersFromJSON(xs, buffers = []) {
    for (let i = -1, n = (xs || []).length; ++i < n;) {
        const column = xs[i];
        column['VALIDITY'] && buffers.push(new BufferMetadata(new Long(buffers.length, 0), new Long(column['VALIDITY'].length, 0)));
        column['OFFSET'] && buffers.push(new BufferMetadata(new Long(buffers.length, 0), new Long(column['OFFSET'].length, 0)));
        column['DATA'] && buffers.push(new BufferMetadata(new Long(buffers.length, 0), new Long(column['DATA'].length, 0)));
        buffers = buffersFromJSON(column['children'], buffers);
    }
    return buffers;
}
function nullCountFromJSON(validity) {
    return (validity || []).reduce((sum, val) => sum + +(val === 0), 0);
}
function fieldFromJSON(f, dictionaryFields) {
    let name = f['name'];
    let field;
    let nullable = f['nullable'];
    let dataType;
    let id, keysMeta, dictMeta;
    let metadata = customMetadata(f['customMetadata']);
    if (!dictionaryFields || !(dictMeta = f['dictionary'])) {
        if (dataType = typeFromJSON(f['type'], fieldsFromJSON(f['children'], dictionaryFields))) {
            field = new Field(name, dataType, nullable, metadata);
        }
    }
    else if (dataType = dictionaryFields.has(id = dictMeta['id'])
        ? dictionaryFields.get(id).type.dictionary
        : typeFromJSON(f['type'], fieldsFromJSON(f['children'], null))) {
        dataType = new Dictionary(dataType, 
        // a dictionary index defaults to signed 32 bit int if unspecified
        (keysMeta = dictMeta['indexType']) ? intFromJSON(keysMeta) : new Int32(), id, dictMeta['isOrdered']);
        field = new Field(name, dataType, nullable, metadata);
        dictionaryFields.has(id) || dictionaryFields.set(id, field);
    }
    return field || null;
}
function customMetadata(metadata) {
    return new Map(Object.entries(metadata || {}));
}
const namesToTypeMap = {
    'NONE': Type.NONE,
    'null': Type.Null,
    'int': Type.Int,
    'floatingpoint': Type.FloatingPoint,
    'binary': Type.Binary,
    'bool': Type.Bool,
    'utf8': Type.Utf8,
    'decimal': Type.Decimal,
    'date': Type.Date,
    'time': Type.Time,
    'timestamp': Type.Timestamp,
    'interval': Type.Interval,
    'list': Type.List,
    'struct': Type.Struct_,
    'union': Type.Union,
    'fixedsizebinary': Type.FixedSizeBinary,
    'fixedsizelist': Type.FixedSizeList,
    'map': Type.Map,
};
function typeFromJSON(t, children) {
    switch (namesToTypeMap[t['name']]) {
        case Type.NONE: return null;
        case Type.Null: return nullFromJSON(t);
        case Type.Int: return intFromJSON(t);
        case Type.FloatingPoint: return floatingPointFromJSON(t);
        case Type.Binary: return binaryFromJSON(t);
        case Type.Utf8: return utf8FromJSON(t);
        case Type.Bool: return boolFromJSON(t);
        case Type.Decimal: return decimalFromJSON(t);
        case Type.Date: return dateFromJSON(t);
        case Type.Time: return timeFromJSON(t);
        case Type.Timestamp: return timestampFromJSON(t);
        case Type.Interval: return intervalFromJSON(t);
        case Type.List: return listFromJSON(t, children || []);
        case Type.Struct_: return structFromJSON(t, children || []);
        case Type.Union: return unionFromJSON(t, children || []);
        case Type.FixedSizeBinary: return fixedSizeBinaryFromJSON(t);
        case Type.FixedSizeList: return fixedSizeListFromJSON(t, children || []);
        case Type.Map: return mapFromJSON(t, children || []);
    }
    throw new Error(`Unrecognized type ${t['name']}`);
}
function nullFromJSON(_type) { return new Null(); }
function intFromJSON(_type) {
    switch (_type['bitWidth']) {
        case 8: return _type['isSigned'] ? new Int8() : new Uint8();
        case 16: return _type['isSigned'] ? new Int16() : new Uint16();
        case 32: return _type['isSigned'] ? new Int32() : new Uint32();
        case 64: return _type['isSigned'] ? new Int64() : new Uint64();
    }
    return null;
}
function floatingPointFromJSON(_type) {
    switch (Precision[_type['precision']]) {
        case Precision.HALF: return new Float16();
        case Precision.SINGLE: return new Float32();
        case Precision.DOUBLE: return new Float64();
    }
    return null;
}
function binaryFromJSON(_type) { return new Binary(); }
function utf8FromJSON(_type) { return new Utf8(); }
function boolFromJSON(_type) { return new Bool(); }
function decimalFromJSON(_type) { return new Decimal(_type['scale'], _type['precision']); }
function dateFromJSON(_type) { return new Date_(DateUnit[_type['unit']]); }
function timeFromJSON(_type) { return new Time(TimeUnit[_type['unit']], _type['bitWidth']); }
function timestampFromJSON(_type) { return new Timestamp(TimeUnit[_type['unit']], _type['timezone']); }
function intervalFromJSON(_type) { return new Interval(IntervalUnit[_type['unit']]); }
function listFromJSON(_type, children) { return new List(children); }
function structFromJSON(_type, children) { return new Struct(children); }
function unionFromJSON(_type, children) { return new Union(_type['mode'], (_type['typeIdsArray'] || []), children); }
function fixedSizeBinaryFromJSON(_type) { return new FixedSizeBinary(_type['byteWidth']); }
function fixedSizeListFromJSON(_type, children) { return new FixedSizeList(_type['listSize'], children); }
function mapFromJSON(_type, children) { return new Map_(_type['keysSorted'], children); }

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNyRSxNQUFNLENBQUMsSUFBSSxVQUFVLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBYSxDQUFDLENBQUMsQ0FBQztRQUMxRSxDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztZQUMzQyxNQUFNLENBQUMsSUFBSSxVQUFVLENBQUMsbUJBQW1CLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBYSxDQUFDLENBQUMsQ0FBQztRQUM1RSxDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztZQUMxQyxNQUFNLENBQUMsSUFBSSxVQUFVLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBYSxDQUFDLENBQUMsQ0FBQztRQUMzRSxDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztZQUN4QyxNQUFNLENBQUMsSUFBSSxVQUFVLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQWEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3pFLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFFLE9BQU8sQ0FBQyxNQUFNLENBQWMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN0RSxD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YyxDQUFDLElBQUksRUFBRSxDQUFXLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3ZKLGlDQUFpQyxLQUFVLElBQXVCLE1BQU0sQ0FBQyxJQUFJLGVBQWUsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFxQyxDQUFDO0FBQ3ZKLCtCQUFpQyxLQUFVLEVBQUUsUUFBaUIsSUFBSSxNQUFNLENBQUMsSUFBSSxhQUFhLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQThCLENBQUM7QUFDdkoscUJBQWlDLEtBQVUsRUFBRSxRQUFpQixJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBcUMsQ0FBQyIsImZpbGUiOiJpcGMvcmVhZGVyL2pzb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4vLyBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbi8vIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4vLyByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4vLyB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4vLyBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Vcbi8vIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbi8vIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4vLyBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuLy8gS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4vLyBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4vLyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgVmVjdG9yIH0gZnJvbSAnLi4vLi4vdmVjdG9yJztcbmltcG9ydCB7IGZsYXRidWZmZXJzIH0gZnJvbSAnZmxhdGJ1ZmZlcnMnO1xuaW1wb3J0IHsgVHlwZURhdGFMb2FkZXIgfSBmcm9tICcuL3ZlY3Rvcic7XG5pbXBvcnQgeyBwYWNrQm9vbHMgfSBmcm9tICcuLi8uLi91dGlsL2JpdCc7XG5pbXBvcnQgKiBhcyBJbnRVdGlsIGZyb20gJy4uLy4uL3V0aWwvaW50JztcbmltcG9ydCB7IFRleHRFbmNvZGVyIH0gZnJvbSAndGV4dC1lbmNvZGluZy11dGYtOCc7XG5pbXBvcnQgeyBSZWNvcmRCYXRjaE1ldGFkYXRhLCBEaWN0aW9uYXJ5QmF0Y2gsIEJ1ZmZlck1ldGFkYXRhLCBGaWVsZE1ldGFkYXRhIH0gZnJvbSAnLi4vbWV0YWRhdGEnO1xuaW1wb3J0IHtcbiAgICBTY2hlbWEsIEZpZWxkLFxuICAgIERhdGFUeXBlLCBEaWN0aW9uYXJ5LFxuICAgIE51bGwsIFRpbWVCaXRXaWR0aCxcbiAgICBCaW5hcnksIEJvb2wsIFV0ZjgsIERlY2ltYWwsXG4gICAgRGF0ZV8sIFRpbWUsIFRpbWVzdGFtcCwgSW50ZXJ2YWwsXG4gICAgTGlzdCwgU3RydWN0LCBVbmlvbiwgRml4ZWRTaXplQmluYXJ5LCBGaXhlZFNpemVMaXN0LCBNYXBfLFxufSBmcm9tICcuLi8uLi90eXBlJztcblxuaW1wb3J0IHtcbiAgICBJbnQ4LCAgVWludDgsXG4gICAgSW50MTYsIFVpbnQxNixcbiAgICBJbnQzMiwgVWludDMyLFxuICAgIEludDY0LCBVaW50NjQsXG4gICAgRmxvYXQxNiwgRmxvYXQ2NCwgRmxvYXQzMixcbn0gZnJvbSAnLi4vLi4vdHlwZSc7XG5cbmltcG9ydCBMb25nID0gZmxhdGJ1ZmZlcnMuTG9uZztcblxuZXhwb3J0IGZ1bmN0aW9uKiByZWFkSlNPTihqc29uOiBhbnkpIHtcbiAgICBjb25zdCBzY2hlbWEgPSBzY2hlbWFGcm9tSlNPTihqc29uWydzY2hlbWEnXSk7XG4gICAgY29uc3QgZGljdGlvbmFyaWVzID0gbmV3IE1hcDxudW1iZXIsIFZlY3Rvcj4oKTtcbiAgICBmb3IgKGNvbnN0IGJhdGNoIG9mIChqc29uWydkaWN0aW9uYXJpZXMnXSB8fCBbXSkpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGRpY3Rpb25hcnlCYXRjaEZyb21KU09OKGJhdGNoKTtcbiAgICAgICAgeWllbGQge1xuICAgICAgICAgICAgc2NoZW1hLCBtZXNzYWdlLFxuICAgICAgICAgICAgbG9hZGVyOiBuZXcgSlNPTkRhdGFMb2FkZXIoXG4gICAgICAgICAgICAgICAgZmxhdHRlbkRhdGFTb3VyY2VzKGJhdGNoWydkYXRhJ11bJ2NvbHVtbnMnXSksXG4gICAgICAgICAgICAgICAgYXJyYXlJdGVyYXRvcihtZXNzYWdlLm5vZGVzKSxcbiAgICAgICAgICAgICAgICBhcnJheUl0ZXJhdG9yKG1lc3NhZ2UuYnVmZmVycyksXG4gICAgICAgICAgICAgICAgZGljdGlvbmFyaWVzXG4gICAgICAgICAgICApXG4gICAgICAgIH07XG4gICAgfVxuICAgIGZvciAoY29uc3QgYmF0Y2ggb2YgKGpzb25bJ2JhdGNoZXMnXSB8fCBbXSkpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IHJlY29yZEJhdGNoRnJvbUpTT04oYmF0Y2gpO1xuICAgICAgICB5aWVsZCB7XG4gICAgICAgICAgICBzY2hlbWEsIG1lc3NhZ2UsXG4gICAgICAgICAgICBsb2FkZXI6IG5ldyBKU09ORGF0YUxvYWRlcihcbiAgICAgICAgICAgICAgICBmbGF0dGVuRGF0YVNvdXJjZXMoYmF0Y2hbJ2NvbHVtbnMnXSksXG4gICAgICAgICAgICAgICAgYXJyYXlJdGVyYXRvcihtZXNzYWdlLm5vZGVzKSxcbiAgICAgICAgICAgICAgICBhcnJheUl0ZXJhdG9yKG1lc3NhZ2UuYnVmZmVycyksXG4gICAgICAgICAgICAgICAgZGljdGlvbmFyaWVzXG4gICAgICAgICAgICApXG4gICAgICAgIH07XG4gICAgfVxufVxuXG5mdW5jdGlvbiogYXJyYXlJdGVyYXRvcihhcnI6IEFycmF5PGFueT4pIHsgeWllbGQqIGFycjsgfVxuZnVuY3Rpb24gZmxhdHRlbkRhdGFTb3VyY2VzKHhzOiBhbnlbXSk6IGFueVtdW10ge1xuICAgIHJldHVybiAoeHMgfHwgW10pLnJlZHVjZTxhbnlbXVtdPigoYnVmZmVycywgY29sdW1uOiBhbnkpID0+IFtcbiAgICAgICAgLi4uYnVmZmVycyxcbiAgICAgICAgLi4uKGNvbHVtblsnVkFMSURJVFknXSAmJiBbY29sdW1uWydWQUxJRElUWSddXSB8fCBbXSksXG4gICAgICAgIC4uLihjb2x1bW5bJ09GRlNFVCddICYmIFtjb2x1bW5bJ09GRlNFVCddXSB8fCBbXSksXG4gICAgICAgIC4uLihjb2x1bW5bJ0RBVEEnXSAmJiBbY29sdW1uWydEQVRBJ11dIHx8IFtdKSxcbiAgICAgICAgLi4uZmxhdHRlbkRhdGFTb3VyY2VzKGNvbHVtblsnY2hpbGRyZW4nXSlcbiAgICBdLCBbXSBhcyBhbnlbXVtdKTtcbn1cblxuY29uc3QgdXRmOEVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoJ3V0Zi04Jyk7XG5cbmV4cG9ydCBjbGFzcyBKU09ORGF0YUxvYWRlciBleHRlbmRzIFR5cGVEYXRhTG9hZGVyIHtcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHNvdXJjZXM6IGFueVtdW10sIG5vZGVzOiBJdGVyYXRvcjxGaWVsZE1ldGFkYXRhPiwgYnVmZmVyczogSXRlcmF0b3I8QnVmZmVyTWV0YWRhdGE+LCBkaWN0aW9uYXJpZXM6IE1hcDxudW1iZXIsIFZlY3Rvcj4pIHtcbiAgICAgICAgc3VwZXIobm9kZXMsIGJ1ZmZlcnMsIGRpY3Rpb25hcmllcyk7XG4gICAgfVxuICAgIHByb3RlY3RlZCByZWFkTnVsbEJpdG1hcDxUIGV4dGVuZHMgRGF0YVR5cGU+KF90eXBlOiBULCBudWxsQ291bnQ6IG51bWJlciwgeyBvZmZzZXQgfSA9IHRoaXMuZ2V0QnVmZmVyTWV0YWRhdGEoKSkge1xuICAgICAgICByZXR1cm4gbnVsbENvdW50IDw9IDAgPyBuZXcgVWludDhBcnJheSgwKSA6IHBhY2tCb29scyh0aGlzLnNvdXJjZXNbb2Zmc2V0XSk7XG4gICAgfVxuICAgIHByb3RlY3RlZCByZWFkT2Zmc2V0czxUIGV4dGVuZHMgRGF0YVR5cGU+KF90eXBlOiBULCB7IG9mZnNldCB9OiBCdWZmZXJNZXRhZGF0YSA9IHRoaXMuZ2V0QnVmZmVyTWV0YWRhdGEoKSkge1xuICAgICAgICByZXR1cm4gbmV3IEludDMyQXJyYXkodGhpcy5zb3VyY2VzW29mZnNldF0pO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgcmVhZFR5cGVJZHM8VCBleHRlbmRzIERhdGFUeXBlPihfdHlwZTogVCwgeyBvZmZzZXQgfTogQnVmZmVyTWV0YWRhdGEgPSB0aGlzLmdldEJ1ZmZlck1ldGFkYXRhKCkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJbnQ4QXJyYXkodGhpcy5zb3VyY2VzW29mZnNldF0pO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgcmVhZERhdGE8VCBleHRlbmRzIERhdGFUeXBlPih0eXBlOiBULCB7IG9mZnNldCB9OiBCdWZmZXJNZXRhZGF0YSA9IHRoaXMuZ2V0QnVmZmVyTWV0YWRhdGEoKSkge1xuICAgICAgICBjb25zdCB7IHNvdXJjZXMgfSA9IHRoaXM7XG4gICAgICAgIGlmIChEYXRhVHlwZS5pc1RpbWVzdGFtcCh0eXBlKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGludDY0RGF0YUZyb21KU09OKHNvdXJjZXNbb2Zmc2V0XSBhcyBzdHJpbmdbXSkpO1xuICAgICAgICB9IGVsc2UgaWYgKChEYXRhVHlwZS5pc0ludCh0eXBlKSB8fCBEYXRhVHlwZS5pc1RpbWUodHlwZSkpICYmIHR5cGUuYml0V2lkdGggPT09IDY0KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaW50NjREYXRhRnJvbUpTT04oc291cmNlc1tvZmZzZXRdIGFzIHN0cmluZ1tdKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoRGF0YVR5cGUuaXNEYXRlKHR5cGUpICYmIHR5cGUudW5pdCA9PT0gRGF0ZVVuaXQuTUlMTElTRUNPTkQpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShpbnQ2NERhdGFGcm9tSlNPTihzb3VyY2VzW29mZnNldF0gYXMgc3RyaW5nW10pKTtcbiAgICAgICAgfSBlbHNlIGlmIChEYXRhVHlwZS5pc0RlY2ltYWwodHlwZSkgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShkZWNpbWFsRGF0YUZyb21KU09OKHNvdXJjZXNbb2Zmc2V0XSBhcyBzdHJpbmdbXSkpO1xuICAgICAgICB9IGVsc2UgaWYgKERhdGFUeXBlLmlzQmluYXJ5KHR5cGUpID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYmluYXJ5RGF0YUZyb21KU09OKHNvdXJjZXNbb2Zmc2V0XSBhcyBzdHJpbmdbXSkpO1xuICAgICAgICB9IGVsc2UgaWYgKERhdGFUeXBlLmlzQm9vbCh0eXBlKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KHBhY2tCb29scyhzb3VyY2VzW29mZnNldF0gYXMgbnVtYmVyW10pLmJ1ZmZlcik7XG4gICAgICAgIH0gZWxzZSBpZiAoRGF0YVR5cGUuaXNVdGY4KHR5cGUpID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gdXRmOEVuY29kZXIuZW5jb2RlKChzb3VyY2VzW29mZnNldF0gYXMgc3RyaW5nW10pLmpvaW4oJycpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0b1R5cGVkQXJyYXkodHlwZS5BcnJheVR5cGUsIHNvdXJjZXNbb2Zmc2V0XS5tYXAoKHgpID0+ICt4KSkgYXMgYW55O1xuICAgICAgICB9XG4gICAgfVxufVxuXG5mdW5jdGlvbiBpbnQ2NERhdGFGcm9tSlNPTih2YWx1ZXM6IHN0cmluZ1tdKSB7XG4gICAgY29uc3QgZGF0YSA9IG5ldyBVaW50MzJBcnJheSh2YWx1ZXMubGVuZ3RoICogMik7XG4gICAgZm9yIChsZXQgaSA9IC0xLCBuID0gdmFsdWVzLmxlbmd0aDsgKytpIDwgbjspIHtcbiAgICAgICAgLy8gRm9yY2UgYWxsIHZhbHVlcyAoZXZlbiBudW1iZXJzKSB0byBiZSBwYXJzZWQgYXMgc3RyaW5ncyBzaW5jZVxuICAgICAgICAvLyBwdWxsaW5nIG91dCBoaWdoIGFuZCBsb3cgYml0cyBzZWVtcyB0byBsb3NlIHByZWNpc2lvbiBzb21ldGltZXNcbiAgICAgICAgLy8gRm9yIGV4YW1wbGU6XG4gICAgICAgIC8vICAgICA+IC00NjEzMDM0MTU2NDAwMjEyMDAwID4+PiAwXG4gICAgICAgIC8vICAgICA3MjE3ODI3ODRcbiAgICAgICAgLy8gVGhlIGNvcnJlY3QgbG93ZXIgMzItYml0cyBhcmUgNzIxNzgyNzUyXG4gICAgICAgIEludFV0aWwuSW50NjQuZnJvbVN0cmluZyh2YWx1ZXNbaV0udG9TdHJpbmcoKSwgbmV3IFVpbnQzMkFycmF5KGRhdGEuYnVmZmVyLCBkYXRhLmJ5dGVPZmZzZXQgKyAyICogaSAqIDQsIDIpKTtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGEuYnVmZmVyO1xufVxuXG5mdW5jdGlvbiBkZWNpbWFsRGF0YUZyb21KU09OKHZhbHVlczogc3RyaW5nW10pIHtcbiAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQzMkFycmF5KHZhbHVlcy5sZW5ndGggKiA0KTtcbiAgICBmb3IgKGxldCBpID0gLTEsIG4gPSB2YWx1ZXMubGVuZ3RoOyArK2kgPCBuOykge1xuICAgICAgICBJbnRVdGlsLkludDEyOC5mcm9tU3RyaW5nKHZhbHVlc1tpXSwgbmV3IFVpbnQzMkFycmF5KGRhdGEuYnVmZmVyLCBkYXRhLmJ5dGVPZmZzZXQgKyA0ICogNCAqIGksIDQpKTtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGEuYnVmZmVyO1xufVxuXG5mdW5jdGlvbiBiaW5hcnlEYXRhRnJvbUpTT04odmFsdWVzOiBzdHJpbmdbXSkge1xuICAgIC8vIFwiREFUQVwiOiBbXCI0OUJDN0Q1QjZDNDdEMlwiLFwiM0Y1RkI2RDkzMjIwMjZcIl1cbiAgICAvLyBUaGVyZSBhcmUgZGVmaW5pdGVseSBtb3JlIGVmZmljaWVudCB3YXlzIHRvIGRvIHRoaXMuLi4gYnV0IGl0IGdldHMgdGhlXG4gICAgLy8gam9iIGRvbmUuXG4gICAgY29uc3Qgam9pbmVkID0gdmFsdWVzLmpvaW4oJycpO1xuICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShqb2luZWQubGVuZ3RoIC8gMik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBqb2luZWQubGVuZ3RoOyBpICs9IDIpIHtcbiAgICAgICAgZGF0YVtpID4+IDFdID0gcGFyc2VJbnQoam9pbmVkLnN1YnN0cihpLCAyKSwgMTYpO1xuICAgIH1cbiAgICByZXR1cm4gZGF0YS5idWZmZXI7XG59XG5cbmltcG9ydCAqIGFzIFNjaGVtYV8gZnJvbSAnLi4vLi4vZmIvU2NoZW1hJztcbmltcG9ydCBUeXBlID0gU2NoZW1hXy5vcmcuYXBhY2hlLmFycm93LmZsYXRidWYuVHlwZTtcbmltcG9ydCBEYXRlVW5pdCA9IFNjaGVtYV8ub3JnLmFwYWNoZS5hcnJvdy5mbGF0YnVmLkRhdGVVbml0O1xuaW1wb3J0IFRpbWVVbml0ID0gU2NoZW1hXy5vcmcuYXBhY2hlLmFycm93LmZsYXRidWYuVGltZVVuaXQ7XG5pbXBvcnQgUHJlY2lzaW9uID0gU2NoZW1hXy5vcmcuYXBhY2hlLmFycm93LmZsYXRidWYuUHJlY2lzaW9uO1xuaW1wb3J0IEludGVydmFsVW5pdCA9IFNjaGVtYV8ub3JnLmFwYWNoZS5hcnJvdy5mbGF0YnVmLkludGVydmFsVW5pdDtcbmltcG9ydCBNZXRhZGF0YVZlcnNpb24gPSBTY2hlbWFfLm9yZy5hcGFjaGUuYXJyb3cuZmxhdGJ1Zi5NZXRhZGF0YVZlcnNpb247XG5pbXBvcnQgeyB0b1R5cGVkQXJyYXkgfSBmcm9tICcuLi8uLi9kYXRhJztcblxuZnVuY3Rpb24gc2NoZW1hRnJvbUpTT04oczogYW55KTogU2NoZW1hIHtcbiAgICBjb25zdCBkaWN0aW9uYXJ5RmllbGRzID0gbmV3IE1hcDxudW1iZXIsIEZpZWxkPERpY3Rpb25hcnk+PigpO1xuICAgIHJldHVybiBuZXcgU2NoZW1hKFxuICAgICAgICBmaWVsZHNGcm9tSlNPTihzWydmaWVsZHMnXSwgZGljdGlvbmFyeUZpZWxkcyksXG4gICAgICAgIGN1c3RvbU1ldGFkYXRhKHNbJ2N1c3RvbU1ldGFkYXRhJ10pLFxuICAgICAgICBNZXRhZGF0YVZlcnNpb24uVjQsIGRpY3Rpb25hcnlGaWVsZHNcbiAgICApO1xufVxuXG5mdW5jdGlvbiByZWNvcmRCYXRjaEZyb21KU09OKGI6IGFueSk6IFJlY29yZEJhdGNoTWV0YWRhdGEge1xuICAgIHJldHVybiBuZXcgUmVjb3JkQmF0Y2hNZXRhZGF0YShcbiAgICAgICAgTWV0YWRhdGFWZXJzaW9uLlY0LFxuICAgICAgICBiWydjb3VudCddLFxuICAgICAgICBmaWVsZE5vZGVzRnJvbUpTT04oYlsnY29sdW1ucyddKSxcbiAgICAgICAgYnVmZmVyc0Zyb21KU09OKGJbJ2NvbHVtbnMnXSlcbiAgICApO1xufVxuXG5mdW5jdGlvbiBkaWN0aW9uYXJ5QmF0Y2hGcm9tSlNPTihiOiBhbnkpOiBEaWN0aW9uYXJ5QmF0Y2gge1xuICAgIHJldHVybiBuZXcgRGljdGlvbmFyeUJhdGNoKFxuICAgICAgICBNZXRhZGF0YVZlcnNpb24uVjQsXG4gICAgICAgIHJlY29yZEJhdGNoRnJvbUpTT04oYlsnZGF0YSddKSxcbiAgICAgICAgYlsnaWQnXSwgYlsnaXNEZWx0YSddXG4gICAgKTtcbn1cblxuZnVuY3Rpb24gZmllbGRzRnJvbUpTT04oZnM6IGFueVtdLCBkaWN0aW9uYXJ5RmllbGRzOiBNYXA8bnVtYmVyLCBGaWVsZDxEaWN0aW9uYXJ5Pj4gfCBudWxsKTogRmllbGRbXSB7XG4gICAgcmV0dXJuIChmcyB8fCBbXSlcbiAgICAgICAgLm1hcCgoZikgPT4gZmllbGRGcm9tSlNPTihmLCBkaWN0aW9uYXJ5RmllbGRzKSlcbiAgICAgICAgLmZpbHRlcigoZikgPT4gZiAhPSBudWxsKSBhcyBGaWVsZFtdO1xufVxuXG5mdW5jdGlvbiBmaWVsZE5vZGVzRnJvbUpTT04oeHM6IGFueVtdKTogRmllbGRNZXRhZGF0YVtdIHtcbiAgICByZXR1cm4gKHhzIHx8IFtdKS5yZWR1Y2U8RmllbGRNZXRhZGF0YVtdPigoZmllbGROb2RlcywgY29sdW1uOiBhbnkpID0+IFtcbiAgICAgICAgLi4uZmllbGROb2RlcyxcbiAgICAgICAgbmV3IEZpZWxkTWV0YWRhdGEoXG4gICAgICAgICAgICBuZXcgTG9uZyhjb2x1bW5bJ2NvdW50J10sIDApLFxuICAgICAgICAgICAgbmV3IExvbmcobnVsbENvdW50RnJvbUpTT04oY29sdW1uWydWQUxJRElUWSddKSwgMClcbiAgICAgICAgKSxcbiAgICAgICAgLi4uZmllbGROb2Rlc0Zyb21KU09OKGNvbHVtblsnY2hpbGRyZW4nXSlcbiAgICBdLCBbXSBhcyBGaWVsZE1ldGFkYXRhW10pO1xufVxuXG5mdW5jdGlvbiBidWZmZXJzRnJvbUpTT04oeHM6IGFueVtdLCBidWZmZXJzOiBCdWZmZXJNZXRhZGF0YVtdID0gW10pOiBCdWZmZXJNZXRhZGF0YVtdIHtcbiAgICBmb3IgKGxldCBpID0gLTEsIG4gPSAoeHMgfHwgW10pLmxlbmd0aDsgKytpIDwgbjspIHtcbiAgICAgICAgY29uc3QgY29sdW1uID0geHNbaV07XG4gICAgICAgIGNvbHVtblsnVkFMSURJVFknXSAmJiBidWZmZXJzLnB1c2gobmV3IEJ1ZmZlck1ldGFkYXRhKG5ldyBMb25nKGJ1ZmZlcnMubGVuZ3RoLCAwKSwgbmV3IExvbmcoY29sdW1uWydWQUxJRElUWSddLmxlbmd0aCwgMCkpKTtcbiAgICAgICAgY29sdW1uWydPRkZTRVQnXSAmJiBidWZmZXJzLnB1c2gobmV3IEJ1ZmZlck1ldGFkYXRhKG5ldyBMb25nKGJ1ZmZlcnMubGVuZ3RoLCAwKSwgbmV3IExvbmcoY29sdW1uWydPRkZTRVQnXS5sZW5ndGgsIDApKSk7XG4gICAgICAgIGNvbHVtblsnREFUQSddICYmIGJ1ZmZlcnMucHVzaChuZXcgQnVmZmVyTWV0YWRhdGEobmV3IExvbmcoYnVmZmVycy5sZW5ndGgsIDApLCBuZXcgTG9uZyhjb2x1bW5bJ0RBVEEnXS5sZW5ndGgsIDApKSk7XG4gICAgICAgIGJ1ZmZlcnMgPSBidWZmZXJzRnJvbUpTT04oY29sdW1uWydjaGlsZHJlbiddLCBidWZmZXJzKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ1ZmZlcnM7XG59XG5cbmZ1bmN0aW9uIG51bGxDb3VudEZyb21KU09OKHZhbGlkaXR5OiBudW1iZXJbXSkge1xuICAgIHJldHVybiAodmFsaWRpdHkgfHwgW10pLnJlZHVjZSgoc3VtLCB2YWwpID0+IHN1bSArICsodmFsID09PSAwKSwgMCk7XG59XG5cbmZ1bmN0aW9uIGZpZWxkRnJvbUpTT04oZjogYW55LCBkaWN0aW9uYXJ5RmllbGRzOiBNYXA8bnVtYmVyLCBGaWVsZDxEaWN0aW9uYXJ5Pj4gfCBudWxsKSB7XG4gICAgbGV0IG5hbWUgPSBmWyduYW1lJ107XG4gICAgbGV0IGZpZWxkOiBGaWVsZCB8IHZvaWQ7XG4gICAgbGV0IG51bGxhYmxlID0gZlsnbnVsbGFibGUnXTtcbiAgICBsZXQgZGF0YVR5cGU6IERhdGFUeXBlPGFueT4gfCBudWxsO1xuICAgIGxldCBpZDogbnVtYmVyLCBrZXlzTWV0YTogYW55LCBkaWN0TWV0YTogYW55O1xuICAgIGxldCBtZXRhZGF0YSA9IGN1c3RvbU1ldGFkYXRhKGZbJ2N1c3RvbU1ldGFkYXRhJ10pO1xuICAgIGlmICghZGljdGlvbmFyeUZpZWxkcyB8fCAhKGRpY3RNZXRhID0gZlsnZGljdGlvbmFyeSddKSkge1xuICAgICAgICBpZiAoZGF0YVR5cGUgPSB0eXBlRnJvbUpTT04oZlsndHlwZSddLCBmaWVsZHNGcm9tSlNPTihmWydjaGlsZHJlbiddLCBkaWN0aW9uYXJ5RmllbGRzKSkpIHtcbiAgICAgICAgICAgIGZpZWxkID0gbmV3IEZpZWxkKG5hbWUsIGRhdGFUeXBlLCBudWxsYWJsZSwgbWV0YWRhdGEpO1xuICAgICAgICB9XG4gICAgfSBlbHNlIGlmIChkYXRhVHlwZSA9IGRpY3Rpb25hcnlGaWVsZHMuaGFzKGlkID0gZGljdE1ldGFbJ2lkJ10pXG4gICAgICAgICAgICAgICAgICAgICAgICA/IGRpY3Rpb25hcnlGaWVsZHMuZ2V0KGlkKSEudHlwZS5kaWN0aW9uYXJ5XG4gICAgICAgICAgICAgICAgICAgICAgICA6IHR5cGVGcm9tSlNPTihmWyd0eXBlJ10sIGZpZWxkc0Zyb21KU09OKGZbJ2NoaWxkcmVuJ10sIG51bGwpKSkge1xuICAgICAgICBkYXRhVHlwZSA9IG5ldyBEaWN0aW9uYXJ5KGRhdGFUeXBlLFxuICAgICAgICAgICAgLy8gYSBkaWN0aW9uYXJ5IGluZGV4IGRlZmF1bHRzIHRvIHNpZ25lZCAzMiBiaXQgaW50IGlmIHVuc3BlY2lmaWVkXG4gICAgICAgICAgICAoa2V5c01ldGEgPSBkaWN0TWV0YVsnaW5kZXhUeXBlJ10pID8gaW50RnJvbUpTT04oa2V5c01ldGEpISA6IG5ldyBJbnQzMigpLFxuICAgICAgICAgICAgaWQsIGRpY3RNZXRhWydpc09yZGVyZWQnXVxuICAgICAgICApO1xuICAgICAgICBmaWVsZCA9IG5ldyBGaWVsZChuYW1lLCBkYXRhVHlwZSwgbnVsbGFibGUsIG1ldGFkYXRhKTtcbiAgICAgICAgZGljdGlvbmFyeUZpZWxkcy5oYXMoaWQpIHx8IGRpY3Rpb25hcnlGaWVsZHMuc2V0KGlkLCBmaWVsZCBhcyBGaWVsZDxEaWN0aW9uYXJ5Pik7XG4gICAgfVxuICAgIHJldHVybiBmaWVsZCB8fCBudWxsO1xufVxuXG5mdW5jdGlvbiBjdXN0b21NZXRhZGF0YShtZXRhZGF0YT86IGFueSkge1xuICAgIHJldHVybiBuZXcgTWFwPHN0cmluZywgc3RyaW5nPihPYmplY3QuZW50cmllcyhtZXRhZGF0YSB8fCB7fSkpO1xufVxuXG5jb25zdCBuYW1lc1RvVHlwZU1hcDogeyBbbjogc3RyaW5nXTogVHlwZSB9ICA9IHtcbiAgICAnTk9ORSc6IFR5cGUuTk9ORSxcbiAgICAnbnVsbCc6IFR5cGUuTnVsbCxcbiAgICAnaW50JzogVHlwZS5JbnQsXG4gICAgJ2Zsb2F0aW5ncG9pbnQnOiBUeXBlLkZsb2F0aW5nUG9pbnQsXG4gICAgJ2JpbmFyeSc6IFR5cGUuQmluYXJ5LFxuICAgICdib29sJzogVHlwZS5Cb29sLFxuICAgICd1dGY4JzogVHlwZS5VdGY4LFxuICAgICdkZWNpbWFsJzogVHlwZS5EZWNpbWFsLFxuICAgICdkYXRlJzogVHlwZS5EYXRlLFxuICAgICd0aW1lJzogVHlwZS5UaW1lLFxuICAgICd0aW1lc3RhbXAnOiBUeXBlLlRpbWVzdGFtcCxcbiAgICAnaW50ZXJ2YWwnOiBUeXBlLkludGVydmFsLFxuICAgICdsaXN0JzogVHlwZS5MaXN0LFxuICAgICdzdHJ1Y3QnOiBUeXBlLlN0cnVjdF8sXG4gICAgJ3VuaW9uJzogVHlwZS5VbmlvbixcbiAgICAnZml4ZWRzaXplYmluYXJ5JzogVHlwZS5GaXhlZFNpemVCaW5hcnksXG4gICAgJ2ZpeGVkc2l6ZWxpc3QnOiBUeXBlLkZpeGVkU2l6ZUxpc3QsXG4gICAgJ21hcCc6IFR5cGUuTWFwLFxufTtcblxuZnVuY3Rpb24gdHlwZUZyb21KU09OKHQ6IGFueSwgY2hpbGRyZW4/OiBGaWVsZFtdKSB7XG4gICAgc3dpdGNoIChuYW1lc1RvVHlwZU1hcFt0WyduYW1lJ11dKSB7XG4gICAgICAgIGNhc2UgVHlwZS5OT05FOiByZXR1cm4gbnVsbDtcbiAgICAgICAgY2FzZSBUeXBlLk51bGw6IHJldHVybiBudWxsRnJvbUpTT04odCk7XG4gICAgICAgIGNhc2UgVHlwZS5JbnQ6IHJldHVybiBpbnRGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkZsb2F0aW5nUG9pbnQ6IHJldHVybiBmbG9hdGluZ1BvaW50RnJvbUpTT04odCk7XG4gICAgICAgIGNhc2UgVHlwZS5CaW5hcnk6IHJldHVybiBiaW5hcnlGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLlV0Zjg6IHJldHVybiB1dGY4RnJvbUpTT04odCk7XG4gICAgICAgIGNhc2UgVHlwZS5Cb29sOiByZXR1cm4gYm9vbEZyb21KU09OKHQpO1xuICAgICAgICBjYXNlIFR5cGUuRGVjaW1hbDogcmV0dXJuIGRlY2ltYWxGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkRhdGU6IHJldHVybiBkYXRlRnJvbUpTT04odCk7XG4gICAgICAgIGNhc2UgVHlwZS5UaW1lOiByZXR1cm4gdGltZUZyb21KU09OKHQpO1xuICAgICAgICBjYXNlIFR5cGUuVGltZXN0YW1wOiByZXR1cm4gdGltZXN0YW1wRnJvbUpTT04odCk7XG4gICAgICAgIGNhc2UgVHlwZS5JbnRlcnZhbDogcmV0dXJuIGludGVydmFsRnJvbUpTT04odCk7XG4gICAgICAgIGNhc2UgVHlwZS5MaXN0OiByZXR1cm4gbGlzdEZyb21KU09OKHQsIGNoaWxkcmVuIHx8IFtdKTtcbiAgICAgICAgY2FzZSBUeXBlLlN0cnVjdF86IHJldHVybiBzdHJ1Y3RGcm9tSlNPTih0LCBjaGlsZHJlbiB8fCBbXSk7XG4gICAgICAgIGNhc2UgVHlwZS5VbmlvbjogcmV0dXJuIHVuaW9uRnJvbUpTT04odCwgY2hpbGRyZW4gfHwgW10pO1xuICAgICAgICBjYXNlIFR5cGUuRml4ZWRTaXplQmluYXJ5OiByZXR1cm4gZml4ZWRTaXplQmluYXJ5RnJvbUpTT04odCk7XG4gICAgICAgIGNhc2UgVHlwZS5GaXhlZFNpemVMaXN0OiByZXR1cm4gZml4ZWRTaXplTGlzdEZyb21KU09OKHQsIGNoaWxkcmVuIHx8IFtdKTtcbiAgICAgICAgY2FzZSBUeXBlLk1hcDogcmV0dXJuIG1hcEZyb21KU09OKHQsIGNoaWxkcmVuIHx8IFtdKTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKGBVbnJlY29nbml6ZWQgdHlwZSAke3RbJ25hbWUnXX1gKTtcbn1cblxuZnVuY3Rpb24gbnVsbEZyb21KU09OICAgICAgICAgICAoX3R5cGU6IGFueSkgICAgICAgICAgICAgICAgICAgIHsgcmV0dXJuIG5ldyBOdWxsKCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuZnVuY3Rpb24gaW50RnJvbUpTT04gICAgICAgICAgICAoX3R5cGU6IGFueSkgICAgICAgICAgICAgICAgICAgIHsgc3dpdGNoIChfdHlwZVsnYml0V2lkdGgnXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgIDg6IHJldHVybiBfdHlwZVsnaXNTaWduZWQnXSA/IG5ldyAgSW50OCgpIDogbmV3ICBVaW50OCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTY6IHJldHVybiBfdHlwZVsnaXNTaWduZWQnXSA/IG5ldyBJbnQxNigpIDogbmV3IFVpbnQxNigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzI6IHJldHVybiBfdHlwZVsnaXNTaWduZWQnXSA/IG5ldyBJbnQzMigpIDogbmV3IFVpbnQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNjQ6IHJldHVybiBfdHlwZVsnaXNTaWduZWQnXSA/IG5ldyBJbnQ2NCgpIDogbmV3IFVpbnQ2NCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuZnVuY3Rpb24gZmxvYXRpbmdQb2ludEZyb21KU09OICAoX3R5cGU6IGFueSkgICAgICAgICAgICAgICAgICAgIHsgc3dpdGNoIChQcmVjaXNpb25bX3R5cGVbJ3ByZWNpc2lvbiddXSBhcyBhbnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFByZWNpc2lvbi5IQUxGOiByZXR1cm4gbmV3IEZsb2F0MTYoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFByZWNpc2lvbi5TSU5HTEU6IHJldHVybiBuZXcgRmxvYXQzMigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUHJlY2lzaW9uLkRPVUJMRTogcmV0dXJuIG5ldyBGbG9hdDY0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBiaW5hcnlGcm9tSlNPTiAgICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IEJpbmFyeSgpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiB1dGY4RnJvbUpTT04gICAgICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IFV0ZjgoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBib29sRnJvbUpTT04gICAgICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IEJvb2woKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBkZWNpbWFsRnJvbUpTT04gICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IERlY2ltYWwoX3R5cGVbJ3NjYWxlJ10sIF90eXBlWydwcmVjaXNpb24nXSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBkYXRlRnJvbUpTT04gICAgICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IERhdGVfKERhdGVVbml0W190eXBlWyd1bml0J11dIGFzIGFueSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiB0aW1lRnJvbUpTT04gICAgICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IFRpbWUoVGltZVVuaXRbX3R5cGVbJ3VuaXQnXV0gYXMgYW55LCBfdHlwZVsnYml0V2lkdGgnXSBhcyBUaW1lQml0V2lkdGgpOyB9XG5mdW5jdGlvbiB0aW1lc3RhbXBGcm9tSlNPTiAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IFRpbWVzdGFtcChUaW1lVW5pdFtfdHlwZVsndW5pdCddXSBhcyBhbnksIF90eXBlWyd0aW1lem9uZSddKTsgICAgICAgICAgICB9XG5mdW5jdGlvbiBpbnRlcnZhbEZyb21KU09OICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IEludGVydmFsKEludGVydmFsVW5pdFtfdHlwZVsndW5pdCddXSBhcyBhbnkpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBsaXN0RnJvbUpTT04gICAgICAgICAgIChfdHlwZTogYW55LCBjaGlsZHJlbjogRmllbGRbXSkgeyByZXR1cm4gbmV3IExpc3QoY2hpbGRyZW4pOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBzdHJ1Y3RGcm9tSlNPTiAgICAgICAgIChfdHlwZTogYW55LCBjaGlsZHJlbjogRmllbGRbXSkgeyByZXR1cm4gbmV3IFN0cnVjdChjaGlsZHJlbik7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiB1bmlvbkZyb21KU09OICAgICAgICAgIChfdHlwZTogYW55LCBjaGlsZHJlbjogRmllbGRbXSkgeyByZXR1cm4gbmV3IFVuaW9uKF90eXBlWydtb2RlJ10sIChfdHlwZVsndHlwZUlkc0FycmF5J10gfHwgW10pIGFzIFR5cGVbXSwgY2hpbGRyZW4pOyB9XG5mdW5jdGlvbiBmaXhlZFNpemVCaW5hcnlGcm9tSlNPTihfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IEZpeGVkU2l6ZUJpbmFyeShfdHlwZVsnYnl0ZVdpZHRoJ10pOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBmaXhlZFNpemVMaXN0RnJvbUpTT04gIChfdHlwZTogYW55LCBjaGlsZHJlbjogRmllbGRbXSkgeyByZXR1cm4gbmV3IEZpeGVkU2l6ZUxpc3QoX3R5cGVbJ2xpc3RTaXplJ10sIGNoaWxkcmVuKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBtYXBGcm9tSlNPTiAgICAgICAgICAgIChfdHlwZTogYW55LCBjaGlsZHJlbjogRmllbGRbXSkgeyByZXR1cm4gbmV3IE1hcF8oX3R5cGVbJ2tleXNTb3J0ZWQnXSwgY2hpbGRyZW4pOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4iXX0=
