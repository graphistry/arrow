// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import { flatbuffers } from 'flatbuffers';
import { TypeDataLoader } from './vector';
import { packBools } from '../../util/bit';
import * as IntUtil from '../../util/int';
import { TextEncoder } from 'text-encoding-utf-8';
import { RecordBatchMetadata, DictionaryBatch, BufferMetadata, FieldMetadata } from '../metadata';
import { Schema, Field, DataType, Dictionary, Null, Binary, Bool, Utf8, Decimal, Date_, Time, Timestamp, Interval, List, Struct, Union, FixedSizeBinary, FixedSizeList, Map_, } from '../../type';
import { Int8, Uint8, Int16, Uint16, Int32, Uint32, Int64, Uint64, Float16, Float64, Float32, } from '../../type';
var Long = flatbuffers.Long;
export function* readJSON(json) {
    const schema = schemaFromJSON(json['schema']);
    const dictionaries = new Map();
    for (const batch of (json['dictionaries'] || [])) {
        const message = dictionaryBatchFromJSON(batch);
        yield {
            schema, message,
            loader: new JSONDataLoader(flattenDataSources(batch['data']['columns']), arrayIterator(message.nodes), arrayIterator(message.buffers), dictionaries)
        };
    }
    for (const batch of (json['batches'] || [])) {
        const message = recordBatchFromJSON(batch);
        yield {
            schema, message,
            loader: new JSONDataLoader(flattenDataSources(batch['columns']), arrayIterator(message.nodes), arrayIterator(message.buffers), dictionaries)
        };
    }
}
function* arrayIterator(arr) { yield* arr; }
function flattenDataSources(xs) {
    return (xs || []).reduce((buffers, column) => [
        ...buffers,
        ...(column['VALIDITY'] && [column['VALIDITY']] || []),
        ...(column['OFFSET'] && [column['OFFSET']] || []),
        ...(column['DATA'] && [column['DATA']] || []),
        ...flattenDataSources(column['children'])
    ], []);
}
const utf8Encoder = new TextEncoder('utf-8');
export class JSONDataLoader extends TypeDataLoader {
    constructor(sources, nodes, buffers, dictionaries) {
        super(nodes, buffers, dictionaries);
        this.sources = sources;
    }
    readNullBitmap(_type, nullCount, { offset } = this.getBufferMetadata()) {
        return nullCount <= 0 ? new Uint8Array(0) : packBools(this.sources[offset]);
    }
    readOffsets(_type, { offset } = this.getBufferMetadata()) {
        return new Int32Array(this.sources[offset]);
    }
    readTypeIds(_type, { offset } = this.getBufferMetadata()) {
        return new Int8Array(this.sources[offset]);
    }
    readData(type, { offset } = this.getBufferMetadata()) {
        const { sources } = this;
        if (DataType.isTimestamp(type) === true) {
            return new Uint8Array(int64DataFromJSON(sources[offset]));
        }
        else if ((DataType.isInt(type) || DataType.isTime(type)) && type.bitWidth === 64) {
            return new Uint8Array(int64DataFromJSON(sources[offset]));
        }
        else if (DataType.isDate(type) && type.unit === DateUnit.MILLISECOND) {
            return new Uint8Array(int64DataFromJSON(sources[offset]));
        }
        else if (DataType.isDecimal(type) === true) {
            return new Uint8Array(decimalDataFromJSON(sources[offset]));
        }
        else if (DataType.isBinary(type) === true || DataType.isFixedSizeBinary(type) === true) {
            return new Uint8Array(binaryDataFromJSON(sources[offset]));
        }
        else if (DataType.isBool(type) === true) {
            return new Uint8Array(packBools(sources[offset]).buffer);
        }
        else if (DataType.isUtf8(type) === true) {
            return utf8Encoder.encode(sources[offset].join(''));
        }
        else {
            return toTypedArray(type.ArrayType, sources[offset].map((x) => +x));
        }
    }
}
function int64DataFromJSON(values) {
    const data = new Uint32Array(values.length * 2);
    for (let i = -1, n = values.length; ++i < n;) {
        // Force all values (even numbers) to be parsed as strings since
        // pulling out high and low bits seems to lose precision sometimes
        // For example:
        //     > -4613034156400212000 >>> 0
        //     721782784
        // The correct lower 32-bits are 721782752
        IntUtil.Int64.fromString(values[i].toString(), new Uint32Array(data.buffer, data.byteOffset + 2 * i * 4, 2));
    }
    return data.buffer;
}
function decimalDataFromJSON(values) {
    const data = new Uint32Array(values.length * 4);
    for (let i = -1, n = values.length; ++i < n;) {
        IntUtil.Int128.fromString(values[i], new Uint32Array(data.buffer, data.byteOffset + 4 * 4 * i, 4));
    }
    return data.buffer;
}
function binaryDataFromJSON(values) {
    // "DATA": ["49BC7D5B6C47D2","3F5FB6D9322026"]
    // There are definitely more efficient ways to do this... but it gets the
    // job done.
    const joined = values.join('');
    const data = new Uint8Array(joined.length / 2);
    for (let i = 0; i < joined.length; i += 2) {
        data[i >> 1] = parseInt(joined.substr(i, 2), 16);
    }
    return data.buffer;
}
import * as Schema_ from '../../fb/Schema';
var Type = Schema_.org.apache.arrow.flatbuf.Type;
var DateUnit = Schema_.org.apache.arrow.flatbuf.DateUnit;
var TimeUnit = Schema_.org.apache.arrow.flatbuf.TimeUnit;
var Precision = Schema_.org.apache.arrow.flatbuf.Precision;
var IntervalUnit = Schema_.org.apache.arrow.flatbuf.IntervalUnit;
var MetadataVersion = Schema_.org.apache.arrow.flatbuf.MetadataVersion;
import { toTypedArray } from '../../data';
function schemaFromJSON(s) {
    const dictionaryFields = new Map();
    return new Schema(fieldsFromJSON(s['fields'], dictionaryFields), customMetadata(s['customMetadata']), MetadataVersion.V4, dictionaryFields);
}
function recordBatchFromJSON(b) {
    return new RecordBatchMetadata(MetadataVersion.V4, b['count'], fieldNodesFromJSON(b['columns']), buffersFromJSON(b['columns']));
}
function dictionaryBatchFromJSON(b) {
    return new DictionaryBatch(MetadataVersion.V4, recordBatchFromJSON(b['data']), b['id'], b['isDelta']);
}
function fieldsFromJSON(fs, dictionaryFields) {
    return (fs || [])
        .map((f) => fieldFromJSON(f, dictionaryFields))
        .filter((f) => f != null);
}
function fieldNodesFromJSON(xs) {
    return (xs || []).reduce((fieldNodes, column) => [
        ...fieldNodes,
        new FieldMetadata(new Long(column['count'], 0), new Long(nullCountFromJSON(column['VALIDITY']), 0)),
        ...fieldNodesFromJSON(column['children'])
    ], []);
}
function buffersFromJSON(xs, buffers = []) {
    for (let i = -1, n = (xs || []).length; ++i < n;) {
        const column = xs[i];
        column['VALIDITY'] && buffers.push(new BufferMetadata(new Long(buffers.length, 0), new Long(column['VALIDITY'].length, 0)));
        column['OFFSET'] && buffers.push(new BufferMetadata(new Long(buffers.length, 0), new Long(column['OFFSET'].length, 0)));
        column['DATA'] && buffers.push(new BufferMetadata(new Long(buffers.length, 0), new Long(column['DATA'].length, 0)));
        buffers = buffersFromJSON(column['children'], buffers);
    }
    return buffers;
}
function nullCountFromJSON(validity) {
    return (validity || []).reduce((sum, val) => sum + +(val === 0), 0);
}
function fieldFromJSON(f, dictionaryFields) {
    let name = f['name'];
    let field;
    let nullable = f['nullable'];
    let dataType;
    let id, keysMeta, dictMeta;
    let metadata = customMetadata(f['customMetadata']);
    if (!dictionaryFields || !(dictMeta = f['dictionary'])) {
        if (dataType = typeFromJSON(f['type'], fieldsFromJSON(f['children'], dictionaryFields))) {
            field = new Field(name, dataType, nullable, metadata);
        }
    }
    else if (dataType = dictionaryFields.has(id = dictMeta['id'])
        ? dictionaryFields.get(id).type.dictionary
        : typeFromJSON(f['type'], fieldsFromJSON(f['children'], null))) {
        dataType = new Dictionary(dataType, 
        // a dictionary index defaults to signed 32 bit int if unspecified
        (keysMeta = dictMeta['indexType']) ? intFromJSON(keysMeta) : new Int32(), id, dictMeta['isOrdered']);
        field = new Field(name, dataType, nullable, metadata);
        dictionaryFields.has(id) || dictionaryFields.set(id, field);
    }
    return field || null;
}
function customMetadata(metadata) {
    return new Map(Object.entries(metadata || {}));
}
const namesToTypeMap = {
    'NONE': Type.NONE,
    'null': Type.Null,
    'int': Type.Int,
    'floatingpoint': Type.FloatingPoint,
    'binary': Type.Binary,
    'bool': Type.Bool,
    'utf8': Type.Utf8,
    'decimal': Type.Decimal,
    'date': Type.Date,
    'time': Type.Time,
    'timestamp': Type.Timestamp,
    'interval': Type.Interval,
    'list': Type.List,
    'struct': Type.Struct_,
    'union': Type.Union,
    'fixedsizebinary': Type.FixedSizeBinary,
    'fixedsizelist': Type.FixedSizeList,
    'map': Type.Map,
};
function typeFromJSON(t, children) {
    switch (namesToTypeMap[t['name']]) {
        case Type.NONE: return null;
        case Type.Null: return nullFromJSON(t);
        case Type.Int: return intFromJSON(t);
        case Type.FloatingPoint: return floatingPointFromJSON(t);
        case Type.Binary: return binaryFromJSON(t);
        case Type.Utf8: return utf8FromJSON(t);
        case Type.Bool: return boolFromJSON(t);
        case Type.Decimal: return decimalFromJSON(t);
        case Type.Date: return dateFromJSON(t);
        case Type.Time: return timeFromJSON(t);
        case Type.Timestamp: return timestampFromJSON(t);
        case Type.Interval: return intervalFromJSON(t);
        case Type.List: return listFromJSON(t, children || []);
        case Type.Struct_: return structFromJSON(t, children || []);
        case Type.Union: return unionFromJSON(t, children || []);
        case Type.FixedSizeBinary: return fixedSizeBinaryFromJSON(t);
        case Type.FixedSizeList: return fixedSizeListFromJSON(t, children || []);
        case Type.Map: return mapFromJSON(t, children || []);
    }
    throw new Error(`Unrecognized type ${t['name']}`);
}
function nullFromJSON(_type) { return new Null(); }
function intFromJSON(_type) {
    switch (_type['bitWidth']) {
        case 8: return _type['isSigned'] ? new Int8() : new Uint8();
        case 16: return _type['isSigned'] ? new Int16() : new Uint16();
        case 32: return _type['isSigned'] ? new Int32() : new Uint32();
        case 64: return _type['isSigned'] ? new Int64() : new Uint64();
    }
    return null;
}
function floatingPointFromJSON(_type) {
    switch (Precision[_type['precision']]) {
        case Precision.HALF: return new Float16();
        case Precision.SINGLE: return new Float32();
        case Precision.DOUBLE: return new Float64();
    }
    return null;
}
function binaryFromJSON(_type) { return new Binary(); }
function utf8FromJSON(_type) { return new Utf8(); }
function boolFromJSON(_type) { return new Bool(); }
function decimalFromJSON(_type) { return new Decimal(_type['scale'], _type['precision']); }
function dateFromJSON(_type) { return new Date_(DateUnit[_type['unit']]); }
function timeFromJSON(_type) { return new Time(TimeUnit[_type['unit']], _type['bitWidth']); }
function timestampFromJSON(_type) { return new Timestamp(TimeUnit[_type['unit']], _type['timezone']); }
function intervalFromJSON(_type) { return new Interval(IntervalUnit[_type['unit']]); }
function listFromJSON(_type, children) { return new List(children); }
function structFromJSON(_type, children) { return new Struct(children); }
function unionFromJSON(_type, children) { return new Union(_type['mode'], (_type['typeIdsArray'] || []), children); }
function fixedSizeBinaryFromJSON(_type) { return new FixedSizeBinary(_type['byteWidth']); }
function fixedSizeListFromJSON(_type, children) { return new FixedSizeList(_type['listSize'], children); }
function mapFromJSON(_type, children) { return new Map_(_type['keysSorted'], children); }

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLENBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDdkosaUNBQWlDLEtBQVUsSUFBdUIsTUFBTSxDQUFDLElBQUksZUFBZSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQXFDLENBQUM7QUFDdkosK0JBQWlDLEtBQVUsRUFBRSxRQUFpQixJQUFJLE1BQU0sQ0FBQyxJQUFJLGFBQWEsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBOEIsQ0FBQztBQUN2SixxQkFBaUMsS0FBVSxFQUFFLFFBQWlCLElBQUksTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFxQyxDQUFDIiwiZmlsZSI6ImlwYy9yZWFkZXIvanNvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBWZWN0b3IgfSBmcm9tICcuLi8uLi92ZWN0b3InO1xuaW1wb3J0IHsgZmxhdGJ1ZmZlcnMgfSBmcm9tICdmbGF0YnVmZmVycyc7XG5pbXBvcnQgeyBUeXBlRGF0YUxvYWRlciB9IGZyb20gJy4vdmVjdG9yJztcbmltcG9ydCB7IHBhY2tCb29scyB9IGZyb20gJy4uLy4uL3V0aWwvYml0JztcbmltcG9ydCAqIGFzIEludFV0aWwgZnJvbSAnLi4vLi4vdXRpbC9pbnQnO1xuaW1wb3J0IHsgVGV4dEVuY29kZXIgfSBmcm9tICd0ZXh0LWVuY29kaW5nLXV0Zi04JztcbmltcG9ydCB7IFJlY29yZEJhdGNoTWV0YWRhdGEsIERpY3Rpb25hcnlCYXRjaCwgQnVmZmVyTWV0YWRhdGEsIEZpZWxkTWV0YWRhdGEgfSBmcm9tICcuLi9tZXRhZGF0YSc7XG5pbXBvcnQge1xuICAgIFNjaGVtYSwgRmllbGQsXG4gICAgRGF0YVR5cGUsIERpY3Rpb25hcnksXG4gICAgTnVsbCwgVGltZUJpdFdpZHRoLFxuICAgIEJpbmFyeSwgQm9vbCwgVXRmOCwgRGVjaW1hbCxcbiAgICBEYXRlXywgVGltZSwgVGltZXN0YW1wLCBJbnRlcnZhbCxcbiAgICBMaXN0LCBTdHJ1Y3QsIFVuaW9uLCBGaXhlZFNpemVCaW5hcnksIEZpeGVkU2l6ZUxpc3QsIE1hcF8sXG59IGZyb20gJy4uLy4uL3R5cGUnO1xuXG5pbXBvcnQge1xuICAgIEludDgsICBVaW50OCxcbiAgICBJbnQxNiwgVWludDE2LFxuICAgIEludDMyLCBVaW50MzIsXG4gICAgSW50NjQsIFVpbnQ2NCxcbiAgICBGbG9hdDE2LCBGbG9hdDY0LCBGbG9hdDMyLFxufSBmcm9tICcuLi8uLi90eXBlJztcblxuaW1wb3J0IExvbmcgPSBmbGF0YnVmZmVycy5Mb25nO1xuXG5leHBvcnQgZnVuY3Rpb24qIHJlYWRKU09OKGpzb246IGFueSkge1xuICAgIGNvbnN0IHNjaGVtYSA9IHNjaGVtYUZyb21KU09OKGpzb25bJ3NjaGVtYSddKTtcbiAgICBjb25zdCBkaWN0aW9uYXJpZXMgPSBuZXcgTWFwPG51bWJlciwgVmVjdG9yPigpO1xuICAgIGZvciAoY29uc3QgYmF0Y2ggb2YgKGpzb25bJ2RpY3Rpb25hcmllcyddIHx8IFtdKSkge1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gZGljdGlvbmFyeUJhdGNoRnJvbUpTT04oYmF0Y2gpO1xuICAgICAgICB5aWVsZCB7XG4gICAgICAgICAgICBzY2hlbWEsIG1lc3NhZ2UsXG4gICAgICAgICAgICBsb2FkZXI6IG5ldyBKU09ORGF0YUxvYWRlcihcbiAgICAgICAgICAgICAgICBmbGF0dGVuRGF0YVNvdXJjZXMoYmF0Y2hbJ2RhdGEnXVsnY29sdW1ucyddKSxcbiAgICAgICAgICAgICAgICBhcnJheUl0ZXJhdG9yKG1lc3NhZ2Uubm9kZXMpLFxuICAgICAgICAgICAgICAgIGFycmF5SXRlcmF0b3IobWVzc2FnZS5idWZmZXJzKSxcbiAgICAgICAgICAgICAgICBkaWN0aW9uYXJpZXNcbiAgICAgICAgICAgIClcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBiYXRjaCBvZiAoanNvblsnYmF0Y2hlcyddIHx8IFtdKSkge1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gcmVjb3JkQmF0Y2hGcm9tSlNPTihiYXRjaCk7XG4gICAgICAgIHlpZWxkIHtcbiAgICAgICAgICAgIHNjaGVtYSwgbWVzc2FnZSxcbiAgICAgICAgICAgIGxvYWRlcjogbmV3IEpTT05EYXRhTG9hZGVyKFxuICAgICAgICAgICAgICAgIGZsYXR0ZW5EYXRhU291cmNlcyhiYXRjaFsnY29sdW1ucyddKSxcbiAgICAgICAgICAgICAgICBhcnJheUl0ZXJhdG9yKG1lc3NhZ2Uubm9kZXMpLFxuICAgICAgICAgICAgICAgIGFycmF5SXRlcmF0b3IobWVzc2FnZS5idWZmZXJzKSxcbiAgICAgICAgICAgICAgICBkaWN0aW9uYXJpZXNcbiAgICAgICAgICAgIClcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uKiBhcnJheUl0ZXJhdG9yKGFycjogQXJyYXk8YW55PikgeyB5aWVsZCogYXJyOyB9XG5mdW5jdGlvbiBmbGF0dGVuRGF0YVNvdXJjZXMoeHM6IGFueVtdKTogYW55W11bXSB7XG4gICAgcmV0dXJuICh4cyB8fCBbXSkucmVkdWNlPGFueVtdW10+KChidWZmZXJzLCBjb2x1bW46IGFueSkgPT4gW1xuICAgICAgICAuLi5idWZmZXJzLFxuICAgICAgICAuLi4oY29sdW1uWydWQUxJRElUWSddICYmIFtjb2x1bW5bJ1ZBTElESVRZJ11dIHx8IFtdKSxcbiAgICAgICAgLi4uKGNvbHVtblsnT0ZGU0VUJ10gJiYgW2NvbHVtblsnT0ZGU0VUJ11dIHx8IFtdKSxcbiAgICAgICAgLi4uKGNvbHVtblsnREFUQSddICYmIFtjb2x1bW5bJ0RBVEEnXV0gfHwgW10pLFxuICAgICAgICAuLi5mbGF0dGVuRGF0YVNvdXJjZXMoY29sdW1uWydjaGlsZHJlbiddKVxuICAgIF0sIFtdIGFzIGFueVtdW10pO1xufVxuXG5jb25zdCB1dGY4RW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigndXRmLTgnKTtcblxuZXhwb3J0IGNsYXNzIEpTT05EYXRhTG9hZGVyIGV4dGVuZHMgVHlwZURhdGFMb2FkZXIge1xuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgc291cmNlczogYW55W11bXSwgbm9kZXM6IEl0ZXJhdG9yPEZpZWxkTWV0YWRhdGE+LCBidWZmZXJzOiBJdGVyYXRvcjxCdWZmZXJNZXRhZGF0YT4sIGRpY3Rpb25hcmllczogTWFwPG51bWJlciwgVmVjdG9yPikge1xuICAgICAgICBzdXBlcihub2RlcywgYnVmZmVycywgZGljdGlvbmFyaWVzKTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHJlYWROdWxsQml0bWFwPFQgZXh0ZW5kcyBEYXRhVHlwZT4oX3R5cGU6IFQsIG51bGxDb3VudDogbnVtYmVyLCB7IG9mZnNldCB9ID0gdGhpcy5nZXRCdWZmZXJNZXRhZGF0YSgpKSB7XG4gICAgICAgIHJldHVybiBudWxsQ291bnQgPD0gMCA/IG5ldyBVaW50OEFycmF5KDApIDogcGFja0Jvb2xzKHRoaXMuc291cmNlc1tvZmZzZXRdKTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHJlYWRPZmZzZXRzPFQgZXh0ZW5kcyBEYXRhVHlwZT4oX3R5cGU6IFQsIHsgb2Zmc2V0IH06IEJ1ZmZlck1ldGFkYXRhID0gdGhpcy5nZXRCdWZmZXJNZXRhZGF0YSgpKSB7XG4gICAgICAgIHJldHVybiBuZXcgSW50MzJBcnJheSh0aGlzLnNvdXJjZXNbb2Zmc2V0XSk7XG4gICAgfVxuICAgIHByb3RlY3RlZCByZWFkVHlwZUlkczxUIGV4dGVuZHMgRGF0YVR5cGU+KF90eXBlOiBULCB7IG9mZnNldCB9OiBCdWZmZXJNZXRhZGF0YSA9IHRoaXMuZ2V0QnVmZmVyTWV0YWRhdGEoKSkge1xuICAgICAgICByZXR1cm4gbmV3IEludDhBcnJheSh0aGlzLnNvdXJjZXNbb2Zmc2V0XSk7XG4gICAgfVxuICAgIHByb3RlY3RlZCByZWFkRGF0YTxUIGV4dGVuZHMgRGF0YVR5cGU+KHR5cGU6IFQsIHsgb2Zmc2V0IH06IEJ1ZmZlck1ldGFkYXRhID0gdGhpcy5nZXRCdWZmZXJNZXRhZGF0YSgpKSB7XG4gICAgICAgIGNvbnN0IHsgc291cmNlcyB9ID0gdGhpcztcbiAgICAgICAgaWYgKERhdGFUeXBlLmlzVGltZXN0YW1wKHR5cGUpID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaW50NjREYXRhRnJvbUpTT04oc291cmNlc1tvZmZzZXRdIGFzIHN0cmluZ1tdKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoKERhdGFUeXBlLmlzSW50KHR5cGUpIHx8IERhdGFUeXBlLmlzVGltZSh0eXBlKSkgJiYgdHlwZS5iaXRXaWR0aCA9PT0gNjQpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShpbnQ2NERhdGFGcm9tSlNPTihzb3VyY2VzW29mZnNldF0gYXMgc3RyaW5nW10pKTtcbiAgICAgICAgfSBlbHNlIGlmIChEYXRhVHlwZS5pc0RhdGUodHlwZSkgJiYgdHlwZS51bml0ID09PSBEYXRlVW5pdC5NSUxMSVNFQ09ORCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGludDY0RGF0YUZyb21KU09OKHNvdXJjZXNbb2Zmc2V0XSBhcyBzdHJpbmdbXSkpO1xuICAgICAgICB9IGVsc2UgaWYgKERhdGFUeXBlLmlzRGVjaW1hbCh0eXBlKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGRlY2ltYWxEYXRhRnJvbUpTT04oc291cmNlc1tvZmZzZXRdIGFzIHN0cmluZ1tdKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoRGF0YVR5cGUuaXNCaW5hcnkodHlwZSkgPT09IHRydWUgfHwgRGF0YVR5cGUuaXNGaXhlZFNpemVCaW5hcnkodHlwZSkgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShiaW5hcnlEYXRhRnJvbUpTT04oc291cmNlc1tvZmZzZXRdIGFzIHN0cmluZ1tdKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoRGF0YVR5cGUuaXNCb29sKHR5cGUpID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkocGFja0Jvb2xzKHNvdXJjZXNbb2Zmc2V0XSBhcyBudW1iZXJbXSkuYnVmZmVyKTtcbiAgICAgICAgfSBlbHNlIGlmIChEYXRhVHlwZS5pc1V0ZjgodHlwZSkgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHJldHVybiB1dGY4RW5jb2Rlci5lbmNvZGUoKHNvdXJjZXNbb2Zmc2V0XSBhcyBzdHJpbmdbXSkuam9pbignJykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRvVHlwZWRBcnJheSh0eXBlLkFycmF5VHlwZSwgc291cmNlc1tvZmZzZXRdLm1hcCgoeCkgPT4gK3gpKSBhcyBhbnk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGludDY0RGF0YUZyb21KU09OKHZhbHVlczogc3RyaW5nW10pIHtcbiAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQzMkFycmF5KHZhbHVlcy5sZW5ndGggKiAyKTtcbiAgICBmb3IgKGxldCBpID0gLTEsIG4gPSB2YWx1ZXMubGVuZ3RoOyArK2kgPCBuOykge1xuICAgICAgICAvLyBGb3JjZSBhbGwgdmFsdWVzIChldmVuIG51bWJlcnMpIHRvIGJlIHBhcnNlZCBhcyBzdHJpbmdzIHNpbmNlXG4gICAgICAgIC8vIHB1bGxpbmcgb3V0IGhpZ2ggYW5kIGxvdyBiaXRzIHNlZW1zIHRvIGxvc2UgcHJlY2lzaW9uIHNvbWV0aW1lc1xuICAgICAgICAvLyBGb3IgZXhhbXBsZTpcbiAgICAgICAgLy8gICAgID4gLTQ2MTMwMzQxNTY0MDAyMTIwMDAgPj4+IDBcbiAgICAgICAgLy8gICAgIDcyMTc4Mjc4NFxuICAgICAgICAvLyBUaGUgY29ycmVjdCBsb3dlciAzMi1iaXRzIGFyZSA3MjE3ODI3NTJcbiAgICAgICAgSW50VXRpbC5JbnQ2NC5mcm9tU3RyaW5nKHZhbHVlc1tpXS50b1N0cmluZygpLCBuZXcgVWludDMyQXJyYXkoZGF0YS5idWZmZXIsIGRhdGEuYnl0ZU9mZnNldCArIDIgKiBpICogNCwgMikpO1xuICAgIH1cbiAgICByZXR1cm4gZGF0YS5idWZmZXI7XG59XG5cbmZ1bmN0aW9uIGRlY2ltYWxEYXRhRnJvbUpTT04odmFsdWVzOiBzdHJpbmdbXSkge1xuICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDMyQXJyYXkodmFsdWVzLmxlbmd0aCAqIDQpO1xuICAgIGZvciAobGV0IGkgPSAtMSwgbiA9IHZhbHVlcy5sZW5ndGg7ICsraSA8IG47KSB7XG4gICAgICAgIEludFV0aWwuSW50MTI4LmZyb21TdHJpbmcodmFsdWVzW2ldLCBuZXcgVWludDMyQXJyYXkoZGF0YS5idWZmZXIsIGRhdGEuYnl0ZU9mZnNldCArIDQgKiA0ICogaSwgNCkpO1xuICAgIH1cbiAgICByZXR1cm4gZGF0YS5idWZmZXI7XG59XG5cbmZ1bmN0aW9uIGJpbmFyeURhdGFGcm9tSlNPTih2YWx1ZXM6IHN0cmluZ1tdKSB7XG4gICAgLy8gXCJEQVRBXCI6IFtcIjQ5QkM3RDVCNkM0N0QyXCIsXCIzRjVGQjZEOTMyMjAyNlwiXVxuICAgIC8vIFRoZXJlIGFyZSBkZWZpbml0ZWx5IG1vcmUgZWZmaWNpZW50IHdheXMgdG8gZG8gdGhpcy4uLiBidXQgaXQgZ2V0cyB0aGVcbiAgICAvLyBqb2IgZG9uZS5cbiAgICBjb25zdCBqb2luZWQgPSB2YWx1ZXMuam9pbignJyk7XG4gICAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KGpvaW5lZC5sZW5ndGggLyAyKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGpvaW5lZC5sZW5ndGg7IGkgKz0gMikge1xuICAgICAgICBkYXRhW2kgPj4gMV0gPSBwYXJzZUludChqb2luZWQuc3Vic3RyKGksIDIpLCAxNik7XG4gICAgfVxuICAgIHJldHVybiBkYXRhLmJ1ZmZlcjtcbn1cblxuaW1wb3J0ICogYXMgU2NoZW1hXyBmcm9tICcuLi8uLi9mYi9TY2hlbWEnO1xuaW1wb3J0IFR5cGUgPSBTY2hlbWFfLm9yZy5hcGFjaGUuYXJyb3cuZmxhdGJ1Zi5UeXBlO1xuaW1wb3J0IERhdGVVbml0ID0gU2NoZW1hXy5vcmcuYXBhY2hlLmFycm93LmZsYXRidWYuRGF0ZVVuaXQ7XG5pbXBvcnQgVGltZVVuaXQgPSBTY2hlbWFfLm9yZy5hcGFjaGUuYXJyb3cuZmxhdGJ1Zi5UaW1lVW5pdDtcbmltcG9ydCBQcmVjaXNpb24gPSBTY2hlbWFfLm9yZy5hcGFjaGUuYXJyb3cuZmxhdGJ1Zi5QcmVjaXNpb247XG5pbXBvcnQgSW50ZXJ2YWxVbml0ID0gU2NoZW1hXy5vcmcuYXBhY2hlLmFycm93LmZsYXRidWYuSW50ZXJ2YWxVbml0O1xuaW1wb3J0IE1ldGFkYXRhVmVyc2lvbiA9IFNjaGVtYV8ub3JnLmFwYWNoZS5hcnJvdy5mbGF0YnVmLk1ldGFkYXRhVmVyc2lvbjtcbmltcG9ydCB7IHRvVHlwZWRBcnJheSB9IGZyb20gJy4uLy4uL2RhdGEnO1xuXG5mdW5jdGlvbiBzY2hlbWFGcm9tSlNPTihzOiBhbnkpOiBTY2hlbWEge1xuICAgIGNvbnN0IGRpY3Rpb25hcnlGaWVsZHMgPSBuZXcgTWFwPG51bWJlciwgRmllbGQ8RGljdGlvbmFyeT4+KCk7XG4gICAgcmV0dXJuIG5ldyBTY2hlbWEoXG4gICAgICAgIGZpZWxkc0Zyb21KU09OKHNbJ2ZpZWxkcyddLCBkaWN0aW9uYXJ5RmllbGRzKSxcbiAgICAgICAgY3VzdG9tTWV0YWRhdGEoc1snY3VzdG9tTWV0YWRhdGEnXSksXG4gICAgICAgIE1ldGFkYXRhVmVyc2lvbi5WNCwgZGljdGlvbmFyeUZpZWxkc1xuICAgICk7XG59XG5cbmZ1bmN0aW9uIHJlY29yZEJhdGNoRnJvbUpTT04oYjogYW55KTogUmVjb3JkQmF0Y2hNZXRhZGF0YSB7XG4gICAgcmV0dXJuIG5ldyBSZWNvcmRCYXRjaE1ldGFkYXRhKFxuICAgICAgICBNZXRhZGF0YVZlcnNpb24uVjQsXG4gICAgICAgIGJbJ2NvdW50J10sXG4gICAgICAgIGZpZWxkTm9kZXNGcm9tSlNPTihiWydjb2x1bW5zJ10pLFxuICAgICAgICBidWZmZXJzRnJvbUpTT04oYlsnY29sdW1ucyddKVxuICAgICk7XG59XG5cbmZ1bmN0aW9uIGRpY3Rpb25hcnlCYXRjaEZyb21KU09OKGI6IGFueSk6IERpY3Rpb25hcnlCYXRjaCB7XG4gICAgcmV0dXJuIG5ldyBEaWN0aW9uYXJ5QmF0Y2goXG4gICAgICAgIE1ldGFkYXRhVmVyc2lvbi5WNCxcbiAgICAgICAgcmVjb3JkQmF0Y2hGcm9tSlNPTihiWydkYXRhJ10pLFxuICAgICAgICBiWydpZCddLCBiWydpc0RlbHRhJ11cbiAgICApO1xufVxuXG5mdW5jdGlvbiBmaWVsZHNGcm9tSlNPTihmczogYW55W10sIGRpY3Rpb25hcnlGaWVsZHM6IE1hcDxudW1iZXIsIEZpZWxkPERpY3Rpb25hcnk+PiB8IG51bGwpOiBGaWVsZFtdIHtcbiAgICByZXR1cm4gKGZzIHx8IFtdKVxuICAgICAgICAubWFwKChmKSA9PiBmaWVsZEZyb21KU09OKGYsIGRpY3Rpb25hcnlGaWVsZHMpKVxuICAgICAgICAuZmlsdGVyKChmKSA9PiBmICE9IG51bGwpIGFzIEZpZWxkW107XG59XG5cbmZ1bmN0aW9uIGZpZWxkTm9kZXNGcm9tSlNPTih4czogYW55W10pOiBGaWVsZE1ldGFkYXRhW10ge1xuICAgIHJldHVybiAoeHMgfHwgW10pLnJlZHVjZTxGaWVsZE1ldGFkYXRhW10+KChmaWVsZE5vZGVzLCBjb2x1bW46IGFueSkgPT4gW1xuICAgICAgICAuLi5maWVsZE5vZGVzLFxuICAgICAgICBuZXcgRmllbGRNZXRhZGF0YShcbiAgICAgICAgICAgIG5ldyBMb25nKGNvbHVtblsnY291bnQnXSwgMCksXG4gICAgICAgICAgICBuZXcgTG9uZyhudWxsQ291bnRGcm9tSlNPTihjb2x1bW5bJ1ZBTElESVRZJ10pLCAwKVxuICAgICAgICApLFxuICAgICAgICAuLi5maWVsZE5vZGVzRnJvbUpTT04oY29sdW1uWydjaGlsZHJlbiddKVxuICAgIF0sIFtdIGFzIEZpZWxkTWV0YWRhdGFbXSk7XG59XG5cbmZ1bmN0aW9uIGJ1ZmZlcnNGcm9tSlNPTih4czogYW55W10sIGJ1ZmZlcnM6IEJ1ZmZlck1ldGFkYXRhW10gPSBbXSk6IEJ1ZmZlck1ldGFkYXRhW10ge1xuICAgIGZvciAobGV0IGkgPSAtMSwgbiA9ICh4cyB8fCBbXSkubGVuZ3RoOyArK2kgPCBuOykge1xuICAgICAgICBjb25zdCBjb2x1bW4gPSB4c1tpXTtcbiAgICAgICAgY29sdW1uWydWQUxJRElUWSddICYmIGJ1ZmZlcnMucHVzaChuZXcgQnVmZmVyTWV0YWRhdGEobmV3IExvbmcoYnVmZmVycy5sZW5ndGgsIDApLCBuZXcgTG9uZyhjb2x1bW5bJ1ZBTElESVRZJ10ubGVuZ3RoLCAwKSkpO1xuICAgICAgICBjb2x1bW5bJ09GRlNFVCddICYmIGJ1ZmZlcnMucHVzaChuZXcgQnVmZmVyTWV0YWRhdGEobmV3IExvbmcoYnVmZmVycy5sZW5ndGgsIDApLCBuZXcgTG9uZyhjb2x1bW5bJ09GRlNFVCddLmxlbmd0aCwgMCkpKTtcbiAgICAgICAgY29sdW1uWydEQVRBJ10gJiYgYnVmZmVycy5wdXNoKG5ldyBCdWZmZXJNZXRhZGF0YShuZXcgTG9uZyhidWZmZXJzLmxlbmd0aCwgMCksIG5ldyBMb25nKGNvbHVtblsnREFUQSddLmxlbmd0aCwgMCkpKTtcbiAgICAgICAgYnVmZmVycyA9IGJ1ZmZlcnNGcm9tSlNPTihjb2x1bW5bJ2NoaWxkcmVuJ10sIGJ1ZmZlcnMpO1xuICAgIH1cbiAgICByZXR1cm4gYnVmZmVycztcbn1cblxuZnVuY3Rpb24gbnVsbENvdW50RnJvbUpTT04odmFsaWRpdHk6IG51bWJlcltdKSB7XG4gICAgcmV0dXJuICh2YWxpZGl0eSB8fCBbXSkucmVkdWNlKChzdW0sIHZhbCkgPT4gc3VtICsgKyh2YWwgPT09IDApLCAwKTtcbn1cblxuZnVuY3Rpb24gZmllbGRGcm9tSlNPTihmOiBhbnksIGRpY3Rpb25hcnlGaWVsZHM6IE1hcDxudW1iZXIsIEZpZWxkPERpY3Rpb25hcnk+PiB8IG51bGwpIHtcbiAgICBsZXQgbmFtZSA9IGZbJ25hbWUnXTtcbiAgICBsZXQgZmllbGQ6IEZpZWxkIHwgdm9pZDtcbiAgICBsZXQgbnVsbGFibGUgPSBmWydudWxsYWJsZSddO1xuICAgIGxldCBkYXRhVHlwZTogRGF0YVR5cGU8YW55PiB8IG51bGw7XG4gICAgbGV0IGlkOiBudW1iZXIsIGtleXNNZXRhOiBhbnksIGRpY3RNZXRhOiBhbnk7XG4gICAgbGV0IG1ldGFkYXRhID0gY3VzdG9tTWV0YWRhdGEoZlsnY3VzdG9tTWV0YWRhdGEnXSk7XG4gICAgaWYgKCFkaWN0aW9uYXJ5RmllbGRzIHx8ICEoZGljdE1ldGEgPSBmWydkaWN0aW9uYXJ5J10pKSB7XG4gICAgICAgIGlmIChkYXRhVHlwZSA9IHR5cGVGcm9tSlNPTihmWyd0eXBlJ10sIGZpZWxkc0Zyb21KU09OKGZbJ2NoaWxkcmVuJ10sIGRpY3Rpb25hcnlGaWVsZHMpKSkge1xuICAgICAgICAgICAgZmllbGQgPSBuZXcgRmllbGQobmFtZSwgZGF0YVR5cGUsIG51bGxhYmxlLCBtZXRhZGF0YSk7XG4gICAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGRhdGFUeXBlID0gZGljdGlvbmFyeUZpZWxkcy5oYXMoaWQgPSBkaWN0TWV0YVsnaWQnXSlcbiAgICAgICAgICAgICAgICAgICAgICAgID8gZGljdGlvbmFyeUZpZWxkcy5nZXQoaWQpIS50eXBlLmRpY3Rpb25hcnlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogdHlwZUZyb21KU09OKGZbJ3R5cGUnXSwgZmllbGRzRnJvbUpTT04oZlsnY2hpbGRyZW4nXSwgbnVsbCkpKSB7XG4gICAgICAgIGRhdGFUeXBlID0gbmV3IERpY3Rpb25hcnkoZGF0YVR5cGUsXG4gICAgICAgICAgICAvLyBhIGRpY3Rpb25hcnkgaW5kZXggZGVmYXVsdHMgdG8gc2lnbmVkIDMyIGJpdCBpbnQgaWYgdW5zcGVjaWZpZWRcbiAgICAgICAgICAgIChrZXlzTWV0YSA9IGRpY3RNZXRhWydpbmRleFR5cGUnXSkgPyBpbnRGcm9tSlNPTihrZXlzTWV0YSkhIDogbmV3IEludDMyKCksXG4gICAgICAgICAgICBpZCwgZGljdE1ldGFbJ2lzT3JkZXJlZCddXG4gICAgICAgICk7XG4gICAgICAgIGZpZWxkID0gbmV3IEZpZWxkKG5hbWUsIGRhdGFUeXBlLCBudWxsYWJsZSwgbWV0YWRhdGEpO1xuICAgICAgICBkaWN0aW9uYXJ5RmllbGRzLmhhcyhpZCkgfHwgZGljdGlvbmFyeUZpZWxkcy5zZXQoaWQsIGZpZWxkIGFzIEZpZWxkPERpY3Rpb25hcnk+KTtcbiAgICB9XG4gICAgcmV0dXJuIGZpZWxkIHx8IG51bGw7XG59XG5cbmZ1bmN0aW9uIGN1c3RvbU1ldGFkYXRhKG1ldGFkYXRhPzogYW55KSB7XG4gICAgcmV0dXJuIG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KE9iamVjdC5lbnRyaWVzKG1ldGFkYXRhIHx8IHt9KSk7XG59XG5cbmNvbnN0IG5hbWVzVG9UeXBlTWFwOiB7IFtuOiBzdHJpbmddOiBUeXBlIH0gID0ge1xuICAgICdOT05FJzogVHlwZS5OT05FLFxuICAgICdudWxsJzogVHlwZS5OdWxsLFxuICAgICdpbnQnOiBUeXBlLkludCxcbiAgICAnZmxvYXRpbmdwb2ludCc6IFR5cGUuRmxvYXRpbmdQb2ludCxcbiAgICAnYmluYXJ5JzogVHlwZS5CaW5hcnksXG4gICAgJ2Jvb2wnOiBUeXBlLkJvb2wsXG4gICAgJ3V0ZjgnOiBUeXBlLlV0ZjgsXG4gICAgJ2RlY2ltYWwnOiBUeXBlLkRlY2ltYWwsXG4gICAgJ2RhdGUnOiBUeXBlLkRhdGUsXG4gICAgJ3RpbWUnOiBUeXBlLlRpbWUsXG4gICAgJ3RpbWVzdGFtcCc6IFR5cGUuVGltZXN0YW1wLFxuICAgICdpbnRlcnZhbCc6IFR5cGUuSW50ZXJ2YWwsXG4gICAgJ2xpc3QnOiBUeXBlLkxpc3QsXG4gICAgJ3N0cnVjdCc6IFR5cGUuU3RydWN0XyxcbiAgICAndW5pb24nOiBUeXBlLlVuaW9uLFxuICAgICdmaXhlZHNpemViaW5hcnknOiBUeXBlLkZpeGVkU2l6ZUJpbmFyeSxcbiAgICAnZml4ZWRzaXplbGlzdCc6IFR5cGUuRml4ZWRTaXplTGlzdCxcbiAgICAnbWFwJzogVHlwZS5NYXAsXG59O1xuXG5mdW5jdGlvbiB0eXBlRnJvbUpTT04odDogYW55LCBjaGlsZHJlbj86IEZpZWxkW10pIHtcbiAgICBzd2l0Y2ggKG5hbWVzVG9UeXBlTWFwW3RbJ25hbWUnXV0pIHtcbiAgICAgICAgY2FzZSBUeXBlLk5PTkU6IHJldHVybiBudWxsO1xuICAgICAgICBjYXNlIFR5cGUuTnVsbDogcmV0dXJuIG51bGxGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkludDogcmV0dXJuIGludEZyb21KU09OKHQpO1xuICAgICAgICBjYXNlIFR5cGUuRmxvYXRpbmdQb2ludDogcmV0dXJuIGZsb2F0aW5nUG9pbnRGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkJpbmFyeTogcmV0dXJuIGJpbmFyeUZyb21KU09OKHQpO1xuICAgICAgICBjYXNlIFR5cGUuVXRmODogcmV0dXJuIHV0ZjhGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkJvb2w6IHJldHVybiBib29sRnJvbUpTT04odCk7XG4gICAgICAgIGNhc2UgVHlwZS5EZWNpbWFsOiByZXR1cm4gZGVjaW1hbEZyb21KU09OKHQpO1xuICAgICAgICBjYXNlIFR5cGUuRGF0ZTogcmV0dXJuIGRhdGVGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLlRpbWU6IHJldHVybiB0aW1lRnJvbUpTT04odCk7XG4gICAgICAgIGNhc2UgVHlwZS5UaW1lc3RhbXA6IHJldHVybiB0aW1lc3RhbXBGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkludGVydmFsOiByZXR1cm4gaW50ZXJ2YWxGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkxpc3Q6IHJldHVybiBsaXN0RnJvbUpTT04odCwgY2hpbGRyZW4gfHwgW10pO1xuICAgICAgICBjYXNlIFR5cGUuU3RydWN0XzogcmV0dXJuIHN0cnVjdEZyb21KU09OKHQsIGNoaWxkcmVuIHx8IFtdKTtcbiAgICAgICAgY2FzZSBUeXBlLlVuaW9uOiByZXR1cm4gdW5pb25Gcm9tSlNPTih0LCBjaGlsZHJlbiB8fCBbXSk7XG4gICAgICAgIGNhc2UgVHlwZS5GaXhlZFNpemVCaW5hcnk6IHJldHVybiBmaXhlZFNpemVCaW5hcnlGcm9tSlNPTih0KTtcbiAgICAgICAgY2FzZSBUeXBlLkZpeGVkU2l6ZUxpc3Q6IHJldHVybiBmaXhlZFNpemVMaXN0RnJvbUpTT04odCwgY2hpbGRyZW4gfHwgW10pO1xuICAgICAgICBjYXNlIFR5cGUuTWFwOiByZXR1cm4gbWFwRnJvbUpTT04odCwgY2hpbGRyZW4gfHwgW10pO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVucmVjb2duaXplZCB0eXBlICR7dFsnbmFtZSddfWApO1xufVxuXG5mdW5jdGlvbiBudWxsRnJvbUpTT04gICAgICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyByZXR1cm4gbmV3IE51bGwoKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBpbnRGcm9tSlNPTiAgICAgICAgICAgIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyBzd2l0Y2ggKF90eXBlWydiaXRXaWR0aCddKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAgODogcmV0dXJuIF90eXBlWydpc1NpZ25lZCddID8gbmV3ICBJbnQ4KCkgOiBuZXcgIFVpbnQ4KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxNjogcmV0dXJuIF90eXBlWydpc1NpZ25lZCddID8gbmV3IEludDE2KCkgOiBuZXcgVWludDE2KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzMjogcmV0dXJuIF90eXBlWydpc1NpZ25lZCddID8gbmV3IEludDMyKCkgOiBuZXcgVWludDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA2NDogcmV0dXJuIF90eXBlWydpc1NpZ25lZCddID8gbmV3IEludDY0KCkgOiBuZXcgVWludDY0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5mdW5jdGlvbiBmbG9hdGluZ1BvaW50RnJvbUpTT04gIChfdHlwZTogYW55KSAgICAgICAgICAgICAgICAgICAgeyBzd2l0Y2ggKFByZWNpc2lvbltfdHlwZVsncHJlY2lzaW9uJ11dIGFzIGFueSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUHJlY2lzaW9uLkhBTEY6IHJldHVybiBuZXcgRmxvYXQxNigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgUHJlY2lzaW9uLlNJTkdMRTogcmV0dXJuIG5ldyBGbG9hdDMyKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBQcmVjaXNpb24uRE9VQkxFOiByZXR1cm4gbmV3IEZsb2F0NjQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIGJpbmFyeUZyb21KU09OICAgICAgICAgKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBuZXcgQmluYXJ5KCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIHV0ZjhGcm9tSlNPTiAgICAgICAgICAgKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBuZXcgVXRmOCgpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIGJvb2xGcm9tSlNPTiAgICAgICAgICAgKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBuZXcgQm9vbCgpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIGRlY2ltYWxGcm9tSlNPTiAgICAgICAgKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBuZXcgRGVjaW1hbChfdHlwZVsnc2NhbGUnXSwgX3R5cGVbJ3ByZWNpc2lvbiddKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIGRhdGVGcm9tSlNPTiAgICAgICAgICAgKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBuZXcgRGF0ZV8oRGF0ZVVuaXRbX3R5cGVbJ3VuaXQnXV0gYXMgYW55KTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIHRpbWVGcm9tSlNPTiAgICAgICAgICAgKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBuZXcgVGltZShUaW1lVW5pdFtfdHlwZVsndW5pdCddXSBhcyBhbnksIF90eXBlWydiaXRXaWR0aCddIGFzIFRpbWVCaXRXaWR0aCk7IH1cbmZ1bmN0aW9uIHRpbWVzdGFtcEZyb21KU09OICAgICAgKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBuZXcgVGltZXN0YW1wKFRpbWVVbml0W190eXBlWyd1bml0J11dIGFzIGFueSwgX3R5cGVbJ3RpbWV6b25lJ10pOyAgICAgICAgICAgIH1cbmZ1bmN0aW9uIGludGVydmFsRnJvbUpTT04gICAgICAgKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBuZXcgSW50ZXJ2YWwoSW50ZXJ2YWxVbml0W190eXBlWyd1bml0J11dIGFzIGFueSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIGxpc3RGcm9tSlNPTiAgICAgICAgICAgKF90eXBlOiBhbnksIGNoaWxkcmVuOiBGaWVsZFtdKSB7IHJldHVybiBuZXcgTGlzdChjaGlsZHJlbik7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIHN0cnVjdEZyb21KU09OICAgICAgICAgKF90eXBlOiBhbnksIGNoaWxkcmVuOiBGaWVsZFtdKSB7IHJldHVybiBuZXcgU3RydWN0KGNoaWxkcmVuKTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIHVuaW9uRnJvbUpTT04gICAgICAgICAgKF90eXBlOiBhbnksIGNoaWxkcmVuOiBGaWVsZFtdKSB7IHJldHVybiBuZXcgVW5pb24oX3R5cGVbJ21vZGUnXSwgKF90eXBlWyd0eXBlSWRzQXJyYXknXSB8fCBbXSkgYXMgVHlwZVtdLCBjaGlsZHJlbik7IH1cbmZ1bmN0aW9uIGZpeGVkU2l6ZUJpbmFyeUZyb21KU09OKF90eXBlOiBhbnkpICAgICAgICAgICAgICAgICAgICB7IHJldHVybiBuZXcgRml4ZWRTaXplQmluYXJ5KF90eXBlWydieXRlV2lkdGgnXSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIGZpeGVkU2l6ZUxpc3RGcm9tSlNPTiAgKF90eXBlOiBhbnksIGNoaWxkcmVuOiBGaWVsZFtdKSB7IHJldHVybiBuZXcgRml4ZWRTaXplTGlzdChfdHlwZVsnbGlzdFNpemUnXSwgY2hpbGRyZW4pOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbmZ1bmN0aW9uIG1hcEZyb21KU09OICAgICAgICAgICAgKF90eXBlOiBhbnksIGNoaWxkcmVuOiBGaWVsZFtdKSB7IHJldHVybiBuZXcgTWFwXyhfdHlwZVsna2V5c1NvcnRlZCddLCBjaGlsZHJlbik7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiJdfQ==
