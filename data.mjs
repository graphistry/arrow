// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import { popcnt_bit_range } from './util/bit';
import { toArrayBufferView } from './util/buffer';
import { VectorType as BufferType, UnionMode } from './enum';
/** @ignore */ export const kUnknownNullCount = -1;
/** @ignore */
export class Data {
    constructor(type, offset, length, nullCount, buffers, childData) {
        this._buffers = [];
        this._type = type;
        this._offset = Math.floor(Math.max(offset || 0, 0));
        this._length = Math.floor(Math.max(length || 0, 0));
        this._buffers = Object.assign([], buffers);
        this._nullCount = Math.floor(Math.max(nullCount || 0, -1));
        this._childData = (childData || []).map((x) => x instanceof Data ? x : x.data);
    }
    get type() { return this._type; }
    get length() { return this._length; }
    get offset() { return this._offset; }
    get typeId() { return this._type.typeId; }
    get childData() { return this._childData; }
    get ArrayType() { return this._type.ArrayType; }
    get buffers() { return this._buffers; }
    get values() { return this._buffers[BufferType.DATA]; }
    get typeIds() { return this._buffers[BufferType.TYPE]; }
    get nullBitmap() { return this._buffers[BufferType.VALIDITY]; }
    get valueOffsets() { return this._buffers[BufferType.OFFSET]; }
    get nullCount() {
        let nullCount = this._nullCount;
        let nullBitmap;
        if (nullCount === kUnknownNullCount && (nullBitmap = this._buffers[BufferType.VALIDITY])) {
            this._nullCount = nullCount = this._length - popcnt_bit_range(nullBitmap, this._offset, this._offset + this._length);
        }
        return nullCount;
    }
    clone(type, offset = this._offset, length = this._length, nullCount = this._nullCount, buffers = this._buffers, childData = this._childData) {
        return new Data(type, offset, length, nullCount, buffers, childData);
    }
    slice(offset, length) {
        // +true === 1, +false === 0, so this means
        // we keep nullCount at 0 if it's already 0,
        // otherwise set to the invalidated flag -1
        const nullCount = +(this._nullCount === 0) - 1;
        const buffers = this.sliceBuffers(offset, length);
        const childData = this.sliceChildren(offset, length);
        return this.clone(this._type, this._offset + offset, length, nullCount, buffers, childData);
    }
    sliceBuffers(offset, length) {
        let arr, buffers = Object.assign([], this._buffers);
        // If typeIds exist, slice the typeIds buffer
        (arr = buffers[BufferType.TYPE]) && (buffers[BufferType.TYPE] = this.sliceData(arr, offset, length));
        // If offsets exist, only slice the offsets buffer
        (arr = buffers[BufferType.OFFSET]) && (buffers[BufferType.OFFSET] = this.sliceOffsets(arr, offset, length)) ||
            // Otherwise if no offsets, slice the data buffer
            (arr = buffers[BufferType.DATA]) && (buffers[BufferType.DATA] = this.sliceData(arr, offset, length));
        return buffers;
    }
    sliceChildren(offset, length) {
        // Only slice children if this isn't variable width data
        if (!this._buffers[BufferType.OFFSET]) {
            return this._childData.map((child) => child.slice(offset, length));
        }
        return this._childData;
    }
    sliceData(data, offset, length) {
        // Don't slice the data vector for Booleans, since the offset goes by bits not bytes
        return this._type.typeId === 6 ? data : data.subarray(offset, offset + length);
    }
    sliceOffsets(valueOffsets, offset, length) {
        return valueOffsets.subarray(offset, offset + length + 1);
    }
    //
    // Convenience methods for creating Data instances for each of the Arrow Vector types
    //
    /** @nocollapse */
    static Null(type, offset, length, nullCount, nullBitmap) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap)
        });
    }
    /** @nocollapse */
    static Int(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.DATA]: toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Dictionary(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.DATA]: toArrayBufferView(type.indices.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Float(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.DATA]: toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Bool(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.DATA]: toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Decimal(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.DATA]: toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Date(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.DATA]: toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Time(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.DATA]: toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Timestamp(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.DATA]: toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Interval(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.DATA]: toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static FixedSizeBinary(type, offset, length, nullCount, nullBitmap, data) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.DATA]: toArrayBufferView(type.ArrayType, data)
        });
    }
    /** @nocollapse */
    static Binary(type, offset, length, nullCount, nullBitmap, valueOffsets, data) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.OFFSET]: toArrayBufferView(Int32Array, valueOffsets),
            [BufferType.DATA]: toArrayBufferView(Uint8Array, data)
        });
    }
    /** @nocollapse */
    static Utf8(type, offset, length, nullCount, nullBitmap, valueOffsets, data) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.OFFSET]: toArrayBufferView(Int32Array, valueOffsets),
            [BufferType.DATA]: toArrayBufferView(Uint8Array, data)
        });
    }
    /** @nocollapse */
    static List(type, offset, length, nullCount, nullBitmap, valueOffsets, childData) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.OFFSET]: toArrayBufferView(Int32Array, valueOffsets)
        }, [childData]);
    }
    /** @nocollapse */
    static FixedSizeList(type, offset, length, nullCount, nullBitmap, childData) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap)
        }, [childData]);
    }
    /** @nocollapse */
    static Struct(type, offset, length, nullCount, nullBitmap, childData) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap)
        }, childData);
    }
    /** @nocollapse */
    static Map(type, offset, length, nullCount, nullBitmap, childData) {
        return new Data(type, offset, length, nullCount, {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap)
        }, childData);
    }
    /** @nocollapse */
    static Union(type, offset, length, nullCount, nullBitmap, typeIds, valueOffsetsOrChildData, childData) {
        const buffers = {
            [BufferType.VALIDITY]: toArrayBufferView(Uint8Array, nullBitmap),
            [BufferType.TYPE]: toArrayBufferView(type.ArrayType, typeIds)
        };
        if (type.mode === UnionMode.Sparse) {
            return new Data(type, offset, length, nullCount, buffers, valueOffsetsOrChildData);
        }
        buffers[BufferType.OFFSET] = toArrayBufferView(Int32Array, valueOffsetsOrChildData);
        return new Data(type, offset, length, nullCount, buffers, childData);
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUUsU0FBaUIsRUFBRSxVQUFzQixFQUFFLE9BQXNCLEVBQUUsdUJBQStELEVBQUUsU0FBNkI7UUFDM08sTUFBTSxPQUFPLEdBQUc7WUFDWixDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsRUFBRSxpQkFBaUIsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDO1lBQ2hFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLGlCQUFpQixDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDO1NBQ3pELENBQUM7UUFDVCxJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssU0FBUyxDQUFDLE1BQU0sRUFBRTtZQUNoQyxPQUFPLElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsdUJBQTRDLENBQUMsQ0FBQztTQUMzRztRQUNELE9BQU8sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsaUJBQWlCLENBQUMsVUFBVSxFQUF1Qix1QkFBdUIsQ0FBQyxDQUFDO1FBQ3pHLE9BQU8sSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQztJQUN6RSxDQUFDO0NBQ0oiLCJmaWxlIjoiZGF0YS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBEYXRhVHlwZSB9IGZyb20gJy4vdHlwZSc7XG5pbXBvcnQgeyBWZWN0b3IgfSBmcm9tICcuL3ZlY3Rvcic7XG5pbXBvcnQgeyBwb3BjbnRfYml0X3JhbmdlIH0gZnJvbSAnLi91dGlsL2JpdCc7XG5pbXBvcnQgeyB0b0FycmF5QnVmZmVyVmlldyB9IGZyb20gJy4vdXRpbC9idWZmZXInO1xuaW1wb3J0IHsgVmVjdG9yVHlwZSBhcyBCdWZmZXJUeXBlLCBVbmlvbk1vZGUgfSBmcm9tICcuL2VudW0nO1xuaW1wb3J0IHtcbiAgICBEaWN0aW9uYXJ5LFxuICAgIE51bGwsIEludCwgRmxvYXQsXG4gICAgQmluYXJ5LCBCb29sLCBVdGY4LCBEZWNpbWFsLFxuICAgIERhdGVfLCBUaW1lLCBUaW1lc3RhbXAsIEludGVydmFsLFxuICAgIExpc3QsIFN0cnVjdCwgVW5pb24sIEZpeGVkU2l6ZUJpbmFyeSwgRml4ZWRTaXplTGlzdCwgTWFwXyxcbn0gZnJvbSAnLi90eXBlJztcblxuLy8gV2hlbiBzbGljaW5nLCB3ZSBkbyBub3Qga25vdyB0aGUgbnVsbCBjb3VudCBvZiB0aGUgc2xpY2VkIHJhbmdlIHdpdGhvdXRcbi8vIGRvaW5nIHNvbWUgY29tcHV0YXRpb24uIFRvIGF2b2lkIGRvaW5nIHRoaXMgZWFnZXJseSwgd2Ugc2V0IHRoZSBudWxsIGNvdW50XG4vLyB0byAtMSAoYW55IG5lZ2F0aXZlIG51bWJlciB3aWxsIGRvKS4gV2hlbiBBcnJheTo6bnVsbF9jb3VudCBpcyBjYWxsZWQgdGhlXG4vLyBmaXJzdCB0aW1lLCB0aGUgbnVsbCBjb3VudCB3aWxsIGJlIGNvbXB1dGVkLiBTZWUgQVJST1ctMzNcbi8qKiBAaWdub3JlICovIGV4cG9ydCB0eXBlIGtVbmtub3duTnVsbENvdW50ID0gLTE7XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgY29uc3Qga1Vua25vd25OdWxsQ291bnQgPSAtMTtcblxuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IHR5cGUgTnVsbEJ1ZmZlciA9IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkO1xuLyoqIEBpZ25vcmUgKi8gZXhwb3J0IHR5cGUgVHlwZUlkc0J1ZmZlciA9IEludDhBcnJheSAgfCBBcnJheUxpa2U8bnVtYmVyPiB8IEl0ZXJhYmxlPG51bWJlcj47XG4vKiogQGlnbm9yZSAqLyBleHBvcnQgdHlwZSBWYWx1ZU9mZnNldHNCdWZmZXIgPSBJbnQzMkFycmF5ICB8IEFycmF5TGlrZTxudW1iZXI+IHwgSXRlcmFibGU8bnVtYmVyPjtcbi8qKiBAaWdub3JlICovIGV4cG9ydCB0eXBlIERhdGFCdWZmZXI8VCBleHRlbmRzIERhdGFUeXBlPiA9IFRbJ1RBcnJheSddIHwgQXJyYXlMaWtlPG51bWJlcj4gfCBJdGVyYWJsZTxudW1iZXI+O1xuXG4vKiogQGlnbm9yZSAqL1xuZXhwb3J0IGludGVyZmFjZSBCdWZmZXJzPFQgZXh0ZW5kcyBEYXRhVHlwZT4ge1xuICAgICAgW0J1ZmZlclR5cGUuT0ZGU0VUXT86IEludDMyQXJyYXk7XG4gICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdPzogVFsnVEFycmF5J107XG4gICAgW0J1ZmZlclR5cGUuVkFMSURJVFldPzogVWludDhBcnJheTtcbiAgICAgICAgW0J1ZmZlclR5cGUuVFlQRV0/OiBUWydUQXJyYXknXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEYXRhPFQgZXh0ZW5kcyBEYXRhVHlwZSA9IERhdGFUeXBlPiB7XG4gICAgcmVhZG9ubHkgVFR5cGU6IFRbJ1RUeXBlJ107XG4gICAgcmVhZG9ubHkgVEFycmF5OiBUWydUQXJyYXknXTtcbiAgICByZWFkb25seSBUVmFsdWU6IFRbJ1RWYWx1ZSddO1xufVxuXG4vKiogQGlnbm9yZSAqL1xuZXhwb3J0IGNsYXNzIERhdGE8VCBleHRlbmRzIERhdGFUeXBlID0gRGF0YVR5cGU+IHtcblxuICAgIHByb3RlY3RlZCBfdHlwZTogVDtcbiAgICBwcm90ZWN0ZWQgX2xlbmd0aDogbnVtYmVyO1xuICAgIHByb3RlY3RlZCBfb2Zmc2V0OiBudW1iZXI7XG5cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHJvdGVjdGVkIF9jaGlsZERhdGE6IERhdGFbXTtcbiAgICBwcm90ZWN0ZWQgX2J1ZmZlcnMgPSBbXSBhcyBCdWZmZXJzPFQ+O1xuICAgIHByb3RlY3RlZCBfbnVsbENvdW50OiBudW1iZXIgfCBrVW5rbm93bk51bGxDb3VudDtcblxuICAgIHB1YmxpYyBnZXQgdHlwZSgpIHsgcmV0dXJuIHRoaXMuX3R5cGU7IH1cbiAgICBwdWJsaWMgZ2V0IGxlbmd0aCgpIHsgcmV0dXJuIHRoaXMuX2xlbmd0aDsgfVxuICAgIHB1YmxpYyBnZXQgb2Zmc2V0KCkgeyByZXR1cm4gdGhpcy5fb2Zmc2V0OyB9XG4gICAgcHVibGljIGdldCB0eXBlSWQoKSB7IHJldHVybiB0aGlzLl90eXBlLnR5cGVJZDsgfVxuICAgIHB1YmxpYyBnZXQgY2hpbGREYXRhKCkgeyByZXR1cm4gdGhpcy5fY2hpbGREYXRhOyB9XG5cbiAgICBwdWJsaWMgZ2V0IEFycmF5VHlwZSgpIHsgcmV0dXJuIHRoaXMuX3R5cGUuQXJyYXlUeXBlOyB9XG5cbiAgICBwdWJsaWMgZ2V0IGJ1ZmZlcnMoKSB7IHJldHVybiB0aGlzLl9idWZmZXJzOyB9XG4gICAgcHVibGljIGdldCB2YWx1ZXMoKSB7IHJldHVybiB0aGlzLl9idWZmZXJzW0J1ZmZlclR5cGUuREFUQV0hOyB9XG4gICAgcHVibGljIGdldCB0eXBlSWRzKCkgeyByZXR1cm4gdGhpcy5fYnVmZmVyc1tCdWZmZXJUeXBlLlRZUEVdITsgfVxuICAgIHB1YmxpYyBnZXQgbnVsbEJpdG1hcCgpIHsgcmV0dXJuIHRoaXMuX2J1ZmZlcnNbQnVmZmVyVHlwZS5WQUxJRElUWV0hOyB9XG4gICAgcHVibGljIGdldCB2YWx1ZU9mZnNldHMoKSB7IHJldHVybiB0aGlzLl9idWZmZXJzW0J1ZmZlclR5cGUuT0ZGU0VUXSE7IH1cbiAgICBwdWJsaWMgZ2V0IG51bGxDb3VudCgpIHtcbiAgICAgICAgbGV0IG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudDtcbiAgICAgICAgbGV0IG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChudWxsQ291bnQgPT09IGtVbmtub3duTnVsbENvdW50ICYmIChudWxsQml0bWFwID0gdGhpcy5fYnVmZmVyc1tCdWZmZXJUeXBlLlZBTElESVRZXSkpIHtcbiAgICAgICAgICAgIHRoaXMuX251bGxDb3VudCA9IG51bGxDb3VudCA9IHRoaXMuX2xlbmd0aCAtIHBvcGNudF9iaXRfcmFuZ2UobnVsbEJpdG1hcCwgdGhpcy5fb2Zmc2V0LCB0aGlzLl9vZmZzZXQgKyB0aGlzLl9sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsQ291bnQ7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIsIGJ1ZmZlcnM/OiBCdWZmZXJzPFQ+LCBjaGlsZERhdGE/OiAoRGF0YSB8IFZlY3RvcilbXSkge1xuICAgICAgICB0aGlzLl90eXBlID0gdHlwZTtcbiAgICAgICAgdGhpcy5fb2Zmc2V0ID0gTWF0aC5mbG9vcihNYXRoLm1heChvZmZzZXQgfHwgMCwgMCkpO1xuICAgICAgICB0aGlzLl9sZW5ndGggPSBNYXRoLmZsb29yKE1hdGgubWF4KGxlbmd0aCB8fCAwLCAwKSk7XG4gICAgICAgIHRoaXMuX2J1ZmZlcnMgPSBPYmplY3QuYXNzaWduKFtdLCBidWZmZXJzKSBhcyBCdWZmZXJzPFQ+O1xuICAgICAgICB0aGlzLl9udWxsQ291bnQgPSBNYXRoLmZsb29yKE1hdGgubWF4KG51bGxDb3VudCB8fCAwLCAtMSkpO1xuICAgICAgICB0aGlzLl9jaGlsZERhdGEgPSAoY2hpbGREYXRhIHx8IFtdKS5tYXAoKHgpID0+IHggaW5zdGFuY2VvZiBEYXRhID8geCA6IHguZGF0YSkgYXMgRGF0YVtdO1xuICAgIH1cblxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgRGF0YVR5cGU+KHR5cGU6IFIsIG9mZnNldCA9IHRoaXMuX29mZnNldCwgbGVuZ3RoID0gdGhpcy5fbGVuZ3RoLCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQsIGJ1ZmZlcnM6IEJ1ZmZlcnM8Uj4gPSA8YW55PiB0aGlzLl9idWZmZXJzLCBjaGlsZERhdGE6IChEYXRhIHwgVmVjdG9yKVtdID0gdGhpcy5fY2hpbGREYXRhKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCBidWZmZXJzLCBjaGlsZERhdGEpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzbGljZShvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpOiBEYXRhPFQ+IHtcbiAgICAgICAgLy8gK3RydWUgPT09IDEsICtmYWxzZSA9PT0gMCwgc28gdGhpcyBtZWFuc1xuICAgICAgICAvLyB3ZSBrZWVwIG51bGxDb3VudCBhdCAwIGlmIGl0J3MgYWxyZWFkeSAwLFxuICAgICAgICAvLyBvdGhlcndpc2Ugc2V0IHRvIHRoZSBpbnZhbGlkYXRlZCBmbGFnIC0xXG4gICAgICAgIGNvbnN0IG51bGxDb3VudCA9ICsodGhpcy5fbnVsbENvdW50ID09PSAwKSAtIDE7XG4gICAgICAgIGNvbnN0IGJ1ZmZlcnMgPSB0aGlzLnNsaWNlQnVmZmVycyhvZmZzZXQsIGxlbmd0aCk7XG4gICAgICAgIGNvbnN0IGNoaWxkRGF0YSA9IHRoaXMuc2xpY2VDaGlsZHJlbihvZmZzZXQsIGxlbmd0aCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNsb25lPFQ+KHRoaXMuX3R5cGUsIHRoaXMuX29mZnNldCArIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIGJ1ZmZlcnMsIGNoaWxkRGF0YSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIHNsaWNlQnVmZmVycyhvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpOiBCdWZmZXJzPFQ+IHtcbiAgICAgICAgbGV0IGFycjogYW55LCBidWZmZXJzID0gT2JqZWN0LmFzc2lnbihbXSwgdGhpcy5fYnVmZmVycykgYXMgQnVmZmVyczxUPjtcbiAgICAgICAgLy8gSWYgdHlwZUlkcyBleGlzdCwgc2xpY2UgdGhlIHR5cGVJZHMgYnVmZmVyXG4gICAgICAgIChhcnIgPSBidWZmZXJzW0J1ZmZlclR5cGUuVFlQRV0pICYmIChidWZmZXJzW0J1ZmZlclR5cGUuVFlQRV0gPSB0aGlzLnNsaWNlRGF0YShhcnIsIG9mZnNldCwgbGVuZ3RoKSk7XG4gICAgICAgIC8vIElmIG9mZnNldHMgZXhpc3QsIG9ubHkgc2xpY2UgdGhlIG9mZnNldHMgYnVmZmVyXG4gICAgICAgIChhcnIgPSBidWZmZXJzW0J1ZmZlclR5cGUuT0ZGU0VUXSkgJiYgKGJ1ZmZlcnNbQnVmZmVyVHlwZS5PRkZTRVRdID0gdGhpcy5zbGljZU9mZnNldHMoYXJyLCBvZmZzZXQsIGxlbmd0aCkpIHx8XG4gICAgICAgICAgICAvLyBPdGhlcndpc2UgaWYgbm8gb2Zmc2V0cywgc2xpY2UgdGhlIGRhdGEgYnVmZmVyXG4gICAgICAgICAgICAoYXJyID0gYnVmZmVyc1tCdWZmZXJUeXBlLkRBVEFdKSAmJiAoYnVmZmVyc1tCdWZmZXJUeXBlLkRBVEFdID0gdGhpcy5zbGljZURhdGEoYXJyLCBvZmZzZXQsIGxlbmd0aCkpO1xuICAgICAgICByZXR1cm4gYnVmZmVycztcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgc2xpY2VDaGlsZHJlbihvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpOiBEYXRhW10ge1xuICAgICAgICAvLyBPbmx5IHNsaWNlIGNoaWxkcmVuIGlmIHRoaXMgaXNuJ3QgdmFyaWFibGUgd2lkdGggZGF0YVxuICAgICAgICBpZiAoIXRoaXMuX2J1ZmZlcnNbQnVmZmVyVHlwZS5PRkZTRVRdKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY2hpbGREYXRhLm1hcCgoY2hpbGQpID0+IGNoaWxkLnNsaWNlKG9mZnNldCwgbGVuZ3RoKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkRGF0YTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgc2xpY2VEYXRhKGRhdGE6IFRbJ1RBcnJheSddICYgQXJyYXlCdWZmZXJWaWV3LCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpIHtcbiAgICAgICAgLy8gRG9uJ3Qgc2xpY2UgdGhlIGRhdGEgdmVjdG9yIGZvciBCb29sZWFucywgc2luY2UgdGhlIG9mZnNldCBnb2VzIGJ5IGJpdHMgbm90IGJ5dGVzXG4gICAgICAgIHJldHVybiB0aGlzLl90eXBlLnR5cGVJZCA9PT0gNiA/IGRhdGEgOiBkYXRhLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgc2xpY2VPZmZzZXRzKHZhbHVlT2Zmc2V0czogSW50MzJBcnJheSwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZU9mZnNldHMuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGggKyAxKTtcbiAgICB9XG5cbiAgICAvL1xuICAgIC8vIENvbnZlbmllbmNlIG1ldGhvZHMgZm9yIGNyZWF0aW5nIERhdGEgaW5zdGFuY2VzIGZvciBlYWNoIG9mIHRoZSBBcnJvdyBWZWN0b3IgdHlwZXNcbiAgICAvL1xuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgTnVsbDxUIGV4dGVuZHMgTnVsbD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlcikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBJbnQ8VCBleHRlbmRzIEludD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgRGljdGlvbmFyeTxUIGV4dGVuZHMgRGljdGlvbmFyeT4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldzxUWydUQXJyYXknXT4odHlwZS5pbmRpY2VzLkFycmF5VHlwZSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgRmxvYXQ8VCBleHRlbmRzIEZsb2F0Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBCb29sPFQgZXh0ZW5kcyBCb29sPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBEZWNpbWFsPFQgZXh0ZW5kcyBEZWNpbWFsPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBkYXRhOiBEYXRhQnVmZmVyPFQ+KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCBkYXRhKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBEYXRlPFQgZXh0ZW5kcyBEYXRlXz4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgVGltZTxUIGV4dGVuZHMgVGltZT4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgVGltZXN0YW1wPFQgZXh0ZW5kcyBUaW1lc3RhbXA+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEludGVydmFsPFQgZXh0ZW5kcyBJbnRlcnZhbD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgZGF0YTogRGF0YUJ1ZmZlcjxUPikge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLkRBVEFdOiB0b0FycmF5QnVmZmVyVmlldyh0eXBlLkFycmF5VHlwZSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgRml4ZWRTaXplQmluYXJ5PFQgZXh0ZW5kcyBGaXhlZFNpemVCaW5hcnk+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIGRhdGE6IERhdGFCdWZmZXI8VD4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcodHlwZS5BcnJheVR5cGUsIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIEJpbmFyeTxUIGV4dGVuZHMgQmluYXJ5Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCB2YWx1ZU9mZnNldHM6IFZhbHVlT2Zmc2V0c0J1ZmZlciwgZGF0YTogVWludDhBcnJheSkge1xuICAgICAgICByZXR1cm4gbmV3IERhdGEodHlwZSwgb2Zmc2V0LCBsZW5ndGgsIG51bGxDb3VudCwge1xuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVkFMSURJVFldOiB0b0FycmF5QnVmZmVyVmlldyhVaW50OEFycmF5LCBudWxsQml0bWFwKSxcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLk9GRlNFVF06IHRvQXJyYXlCdWZmZXJWaWV3KEludDMyQXJyYXksIHZhbHVlT2Zmc2V0cyksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5EQVRBXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgZGF0YSlcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgVXRmODxUIGV4dGVuZHMgVXRmOD4odHlwZTogVCwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBudWxsQ291bnQ6IG51bWJlciwgbnVsbEJpdG1hcDogTnVsbEJ1ZmZlciwgdmFsdWVPZmZzZXRzOiBWYWx1ZU9mZnNldHNCdWZmZXIsIGRhdGE6IFVpbnQ4QXJyYXkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5PRkZTRVRdOiB0b0FycmF5QnVmZmVyVmlldyhJbnQzMkFycmF5LCB2YWx1ZU9mZnNldHMpLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuREFUQV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIGRhdGEpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIExpc3Q8VCBleHRlbmRzIExpc3Q+KHR5cGU6IFQsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgbnVsbENvdW50OiBudW1iZXIsIG51bGxCaXRtYXA6IE51bGxCdWZmZXIsIHZhbHVlT2Zmc2V0czogVmFsdWVPZmZzZXRzQnVmZmVyLCBjaGlsZERhdGE6IERhdGEgfCBWZWN0b3IpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcCksXG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5PRkZTRVRdOiB0b0FycmF5QnVmZmVyVmlldyhJbnQzMkFycmF5LCB2YWx1ZU9mZnNldHMpXG4gICAgICAgIH0sIFtjaGlsZERhdGFdKTtcbiAgICB9XG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBGaXhlZFNpemVMaXN0PFQgZXh0ZW5kcyBGaXhlZFNpemVMaXN0Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBjaGlsZERhdGE6IERhdGEgfCBWZWN0b3IpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIHtcbiAgICAgICAgICAgIFtCdWZmZXJUeXBlLlZBTElESVRZXTogdG9BcnJheUJ1ZmZlclZpZXcoVWludDhBcnJheSwgbnVsbEJpdG1hcClcbiAgICAgICAgfSwgW2NoaWxkRGF0YV0pO1xuICAgIH1cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIFN0cnVjdDxUIGV4dGVuZHMgU3RydWN0Pih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBjaGlsZERhdGE6IChEYXRhIHwgVmVjdG9yKVtdKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXG4gICAgICAgIH0sIGNoaWxkRGF0YSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgTWFwPFQgZXh0ZW5kcyBNYXBfPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCBjaGlsZERhdGE6IChEYXRhIHwgVmVjdG9yKVtdKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YSh0eXBlLCBvZmZzZXQsIGxlbmd0aCwgbnVsbENvdW50LCB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApXG4gICAgICAgIH0sIGNoaWxkRGF0YSk7XG4gICAgfVxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgVW5pb248VCBleHRlbmRzIFVuaW9uPih0eXBlOiBULCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIG51bGxDb3VudDogbnVtYmVyLCBudWxsQml0bWFwOiBOdWxsQnVmZmVyLCB0eXBlSWRzOiBUeXBlSWRzQnVmZmVyLCB2YWx1ZU9mZnNldHNPckNoaWxkRGF0YTogVmFsdWVPZmZzZXRzQnVmZmVyIHwgKERhdGEgfCBWZWN0b3IpW10sIGNoaWxkRGF0YT86IChEYXRhIHwgVmVjdG9yKVtdKSB7XG4gICAgICAgIGNvbnN0IGJ1ZmZlcnMgPSB7XG4gICAgICAgICAgICBbQnVmZmVyVHlwZS5WQUxJRElUWV06IHRvQXJyYXlCdWZmZXJWaWV3KFVpbnQ4QXJyYXksIG51bGxCaXRtYXApLFxuICAgICAgICAgICAgW0J1ZmZlclR5cGUuVFlQRV06IHRvQXJyYXlCdWZmZXJWaWV3KHR5cGUuQXJyYXlUeXBlLCB0eXBlSWRzKVxuICAgICAgICB9IGFzIGFueTtcbiAgICAgICAgaWYgKHR5cGUubW9kZSA9PT0gVW5pb25Nb2RlLlNwYXJzZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIGJ1ZmZlcnMsIHZhbHVlT2Zmc2V0c09yQ2hpbGREYXRhIGFzIChEYXRhIHwgVmVjdG9yKVtdKTtcbiAgICAgICAgfVxuICAgICAgICBidWZmZXJzW0J1ZmZlclR5cGUuT0ZGU0VUXSA9IHRvQXJyYXlCdWZmZXJWaWV3KEludDMyQXJyYXksIDxWYWx1ZU9mZnNldHNCdWZmZXI+IHZhbHVlT2Zmc2V0c09yQ2hpbGREYXRhKTtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhKHR5cGUsIG9mZnNldCwgbGVuZ3RoLCBudWxsQ291bnQsIGJ1ZmZlcnMsIGNoaWxkRGF0YSk7XG4gICAgfVxufVxuIl19
