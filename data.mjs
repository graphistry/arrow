// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import { popcnt_bit_range } from './util/bit';
import { VectorType } from './type';
export function toTypedArray(ArrayType, values) {
    if (!ArrayType && ArrayBuffer.isView(values)) {
        return values;
    }
    return values instanceof ArrayType ? values
        : !values || !ArrayBuffer.isView(values) ? ArrayType.from(values || [])
            : new ArrayType(values.buffer, values.byteOffset, values.byteLength / ArrayType.BYTES_PER_ELEMENT);
}
export const kUnknownNullCount = -1;
export class BaseData {
    constructor(type, length, offset, nullCount) {
        this._type = type;
        this._length = Math.floor(Math.max(length || 0, 0));
        this._offset = Math.floor(Math.max(offset || 0, 0));
        this._nullCount = Math.floor(Math.max(nullCount || 0, -1));
    }
    get type() { return this._type; }
    get length() { return this._length; }
    get offset() { return this._offset; }
    get typeId() { return this._type.TType; }
    get childData() { return this._childData; }
    get nullBitmap() { return this[VectorType.VALIDITY]; }
    get nullCount() {
        let nullCount = this._nullCount;
        let nullBitmap;
        if (nullCount === -1 && (nullBitmap = this[VectorType.VALIDITY])) {
            this._nullCount = nullCount = this._length - popcnt_bit_range(nullBitmap, this._offset, this._offset + this._length);
        }
        return nullCount;
    }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new BaseData(type, length, offset, nullCount);
    }
    slice(offset, length) {
        return length <= 0 ? this : this.sliceInternal(this.clone(this._type, length, this._offset + offset, +(this._nullCount === 0) - 1), offset, length);
    }
    sliceInternal(clone, offset, length) {
        let arr;
        // If typeIds exist, slice the typeIds buffer
        (arr = this[VectorType.TYPE]) && (clone[VectorType.TYPE] = this.sliceData(arr, offset, length));
        // If offsets exist, only slice the offsets buffer
        (arr = this[VectorType.OFFSET]) && (clone[VectorType.OFFSET] = this.sliceOffsets(arr, offset, length)) ||
            // Otherwise if no offsets, slice the data buffer
            (arr = this[VectorType.DATA]) && (clone[VectorType.DATA] = this.sliceData(arr, offset, length));
        return clone;
    }
    sliceData(data, offset, length) {
        return data.subarray(offset, offset + length);
    }
    sliceOffsets(valueOffsets, offset, length) {
        return valueOffsets.subarray(offset, offset + length + 1);
    }
}
export class FlatData extends BaseData {
    constructor(type, length, nullBitmap, data, offset, nullCount) {
        super(type, length, offset, nullCount);
        this[VectorType.DATA] = toTypedArray(this.ArrayType, data);
        this[VectorType.VALIDITY] = toTypedArray(Uint8Array, nullBitmap);
    }
    get values() { return this[VectorType.DATA]; }
    get ArrayType() { return this._type.ArrayType; }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new this.constructor(type, length, this[VectorType.VALIDITY], this[VectorType.DATA], offset, nullCount);
    }
}
export class BoolData extends FlatData {
    sliceData(data) { return data; }
}
export class FlatListData extends FlatData {
    constructor(type, length, nullBitmap, valueOffsets, data, offset, nullCount) {
        super(type, length, nullBitmap, data, offset, nullCount);
        this[VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    get values() { return this[VectorType.DATA]; }
    get valueOffsets() { return this[VectorType.OFFSET]; }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new FlatListData(type, length, this[VectorType.VALIDITY], this[VectorType.OFFSET], this[VectorType.DATA], offset, nullCount);
    }
}
export class DictionaryData extends BaseData {
    constructor(type, dictionary, indicies) {
        super(type, indicies.length, indicies._nullCount);
        this._indicies = indicies;
        this._dictionary = dictionary;
    }
    get indicies() { return this._indicies; }
    get dictionary() { return this._dictionary; }
    get length() { return this._indicies.length; }
    get nullCount() { return this._indicies.nullCount; }
    clone(type, length = this._length, offset = this._offset) {
        const data = this._dictionary.data.clone(type.dictionary);
        return new DictionaryData(this._type, this._dictionary.clone(data), this._indicies.slice(offset - this._offset, length));
    }
    sliceInternal(clone, _offset, _length) {
        clone._length = clone._indicies.length;
        clone._nullCount = clone._indicies._nullCount;
        return clone;
    }
}
export class NestedData extends BaseData {
    constructor(type, length, nullBitmap, childData, offset, nullCount) {
        super(type, length, offset, nullCount);
        this._childData = childData;
        this[VectorType.VALIDITY] = toTypedArray(Uint8Array, nullBitmap);
    }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new NestedData(type, length, this[VectorType.VALIDITY], this._childData, offset, nullCount);
    }
    sliceInternal(clone, offset, length) {
        if (!this[VectorType.OFFSET]) {
            clone._childData = this._childData.map((child) => child.slice(offset, length));
        }
        return super.sliceInternal(clone, offset, length);
    }
}
export class SingleNestedData extends NestedData {
    constructor(type, length, nullBitmap, valueChildData, offset, nullCount) {
        super(type, length, nullBitmap, [valueChildData], offset, nullCount);
        this._valuesData = valueChildData;
    }
    get values() { return this._valuesData; }
}
export class ListData extends SingleNestedData {
    constructor(type, length, nullBitmap, valueOffsets, valueChildData, offset, nullCount) {
        super(type, length, nullBitmap, valueChildData, offset, nullCount);
        this[VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    get valueOffsets() { return this[VectorType.OFFSET]; }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new ListData(type, length, this[VectorType.VALIDITY], this[VectorType.OFFSET], this._valuesData, offset, nullCount);
    }
}
export class UnionData extends NestedData {
    constructor(type, length, nullBitmap, typeIds, childData, offset, nullCount) {
        super(type, length, nullBitmap, childData, offset, nullCount);
        this[VectorType.TYPE] = toTypedArray(Int8Array, typeIds);
    }
    get typeIds() { return this[VectorType.TYPE]; }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new UnionData(type, length, this[VectorType.VALIDITY], this[VectorType.TYPE], this._childData, offset, nullCount);
    }
}
export class SparseUnionData extends UnionData {
    constructor(type, length, nullBitmap, typeIds, childData, offset, nullCount) {
        super(type, length, nullBitmap, typeIds, childData, offset, nullCount);
    }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new SparseUnionData(type, length, this[VectorType.VALIDITY], this[VectorType.TYPE], this._childData, offset, nullCount);
    }
}
export class DenseUnionData extends UnionData {
    get valueOffsets() { return this[VectorType.OFFSET]; }
    constructor(type, length, nullBitmap, typeIds, valueOffsets, childData, offset, nullCount) {
        super(type, length, nullBitmap, typeIds, childData, offset, nullCount);
        this[VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new DenseUnionData(type, length, this[VectorType.VALIDITY], this[VectorType.TYPE], this[VectorType.OFFSET], this._childData, offset, nullCount);
    }
}
export class ChunkedData extends BaseData {
    constructor(type, length, childVectors, offset, nullCount, childOffsets) {
        super(type, length, offset, nullCount);
        this._childVectors = childVectors;
        this._childOffsets = childOffsets || ChunkedData.computeOffsets(childVectors);
    }
    get childVectors() { return this._childVectors; }
    get childOffsets() { return this._childOffsets; }
    get childData() {
        return this._childData || (this._childData = this._childVectors.map(({ data }) => data));
    }
    get nullCount() {
        let nullCount = this._nullCount;
        if (nullCount === -1) {
            this._nullCount = nullCount = this._childVectors.reduce((x, c) => x + c.nullCount, 0);
        }
        return nullCount;
    }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new ChunkedData(type, length, this._childVectors.map((vec) => vec.clone(vec.data.clone(type))), offset, nullCount, this._childOffsets);
    }
    sliceInternal(clone, offset, length) {
        const chunks = this._childVectors;
        const offsets = this._childOffsets;
        const chunkSlices = [];
        for (let childIndex = -1, numChildren = chunks.length; ++childIndex < numChildren;) {
            const child = chunks[childIndex];
            const childLength = child.length;
            const childOffset = offsets[childIndex];
            // If the child is to the right of the slice boundary, exclude
            if (childOffset >= offset + length) {
                continue;
            }
            // If the child is to the left of of the slice boundary, exclude
            if (offset >= childOffset + childLength) {
                continue;
            }
            // If the child is between both left and right boundaries, include w/o slicing
            if (childOffset >= offset && (childOffset + childLength) <= offset + length) {
                chunkSlices.push(child);
                continue;
            }
            // If the child overlaps one of the slice boundaries, include that slice
            const begin = Math.max(0, offset - childOffset);
            const end = begin + Math.min(childLength - begin, (offset + length) - childOffset);
            chunkSlices.push(child.slice(begin, end));
        }
        clone._childVectors = chunkSlices;
        clone._childOffsets = ChunkedData.computeOffsets(chunkSlices);
        return clone;
    }
    static computeOffsets(childVectors) {
        const childOffsets = new Uint32Array(childVectors.length + 1);
        for (let index = 0, length = childOffsets.length, childOffset = childOffsets[0] = 0; ++index < length;) {
            childOffsets[index] = (childOffset += childVectors[index - 1].length);
        }
        return childOffsets;
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IHBvcGNudF9iaXRfcmFuZ2UgfSBmcm9tICcuL3V0aWwvYml0JztcbmltcG9ydCB7IFZlY3Rvckxpa2UsIFZlY3RvciB9IGZyb20gJy4vdmVjdG9yJztcbmltcG9ydCB7IFZlY3RvclR5cGUsIFR5cGVkQXJyYXksIFR5cGVkQXJyYXlDb25zdHJ1Y3RvciwgRGljdGlvbmFyeSB9IGZyb20gJy4vdHlwZSc7XG5pbXBvcnQgeyBJbnQsIEJvb2wsIEZsYXRMaXN0VHlwZSwgTGlzdCwgRml4ZWRTaXplTGlzdCwgU3RydWN0LCBNYXBfIH0gZnJvbSAnLi90eXBlJztcbmltcG9ydCB7IERhdGFUeXBlLCBGbGF0VHlwZSwgTGlzdFR5cGUsIE5lc3RlZFR5cGUsIFNpbmdsZU5lc3RlZFR5cGUsIERlbnNlVW5pb24sIFNwYXJzZVVuaW9uIH0gZnJvbSAnLi90eXBlJztcblxuZXhwb3J0IGZ1bmN0aW9uIHRvVHlwZWRBcnJheTxUIGV4dGVuZHMgVHlwZWRBcnJheT4oQXJyYXlUeXBlOiBUeXBlZEFycmF5Q29uc3RydWN0b3I8VD4sIHZhbHVlcz86IFQgfCBBcnJheUxpa2U8bnVtYmVyPiB8IEl0ZXJhYmxlPG51bWJlcj4gfCBudWxsKTogVCB7XG4gICAgaWYgKCFBcnJheVR5cGUgJiYgQXJyYXlCdWZmZXIuaXNWaWV3KHZhbHVlcykpIHsgcmV0dXJuIHZhbHVlczsgfVxuICAgIHJldHVybiB2YWx1ZXMgaW5zdGFuY2VvZiBBcnJheVR5cGUgPyB2YWx1ZXNcbiAgICAgICAgIDogIXZhbHVlcyB8fCAhQXJyYXlCdWZmZXIuaXNWaWV3KHZhbHVlcykgPyBBcnJheVR5cGUuZnJvbSh2YWx1ZXMgfHwgW10pXG4gICAgICAgICA6IG5ldyBBcnJheVR5cGUodmFsdWVzLmJ1ZmZlciwgdmFsdWVzLmJ5dGVPZmZzZXQsIHZhbHVlcy5ieXRlTGVuZ3RoIC8gQXJyYXlUeXBlLkJZVEVTX1BFUl9FTEVNRU5UKTtcbn1cblxuZXhwb3J0IHR5cGUgRGF0YTxUIGV4dGVuZHMgRGF0YVR5cGU+ID0gRGF0YVR5cGVzPFQ+W1RbJ1RUeXBlJ11dICYgQmFzZURhdGE8VD47XG5leHBvcnQgaW50ZXJmYWNlIERhdGFUeXBlczxUIGV4dGVuZHMgRGF0YVR5cGU+IHtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLk5PTkVdKi8gIDA6IEJhc2VEYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgW1R5cGUuTnVsbF0qLyAgMTogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgICAgW1R5cGUuSW50XSovICAyOiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgW1R5cGUuRmxvYXRdKi8gIDM6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICAgIFtUeXBlLkJpbmFyeV0qLyAgNDogRmxhdExpc3REYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgW1R5cGUuVXRmOF0qLyAgNTogRmxhdExpc3REYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgW1R5cGUuQm9vbF0qLyAgNjogQm9vbERhdGE7XG4vKiAgICAgICAgICAgICBbVHlwZS5EZWNpbWFsXSovICA3OiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLkRhdGVdKi8gIDg6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgW1R5cGUuVGltZV0qLyAgOTogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgW1R5cGUuVGltZXN0YW1wXSovIDEwOiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgW1R5cGUuSW50ZXJ2YWxdKi8gMTE6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgW1R5cGUuTGlzdF0qLyAxMjogTGlzdERhdGE8TGlzdDxUPj47XG4vKiAgICAgICAgICAgICAgW1R5cGUuU3RydWN0XSovIDEzOiBOZXN0ZWREYXRhPFN0cnVjdD47XG4vKiAgICAgICAgICAgICAgIFtUeXBlLlVuaW9uXSovIDE0OiBVbmlvbkRhdGE7XG4vKiAgICAgW1R5cGUuRml4ZWRTaXplQmluYXJ5XSovIDE1OiBGbGF0RGF0YTxUPjtcbi8qICAgICAgIFtUeXBlLkZpeGVkU2l6ZUxpc3RdKi8gMTY6IFNpbmdsZU5lc3RlZERhdGE8Rml4ZWRTaXplTGlzdDxUPj47XG4vKiAgICAgICAgICAgICAgICAgW1R5cGUuTWFwXSovIDE3OiBOZXN0ZWREYXRhPE1hcF8+O1xuLyogIFtUeXBlLkRlbnNlVW5pb25dKi8gRGVuc2VVbmlvbjogRGVuc2VVbmlvbkRhdGE7XG4vKltUeXBlLlNwYXJzZVVuaW9uXSovIFNwYXJzZVVuaW9uOiBTcGFyc2VVbmlvbkRhdGE7XG4vKlsgIFR5cGUuRGljdGlvbmFyeV0qLyBEaWN0aW9uYXJ5OiBEaWN0aW9uYXJ5RGF0YTxhbnk+O1xufVxuLy8gV2hlbiBzbGljaW5nLCB3ZSBkbyBub3Qga25vdyB0aGUgbnVsbCBjb3VudCBvZiB0aGUgc2xpY2VkIHJhbmdlIHdpdGhvdXRcbi8vIGRvaW5nIHNvbWUgY29tcHV0YXRpb24uIFRvIGF2b2lkIGRvaW5nIHRoaXMgZWFnZXJseSwgd2Ugc2V0IHRoZSBudWxsIGNvdW50XG4vLyB0byAtMSAoYW55IG5lZ2F0aXZlIG51bWJlciB3aWxsIGRvKS4gV2hlbiBBcnJheTo6bnVsbF9jb3VudCBpcyBjYWxsZWQgdGhlXG4vLyBmaXJzdCB0aW1lLCB0aGUgbnVsbCBjb3VudCB3aWxsIGJlIGNvbXB1dGVkLiBTZWUgQVJST1ctMzNcbmV4cG9ydCB0eXBlIGtVbmtub3duTnVsbENvdW50ID0gLTE7XG5leHBvcnQgY29uc3Qga1Vua25vd25OdWxsQ291bnQgPSAtMTtcblxuZXhwb3J0IGNsYXNzIEJhc2VEYXRhPFQgZXh0ZW5kcyBEYXRhVHlwZSA9IERhdGFUeXBlPiBpbXBsZW1lbnRzIFZlY3Rvckxpa2Uge1xuICAgIHByb3RlY3RlZCBfdHlwZTogVDtcbiAgICBwcm90ZWN0ZWQgX2xlbmd0aDogbnVtYmVyO1xuICAgIHByb3RlY3RlZCBfb2Zmc2V0OiBudW1iZXI7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHByb3RlY3RlZCBfY2hpbGREYXRhOiBEYXRhPGFueT5bXTtcbiAgICBwcm90ZWN0ZWQgX251bGxDb3VudDogbnVtYmVyIHwga1Vua25vd25OdWxsQ291bnQ7XG4gICAgcHJvdGVjdGVkIC8qICBbVmVjdG9yVHlwZS5PRkZTRVRdOiovIDA/OiBJbnQzMkFycmF5O1xuICAgIHByb3RlY3RlZCAvKiAgICBbVmVjdG9yVHlwZS5EQVRBXToqLyAxPzogVFsnVEFycmF5J107XG4gICAgcHJvdGVjdGVkIC8qW1ZlY3RvclR5cGUuVkFMSURJVFldOiovIDI/OiBVaW50OEFycmF5O1xuICAgIHByb3RlY3RlZCAvKiAgICBbVmVjdG9yVHlwZS5UWVBFXToqLyAzPzogSW50OEFycmF5O1xuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICB0aGlzLl90eXBlID0gdHlwZTtcbiAgICAgICAgdGhpcy5fbGVuZ3RoID0gTWF0aC5mbG9vcihNYXRoLm1heChsZW5ndGggfHwgMCwgMCkpO1xuICAgICAgICB0aGlzLl9vZmZzZXQgPSBNYXRoLmZsb29yKE1hdGgubWF4KG9mZnNldCB8fCAwLCAwKSk7XG4gICAgICAgIHRoaXMuX251bGxDb3VudCA9IE1hdGguZmxvb3IoTWF0aC5tYXgobnVsbENvdW50IHx8IDAsIC0xKSk7XG4gICAgfVxuICAgIHB1YmxpYyBnZXQgdHlwZSgpIHsgcmV0dXJuIHRoaXMuX3R5cGU7IH1cbiAgICBwdWJsaWMgZ2V0IGxlbmd0aCgpIHsgcmV0dXJuIHRoaXMuX2xlbmd0aDsgfVxuICAgIHB1YmxpYyBnZXQgb2Zmc2V0KCkgeyByZXR1cm4gdGhpcy5fb2Zmc2V0OyB9XG4gICAgcHVibGljIGdldCB0eXBlSWQoKSB7IHJldHVybiB0aGlzLl90eXBlLlRUeXBlOyB9XG4gICAgcHVibGljIGdldCBjaGlsZERhdGEoKSB7IHJldHVybiB0aGlzLl9jaGlsZERhdGE7IH1cbiAgICBwdWJsaWMgZ2V0IG51bGxCaXRtYXAoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldOyB9XG4gICAgcHVibGljIGdldCBudWxsQ291bnQoKSB7XG4gICAgICAgIGxldCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQ7XG4gICAgICAgIGxldCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgdW5kZWZpbmVkO1xuICAgICAgICBpZiAobnVsbENvdW50ID09PSAtMSAmJiAobnVsbEJpdG1hcCA9IHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0pKSB7XG4gICAgICAgICAgICB0aGlzLl9udWxsQ291bnQgPSBudWxsQ291bnQgPSB0aGlzLl9sZW5ndGggLSBwb3BjbnRfYml0X3JhbmdlKG51bGxCaXRtYXAsIHRoaXMuX29mZnNldCwgdGhpcy5fb2Zmc2V0ICsgdGhpcy5fbGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbENvdW50O1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMuX2xlbmd0aCwgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCYXNlRGF0YSh0eXBlLCBsZW5ndGgsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICB9XG4gICAgcHVibGljIHNsaWNlKG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gbGVuZ3RoIDw9IDAgPyB0aGlzIDogdGhpcy5zbGljZUludGVybmFsKHRoaXMuY2xvbmUoXG4gICAgICAgICAgICB0aGlzLl90eXBlLCBsZW5ndGgsIHRoaXMuX29mZnNldCArIG9mZnNldCwgKyh0aGlzLl9udWxsQ291bnQgPT09IDApIC0gMVxuICAgICAgICApIGFzIGFueSwgb2Zmc2V0LCBsZW5ndGgpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VJbnRlcm5hbChjbG9uZTogdGhpcywgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIGxldCBhcnI6IGFueTtcbiAgICAgICAgLy8gSWYgdHlwZUlkcyBleGlzdCwgc2xpY2UgdGhlIHR5cGVJZHMgYnVmZmVyXG4gICAgICAgIChhcnIgPSB0aGlzW1ZlY3RvclR5cGUuVFlQRV0pICYmIChjbG9uZVtWZWN0b3JUeXBlLlRZUEVdID0gdGhpcy5zbGljZURhdGEoYXJyLCBvZmZzZXQsIGxlbmd0aCkpO1xuICAgICAgICAvLyBJZiBvZmZzZXRzIGV4aXN0LCBvbmx5IHNsaWNlIHRoZSBvZmZzZXRzIGJ1ZmZlclxuICAgICAgICAoYXJyID0gdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0pICYmIChjbG9uZVtWZWN0b3JUeXBlLk9GRlNFVF0gPSB0aGlzLnNsaWNlT2Zmc2V0cyhhcnIsIG9mZnNldCwgbGVuZ3RoKSkgfHxcbiAgICAgICAgICAgIC8vIE90aGVyd2lzZSBpZiBubyBvZmZzZXRzLCBzbGljZSB0aGUgZGF0YSBidWZmZXJcbiAgICAgICAgICAgIChhcnIgPSB0aGlzW1ZlY3RvclR5cGUuREFUQV0pICYmIChjbG9uZVtWZWN0b3JUeXBlLkRBVEFdID0gdGhpcy5zbGljZURhdGEoYXJyLCBvZmZzZXQsIGxlbmd0aCkpO1xuICAgICAgICByZXR1cm4gY2xvbmU7XG4gICAgfVxuICAgIHByb3RlY3RlZCBzbGljZURhdGEoZGF0YTogVFsnVEFycmF5J10gJiBUeXBlZEFycmF5LCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VPZmZzZXRzKHZhbHVlT2Zmc2V0czogSW50MzJBcnJheSwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZU9mZnNldHMuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGggKyAxKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBGbGF0RGF0YTxUIGV4dGVuZHMgRmxhdFR5cGU+IGV4dGVuZHMgQmFzZURhdGE8VD4ge1xuICAgIHB1YmxpYyAvKiAgICBbVmVjdG9yVHlwZS5EQVRBXToqLyAxOiBUWydUQXJyYXknXTtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlcygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5EQVRBXTsgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgZGF0YTogSXRlcmFibGU8bnVtYmVyPiwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5EQVRBXSA9IHRvVHlwZWRBcnJheSh0aGlzLkFycmF5VHlwZSwgZGF0YSk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0gPSB0b1R5cGVkQXJyYXkoVWludDhBcnJheSwgbnVsbEJpdG1hcCk7XG4gICAgfVxuICAgIHB1YmxpYyBnZXQgQXJyYXlUeXBlKCk6IFRbJ0FycmF5VHlwZSddIHsgcmV0dXJuIHRoaXMuX3R5cGUuQXJyYXlUeXBlOyB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBUPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLl9sZW5ndGgsIG9mZnNldCA9IHRoaXMuX29mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgKHRoaXMuY29uc3RydWN0b3IgYXMgYW55KSh0eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXNbVmVjdG9yVHlwZS5EQVRBXSwgb2Zmc2V0LCBudWxsQ291bnQpIGFzIEZsYXREYXRhPFI+O1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEJvb2xEYXRhIGV4dGVuZHMgRmxhdERhdGE8Qm9vbD4ge1xuICAgIHByb3RlY3RlZCBzbGljZURhdGEoZGF0YTogVWludDhBcnJheSkgeyByZXR1cm4gZGF0YTsgfVxufVxuXG5leHBvcnQgY2xhc3MgRmxhdExpc3REYXRhPFQgZXh0ZW5kcyBGbGF0TGlzdFR5cGU+IGV4dGVuZHMgRmxhdERhdGE8VD4ge1xuICAgIHB1YmxpYyAvKiAgW1ZlY3RvclR5cGUuT0ZGU0VUXToqLyAwOiBJbnQzMkFycmF5O1xuICAgIHB1YmxpYyAvKiAgICBbVmVjdG9yVHlwZS5EQVRBXToqLyAxOiBUWydUQXJyYXknXTtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlcygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5EQVRBXTsgfVxuICAgIHB1YmxpYyBnZXQgdmFsdWVPZmZzZXRzKCkgeyByZXR1cm4gdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF07IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHZhbHVlT2Zmc2V0czogSXRlcmFibGU8bnVtYmVyPiwgZGF0YTogVFsnVEFycmF5J10sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgbnVsbEJpdG1hcCwgZGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSA9IHRvVHlwZWRBcnJheShJbnQzMkFycmF5LCB2YWx1ZU9mZnNldHMpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMuX2xlbmd0aCwgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBGbGF0TGlzdERhdGEodHlwZSwgbGVuZ3RoLCB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLCB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSwgdGhpc1tWZWN0b3JUeXBlLkRBVEFdLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGljdGlvbmFyeURhdGE8VCBleHRlbmRzIERhdGFUeXBlPiBleHRlbmRzIEJhc2VEYXRhPERpY3Rpb25hcnk8VD4+IHtcbiAgICBwcm90ZWN0ZWQgX2RpY3Rpb25hcnk6IFZlY3RvcjxUPjtcbiAgICBwcm90ZWN0ZWQgX2luZGljaWVzOiBEYXRhPEludDxhbnk+PjtcbiAgICBwdWJsaWMgZ2V0IGluZGljaWVzKCkgeyByZXR1cm4gdGhpcy5faW5kaWNpZXM7IH1cbiAgICBwdWJsaWMgZ2V0IGRpY3Rpb25hcnkoKSB7IHJldHVybiB0aGlzLl9kaWN0aW9uYXJ5OyB9XG4gICAgY29uc3RydWN0b3IodHlwZTogRGljdGlvbmFyeTxUPiwgZGljdGlvbmFyeTogVmVjdG9yPFQ+LCBpbmRpY2llczogRGF0YTxJbnQ8YW55Pj4pIHtcbiAgICAgICAgc3VwZXIodHlwZSwgaW5kaWNpZXMubGVuZ3RoLCAoaW5kaWNpZXMgYXMgYW55KS5fbnVsbENvdW50KTtcbiAgICAgICAgdGhpcy5faW5kaWNpZXMgPSBpbmRpY2llcztcbiAgICAgICAgdGhpcy5fZGljdGlvbmFyeSA9IGRpY3Rpb25hcnk7XG4gICAgfVxuICAgIHB1YmxpYyBnZXQgbGVuZ3RoKCkgeyByZXR1cm4gdGhpcy5faW5kaWNpZXMubGVuZ3RoOyB9XG4gICAgcHVibGljIGdldCBudWxsQ291bnQoKSB7IHJldHVybiB0aGlzLl9pbmRpY2llcy5udWxsQ291bnQ7IH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIERpY3Rpb25hcnk8VD4+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMuX2xlbmd0aCwgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0KSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLl9kaWN0aW9uYXJ5LmRhdGEuY2xvbmUodHlwZS5kaWN0aW9uYXJ5IGFzIGFueSk7XG4gICAgICAgIHJldHVybiBuZXcgRGljdGlvbmFyeURhdGE8Uj4oXG4gICAgICAgICAgICB0aGlzLl90eXBlIGFzIGFueSxcbiAgICAgICAgICAgIHRoaXMuX2RpY3Rpb25hcnkuY2xvbmUoZGF0YSkgYXMgYW55LFxuICAgICAgICAgICAgdGhpcy5faW5kaWNpZXMuc2xpY2Uob2Zmc2V0IC0gdGhpcy5fb2Zmc2V0LCBsZW5ndGgpXG4gICAgICAgICkgYXMgYW55O1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VJbnRlcm5hbChjbG9uZTogdGhpcywgX29mZnNldDogbnVtYmVyLCBfbGVuZ3RoOiBudW1iZXIpIHtcbiAgICAgICAgY2xvbmUuX2xlbmd0aCA9IGNsb25lLl9pbmRpY2llcy5sZW5ndGg7XG4gICAgICAgIGNsb25lLl9udWxsQ291bnQgPSAoY2xvbmUuX2luZGljaWVzIGFzIGFueSkuX251bGxDb3VudDtcbiAgICAgICAgcmV0dXJuIGNsb25lO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIE5lc3RlZERhdGE8VCBleHRlbmRzIE5lc3RlZFR5cGUgPSBOZXN0ZWRUeXBlPiBleHRlbmRzIEJhc2VEYXRhPFQ+IHtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIGNoaWxkRGF0YTogRGF0YTxhbnk+W10sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzLl9jaGlsZERhdGEgPSBjaGlsZERhdGE7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0gPSB0b1R5cGVkQXJyYXkoVWludDhBcnJheSwgbnVsbEJpdG1hcCk7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgVD4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5fbGVuZ3RoLCBvZmZzZXQgPSB0aGlzLl9vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IE5lc3RlZERhdGE8Uj4odHlwZSwgbGVuZ3RoLCB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLCB0aGlzLl9jaGlsZERhdGEsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNsaWNlSW50ZXJuYWwoY2xvbmU6IHRoaXMsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICBpZiAoIXRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdKSB7XG4gICAgICAgICAgICBjbG9uZS5fY2hpbGREYXRhID0gdGhpcy5fY2hpbGREYXRhLm1hcCgoY2hpbGQpID0+IGNoaWxkLnNsaWNlKG9mZnNldCwgbGVuZ3RoKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1cGVyLnNsaWNlSW50ZXJuYWwoY2xvbmUsIG9mZnNldCwgbGVuZ3RoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTaW5nbGVOZXN0ZWREYXRhPFQgZXh0ZW5kcyBTaW5nbGVOZXN0ZWRUeXBlPiBleHRlbmRzIE5lc3RlZERhdGE8VD4ge1xuICAgIHByb3RlY3RlZCBfdmFsdWVzRGF0YTogRGF0YTxUPjtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlcygpIHsgcmV0dXJuIHRoaXMuX3ZhbHVlc0RhdGE7IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHZhbHVlQ2hpbGREYXRhOiBEYXRhPFQ+LCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIFt2YWx1ZUNoaWxkRGF0YV0sIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpcy5fdmFsdWVzRGF0YSA9IHZhbHVlQ2hpbGREYXRhO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIExpc3REYXRhPFQgZXh0ZW5kcyBMaXN0VHlwZT4gZXh0ZW5kcyBTaW5nbGVOZXN0ZWREYXRhPFQ+IHtcbiAgICBwdWJsaWMgLyogIFtWZWN0b3JUeXBlLk9GRlNFVF06Ki8gMDogSW50MzJBcnJheTtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlT2Zmc2V0cygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdOyB9XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCB2YWx1ZU9mZnNldHM6IEl0ZXJhYmxlPG51bWJlcj4sIHZhbHVlQ2hpbGREYXRhOiBEYXRhPFQ+LCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIHZhbHVlQ2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdID0gdG9UeXBlZEFycmF5KEludDMyQXJyYXksIHZhbHVlT2Zmc2V0cyk7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgVD4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5fbGVuZ3RoLCBvZmZzZXQgPSB0aGlzLl9vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IExpc3REYXRhPFI+KHR5cGUsIGxlbmd0aCwgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSwgdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0sIHRoaXMuX3ZhbHVlc0RhdGEgYXMgYW55LCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgVW5pb25EYXRhPFQgZXh0ZW5kcyAoRGVuc2VVbmlvbiB8IFNwYXJzZVVuaW9uKSA9IGFueT4gZXh0ZW5kcyBOZXN0ZWREYXRhPFQ+IHtcbiAgICBwdWJsaWMgLyogICAgW1ZlY3RvclR5cGUuVFlQRV06Ki8gMzogVFsnVEFycmF5J107XG4gICAgcHVibGljIGdldCB0eXBlSWRzKCkgeyByZXR1cm4gdGhpc1tWZWN0b3JUeXBlLlRZUEVdOyB9XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCB0eXBlSWRzOiBJdGVyYWJsZTxudW1iZXI+LCBjaGlsZERhdGE6IERhdGE8YW55PltdLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIGNoaWxkRGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuVFlQRV0gPSB0b1R5cGVkQXJyYXkoSW50OEFycmF5LCB0eXBlSWRzKTtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBUPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLl9sZW5ndGgsIG9mZnNldCA9IHRoaXMuX29mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgVW5pb25EYXRhPFI+KHR5cGUsIGxlbmd0aCwgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSwgdGhpc1tWZWN0b3JUeXBlLlRZUEVdLCB0aGlzLl9jaGlsZERhdGEsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTcGFyc2VVbmlvbkRhdGEgZXh0ZW5kcyBVbmlvbkRhdGE8U3BhcnNlVW5pb24+IHtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBTcGFyc2VVbmlvbiwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCB0eXBlSWRzOiBJdGVyYWJsZTxudW1iZXI+LCBjaGlsZERhdGE6IERhdGE8YW55PltdLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIHR5cGVJZHMsIGNoaWxkRGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFNwYXJzZVVuaW9uPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLl9sZW5ndGgsIG9mZnNldCA9IHRoaXMuX29mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgU3BhcnNlVW5pb25EYXRhKFxuICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgIGxlbmd0aCxcbiAgICAgICAgICAgIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sXG4gICAgICAgICAgICB0aGlzW1ZlY3RvclR5cGUuVFlQRV0sXG4gICAgICAgICAgICB0aGlzLl9jaGlsZERhdGEsXG4gICAgICAgICAgICBvZmZzZXQsIG51bGxDb3VudFxuICAgICAgICApIGFzIGFueSBhcyBVbmlvbkRhdGE8Uj47XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGVuc2VVbmlvbkRhdGEgZXh0ZW5kcyBVbmlvbkRhdGE8RGVuc2VVbmlvbj4ge1xuICAgIHB1YmxpYyAvKiAgW1ZlY3RvclR5cGUuT0ZGU0VUXToqLyAwOiBJbnQzMkFycmF5O1xuICAgIHB1YmxpYyBnZXQgdmFsdWVPZmZzZXRzKCkgeyByZXR1cm4gdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF07IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBEZW5zZVVuaW9uLCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHR5cGVJZHM6IEl0ZXJhYmxlPG51bWJlcj4sIHZhbHVlT2Zmc2V0czogSXRlcmFibGU8bnVtYmVyPiwgY2hpbGREYXRhOiBEYXRhPGFueT5bXSwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBudWxsQml0bWFwLCB0eXBlSWRzLCBjaGlsZERhdGEsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0gPSB0b1R5cGVkQXJyYXkoSW50MzJBcnJheSwgdmFsdWVPZmZzZXRzKTtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBEZW5zZVVuaW9uPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLl9sZW5ndGgsIG9mZnNldCA9IHRoaXMuX29mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGVuc2VVbmlvbkRhdGEoXG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgbGVuZ3RoLFxuICAgICAgICAgICAgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSxcbiAgICAgICAgICAgIHRoaXNbVmVjdG9yVHlwZS5UWVBFXSxcbiAgICAgICAgICAgIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdLFxuICAgICAgICAgICAgdGhpcy5fY2hpbGREYXRhLFxuICAgICAgICAgICAgb2Zmc2V0LCBudWxsQ291bnRcbiAgICAgICAgKSBhcyBhbnkgYXMgVW5pb25EYXRhPFI+O1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIENodW5rZWREYXRhPFQgZXh0ZW5kcyBEYXRhVHlwZT4gZXh0ZW5kcyBCYXNlRGF0YTxUPiB7XG4gICAgcHJvdGVjdGVkIF9jaGlsZFZlY3RvcnM6IFZlY3RvcjxUPltdO1xuICAgIHByb3RlY3RlZCBfY2hpbGRPZmZzZXRzOiBVaW50MzJBcnJheTtcbiAgICBwdWJsaWMgZ2V0IGNoaWxkVmVjdG9ycygpIHsgcmV0dXJuIHRoaXMuX2NoaWxkVmVjdG9yczsgfVxuICAgIHB1YmxpYyBnZXQgY2hpbGRPZmZzZXRzKCkgeyByZXR1cm4gdGhpcy5fY2hpbGRPZmZzZXRzOyB9XG4gICAgcHVibGljIGdldCBjaGlsZERhdGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jaGlsZERhdGEgfHwgKFxuICAgICAgICAgICAgICAgdGhpcy5fY2hpbGREYXRhID0gdGhpcy5fY2hpbGRWZWN0b3JzLm1hcCgoeyBkYXRhIH0pID0+IGRhdGEpKTtcbiAgICB9XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIGNoaWxkVmVjdG9yczogVmVjdG9yPFQ+W10sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyLCBjaGlsZE9mZnNldHM/OiBVaW50MzJBcnJheSkge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpcy5fY2hpbGRWZWN0b3JzID0gY2hpbGRWZWN0b3JzO1xuICAgICAgICB0aGlzLl9jaGlsZE9mZnNldHMgPSBjaGlsZE9mZnNldHMgfHwgQ2h1bmtlZERhdGEuY29tcHV0ZU9mZnNldHMoY2hpbGRWZWN0b3JzKTtcbiAgICB9XG4gICAgcHVibGljIGdldCBudWxsQ291bnQoKSB7XG4gICAgICAgIGxldCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQ7XG4gICAgICAgIGlmIChudWxsQ291bnQgPT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLl9udWxsQ291bnQgPSBudWxsQ291bnQgPSB0aGlzLl9jaGlsZFZlY3RvcnMucmVkdWNlKCh4LCBjKSA9PiB4ICsgYy5udWxsQ291bnQsIDApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsQ291bnQ7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgVD4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5fbGVuZ3RoLCBvZmZzZXQgPSB0aGlzLl9vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IENodW5rZWREYXRhPFI+KFxuICAgICAgICAgICAgdHlwZSwgbGVuZ3RoLFxuICAgICAgICAgICAgdGhpcy5fY2hpbGRWZWN0b3JzLm1hcCgodmVjKSA9PiB2ZWMuY2xvbmUodmVjLmRhdGEuY2xvbmUodHlwZSkpKSBhcyBhbnksXG4gICAgICAgICAgICBvZmZzZXQsIG51bGxDb3VudCwgdGhpcy5fY2hpbGRPZmZzZXRzXG4gICAgICAgICk7XG4gICAgfVxuICAgIHByb3RlY3RlZCBzbGljZUludGVybmFsKGNsb25lOiB0aGlzLCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgY2h1bmtzID0gdGhpcy5fY2hpbGRWZWN0b3JzO1xuICAgICAgICBjb25zdCBvZmZzZXRzID0gdGhpcy5fY2hpbGRPZmZzZXRzO1xuICAgICAgICBjb25zdCBjaHVua1NsaWNlczogVmVjdG9yPFQ+W10gPSBbXTtcbiAgICAgICAgZm9yIChsZXQgY2hpbGRJbmRleCA9IC0xLCBudW1DaGlsZHJlbiA9IGNodW5rcy5sZW5ndGg7ICsrY2hpbGRJbmRleCA8IG51bUNoaWxkcmVuOykge1xuICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBjaHVua3NbY2hpbGRJbmRleF07XG4gICAgICAgICAgICBjb25zdCBjaGlsZExlbmd0aCA9IGNoaWxkLmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkT2Zmc2V0ID0gb2Zmc2V0c1tjaGlsZEluZGV4XTtcbiAgICAgICAgICAgIC8vIElmIHRoZSBjaGlsZCBpcyB0byB0aGUgcmlnaHQgb2YgdGhlIHNsaWNlIGJvdW5kYXJ5LCBleGNsdWRlXG4gICAgICAgICAgICBpZiAoY2hpbGRPZmZzZXQgPj0gb2Zmc2V0ICsgbGVuZ3RoKSB7IGNvbnRpbnVlOyB9XG4gICAgICAgICAgICAvLyBJZiB0aGUgY2hpbGQgaXMgdG8gdGhlIGxlZnQgb2Ygb2YgdGhlIHNsaWNlIGJvdW5kYXJ5LCBleGNsdWRlXG4gICAgICAgICAgICBpZiAob2Zmc2V0ID49IGNoaWxkT2Zmc2V0ICsgY2hpbGRMZW5ndGgpIHsgY29udGludWU7IH1cbiAgICAgICAgICAgIC8vIElmIHRoZSBjaGlsZCBpcyBiZXR3ZWVuIGJvdGggbGVmdCBhbmQgcmlnaHQgYm91bmRhcmllcywgaW5jbHVkZSB3L28gc2xpY2luZ1xuICAgICAgICAgICAgaWYgKGNoaWxkT2Zmc2V0ID49IG9mZnNldCAmJiAoY2hpbGRPZmZzZXQgKyBjaGlsZExlbmd0aCkgPD0gb2Zmc2V0ICsgbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY2h1bmtTbGljZXMucHVzaChjaGlsZCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiB0aGUgY2hpbGQgb3ZlcmxhcHMgb25lIG9mIHRoZSBzbGljZSBib3VuZGFyaWVzLCBpbmNsdWRlIHRoYXQgc2xpY2VcbiAgICAgICAgICAgIGNvbnN0IGJlZ2luID0gTWF0aC5tYXgoMCwgb2Zmc2V0IC0gY2hpbGRPZmZzZXQpO1xuICAgICAgICAgICAgY29uc3QgZW5kID0gYmVnaW4gKyBNYXRoLm1pbihjaGlsZExlbmd0aCAtIGJlZ2luLCAob2Zmc2V0ICsgbGVuZ3RoKSAtIGNoaWxkT2Zmc2V0KTtcbiAgICAgICAgICAgIGNodW5rU2xpY2VzLnB1c2goY2hpbGQuc2xpY2UoYmVnaW4sIGVuZCkpO1xuICAgICAgICB9XG4gICAgICAgIGNsb25lLl9jaGlsZFZlY3RvcnMgPSBjaHVua1NsaWNlcztcbiAgICAgICAgY2xvbmUuX2NoaWxkT2Zmc2V0cyA9IENodW5rZWREYXRhLmNvbXB1dGVPZmZzZXRzKGNodW5rU2xpY2VzKTtcbiAgICAgICAgcmV0dXJuIGNsb25lO1xuICAgIH1cbiAgICBzdGF0aWMgY29tcHV0ZU9mZnNldHM8VCBleHRlbmRzIERhdGFUeXBlPihjaGlsZFZlY3RvcnM6IFZlY3RvcjxUPltdKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkT2Zmc2V0cyA9IG5ldyBVaW50MzJBcnJheShjaGlsZFZlY3RvcnMubGVuZ3RoICsgMSk7XG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMCwgbGVuZ3RoID0gY2hpbGRPZmZzZXRzLmxlbmd0aCwgY2hpbGRPZmZzZXQgPSBjaGlsZE9mZnNldHNbMF0gPSAwOyArK2luZGV4IDwgbGVuZ3RoOykge1xuICAgICAgICAgICAgY2hpbGRPZmZzZXRzW2luZGV4XSA9IChjaGlsZE9mZnNldCArPSBjaGlsZFZlY3RvcnNbaW5kZXggLSAxXS5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGlsZE9mZnNldHM7XG4gICAgfVxufVxuIl19
