// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import { popcnt_bit_range } from './util/bit';
import { VectorType } from './type';
export function toTypedArray(ArrayType, values) {
    if (!ArrayType && ArrayBuffer.isView(values)) {
        return values;
    }
    return values instanceof ArrayType ? values
        : !values || !ArrayBuffer.isView(values) ? ArrayType.from(values || [])
            : new ArrayType(values.buffer, values.byteOffset, values.byteLength / ArrayType.BYTES_PER_ELEMENT);
}
export const kUnknownNullCount = -1;
export class BaseData {
    constructor(type, length, offset, nullCount) {
        this.type = type;
        this.length = Math.floor(Math.max(length || 0, 0));
        this.offset = Math.floor(Math.max(offset || 0, 0));
        this._nullCount = Math.floor(Math.max(nullCount || 0, -1));
    }
    get typeId() { return this.type.TType; }
    get nullBitmap() { return this[VectorType.VALIDITY]; }
    get nullCount() {
        let nullCount = this._nullCount;
        let nullBitmap;
        if (nullCount === -1 && (nullBitmap = this[VectorType.VALIDITY])) {
            this._nullCount = nullCount = this.length - popcnt_bit_range(nullBitmap, this.offset, this.offset + this.length);
        }
        return nullCount;
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new BaseData(type, length, offset, nullCount);
    }
    slice(offset, length) {
        return length <= 0 ? this : this.sliceInternal(this.clone(this.type, length, this.offset + offset, +(this._nullCount === 0) - 1), offset, length);
    }
    sliceInternal(clone, offset, length) {
        let arr;
        // If typeIds exist, slice the typeIds buffer
        (arr = this[VectorType.TYPE]) && (clone[VectorType.TYPE] = this.sliceData(arr, offset, length));
        // If offsets exist, only slice the offsets buffer
        (arr = this[VectorType.OFFSET]) && (clone[VectorType.OFFSET] = this.sliceOffsets(arr, offset, length)) ||
            // Otherwise if no offsets, slice the data buffer
            (arr = this[VectorType.DATA]) && (clone[VectorType.DATA] = this.sliceData(arr, offset, length));
        return clone;
    }
    sliceData(data, offset, length) {
        return data.subarray(offset, offset + length);
    }
    sliceOffsets(valueOffsets, offset, length) {
        return valueOffsets.subarray(offset, offset + length + 1);
    }
}
export class FlatData extends BaseData {
    constructor(type, length, nullBitmap, data, offset, nullCount) {
        super(type, length, offset, nullCount);
        this[VectorType.DATA] = toTypedArray(this.ArrayType, data);
        this[VectorType.VALIDITY] = toTypedArray(Uint8Array, nullBitmap);
    }
    get values() { return this[VectorType.DATA]; }
    get ArrayType() { return this.type.ArrayType; }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new this.constructor(type, length, this[VectorType.VALIDITY], this[VectorType.DATA], offset, nullCount);
    }
}
export class BoolData extends FlatData {
    sliceData(data) { return data; }
}
export class FlatListData extends FlatData {
    constructor(type, length, nullBitmap, valueOffsets, data, offset, nullCount) {
        super(type, length, nullBitmap, data, offset, nullCount);
        this[VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    get values() { return this[VectorType.DATA]; }
    get valueOffsets() { return this[VectorType.OFFSET]; }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new FlatListData(type, length, this[VectorType.VALIDITY], this[VectorType.OFFSET], this[VectorType.DATA], offset, nullCount);
    }
}
export class DictionaryData extends BaseData {
    constructor(type, dictionary, indicies) {
        super(type, indicies.length, indicies._nullCount);
        this._indicies = indicies;
        this._dictionary = dictionary;
        this.length = this._indicies.length;
    }
    get indicies() { return this._indicies; }
    get dictionary() { return this._dictionary; }
    get nullCount() { return this._indicies.nullCount; }
    clone(type, length = this.length, offset = this.offset) {
        const data = this._dictionary.data.clone(type.dictionary);
        return new DictionaryData(this.type, this._dictionary.clone(data), this._indicies.slice(offset - this.offset, length));
    }
    sliceInternal(clone, _offset, _length) {
        clone.length = clone._indicies.length;
        clone._nullCount = clone._indicies._nullCount;
        return clone;
    }
}
export class NestedData extends BaseData {
    constructor(type, length, nullBitmap, childData, offset, nullCount) {
        super(type, length, offset, nullCount);
        this.childData = childData;
        this[VectorType.VALIDITY] = toTypedArray(Uint8Array, nullBitmap);
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new NestedData(type, length, this[VectorType.VALIDITY], this.childData, offset, nullCount);
    }
    sliceInternal(clone, offset, length) {
        if (!this[VectorType.OFFSET]) {
            clone.childData = this.childData.map((child) => child.slice(offset, length));
        }
        return super.sliceInternal(clone, offset, length);
    }
}
export class SingleNestedData extends NestedData {
    constructor(type, length, nullBitmap, valueChildData, offset, nullCount) {
        super(type, length, nullBitmap, [valueChildData], offset, nullCount);
        this._valuesData = valueChildData;
    }
    get values() { return this._valuesData; }
}
export class ListData extends SingleNestedData {
    constructor(type, length, nullBitmap, valueOffsets, valueChildData, offset, nullCount) {
        super(type, length, nullBitmap, valueChildData, offset, nullCount);
        this[VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    get valueOffsets() { return this[VectorType.OFFSET]; }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new ListData(type, length, this[VectorType.VALIDITY], this[VectorType.OFFSET], this._valuesData, offset, nullCount);
    }
}
export class UnionData extends NestedData {
    constructor(type, length, nullBitmap, typeIds, childData, offset, nullCount) {
        super(type, length, nullBitmap, childData, offset, nullCount);
        this[VectorType.TYPE] = toTypedArray(Int8Array, typeIds);
    }
    get typeIds() { return this[VectorType.TYPE]; }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new UnionData(type, length, this[VectorType.VALIDITY], this[VectorType.TYPE], this.childData, offset, nullCount);
    }
}
export class SparseUnionData extends UnionData {
    constructor(type, length, nullBitmap, typeIds, childData, offset, nullCount) {
        super(type, length, nullBitmap, typeIds, childData, offset, nullCount);
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new SparseUnionData(type, length, this[VectorType.VALIDITY], this[VectorType.TYPE], this.childData, offset, nullCount);
    }
}
export class DenseUnionData extends UnionData {
    get valueOffsets() { return this[VectorType.OFFSET]; }
    constructor(type, length, nullBitmap, typeIds, valueOffsets, childData, offset, nullCount) {
        super(type, length, nullBitmap, typeIds, childData, offset, nullCount);
        this[VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new DenseUnionData(type, length, this[VectorType.VALIDITY], this[VectorType.TYPE], this[VectorType.OFFSET], this.childData, offset, nullCount);
    }
}
export class ChunkedData extends BaseData {
    constructor(type, length, chunkVectors, offset, nullCount, chunkOffsets) {
        super(type, length, offset, nullCount);
        this._chunkVectors = chunkVectors;
        this._chunkOffsets = chunkOffsets || ChunkedData.computeOffsets(chunkVectors);
    }
    get chunkVectors() { return this._chunkVectors; }
    get chunkOffsets() { return this._chunkOffsets; }
    get chunkData() {
        return this._chunkData || (this._chunkData = this._chunkVectors.map(({ data }) => data));
    }
    get nullCount() {
        let nullCount = this._nullCount;
        if (nullCount === -1) {
            this._nullCount = nullCount = this._chunkVectors.reduce((x, c) => x + c.nullCount, 0);
        }
        return nullCount;
    }
    clone(type, length = this.length, offset = this.offset, nullCount = this._nullCount) {
        return new ChunkedData(type, length, this._chunkVectors.map((vec) => vec.clone(vec.data.clone(type))), offset, nullCount, this._chunkOffsets);
    }
    sliceInternal(clone, offset, length) {
        const chunks = this._chunkVectors;
        const offsets = this._chunkOffsets;
        const chunkSlices = [];
        for (let childIndex = -1, numChildren = chunks.length; ++childIndex < numChildren;) {
            const child = chunks[childIndex];
            const childLength = child.length;
            const childOffset = offsets[childIndex];
            // If the child is to the right of the slice boundary, exclude
            if (childOffset >= offset + length) {
                continue;
            }
            // If the child is to the left of of the slice boundary, exclude
            if (offset >= childOffset + childLength) {
                continue;
            }
            // If the child is between both left and right boundaries, include w/o slicing
            if (childOffset >= offset && (childOffset + childLength) <= offset + length) {
                chunkSlices.push(child);
                continue;
            }
            // If the child overlaps one of the slice boundaries, include that slice
            const begin = Math.max(0, offset - childOffset);
            const end = begin + Math.min(childLength - begin, (offset + length) - childOffset);
            chunkSlices.push(child.slice(begin, end));
        }
        clone._chunkVectors = chunkSlices;
        clone._chunkOffsets = ChunkedData.computeOffsets(chunkSlices);
        return clone;
    }
    static computeOffsets(childVectors) {
        const childOffsets = new Uint32Array(childVectors.length + 1);
        for (let index = 0, length = childOffsets.length, childOffset = childOffsets[0] = 0; ++index < length;) {
            childOffsets[index] = (childOffset += childVectors[index - 1].length);
        }
        return childOffsets;
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUssRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzlDLENBQUM7UUFDRCxLQUFLLENBQUMsYUFBYSxHQUFHLFdBQVcsQ0FBQztRQUNsQyxLQUFLLENBQUMsYUFBYSxHQUFHLFdBQVcsQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDOUQsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNqQixDQUFDO0lBQ0QsTUFBTSxDQUFDLGNBQWMsQ0FBcUIsWUFBeUI7UUFDL0QsTUFBTSxZQUFZLEdBQUcsSUFBSSxXQUFXLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM5RCxHQUFHLENBQUMsQ0FBQyxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUUsTUFBTSxHQUFHLFlBQVksQ0FBQyxNQUFNLEVBQUUsV0FBVyxHQUFHLFlBQVksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxLQUFLLEdBQUcsTUFBTSxHQUFHLENBQUM7WUFDckcsWUFBWSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsV0FBVyxJQUFJLFlBQVksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUUsQ0FBQztRQUNELE1BQU0sQ0FBQyxZQUFZLENBQUM7SUFDeEIsQ0FBQztDQUNKIiwiZmlsZSI6ImRhdGEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4vLyBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbi8vIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4vLyByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4vLyB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4vLyBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Vcbi8vIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbi8vIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4vLyBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuLy8gS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4vLyBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4vLyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgcG9wY250X2JpdF9yYW5nZSB9IGZyb20gJy4vdXRpbC9iaXQnO1xuaW1wb3J0IHsgVmVjdG9yTGlrZSwgVmVjdG9yIH0gZnJvbSAnLi92ZWN0b3InO1xuaW1wb3J0IHsgVmVjdG9yVHlwZSwgVHlwZWRBcnJheSwgVHlwZWRBcnJheUNvbnN0cnVjdG9yLCBEaWN0aW9uYXJ5IH0gZnJvbSAnLi90eXBlJztcbmltcG9ydCB7IEludCwgQm9vbCwgRmxhdExpc3RUeXBlLCBMaXN0LCBGaXhlZFNpemVMaXN0LCBTdHJ1Y3QsIE1hcF8gfSBmcm9tICcuL3R5cGUnO1xuaW1wb3J0IHsgRGF0YVR5cGUsIEZsYXRUeXBlLCBMaXN0VHlwZSwgTmVzdGVkVHlwZSwgU2luZ2xlTmVzdGVkVHlwZSwgRGVuc2VVbmlvbiwgU3BhcnNlVW5pb24gfSBmcm9tICcuL3R5cGUnO1xuXG5leHBvcnQgZnVuY3Rpb24gdG9UeXBlZEFycmF5PFQgZXh0ZW5kcyBUeXBlZEFycmF5PihBcnJheVR5cGU6IFR5cGVkQXJyYXlDb25zdHJ1Y3RvcjxUPiwgdmFsdWVzPzogVCB8IEFycmF5TGlrZTxudW1iZXI+IHwgSXRlcmFibGU8bnVtYmVyPiB8IG51bGwpOiBUIHtcbiAgICBpZiAoIUFycmF5VHlwZSAmJiBBcnJheUJ1ZmZlci5pc1ZpZXcodmFsdWVzKSkgeyByZXR1cm4gdmFsdWVzOyB9XG4gICAgcmV0dXJuIHZhbHVlcyBpbnN0YW5jZW9mIEFycmF5VHlwZSA/IHZhbHVlc1xuICAgICAgICAgOiAhdmFsdWVzIHx8ICFBcnJheUJ1ZmZlci5pc1ZpZXcodmFsdWVzKSA/IEFycmF5VHlwZS5mcm9tKHZhbHVlcyB8fCBbXSlcbiAgICAgICAgIDogbmV3IEFycmF5VHlwZSh2YWx1ZXMuYnVmZmVyLCB2YWx1ZXMuYnl0ZU9mZnNldCwgdmFsdWVzLmJ5dGVMZW5ndGggLyBBcnJheVR5cGUuQllURVNfUEVSX0VMRU1FTlQpO1xufVxuXG5leHBvcnQgdHlwZSBEYXRhPFQgZXh0ZW5kcyBEYXRhVHlwZT4gPSBEYXRhVHlwZXM8VD5bVFsnVFR5cGUnXV0gJiBCYXNlRGF0YTxUPjtcbmV4cG9ydCBpbnRlcmZhY2UgRGF0YVR5cGVzPFQgZXh0ZW5kcyBEYXRhVHlwZT4ge1xuLyogICAgICAgICAgICAgICAgW1R5cGUuTk9ORV0qLyAgMDogQmFzZURhdGE8VD47XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5OdWxsXSovICAxOiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgICBbVHlwZS5JbnRdKi8gIDI6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICAgICBbVHlwZS5GbG9hdF0qLyAgMzogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgW1R5cGUuQmluYXJ5XSovICA0OiBGbGF0TGlzdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5VdGY4XSovICA1OiBGbGF0TGlzdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5Cb29sXSovICA2OiBCb29sRGF0YTtcbi8qICAgICAgICAgICAgIFtUeXBlLkRlY2ltYWxdKi8gIDc6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgW1R5cGUuRGF0ZV0qLyAgODogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5UaW1lXSovICA5OiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICBbVHlwZS5UaW1lc3RhbXBdKi8gMTA6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICBbVHlwZS5JbnRlcnZhbF0qLyAxMTogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5MaXN0XSovIDEyOiBMaXN0RGF0YTxMaXN0PFQ+Pjtcbi8qICAgICAgICAgICAgICBbVHlwZS5TdHJ1Y3RdKi8gMTM6IE5lc3RlZERhdGE8U3RydWN0Pjtcbi8qICAgICAgICAgICAgICAgW1R5cGUuVW5pb25dKi8gMTQ6IFVuaW9uRGF0YTtcbi8qICAgICBbVHlwZS5GaXhlZFNpemVCaW5hcnldKi8gMTU6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgW1R5cGUuRml4ZWRTaXplTGlzdF0qLyAxNjogU2luZ2xlTmVzdGVkRGF0YTxGaXhlZFNpemVMaXN0PFQ+Pjtcbi8qICAgICAgICAgICAgICAgICBbVHlwZS5NYXBdKi8gMTc6IE5lc3RlZERhdGE8TWFwXz47XG4vKiAgW1R5cGUuRGVuc2VVbmlvbl0qLyBEZW5zZVVuaW9uOiBEZW5zZVVuaW9uRGF0YTtcbi8qW1R5cGUuU3BhcnNlVW5pb25dKi8gU3BhcnNlVW5pb246IFNwYXJzZVVuaW9uRGF0YTtcbi8qWyAgVHlwZS5EaWN0aW9uYXJ5XSovIERpY3Rpb25hcnk6IERpY3Rpb25hcnlEYXRhPGFueT47XG59XG4vLyBXaGVuIHNsaWNpbmcsIHdlIGRvIG5vdCBrbm93IHRoZSBudWxsIGNvdW50IG9mIHRoZSBzbGljZWQgcmFuZ2Ugd2l0aG91dFxuLy8gZG9pbmcgc29tZSBjb21wdXRhdGlvbi4gVG8gYXZvaWQgZG9pbmcgdGhpcyBlYWdlcmx5LCB3ZSBzZXQgdGhlIG51bGwgY291bnRcbi8vIHRvIC0xIChhbnkgbmVnYXRpdmUgbnVtYmVyIHdpbGwgZG8pLiBXaGVuIEFycmF5OjpudWxsX2NvdW50IGlzIGNhbGxlZCB0aGVcbi8vIGZpcnN0IHRpbWUsIHRoZSBudWxsIGNvdW50IHdpbGwgYmUgY29tcHV0ZWQuIFNlZSBBUlJPVy0zM1xuZXhwb3J0IHR5cGUga1Vua25vd25OdWxsQ291bnQgPSAtMTtcbmV4cG9ydCBjb25zdCBrVW5rbm93bk51bGxDb3VudCA9IC0xO1xuXG5leHBvcnQgY2xhc3MgQmFzZURhdGE8VCBleHRlbmRzIERhdGFUeXBlID0gRGF0YVR5cGU+IGltcGxlbWVudHMgVmVjdG9yTGlrZSB7XG4gICAgcHVibGljIHR5cGU6IFQ7XG4gICAgcHVibGljIGxlbmd0aDogbnVtYmVyO1xuICAgIHB1YmxpYyBvZmZzZXQ6IG51bWJlcjtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHVibGljIGNoaWxkRGF0YTogRGF0YTxhbnk+W107XG4gICAgcHJvdGVjdGVkIF9udWxsQ291bnQ6IG51bWJlciB8IGtVbmtub3duTnVsbENvdW50O1xuICAgIHByb3RlY3RlZCAvKiAgW1ZlY3RvclR5cGUuT0ZGU0VUXToqLyAwPzogSW50MzJBcnJheTtcbiAgICBwcm90ZWN0ZWQgLyogICAgW1ZlY3RvclR5cGUuREFUQV06Ki8gMT86IFRbJ1RBcnJheSddO1xuICAgIHByb3RlY3RlZCAvKltWZWN0b3JUeXBlLlZBTElESVRZXToqLyAyPzogVWludDhBcnJheTtcbiAgICBwcm90ZWN0ZWQgLyogICAgW1ZlY3RvclR5cGUuVFlQRV06Ki8gMz86IEludDhBcnJheTtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgdGhpcy5sZW5ndGggPSBNYXRoLmZsb29yKE1hdGgubWF4KGxlbmd0aCB8fCAwLCAwKSk7XG4gICAgICAgIHRoaXMub2Zmc2V0ID0gTWF0aC5mbG9vcihNYXRoLm1heChvZmZzZXQgfHwgMCwgMCkpO1xuICAgICAgICB0aGlzLl9udWxsQ291bnQgPSBNYXRoLmZsb29yKE1hdGgubWF4KG51bGxDb3VudCB8fCAwLCAtMSkpO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IHR5cGVJZCgpIHsgcmV0dXJuIHRoaXMudHlwZS5UVHlwZTsgfVxuICAgIHB1YmxpYyBnZXQgbnVsbEJpdG1hcCgpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV07IH1cbiAgICBwdWJsaWMgZ2V0IG51bGxDb3VudCgpIHtcbiAgICAgICAgbGV0IG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudDtcbiAgICAgICAgbGV0IG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChudWxsQ291bnQgPT09IC0xICYmIChudWxsQml0bWFwID0gdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSkpIHtcbiAgICAgICAgICAgIHRoaXMuX251bGxDb3VudCA9IG51bGxDb3VudCA9IHRoaXMubGVuZ3RoIC0gcG9wY250X2JpdF9yYW5nZShudWxsQml0bWFwLCB0aGlzLm9mZnNldCwgdGhpcy5vZmZzZXQgKyB0aGlzLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGxDb3VudDtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBUPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLmxlbmd0aCwgb2Zmc2V0ID0gdGhpcy5vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IEJhc2VEYXRhKHR5cGUsIGxlbmd0aCwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgIH1cbiAgICBwdWJsaWMgc2xpY2Uob2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiBsZW5ndGggPD0gMCA/IHRoaXMgOiB0aGlzLnNsaWNlSW50ZXJuYWwodGhpcy5jbG9uZShcbiAgICAgICAgICAgIHRoaXMudHlwZSwgbGVuZ3RoLCB0aGlzLm9mZnNldCArIG9mZnNldCwgKyh0aGlzLl9udWxsQ291bnQgPT09IDApIC0gMVxuICAgICAgICApIGFzIGFueSwgb2Zmc2V0LCBsZW5ndGgpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VJbnRlcm5hbChjbG9uZTogdGhpcywgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIGxldCBhcnI6IGFueTtcbiAgICAgICAgLy8gSWYgdHlwZUlkcyBleGlzdCwgc2xpY2UgdGhlIHR5cGVJZHMgYnVmZmVyXG4gICAgICAgIChhcnIgPSB0aGlzW1ZlY3RvclR5cGUuVFlQRV0pICYmIChjbG9uZVtWZWN0b3JUeXBlLlRZUEVdID0gdGhpcy5zbGljZURhdGEoYXJyLCBvZmZzZXQsIGxlbmd0aCkpO1xuICAgICAgICAvLyBJZiBvZmZzZXRzIGV4aXN0LCBvbmx5IHNsaWNlIHRoZSBvZmZzZXRzIGJ1ZmZlclxuICAgICAgICAoYXJyID0gdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0pICYmIChjbG9uZVtWZWN0b3JUeXBlLk9GRlNFVF0gPSB0aGlzLnNsaWNlT2Zmc2V0cyhhcnIsIG9mZnNldCwgbGVuZ3RoKSkgfHxcbiAgICAgICAgICAgIC8vIE90aGVyd2lzZSBpZiBubyBvZmZzZXRzLCBzbGljZSB0aGUgZGF0YSBidWZmZXJcbiAgICAgICAgICAgIChhcnIgPSB0aGlzW1ZlY3RvclR5cGUuREFUQV0pICYmIChjbG9uZVtWZWN0b3JUeXBlLkRBVEFdID0gdGhpcy5zbGljZURhdGEoYXJyLCBvZmZzZXQsIGxlbmd0aCkpO1xuICAgICAgICByZXR1cm4gY2xvbmU7XG4gICAgfVxuICAgIHByb3RlY3RlZCBzbGljZURhdGEoZGF0YTogVFsnVEFycmF5J10gJiBUeXBlZEFycmF5LCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VPZmZzZXRzKHZhbHVlT2Zmc2V0czogSW50MzJBcnJheSwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZU9mZnNldHMuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGggKyAxKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBGbGF0RGF0YTxUIGV4dGVuZHMgRmxhdFR5cGU+IGV4dGVuZHMgQmFzZURhdGE8VD4ge1xuICAgIHB1YmxpYyAvKiAgICBbVmVjdG9yVHlwZS5EQVRBXToqLyAxOiBUWydUQXJyYXknXTtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlcygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5EQVRBXTsgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgZGF0YTogSXRlcmFibGU8bnVtYmVyPiwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5EQVRBXSA9IHRvVHlwZWRBcnJheSh0aGlzLkFycmF5VHlwZSwgZGF0YSk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0gPSB0b1R5cGVkQXJyYXkoVWludDhBcnJheSwgbnVsbEJpdG1hcCk7XG4gICAgfVxuICAgIHB1YmxpYyBnZXQgQXJyYXlUeXBlKCk6IFRbJ0FycmF5VHlwZSddIHsgcmV0dXJuIHRoaXMudHlwZS5BcnJheVR5cGU7IH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBvZmZzZXQgPSB0aGlzLm9mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgKHRoaXMuY29uc3RydWN0b3IgYXMgYW55KSh0eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXNbVmVjdG9yVHlwZS5EQVRBXSwgb2Zmc2V0LCBudWxsQ291bnQpIGFzIEZsYXREYXRhPFI+O1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEJvb2xEYXRhIGV4dGVuZHMgRmxhdERhdGE8Qm9vbD4ge1xuICAgIHByb3RlY3RlZCBzbGljZURhdGEoZGF0YTogVWludDhBcnJheSkgeyByZXR1cm4gZGF0YTsgfVxufVxuXG5leHBvcnQgY2xhc3MgRmxhdExpc3REYXRhPFQgZXh0ZW5kcyBGbGF0TGlzdFR5cGU+IGV4dGVuZHMgRmxhdERhdGE8VD4ge1xuICAgIHB1YmxpYyAvKiAgW1ZlY3RvclR5cGUuT0ZGU0VUXToqLyAwOiBJbnQzMkFycmF5O1xuICAgIHB1YmxpYyAvKiAgICBbVmVjdG9yVHlwZS5EQVRBXToqLyAxOiBUWydUQXJyYXknXTtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBwdWJsaWMgZ2V0IHZhbHVlcygpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5EQVRBXTsgfVxuICAgIHB1YmxpYyBnZXQgdmFsdWVPZmZzZXRzKCkgeyByZXR1cm4gdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF07IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHZhbHVlT2Zmc2V0czogSXRlcmFibGU8bnVtYmVyPiwgZGF0YTogVFsnVEFycmF5J10sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgbnVsbEJpdG1hcCwgZGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSA9IHRvVHlwZWRBcnJheShJbnQzMkFycmF5LCB2YWx1ZU9mZnNldHMpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBvZmZzZXQgPSB0aGlzLm9mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgRmxhdExpc3REYXRhKHR5cGUsIGxlbmd0aCwgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSwgdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0sIHRoaXNbVmVjdG9yVHlwZS5EQVRBXSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIERpY3Rpb25hcnlEYXRhPFQgZXh0ZW5kcyBEYXRhVHlwZT4gZXh0ZW5kcyBCYXNlRGF0YTxEaWN0aW9uYXJ5PFQ+PiB7XG4gICAgcHJvdGVjdGVkIF9kaWN0aW9uYXJ5OiBWZWN0b3I8VD47XG4gICAgcHJvdGVjdGVkIF9pbmRpY2llczogRGF0YTxJbnQ8YW55Pj47XG4gICAgcHVibGljIGdldCBpbmRpY2llcygpIHsgcmV0dXJuIHRoaXMuX2luZGljaWVzOyB9XG4gICAgcHVibGljIGdldCBkaWN0aW9uYXJ5KCkgeyByZXR1cm4gdGhpcy5fZGljdGlvbmFyeTsgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IERpY3Rpb25hcnk8VD4sIGRpY3Rpb25hcnk6IFZlY3RvcjxUPiwgaW5kaWNpZXM6IERhdGE8SW50PGFueT4+KSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGluZGljaWVzLmxlbmd0aCwgKGluZGljaWVzIGFzIGFueSkuX251bGxDb3VudCk7XG4gICAgICAgIHRoaXMuX2luZGljaWVzID0gaW5kaWNpZXM7XG4gICAgICAgIHRoaXMuX2RpY3Rpb25hcnkgPSBkaWN0aW9uYXJ5O1xuICAgICAgICB0aGlzLmxlbmd0aCA9IHRoaXMuX2luZGljaWVzLmxlbmd0aDtcbiAgICB9XG4gICAgcHVibGljIGdldCBudWxsQ291bnQoKSB7IHJldHVybiB0aGlzLl9pbmRpY2llcy5udWxsQ291bnQ7IH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIERpY3Rpb25hcnk8VD4+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBvZmZzZXQgPSB0aGlzLm9mZnNldCkge1xuICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5fZGljdGlvbmFyeS5kYXRhLmNsb25lKHR5cGUuZGljdGlvbmFyeSBhcyBhbnkpO1xuICAgICAgICByZXR1cm4gbmV3IERpY3Rpb25hcnlEYXRhPFI+KFxuICAgICAgICAgICAgdGhpcy50eXBlIGFzIGFueSxcbiAgICAgICAgICAgIHRoaXMuX2RpY3Rpb25hcnkuY2xvbmUoZGF0YSkgYXMgYW55LFxuICAgICAgICAgICAgdGhpcy5faW5kaWNpZXMuc2xpY2Uob2Zmc2V0IC0gdGhpcy5vZmZzZXQsIGxlbmd0aClcbiAgICAgICAgKSBhcyBhbnk7XG4gICAgfVxuICAgIHByb3RlY3RlZCBzbGljZUludGVybmFsKGNsb25lOiB0aGlzLCBfb2Zmc2V0OiBudW1iZXIsIF9sZW5ndGg6IG51bWJlcikge1xuICAgICAgICBjbG9uZS5sZW5ndGggPSBjbG9uZS5faW5kaWNpZXMubGVuZ3RoO1xuICAgICAgICBjbG9uZS5fbnVsbENvdW50ID0gKGNsb25lLl9pbmRpY2llcyBhcyBhbnkpLl9udWxsQ291bnQ7XG4gICAgICAgIHJldHVybiBjbG9uZTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBOZXN0ZWREYXRhPFQgZXh0ZW5kcyBOZXN0ZWRUeXBlID0gTmVzdGVkVHlwZT4gZXh0ZW5kcyBCYXNlRGF0YTxUPiB7XG4gICAgcHVibGljIC8qW1ZlY3RvclR5cGUuVkFMSURJVFldOiovIDI6IFVpbnQ4QXJyYXk7XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCBjaGlsZERhdGE6IERhdGE8YW55PltdLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpcy5jaGlsZERhdGEgPSBjaGlsZERhdGE7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0gPSB0b1R5cGVkQXJyYXkoVWludDhBcnJheSwgbnVsbEJpdG1hcCk7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgVD4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5sZW5ndGgsIG9mZnNldCA9IHRoaXMub2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBOZXN0ZWREYXRhPFI+KHR5cGUsIGxlbmd0aCwgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSwgdGhpcy5jaGlsZERhdGEsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNsaWNlSW50ZXJuYWwoY2xvbmU6IHRoaXMsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICBpZiAoIXRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdKSB7XG4gICAgICAgICAgICBjbG9uZS5jaGlsZERhdGEgPSB0aGlzLmNoaWxkRGF0YS5tYXAoKGNoaWxkKSA9PiBjaGlsZC5zbGljZShvZmZzZXQsIGxlbmd0aCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdXBlci5zbGljZUludGVybmFsKGNsb25lLCBvZmZzZXQsIGxlbmd0aCk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgU2luZ2xlTmVzdGVkRGF0YTxUIGV4dGVuZHMgU2luZ2xlTmVzdGVkVHlwZT4gZXh0ZW5kcyBOZXN0ZWREYXRhPFQ+IHtcbiAgICBwcm90ZWN0ZWQgX3ZhbHVlc0RhdGE6IERhdGE8VD47XG4gICAgcHVibGljIGdldCB2YWx1ZXMoKSB7IHJldHVybiB0aGlzLl92YWx1ZXNEYXRhOyB9XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCB2YWx1ZUNoaWxkRGF0YTogRGF0YTxUPiwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBudWxsQml0bWFwLCBbdmFsdWVDaGlsZERhdGFdLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXMuX3ZhbHVlc0RhdGEgPSB2YWx1ZUNoaWxkRGF0YTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBMaXN0RGF0YTxUIGV4dGVuZHMgTGlzdFR5cGU+IGV4dGVuZHMgU2luZ2xlTmVzdGVkRGF0YTxUPiB7XG4gICAgcHVibGljIC8qICBbVmVjdG9yVHlwZS5PRkZTRVRdOiovIDA6IEludDMyQXJyYXk7XG4gICAgcHVibGljIC8qW1ZlY3RvclR5cGUuVkFMSURJVFldOiovIDI6IFVpbnQ4QXJyYXk7XG4gICAgcHVibGljIGdldCB2YWx1ZU9mZnNldHMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXTsgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgdmFsdWVPZmZzZXRzOiBJdGVyYWJsZTxudW1iZXI+LCB2YWx1ZUNoaWxkRGF0YTogRGF0YTxUPiwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBudWxsQml0bWFwLCB2YWx1ZUNoaWxkRGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSA9IHRvVHlwZWRBcnJheShJbnQzMkFycmF5LCB2YWx1ZU9mZnNldHMpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBvZmZzZXQgPSB0aGlzLm9mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgTGlzdERhdGE8Uj4odHlwZSwgbGVuZ3RoLCB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLCB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSwgdGhpcy5fdmFsdWVzRGF0YSBhcyBhbnksIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBVbmlvbkRhdGE8VCBleHRlbmRzIChEZW5zZVVuaW9uIHwgU3BhcnNlVW5pb24pID0gYW55PiBleHRlbmRzIE5lc3RlZERhdGE8VD4ge1xuICAgIHB1YmxpYyAvKiAgICBbVmVjdG9yVHlwZS5UWVBFXToqLyAzOiBUWydUQXJyYXknXTtcbiAgICBwdWJsaWMgZ2V0IHR5cGVJZHMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuVFlQRV07IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHR5cGVJZHM6IEl0ZXJhYmxlPG51bWJlcj4sIGNoaWxkRGF0YTogRGF0YTxhbnk+W10sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgbnVsbEJpdG1hcCwgY2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5UWVBFXSA9IHRvVHlwZWRBcnJheShJbnQ4QXJyYXksIHR5cGVJZHMpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBvZmZzZXQgPSB0aGlzLm9mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgVW5pb25EYXRhPFI+KHR5cGUsIGxlbmd0aCwgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSwgdGhpc1tWZWN0b3JUeXBlLlRZUEVdLCB0aGlzLmNoaWxkRGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFNwYXJzZVVuaW9uRGF0YSBleHRlbmRzIFVuaW9uRGF0YTxTcGFyc2VVbmlvbj4ge1xuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFNwYXJzZVVuaW9uLCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHR5cGVJZHM6IEl0ZXJhYmxlPG51bWJlcj4sIGNoaWxkRGF0YTogRGF0YTxhbnk+W10sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgbnVsbEJpdG1hcCwgdHlwZUlkcywgY2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgU3BhcnNlVW5pb24+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBvZmZzZXQgPSB0aGlzLm9mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgU3BhcnNlVW5pb25EYXRhKFxuICAgICAgICAgICAgdHlwZSxcbiAgICAgICAgICAgIGxlbmd0aCxcbiAgICAgICAgICAgIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sXG4gICAgICAgICAgICB0aGlzW1ZlY3RvclR5cGUuVFlQRV0sXG4gICAgICAgICAgICB0aGlzLmNoaWxkRGF0YSxcbiAgICAgICAgICAgIG9mZnNldCwgbnVsbENvdW50XG4gICAgICAgICkgYXMgYW55IGFzIFVuaW9uRGF0YTxSPjtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBEZW5zZVVuaW9uRGF0YSBleHRlbmRzIFVuaW9uRGF0YTxEZW5zZVVuaW9uPiB7XG4gICAgcHVibGljIC8qICBbVmVjdG9yVHlwZS5PRkZTRVRdOiovIDA6IEludDMyQXJyYXk7XG4gICAgcHVibGljIGdldCB2YWx1ZU9mZnNldHMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXTsgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IERlbnNlVW5pb24sIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgdHlwZUlkczogSXRlcmFibGU8bnVtYmVyPiwgdmFsdWVPZmZzZXRzOiBJdGVyYWJsZTxudW1iZXI+LCBjaGlsZERhdGE6IERhdGE8YW55PltdLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIHR5cGVJZHMsIGNoaWxkRGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSA9IHRvVHlwZWRBcnJheShJbnQzMkFycmF5LCB2YWx1ZU9mZnNldHMpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIERlbnNlVW5pb24+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMubGVuZ3RoLCBvZmZzZXQgPSB0aGlzLm9mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGVuc2VVbmlvbkRhdGEoXG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgbGVuZ3RoLFxuICAgICAgICAgICAgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSxcbiAgICAgICAgICAgIHRoaXNbVmVjdG9yVHlwZS5UWVBFXSxcbiAgICAgICAgICAgIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdLFxuICAgICAgICAgICAgdGhpcy5jaGlsZERhdGEsXG4gICAgICAgICAgICBvZmZzZXQsIG51bGxDb3VudFxuICAgICAgICApIGFzIGFueSBhcyBVbmlvbkRhdGE8Uj47XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ2h1bmtlZERhdGE8VCBleHRlbmRzIERhdGFUeXBlPiBleHRlbmRzIEJhc2VEYXRhPFQ+IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHJvdGVjdGVkIF9jaHVua0RhdGE6IERhdGE8VD5bXTtcbiAgICBwcm90ZWN0ZWQgX2NodW5rVmVjdG9yczogVmVjdG9yPFQ+W107XG4gICAgcHJvdGVjdGVkIF9jaHVua09mZnNldHM6IFVpbnQzMkFycmF5O1xuICAgIHB1YmxpYyBnZXQgY2h1bmtWZWN0b3JzKCkgeyByZXR1cm4gdGhpcy5fY2h1bmtWZWN0b3JzOyB9XG4gICAgcHVibGljIGdldCBjaHVua09mZnNldHMoKSB7IHJldHVybiB0aGlzLl9jaHVua09mZnNldHM7IH1cbiAgICBwdWJsaWMgZ2V0IGNodW5rRGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NodW5rRGF0YSB8fCAoXG4gICAgICAgICAgICAgICB0aGlzLl9jaHVua0RhdGEgPSB0aGlzLl9jaHVua1ZlY3RvcnMubWFwKCh7IGRhdGEgfSkgPT4gZGF0YSkpO1xuICAgIH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgY2h1bmtWZWN0b3JzOiBWZWN0b3I8VD5bXSwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIsIGNodW5rT2Zmc2V0cz86IFVpbnQzMkFycmF5KSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzLl9jaHVua1ZlY3RvcnMgPSBjaHVua1ZlY3RvcnM7XG4gICAgICAgIHRoaXMuX2NodW5rT2Zmc2V0cyA9IGNodW5rT2Zmc2V0cyB8fCBDaHVua2VkRGF0YS5jb21wdXRlT2Zmc2V0cyhjaHVua1ZlY3RvcnMpO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IG51bGxDb3VudCgpIHtcbiAgICAgICAgbGV0IG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudDtcbiAgICAgICAgaWYgKG51bGxDb3VudCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuX251bGxDb3VudCA9IG51bGxDb3VudCA9IHRoaXMuX2NodW5rVmVjdG9ycy5yZWR1Y2UoKHgsIGMpID0+IHggKyBjLm51bGxDb3VudCwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGxDb3VudDtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBUPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLmxlbmd0aCwgb2Zmc2V0ID0gdGhpcy5vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IENodW5rZWREYXRhPFI+KFxuICAgICAgICAgICAgdHlwZSwgbGVuZ3RoLFxuICAgICAgICAgICAgdGhpcy5fY2h1bmtWZWN0b3JzLm1hcCgodmVjKSA9PiB2ZWMuY2xvbmUodmVjLmRhdGEuY2xvbmUodHlwZSkpKSBhcyBhbnksXG4gICAgICAgICAgICBvZmZzZXQsIG51bGxDb3VudCwgdGhpcy5fY2h1bmtPZmZzZXRzXG4gICAgICAgICk7XG4gICAgfVxuICAgIHByb3RlY3RlZCBzbGljZUludGVybmFsKGNsb25lOiB0aGlzLCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgY2h1bmtzID0gdGhpcy5fY2h1bmtWZWN0b3JzO1xuICAgICAgICBjb25zdCBvZmZzZXRzID0gdGhpcy5fY2h1bmtPZmZzZXRzO1xuICAgICAgICBjb25zdCBjaHVua1NsaWNlczogVmVjdG9yPFQ+W10gPSBbXTtcbiAgICAgICAgZm9yIChsZXQgY2hpbGRJbmRleCA9IC0xLCBudW1DaGlsZHJlbiA9IGNodW5rcy5sZW5ndGg7ICsrY2hpbGRJbmRleCA8IG51bUNoaWxkcmVuOykge1xuICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBjaHVua3NbY2hpbGRJbmRleF07XG4gICAgICAgICAgICBjb25zdCBjaGlsZExlbmd0aCA9IGNoaWxkLmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkT2Zmc2V0ID0gb2Zmc2V0c1tjaGlsZEluZGV4XTtcbiAgICAgICAgICAgIC8vIElmIHRoZSBjaGlsZCBpcyB0byB0aGUgcmlnaHQgb2YgdGhlIHNsaWNlIGJvdW5kYXJ5LCBleGNsdWRlXG4gICAgICAgICAgICBpZiAoY2hpbGRPZmZzZXQgPj0gb2Zmc2V0ICsgbGVuZ3RoKSB7IGNvbnRpbnVlOyB9XG4gICAgICAgICAgICAvLyBJZiB0aGUgY2hpbGQgaXMgdG8gdGhlIGxlZnQgb2Ygb2YgdGhlIHNsaWNlIGJvdW5kYXJ5LCBleGNsdWRlXG4gICAgICAgICAgICBpZiAob2Zmc2V0ID49IGNoaWxkT2Zmc2V0ICsgY2hpbGRMZW5ndGgpIHsgY29udGludWU7IH1cbiAgICAgICAgICAgIC8vIElmIHRoZSBjaGlsZCBpcyBiZXR3ZWVuIGJvdGggbGVmdCBhbmQgcmlnaHQgYm91bmRhcmllcywgaW5jbHVkZSB3L28gc2xpY2luZ1xuICAgICAgICAgICAgaWYgKGNoaWxkT2Zmc2V0ID49IG9mZnNldCAmJiAoY2hpbGRPZmZzZXQgKyBjaGlsZExlbmd0aCkgPD0gb2Zmc2V0ICsgbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY2h1bmtTbGljZXMucHVzaChjaGlsZCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiB0aGUgY2hpbGQgb3ZlcmxhcHMgb25lIG9mIHRoZSBzbGljZSBib3VuZGFyaWVzLCBpbmNsdWRlIHRoYXQgc2xpY2VcbiAgICAgICAgICAgIGNvbnN0IGJlZ2luID0gTWF0aC5tYXgoMCwgb2Zmc2V0IC0gY2hpbGRPZmZzZXQpO1xuICAgICAgICAgICAgY29uc3QgZW5kID0gYmVnaW4gKyBNYXRoLm1pbihjaGlsZExlbmd0aCAtIGJlZ2luLCAob2Zmc2V0ICsgbGVuZ3RoKSAtIGNoaWxkT2Zmc2V0KTtcbiAgICAgICAgICAgIGNodW5rU2xpY2VzLnB1c2goY2hpbGQuc2xpY2UoYmVnaW4sIGVuZCkpO1xuICAgICAgICB9XG4gICAgICAgIGNsb25lLl9jaHVua1ZlY3RvcnMgPSBjaHVua1NsaWNlcztcbiAgICAgICAgY2xvbmUuX2NodW5rT2Zmc2V0cyA9IENodW5rZWREYXRhLmNvbXB1dGVPZmZzZXRzKGNodW5rU2xpY2VzKTtcbiAgICAgICAgcmV0dXJuIGNsb25lO1xuICAgIH1cbiAgICBzdGF0aWMgY29tcHV0ZU9mZnNldHM8VCBleHRlbmRzIERhdGFUeXBlPihjaGlsZFZlY3RvcnM6IFZlY3RvcjxUPltdKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkT2Zmc2V0cyA9IG5ldyBVaW50MzJBcnJheShjaGlsZFZlY3RvcnMubGVuZ3RoICsgMSk7XG4gICAgICAgIGZvciAobGV0IGluZGV4ID0gMCwgbGVuZ3RoID0gY2hpbGRPZmZzZXRzLmxlbmd0aCwgY2hpbGRPZmZzZXQgPSBjaGlsZE9mZnNldHNbMF0gPSAwOyArK2luZGV4IDwgbGVuZ3RoOykge1xuICAgICAgICAgICAgY2hpbGRPZmZzZXRzW2luZGV4XSA9IChjaGlsZE9mZnNldCArPSBjaGlsZFZlY3RvcnNbaW5kZXggLSAxXS5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGlsZE9mZnNldHM7XG4gICAgfVxufVxuIl19
