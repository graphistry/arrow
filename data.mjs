// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import { popcnt_bit_range } from './util/bit';
import { VectorType } from './type';
export function toTypedArray(ArrayType, values) {
    if (!ArrayType && ArrayBuffer.isView(values)) {
        return values;
    }
    return values instanceof ArrayType ? values
        : !values || !ArrayBuffer.isView(values) ? ArrayType.from(values || [])
            : new ArrayType(values.buffer, values.byteOffset, values.byteLength / ArrayType.BYTES_PER_ELEMENT);
}
export const kUnknownNullCount = -1;
export class BaseData {
    constructor(type, length, offset, nullCount) {
        this._type = type;
        this._length = Math.floor(Math.max(length || 0, 0));
        this._offset = Math.floor(Math.max(offset || 0, 0));
        this._nullCount = Math.floor(Math.max(nullCount || 0, -1));
    }
    get type() { return this._type; }
    get length() { return this._length; }
    get offset() { return this._offset; }
    get typeId() { return this._type.TType; }
    get childData() { return this._childData; }
    get nullBitmap() { return this[VectorType.VALIDITY]; }
    get nullCount() {
        let nullCount = this._nullCount;
        let nullBitmap;
        if (nullCount === -1 && (nullBitmap = this[VectorType.VALIDITY])) {
            this._nullCount = nullCount = popcnt_bit_range(nullBitmap, this._offset, this._offset + this._length);
        }
        return nullCount;
    }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new BaseData(type, length, offset, nullCount);
    }
    slice(offset, length) {
        return length <= 0 ? this : this.sliceInternal(this.clone(this._type, length, this._offset + offset, +(this._nullCount === 0) - 1), offset, length);
    }
    sliceInternal(clone, offset, length) {
        let arr;
        // If typeIds exist, slice the typeIds buffer
        (arr = this[VectorType.TYPE]) && (clone[VectorType.TYPE] = this.sliceData(arr, offset, length));
        // If offsets exist, only slice the offsets buffer
        (arr = this[VectorType.OFFSET]) && (clone[VectorType.OFFSET] = this.sliceOffsets(arr, offset, length)) ||
            // Otherwise if no offsets, slice the data buffer
            (arr = this[VectorType.DATA]) && (clone[VectorType.DATA] = this.sliceData(arr, offset, length));
        return clone;
    }
    sliceData(data, offset, length) {
        return data.subarray(offset, offset + length);
    }
    sliceOffsets(valueOffsets, offset, length) {
        return valueOffsets.subarray(offset, offset + length + 1);
    }
}
export class FlatData extends BaseData {
    constructor(type, length, nullBitmap, data, offset, nullCount) {
        super(type, length, offset, nullCount);
        this[VectorType.DATA] = toTypedArray(this.ArrayType, data);
        this[VectorType.VALIDITY] = toTypedArray(Uint8Array, nullBitmap);
    }
    get values() { return this[VectorType.DATA]; }
    get ArrayType() { return this._type.ArrayType; }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new this.constructor(type, length, this[VectorType.VALIDITY], this[VectorType.DATA], offset, nullCount);
    }
}
export class BoolData extends FlatData {
    sliceData(data) { return data; }
}
export class FlatListData extends FlatData {
    constructor(type, length, nullBitmap, valueOffsets, data, offset, nullCount) {
        super(type, length, nullBitmap, data, offset, nullCount);
        this[VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    get values() { return this[VectorType.DATA]; }
    get valueOffsets() { return this[VectorType.OFFSET]; }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new FlatListData(type, length, this[VectorType.VALIDITY], this[VectorType.OFFSET], this[VectorType.DATA], offset, nullCount);
    }
}
export class DictionaryData extends BaseData {
    constructor(type, dictionary, indicies) {
        super(type, indicies.length, indicies._nullCount);
        this._indicies = indicies;
        this._dictionary = dictionary;
    }
    get indicies() { return this._indicies; }
    get dictionary() { return this._dictionary; }
    get length() { return this._indicies.length; }
    get nullCount() { return this._indicies.nullCount; }
    clone(type, length = this._length, offset = this._offset) {
        const data = this._dictionary.data.clone(type.dictionary);
        return new DictionaryData(this._type, this._dictionary.clone(data), this._indicies.slice(offset - this._offset, length));
    }
    sliceInternal(clone, _offset, _length) {
        clone._length = clone._indicies.length;
        clone._nullCount = clone._indicies._nullCount;
        return clone;
    }
}
export class NestedData extends BaseData {
    constructor(type, length, nullBitmap, childData, offset, nullCount) {
        super(type, length, offset, nullCount);
        this._childData = childData;
        this[VectorType.VALIDITY] = toTypedArray(Uint8Array, nullBitmap);
    }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new NestedData(type, length, this[VectorType.VALIDITY], this._childData, offset, nullCount);
    }
    sliceInternal(clone, offset, length) {
        if (!this[VectorType.OFFSET]) {
            clone._childData = this._childData.map((child) => child.slice(offset, length));
        }
        return super.sliceInternal(clone, offset, length);
    }
}
export class ListData extends NestedData {
    constructor(type, length, nullBitmap, valueOffsets, valueChildData, offset, nullCount) {
        super(type, length, nullBitmap, [valueChildData], offset, nullCount);
        this._valuesData = valueChildData;
        this[VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    get values() { return this._valuesData; }
    get valueOffsets() { return this[VectorType.OFFSET]; }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new ListData(type, length, this[VectorType.VALIDITY], this[VectorType.OFFSET], this._valuesData, offset, nullCount);
    }
}
export class UnionData extends NestedData {
    constructor(type, length, nullBitmap, typeIds, childData, offset, nullCount) {
        super(type, length, nullBitmap, childData, offset, nullCount);
        this[VectorType.TYPE] = toTypedArray(Int8Array, typeIds);
    }
    get typeIds() { return this[VectorType.TYPE]; }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new UnionData(type, length, this[VectorType.VALIDITY], this[VectorType.TYPE], this._childData, offset, nullCount);
    }
}
export class SparseUnionData extends UnionData {
    constructor(type, length, nullBitmap, typeIds, childData, offset, nullCount) {
        super(type, length, nullBitmap, typeIds, childData, offset, nullCount);
    }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new SparseUnionData(type, length, this[VectorType.VALIDITY], this[VectorType.TYPE], this._childData, offset, nullCount);
    }
}
export class DenseUnionData extends UnionData {
    get valueOffsets() { return this[VectorType.OFFSET]; }
    constructor(type, length, nullBitmap, typeIds, valueOffsets, childData, offset, nullCount) {
        super(type, length, nullBitmap, typeIds, childData, offset, nullCount);
        this[VectorType.OFFSET] = toTypedArray(Int32Array, valueOffsets);
    }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new DenseUnionData(type, length, this[VectorType.VALIDITY], this[VectorType.TYPE], this[VectorType.OFFSET], this._childData, offset, nullCount);
    }
}
export class ChunkedData extends BaseData {
    constructor(type, length, childVectors, offset, nullCount, childOffsets) {
        super(type, length, offset, nullCount);
        this._childVectors = childVectors;
        this._childOffsets = childOffsets || ChunkedData.computeOffsets(childVectors);
    }
    get childVectors() { return this._childVectors; }
    get childOffsets() { return this._childOffsets; }
    get childData() {
        return this._childData || (this._childData = this._childVectors.map(({ data }) => data));
    }
    get nullCount() {
        let nullCount = this._nullCount;
        if (nullCount === -1) {
            this._nullCount = nullCount = this._childVectors.reduce((x, c) => x + c.nullCount, 0);
        }
        return nullCount;
    }
    clone(type, length = this._length, offset = this._offset, nullCount = this._nullCount) {
        return new ChunkedData(type, length, this._childVectors.map((vec) => vec.clone(vec.data.clone(type))), offset, nullCount, this._childOffsets);
    }
    sliceInternal(clone, offset, length) {
        const chunks = this._childVectors;
        const offsets = this._childOffsets;
        const chunkSlices = [];
        for (let childIndex = -1, numChildren = chunks.length; ++childIndex < numChildren;) {
            const child = chunks[childIndex];
            const childLength = child.length;
            const childOffset = offsets[childIndex];
            // If the child is to the right of the slice boundary, exclude
            if (childOffset >= offset + length) {
                continue;
            }
            // If the child is to the left of of the slice boundary, exclude
            if (offset >= childOffset + childLength) {
                continue;
            }
            // If the child is between both left and right boundaries, include w/o slicing
            if (childOffset >= offset && (childOffset + childLength) <= offset + length) {
                chunkSlices.push(child);
                continue;
            }
            // If the child overlaps one of the slice boundaries, include that slice
            const begin = Math.max(0, offset - childOffset);
            const end = begin + Math.min(childLength - begin, (offset + length) - childOffset);
            chunkSlices.push(child.slice(begin, end));
        }
        clone._childVectors = chunkSlices;
        clone._childOffsets = ChunkedData.computeOffsets(chunkSlices);
        return clone;
    }
    static computeOffsets(childVectors) {
        const childOffsets = new Uint32Array(childVectors.length + 1);
        for (let index = 0, length = childOffsets.length, childOffset = childOffsets[0] = 0; ++index < length;) {
            childOffsets[index] = (childOffset += childVectors[index - 1].length);
        }
        return childOffsets;
    }
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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RixXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDOUMsQ0FBQztRQUNELEtBQUssQ0FBQyxhQUFhLEdBQUcsV0FBVyxDQUFDO1FBQ2xDLEtBQUssQ0FBQyxhQUFhLEdBQUcsV0FBVyxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUM5RCxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFDRCxNQUFNLENBQUMsY0FBYyxDQUFxQixZQUF5QjtRQUMvRCxNQUFNLFlBQVksR0FBRyxJQUFJLFdBQVcsQ0FBQyxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQzlELEdBQUcsQ0FBQyxDQUFDLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRSxNQUFNLEdBQUcsWUFBWSxDQUFDLE1BQU0sRUFBRSxXQUFXLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEtBQUssR0FBRyxNQUFNLEdBQUcsQ0FBQztZQUNyRyxZQUFZLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxXQUFXLElBQUksWUFBWSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMxRSxDQUFDO1FBQ0QsTUFBTSxDQUFDLFlBQVksQ0FBQztJQUN4QixDQUFDO0NBQ0oiLCJmaWxlIjoiZGF0YS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBwb3BjbnRfYml0X3JhbmdlIH0gZnJvbSAnLi91dGlsL2JpdCc7XG5pbXBvcnQgeyBWZWN0b3JMaWtlLCBWZWN0b3IgfSBmcm9tICcuL3ZlY3Rvcic7XG5pbXBvcnQgeyBWZWN0b3JUeXBlLCBUeXBlZEFycmF5LCBUeXBlZEFycmF5Q29uc3RydWN0b3IsIERpY3Rpb25hcnkgfSBmcm9tICcuL3R5cGUnO1xuaW1wb3J0IHsgSW50LCBCb29sLCBGbGF0TGlzdFR5cGUsIExpc3QsIEZpeGVkU2l6ZUxpc3QsIFN0cnVjdCwgTWFwXyB9IGZyb20gJy4vdHlwZSc7XG5pbXBvcnQgeyBEYXRhVHlwZSwgRmxhdFR5cGUsIExpc3RUeXBlLCBOZXN0ZWRUeXBlLCBEZW5zZVVuaW9uLCBTcGFyc2VVbmlvbiB9IGZyb20gJy4vdHlwZSc7XG5cbmV4cG9ydCBmdW5jdGlvbiB0b1R5cGVkQXJyYXk8VCBleHRlbmRzIFR5cGVkQXJyYXk+KEFycmF5VHlwZTogVHlwZWRBcnJheUNvbnN0cnVjdG9yPFQ+LCB2YWx1ZXM/OiBUIHwgQXJyYXlMaWtlPG51bWJlcj4gfCBJdGVyYWJsZTxudW1iZXI+IHwgbnVsbCk6IFQge1xuICAgIGlmICghQXJyYXlUeXBlICYmIEFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZXMpKSB7IHJldHVybiB2YWx1ZXM7IH1cbiAgICByZXR1cm4gdmFsdWVzIGluc3RhbmNlb2YgQXJyYXlUeXBlID8gdmFsdWVzXG4gICAgICAgICA6ICF2YWx1ZXMgfHwgIUFycmF5QnVmZmVyLmlzVmlldyh2YWx1ZXMpID8gQXJyYXlUeXBlLmZyb20odmFsdWVzIHx8IFtdKVxuICAgICAgICAgOiBuZXcgQXJyYXlUeXBlKHZhbHVlcy5idWZmZXIsIHZhbHVlcy5ieXRlT2Zmc2V0LCB2YWx1ZXMuYnl0ZUxlbmd0aCAvIEFycmF5VHlwZS5CWVRFU19QRVJfRUxFTUVOVCk7XG59XG5cbmV4cG9ydCB0eXBlIERhdGE8VCBleHRlbmRzIERhdGFUeXBlPiA9IERhdGFUeXBlczxUPltUWydUVHlwZSddXSAmIEJhc2VEYXRhPFQ+O1xuZXhwb3J0IGludGVyZmFjZSBEYXRhVHlwZXM8VCBleHRlbmRzIERhdGFUeXBlPiB7XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5OT05FXSovICAwOiBCYXNlRGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLk51bGxdKi8gIDE6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgICAgICAgIFtUeXBlLkludF0qLyAgMjogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgIFtUeXBlLkZsb2F0XSovICAzOiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICBbVHlwZS5CaW5hcnldKi8gIDQ6IEZsYXRMaXN0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLlV0ZjhdKi8gIDU6IEZsYXRMaXN0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLkJvb2xdKi8gIDY6IEJvb2xEYXRhO1xuLyogICAgICAgICAgICAgW1R5cGUuRGVjaW1hbF0qLyAgNzogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgICAgICBbVHlwZS5EYXRlXSovICA4OiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLlRpbWVdKi8gIDk6IEZsYXREYXRhPFQ+O1xuLyogICAgICAgICAgIFtUeXBlLlRpbWVzdGFtcF0qLyAxMDogRmxhdERhdGE8VD47XG4vKiAgICAgICAgICAgIFtUeXBlLkludGVydmFsXSovIDExOiBGbGF0RGF0YTxUPjtcbi8qICAgICAgICAgICAgICAgIFtUeXBlLkxpc3RdKi8gMTI6IExpc3REYXRhPExpc3Q8VD4+O1xuLyogICAgICAgICAgICAgIFtUeXBlLlN0cnVjdF0qLyAxMzogTmVzdGVkRGF0YTxTdHJ1Y3Q+O1xuLyogICAgICAgICAgICAgICBbVHlwZS5Vbmlvbl0qLyAxNDogVW5pb25EYXRhO1xuLyogICAgIFtUeXBlLkZpeGVkU2l6ZUJpbmFyeV0qLyAxNTogRmxhdERhdGE8VD47XG4vKiAgICAgICBbVHlwZS5GaXhlZFNpemVMaXN0XSovIDE2OiBMaXN0RGF0YTxGaXhlZFNpemVMaXN0PFQ+Pjtcbi8qICAgICAgICAgICAgICAgICBbVHlwZS5NYXBdKi8gMTc6IE5lc3RlZERhdGE8TWFwXz47XG4vKiAgW1R5cGUuRGVuc2VVbmlvbl0qLyBEZW5zZVVuaW9uOiBEZW5zZVVuaW9uRGF0YTtcbi8qW1R5cGUuU3BhcnNlVW5pb25dKi8gU3BhcnNlVW5pb246IFNwYXJzZVVuaW9uRGF0YTtcbi8qWyAgVHlwZS5EaWN0aW9uYXJ5XSovIERpY3Rpb25hcnk6IERpY3Rpb25hcnlEYXRhPGFueT47XG59XG4vLyBXaGVuIHNsaWNpbmcsIHdlIGRvIG5vdCBrbm93IHRoZSBudWxsIGNvdW50IG9mIHRoZSBzbGljZWQgcmFuZ2Ugd2l0aG91dFxuLy8gZG9pbmcgc29tZSBjb21wdXRhdGlvbi4gVG8gYXZvaWQgZG9pbmcgdGhpcyBlYWdlcmx5LCB3ZSBzZXQgdGhlIG51bGwgY291bnRcbi8vIHRvIC0xIChhbnkgbmVnYXRpdmUgbnVtYmVyIHdpbGwgZG8pLiBXaGVuIEFycmF5OjpudWxsX2NvdW50IGlzIGNhbGxlZCB0aGVcbi8vIGZpcnN0IHRpbWUsIHRoZSBudWxsIGNvdW50IHdpbGwgYmUgY29tcHV0ZWQuIFNlZSBBUlJPVy0zM1xuZXhwb3J0IHR5cGUga1Vua25vd25OdWxsQ291bnQgPSAtMTtcbmV4cG9ydCBjb25zdCBrVW5rbm93bk51bGxDb3VudCA9IC0xO1xuXG5leHBvcnQgY2xhc3MgQmFzZURhdGE8VCBleHRlbmRzIERhdGFUeXBlID0gRGF0YVR5cGU+IGltcGxlbWVudHMgVmVjdG9yTGlrZSB7XG4gICAgcHJvdGVjdGVkIF90eXBlOiBUO1xuICAgIHByb3RlY3RlZCBfbGVuZ3RoOiBudW1iZXI7XG4gICAgcHJvdGVjdGVkIF9vZmZzZXQ6IG51bWJlcjtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHJvdGVjdGVkIF9jaGlsZERhdGE6IERhdGE8YW55PltdO1xuICAgIHByb3RlY3RlZCBfbnVsbENvdW50OiBudW1iZXIgfCBrVW5rbm93bk51bGxDb3VudDtcbiAgICBwcm90ZWN0ZWQgLyogIFtWZWN0b3JUeXBlLk9GRlNFVF06Ki8gMD86IEludDMyQXJyYXk7XG4gICAgcHJvdGVjdGVkIC8qICAgIFtWZWN0b3JUeXBlLkRBVEFdOiovIDE/OiBUWydUQXJyYXknXTtcbiAgICBwcm90ZWN0ZWQgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMj86IFVpbnQ4QXJyYXk7XG4gICAgcHJvdGVjdGVkIC8qICAgIFtWZWN0b3JUeXBlLlRZUEVdOiovIDM/OiBJbnQ4QXJyYXk7XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuX3R5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLl9sZW5ndGggPSBNYXRoLmZsb29yKE1hdGgubWF4KGxlbmd0aCB8fCAwLCAwKSk7XG4gICAgICAgIHRoaXMuX29mZnNldCA9IE1hdGguZmxvb3IoTWF0aC5tYXgob2Zmc2V0IHx8IDAsIDApKTtcbiAgICAgICAgdGhpcy5fbnVsbENvdW50ID0gTWF0aC5mbG9vcihNYXRoLm1heChudWxsQ291bnQgfHwgMCwgLTEpKTtcbiAgICB9XG4gICAgcHVibGljIGdldCB0eXBlKCkgeyByZXR1cm4gdGhpcy5fdHlwZTsgfVxuICAgIHB1YmxpYyBnZXQgbGVuZ3RoKCkgeyByZXR1cm4gdGhpcy5fbGVuZ3RoOyB9XG4gICAgcHVibGljIGdldCBvZmZzZXQoKSB7IHJldHVybiB0aGlzLl9vZmZzZXQ7IH1cbiAgICBwdWJsaWMgZ2V0IHR5cGVJZCgpIHsgcmV0dXJuIHRoaXMuX3R5cGUuVFR5cGU7IH1cbiAgICBwdWJsaWMgZ2V0IGNoaWxkRGF0YSgpIHsgcmV0dXJuIHRoaXMuX2NoaWxkRGF0YTsgfVxuICAgIHB1YmxpYyBnZXQgbnVsbEJpdG1hcCgpIHsgcmV0dXJuIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV07IH1cbiAgICBwdWJsaWMgZ2V0IG51bGxDb3VudCgpIHtcbiAgICAgICAgbGV0IG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudDtcbiAgICAgICAgbGV0IG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChudWxsQ291bnQgPT09IC0xICYmIChudWxsQml0bWFwID0gdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSkpIHtcbiAgICAgICAgICAgIHRoaXMuX251bGxDb3VudCA9IG51bGxDb3VudCA9IHBvcGNudF9iaXRfcmFuZ2UobnVsbEJpdG1hcCwgdGhpcy5fb2Zmc2V0LCB0aGlzLl9vZmZzZXQgKyB0aGlzLl9sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsQ291bnQ7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgVD4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5fbGVuZ3RoLCBvZmZzZXQgPSB0aGlzLl9vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IEJhc2VEYXRhKHR5cGUsIGxlbmd0aCwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgIH1cbiAgICBwdWJsaWMgc2xpY2Uob2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiBsZW5ndGggPD0gMCA/IHRoaXMgOiB0aGlzLnNsaWNlSW50ZXJuYWwodGhpcy5jbG9uZShcbiAgICAgICAgICAgIHRoaXMuX3R5cGUsIGxlbmd0aCwgdGhpcy5fb2Zmc2V0ICsgb2Zmc2V0LCArKHRoaXMuX251bGxDb3VudCA9PT0gMCkgLSAxXG4gICAgICAgICkgYXMgYW55LCBvZmZzZXQsIGxlbmd0aCk7XG4gICAgfVxuICAgIHByb3RlY3RlZCBzbGljZUludGVybmFsKGNsb25lOiB0aGlzLCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpIHtcbiAgICAgICAgbGV0IGFycjogYW55O1xuICAgICAgICAvLyBJZiB0eXBlSWRzIGV4aXN0LCBzbGljZSB0aGUgdHlwZUlkcyBidWZmZXJcbiAgICAgICAgKGFyciA9IHRoaXNbVmVjdG9yVHlwZS5UWVBFXSkgJiYgKGNsb25lW1ZlY3RvclR5cGUuVFlQRV0gPSB0aGlzLnNsaWNlRGF0YShhcnIsIG9mZnNldCwgbGVuZ3RoKSk7XG4gICAgICAgIC8vIElmIG9mZnNldHMgZXhpc3QsIG9ubHkgc2xpY2UgdGhlIG9mZnNldHMgYnVmZmVyXG4gICAgICAgIChhcnIgPSB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSkgJiYgKGNsb25lW1ZlY3RvclR5cGUuT0ZGU0VUXSA9IHRoaXMuc2xpY2VPZmZzZXRzKGFyciwgb2Zmc2V0LCBsZW5ndGgpKSB8fFxuICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIGlmIG5vIG9mZnNldHMsIHNsaWNlIHRoZSBkYXRhIGJ1ZmZlclxuICAgICAgICAgICAgKGFyciA9IHRoaXNbVmVjdG9yVHlwZS5EQVRBXSkgJiYgKGNsb25lW1ZlY3RvclR5cGUuREFUQV0gPSB0aGlzLnNsaWNlRGF0YShhcnIsIG9mZnNldCwgbGVuZ3RoKSk7XG4gICAgICAgIHJldHVybiBjbG9uZTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNsaWNlRGF0YShkYXRhOiBUWydUQXJyYXknXSAmIFR5cGVkQXJyYXksIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICByZXR1cm4gZGF0YS5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIGxlbmd0aCk7XG4gICAgfVxuICAgIHByb3RlY3RlZCBzbGljZU9mZnNldHModmFsdWVPZmZzZXRzOiBJbnQzMkFycmF5LCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlT2Zmc2V0cy5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIGxlbmd0aCArIDEpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEZsYXREYXRhPFQgZXh0ZW5kcyBGbGF0VHlwZT4gZXh0ZW5kcyBCYXNlRGF0YTxUPiB7XG4gICAgcHVibGljIC8qICAgIFtWZWN0b3JUeXBlLkRBVEFdOiovIDE6IFRbJ1RBcnJheSddO1xuICAgIHB1YmxpYyAvKltWZWN0b3JUeXBlLlZBTElESVRZXToqLyAyOiBVaW50OEFycmF5O1xuICAgIHB1YmxpYyBnZXQgdmFsdWVzKCkgeyByZXR1cm4gdGhpc1tWZWN0b3JUeXBlLkRBVEFdOyB9XG4gICAgY29uc3RydWN0b3IodHlwZTogVCwgbGVuZ3RoOiBudW1iZXIsIG51bGxCaXRtYXA6IFVpbnQ4QXJyYXkgfCBudWxsIHwgdW5kZWZpbmVkLCBkYXRhOiBJdGVyYWJsZTxudW1iZXI+LCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICAgICAgdGhpc1tWZWN0b3JUeXBlLkRBVEFdID0gdG9UeXBlZEFycmF5KHRoaXMuQXJyYXlUeXBlLCBkYXRhKTtcbiAgICAgICAgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSA9IHRvVHlwZWRBcnJheShVaW50OEFycmF5LCBudWxsQml0bWFwKTtcbiAgICB9XG4gICAgcHVibGljIGdldCBBcnJheVR5cGUoKTogVFsnQXJyYXlUeXBlJ10geyByZXR1cm4gdGhpcy5fdHlwZS5BcnJheVR5cGU7IH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMuX2xlbmd0aCwgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyAodGhpcy5jb25zdHJ1Y3RvciBhcyBhbnkpKHR5cGUsIGxlbmd0aCwgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSwgdGhpc1tWZWN0b3JUeXBlLkRBVEFdLCBvZmZzZXQsIG51bGxDb3VudCkgYXMgRmxhdERhdGE8Uj47XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgQm9vbERhdGEgZXh0ZW5kcyBGbGF0RGF0YTxCb29sPiB7XG4gICAgcHJvdGVjdGVkIHNsaWNlRGF0YShkYXRhOiBVaW50OEFycmF5KSB7IHJldHVybiBkYXRhOyB9XG59XG5cbmV4cG9ydCBjbGFzcyBGbGF0TGlzdERhdGE8VCBleHRlbmRzIEZsYXRMaXN0VHlwZT4gZXh0ZW5kcyBGbGF0RGF0YTxUPiB7XG4gICAgcHVibGljIC8qICBbVmVjdG9yVHlwZS5PRkZTRVRdOiovIDA6IEludDMyQXJyYXk7XG4gICAgcHVibGljIC8qICAgIFtWZWN0b3JUeXBlLkRBVEFdOiovIDE6IFRbJ1RBcnJheSddO1xuICAgIHB1YmxpYyAvKltWZWN0b3JUeXBlLlZBTElESVRZXToqLyAyOiBVaW50OEFycmF5O1xuICAgIHB1YmxpYyBnZXQgdmFsdWVzKCkgeyByZXR1cm4gdGhpc1tWZWN0b3JUeXBlLkRBVEFdOyB9XG4gICAgcHVibGljIGdldCB2YWx1ZU9mZnNldHMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXTsgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgdmFsdWVPZmZzZXRzOiBJdGVyYWJsZTxudW1iZXI+LCBkYXRhOiBUWydUQXJyYXknXSwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBudWxsQml0bWFwLCBkYXRhLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdID0gdG9UeXBlZEFycmF5KEludDMyQXJyYXksIHZhbHVlT2Zmc2V0cyk7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgVD4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5fbGVuZ3RoLCBvZmZzZXQgPSB0aGlzLl9vZmZzZXQsIG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudCkge1xuICAgICAgICByZXR1cm4gbmV3IEZsYXRMaXN0RGF0YSh0eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXNbVmVjdG9yVHlwZS5PRkZTRVRdLCB0aGlzW1ZlY3RvclR5cGUuREFUQV0sIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBEaWN0aW9uYXJ5RGF0YTxUIGV4dGVuZHMgRGF0YVR5cGU+IGV4dGVuZHMgQmFzZURhdGE8RGljdGlvbmFyeTxUPj4ge1xuICAgIHByb3RlY3RlZCBfZGljdGlvbmFyeTogVmVjdG9yPFQ+O1xuICAgIHByb3RlY3RlZCBfaW5kaWNpZXM6IERhdGE8SW50PGFueT4+O1xuICAgIHB1YmxpYyBnZXQgaW5kaWNpZXMoKSB7IHJldHVybiB0aGlzLl9pbmRpY2llczsgfVxuICAgIHB1YmxpYyBnZXQgZGljdGlvbmFyeSgpIHsgcmV0dXJuIHRoaXMuX2RpY3Rpb25hcnk7IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBEaWN0aW9uYXJ5PFQ+LCBkaWN0aW9uYXJ5OiBWZWN0b3I8VD4sIGluZGljaWVzOiBEYXRhPEludDxhbnk+Pikge1xuICAgICAgICBzdXBlcih0eXBlLCBpbmRpY2llcy5sZW5ndGgsIChpbmRpY2llcyBhcyBhbnkpLl9udWxsQ291bnQpO1xuICAgICAgICB0aGlzLl9pbmRpY2llcyA9IGluZGljaWVzO1xuICAgICAgICB0aGlzLl9kaWN0aW9uYXJ5ID0gZGljdGlvbmFyeTtcbiAgICB9XG4gICAgcHVibGljIGdldCBsZW5ndGgoKSB7IHJldHVybiB0aGlzLl9pbmRpY2llcy5sZW5ndGg7IH1cbiAgICBwdWJsaWMgZ2V0IG51bGxDb3VudCgpIHsgcmV0dXJuIHRoaXMuX2luZGljaWVzLm51bGxDb3VudDsgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgRGljdGlvbmFyeTxUPj4odHlwZTogUiwgbGVuZ3RoID0gdGhpcy5fbGVuZ3RoLCBvZmZzZXQgPSB0aGlzLl9vZmZzZXQpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuX2RpY3Rpb25hcnkuZGF0YS5jbG9uZSh0eXBlLmRpY3Rpb25hcnkgYXMgYW55KTtcbiAgICAgICAgcmV0dXJuIG5ldyBEaWN0aW9uYXJ5RGF0YTxSPihcbiAgICAgICAgICAgIHRoaXMuX3R5cGUgYXMgYW55LFxuICAgICAgICAgICAgdGhpcy5fZGljdGlvbmFyeS5jbG9uZShkYXRhKSBhcyBhbnksXG4gICAgICAgICAgICB0aGlzLl9pbmRpY2llcy5zbGljZShvZmZzZXQgLSB0aGlzLl9vZmZzZXQsIGxlbmd0aClcbiAgICAgICAgKSBhcyBhbnk7XG4gICAgfVxuICAgIHByb3RlY3RlZCBzbGljZUludGVybmFsKGNsb25lOiB0aGlzLCBfb2Zmc2V0OiBudW1iZXIsIF9sZW5ndGg6IG51bWJlcikge1xuICAgICAgICBjbG9uZS5fbGVuZ3RoID0gY2xvbmUuX2luZGljaWVzLmxlbmd0aDtcbiAgICAgICAgY2xvbmUuX251bGxDb3VudCA9IChjbG9uZS5faW5kaWNpZXMgYXMgYW55KS5fbnVsbENvdW50O1xuICAgICAgICByZXR1cm4gY2xvbmU7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgTmVzdGVkRGF0YTxUIGV4dGVuZHMgTmVzdGVkVHlwZSA9IE5lc3RlZFR5cGU+IGV4dGVuZHMgQmFzZURhdGE8VD4ge1xuICAgIHB1YmxpYyAvKltWZWN0b3JUeXBlLlZBTElESVRZXToqLyAyOiBVaW50OEFycmF5O1xuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgY2hpbGREYXRhOiBEYXRhPGFueT5bXSwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXMuX2NoaWxkRGF0YSA9IGNoaWxkRGF0YTtcbiAgICAgICAgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSA9IHRvVHlwZWRBcnJheShVaW50OEFycmF5LCBudWxsQml0bWFwKTtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBUPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLl9sZW5ndGgsIG9mZnNldCA9IHRoaXMuX29mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgTmVzdGVkRGF0YTxSPih0eXBlLCBsZW5ndGgsIHRoaXNbVmVjdG9yVHlwZS5WQUxJRElUWV0sIHRoaXMuX2NoaWxkRGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgIH1cbiAgICBwcm90ZWN0ZWQgc2xpY2VJbnRlcm5hbChjbG9uZTogdGhpcywgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyKSB7XG4gICAgICAgIGlmICghdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0pIHtcbiAgICAgICAgICAgIGNsb25lLl9jaGlsZERhdGEgPSB0aGlzLl9jaGlsZERhdGEubWFwKChjaGlsZCkgPT4gY2hpbGQuc2xpY2Uob2Zmc2V0LCBsZW5ndGgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3VwZXIuc2xpY2VJbnRlcm5hbChjbG9uZSwgb2Zmc2V0LCBsZW5ndGgpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIExpc3REYXRhPFQgZXh0ZW5kcyBMaXN0VHlwZT4gZXh0ZW5kcyBOZXN0ZWREYXRhPFQ+IHtcbiAgICBwdWJsaWMgLyogIFtWZWN0b3JUeXBlLk9GRlNFVF06Ki8gMDogSW50MzJBcnJheTtcbiAgICBwdWJsaWMgLypbVmVjdG9yVHlwZS5WQUxJRElUWV06Ki8gMjogVWludDhBcnJheTtcbiAgICBwcm90ZWN0ZWQgX3ZhbHVlc0RhdGE6IERhdGE8VD47XG4gICAgcHVibGljIGdldCB2YWx1ZXMoKSB7IHJldHVybiB0aGlzLl92YWx1ZXNEYXRhOyB9XG4gICAgcHVibGljIGdldCB2YWx1ZU9mZnNldHMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXTsgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFQsIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgdmFsdWVPZmZzZXRzOiBJdGVyYWJsZTxudW1iZXI+LCB2YWx1ZUNoaWxkRGF0YTogRGF0YTxUPiwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIpIHtcbiAgICAgICAgc3VwZXIodHlwZSwgbGVuZ3RoLCBudWxsQml0bWFwLCBbdmFsdWVDaGlsZERhdGFdLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXMuX3ZhbHVlc0RhdGEgPSB2YWx1ZUNoaWxkRGF0YTtcbiAgICAgICAgdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0gPSB0b1R5cGVkQXJyYXkoSW50MzJBcnJheSwgdmFsdWVPZmZzZXRzKTtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBUPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLl9sZW5ndGgsIG9mZnNldCA9IHRoaXMuX29mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgTGlzdERhdGE8Uj4odHlwZSwgbGVuZ3RoLCB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLCB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSwgdGhpcy5fdmFsdWVzRGF0YSBhcyBhbnksIG9mZnNldCwgbnVsbENvdW50KTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBVbmlvbkRhdGE8VCBleHRlbmRzIChEZW5zZVVuaW9uIHwgU3BhcnNlVW5pb24pID0gYW55PiBleHRlbmRzIE5lc3RlZERhdGE8VD4ge1xuICAgIHB1YmxpYyAvKiAgICBbVmVjdG9yVHlwZS5UWVBFXToqLyAzOiBUWydUQXJyYXknXTtcbiAgICBwdWJsaWMgZ2V0IHR5cGVJZHMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuVFlQRV07IH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHR5cGVJZHM6IEl0ZXJhYmxlPG51bWJlcj4sIGNoaWxkRGF0YTogRGF0YTxhbnk+W10sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgbnVsbEJpdG1hcCwgY2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgICAgIHRoaXNbVmVjdG9yVHlwZS5UWVBFXSA9IHRvVHlwZWRBcnJheShJbnQ4QXJyYXksIHR5cGVJZHMpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMuX2xlbmd0aCwgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBVbmlvbkRhdGE8Uj4odHlwZSwgbGVuZ3RoLCB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLCB0aGlzW1ZlY3RvclR5cGUuVFlQRV0sIHRoaXMuX2NoaWxkRGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFNwYXJzZVVuaW9uRGF0YSBleHRlbmRzIFVuaW9uRGF0YTxTcGFyc2VVbmlvbj4ge1xuICAgIGNvbnN0cnVjdG9yKHR5cGU6IFNwYXJzZVVuaW9uLCBsZW5ndGg6IG51bWJlciwgbnVsbEJpdG1hcDogVWludDhBcnJheSB8IG51bGwgfCB1bmRlZmluZWQsIHR5cGVJZHM6IEl0ZXJhYmxlPG51bWJlcj4sIGNoaWxkRGF0YTogRGF0YTxhbnk+W10sIG9mZnNldD86IG51bWJlciwgbnVsbENvdW50PzogbnVtYmVyKSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgbnVsbEJpdG1hcCwgdHlwZUlkcywgY2hpbGREYXRhLCBvZmZzZXQsIG51bGxDb3VudCk7XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgU3BhcnNlVW5pb24+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMuX2xlbmd0aCwgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTcGFyc2VVbmlvbkRhdGEoXG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgbGVuZ3RoLFxuICAgICAgICAgICAgdGhpc1tWZWN0b3JUeXBlLlZBTElESVRZXSxcbiAgICAgICAgICAgIHRoaXNbVmVjdG9yVHlwZS5UWVBFXSxcbiAgICAgICAgICAgIHRoaXMuX2NoaWxkRGF0YSxcbiAgICAgICAgICAgIG9mZnNldCwgbnVsbENvdW50XG4gICAgICAgICkgYXMgYW55IGFzIFVuaW9uRGF0YTxSPjtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBEZW5zZVVuaW9uRGF0YSBleHRlbmRzIFVuaW9uRGF0YTxEZW5zZVVuaW9uPiB7XG4gICAgcHVibGljIC8qICBbVmVjdG9yVHlwZS5PRkZTRVRdOiovIDA6IEludDMyQXJyYXk7XG4gICAgcHVibGljIGdldCB2YWx1ZU9mZnNldHMoKSB7IHJldHVybiB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXTsgfVxuICAgIGNvbnN0cnVjdG9yKHR5cGU6IERlbnNlVW5pb24sIGxlbmd0aDogbnVtYmVyLCBudWxsQml0bWFwOiBVaW50OEFycmF5IHwgbnVsbCB8IHVuZGVmaW5lZCwgdHlwZUlkczogSXRlcmFibGU8bnVtYmVyPiwgdmFsdWVPZmZzZXRzOiBJdGVyYWJsZTxudW1iZXI+LCBjaGlsZERhdGE6IERhdGE8YW55PltdLCBvZmZzZXQ/OiBudW1iZXIsIG51bGxDb3VudD86IG51bWJlcikge1xuICAgICAgICBzdXBlcih0eXBlLCBsZW5ndGgsIG51bGxCaXRtYXAsIHR5cGVJZHMsIGNoaWxkRGF0YSwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzW1ZlY3RvclR5cGUuT0ZGU0VUXSA9IHRvVHlwZWRBcnJheShJbnQzMkFycmF5LCB2YWx1ZU9mZnNldHMpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIERlbnNlVW5pb24+KHR5cGU6IFIsIGxlbmd0aCA9IHRoaXMuX2xlbmd0aCwgb2Zmc2V0ID0gdGhpcy5fb2Zmc2V0LCBudWxsQ291bnQgPSB0aGlzLl9udWxsQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEZW5zZVVuaW9uRGF0YShcbiAgICAgICAgICAgIHR5cGUsXG4gICAgICAgICAgICBsZW5ndGgsXG4gICAgICAgICAgICB0aGlzW1ZlY3RvclR5cGUuVkFMSURJVFldLFxuICAgICAgICAgICAgdGhpc1tWZWN0b3JUeXBlLlRZUEVdLFxuICAgICAgICAgICAgdGhpc1tWZWN0b3JUeXBlLk9GRlNFVF0sXG4gICAgICAgICAgICB0aGlzLl9jaGlsZERhdGEsXG4gICAgICAgICAgICBvZmZzZXQsIG51bGxDb3VudFxuICAgICAgICApIGFzIGFueSBhcyBVbmlvbkRhdGE8Uj47XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ2h1bmtlZERhdGE8VCBleHRlbmRzIERhdGFUeXBlPiBleHRlbmRzIEJhc2VEYXRhPFQ+IHtcbiAgICBwcm90ZWN0ZWQgX2NoaWxkVmVjdG9yczogVmVjdG9yPFQ+W107XG4gICAgcHJvdGVjdGVkIF9jaGlsZE9mZnNldHM6IFVpbnQzMkFycmF5O1xuICAgIHB1YmxpYyBnZXQgY2hpbGRWZWN0b3JzKCkgeyByZXR1cm4gdGhpcy5fY2hpbGRWZWN0b3JzOyB9XG4gICAgcHVibGljIGdldCBjaGlsZE9mZnNldHMoKSB7IHJldHVybiB0aGlzLl9jaGlsZE9mZnNldHM7IH1cbiAgICBwdWJsaWMgZ2V0IGNoaWxkRGF0YSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoaWxkRGF0YSB8fCAoXG4gICAgICAgICAgICAgICB0aGlzLl9jaGlsZERhdGEgPSB0aGlzLl9jaGlsZFZlY3RvcnMubWFwKCh7IGRhdGEgfSkgPT4gZGF0YSkpO1xuICAgIH1cbiAgICBjb25zdHJ1Y3Rvcih0eXBlOiBULCBsZW5ndGg6IG51bWJlciwgY2hpbGRWZWN0b3JzOiBWZWN0b3I8VD5bXSwgb2Zmc2V0PzogbnVtYmVyLCBudWxsQ291bnQ/OiBudW1iZXIsIGNoaWxkT2Zmc2V0cz86IFVpbnQzMkFycmF5KSB7XG4gICAgICAgIHN1cGVyKHR5cGUsIGxlbmd0aCwgb2Zmc2V0LCBudWxsQ291bnQpO1xuICAgICAgICB0aGlzLl9jaGlsZFZlY3RvcnMgPSBjaGlsZFZlY3RvcnM7XG4gICAgICAgIHRoaXMuX2NoaWxkT2Zmc2V0cyA9IGNoaWxkT2Zmc2V0cyB8fCBDaHVua2VkRGF0YS5jb21wdXRlT2Zmc2V0cyhjaGlsZFZlY3RvcnMpO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IG51bGxDb3VudCgpIHtcbiAgICAgICAgbGV0IG51bGxDb3VudCA9IHRoaXMuX251bGxDb3VudDtcbiAgICAgICAgaWYgKG51bGxDb3VudCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuX251bGxDb3VudCA9IG51bGxDb3VudCA9IHRoaXMuX2NoaWxkVmVjdG9ycy5yZWR1Y2UoKHgsIGMpID0+IHggKyBjLm51bGxDb3VudCwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGxDb3VudDtcbiAgICB9XG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyBUPih0eXBlOiBSLCBsZW5ndGggPSB0aGlzLl9sZW5ndGgsIG9mZnNldCA9IHRoaXMuX29mZnNldCwgbnVsbENvdW50ID0gdGhpcy5fbnVsbENvdW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgQ2h1bmtlZERhdGE8Uj4oXG4gICAgICAgICAgICB0eXBlLCBsZW5ndGgsXG4gICAgICAgICAgICB0aGlzLl9jaGlsZFZlY3RvcnMubWFwKCh2ZWMpID0+IHZlYy5jbG9uZSh2ZWMuZGF0YS5jbG9uZSh0eXBlKSkpIGFzIGFueSxcbiAgICAgICAgICAgIG9mZnNldCwgbnVsbENvdW50LCB0aGlzLl9jaGlsZE9mZnNldHNcbiAgICAgICAgKTtcbiAgICB9XG4gICAgcHJvdGVjdGVkIHNsaWNlSW50ZXJuYWwoY2xvbmU6IHRoaXMsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlcikge1xuICAgICAgICBjb25zdCBjaHVua3MgPSB0aGlzLl9jaGlsZFZlY3RvcnM7XG4gICAgICAgIGNvbnN0IG9mZnNldHMgPSB0aGlzLl9jaGlsZE9mZnNldHM7XG4gICAgICAgIGNvbnN0IGNodW5rU2xpY2VzOiBWZWN0b3I8VD5bXSA9IFtdO1xuICAgICAgICBmb3IgKGxldCBjaGlsZEluZGV4ID0gLTEsIG51bUNoaWxkcmVuID0gY2h1bmtzLmxlbmd0aDsgKytjaGlsZEluZGV4IDwgbnVtQ2hpbGRyZW47KSB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZCA9IGNodW5rc1tjaGlsZEluZGV4XTtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkTGVuZ3RoID0gY2hpbGQubGVuZ3RoO1xuICAgICAgICAgICAgY29uc3QgY2hpbGRPZmZzZXQgPSBvZmZzZXRzW2NoaWxkSW5kZXhdO1xuICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkIGlzIHRvIHRoZSByaWdodCBvZiB0aGUgc2xpY2UgYm91bmRhcnksIGV4Y2x1ZGVcbiAgICAgICAgICAgIGlmIChjaGlsZE9mZnNldCA+PSBvZmZzZXQgKyBsZW5ndGgpIHsgY29udGludWU7IH1cbiAgICAgICAgICAgIC8vIElmIHRoZSBjaGlsZCBpcyB0byB0aGUgbGVmdCBvZiBvZiB0aGUgc2xpY2UgYm91bmRhcnksIGV4Y2x1ZGVcbiAgICAgICAgICAgIGlmIChvZmZzZXQgPj0gY2hpbGRPZmZzZXQgKyBjaGlsZExlbmd0aCkgeyBjb250aW51ZTsgfVxuICAgICAgICAgICAgLy8gSWYgdGhlIGNoaWxkIGlzIGJldHdlZW4gYm90aCBsZWZ0IGFuZCByaWdodCBib3VuZGFyaWVzLCBpbmNsdWRlIHcvbyBzbGljaW5nXG4gICAgICAgICAgICBpZiAoY2hpbGRPZmZzZXQgPj0gb2Zmc2V0ICYmIChjaGlsZE9mZnNldCArIGNoaWxkTGVuZ3RoKSA8PSBvZmZzZXQgKyBsZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBjaHVua1NsaWNlcy5wdXNoKGNoaWxkKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIHRoZSBjaGlsZCBvdmVybGFwcyBvbmUgb2YgdGhlIHNsaWNlIGJvdW5kYXJpZXMsIGluY2x1ZGUgdGhhdCBzbGljZVxuICAgICAgICAgICAgY29uc3QgYmVnaW4gPSBNYXRoLm1heCgwLCBvZmZzZXQgLSBjaGlsZE9mZnNldCk7XG4gICAgICAgICAgICBjb25zdCBlbmQgPSBiZWdpbiArIE1hdGgubWluKGNoaWxkTGVuZ3RoIC0gYmVnaW4sIChvZmZzZXQgKyBsZW5ndGgpIC0gY2hpbGRPZmZzZXQpO1xuICAgICAgICAgICAgY2h1bmtTbGljZXMucHVzaChjaGlsZC5zbGljZShiZWdpbiwgZW5kKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2xvbmUuX2NoaWxkVmVjdG9ycyA9IGNodW5rU2xpY2VzO1xuICAgICAgICBjbG9uZS5fY2hpbGRPZmZzZXRzID0gQ2h1bmtlZERhdGEuY29tcHV0ZU9mZnNldHMoY2h1bmtTbGljZXMpO1xuICAgICAgICByZXR1cm4gY2xvbmU7XG4gICAgfVxuICAgIHN0YXRpYyBjb21wdXRlT2Zmc2V0czxUIGV4dGVuZHMgRGF0YVR5cGU+KGNoaWxkVmVjdG9yczogVmVjdG9yPFQ+W10pIHtcbiAgICAgICAgY29uc3QgY2hpbGRPZmZzZXRzID0gbmV3IFVpbnQzMkFycmF5KGNoaWxkVmVjdG9ycy5sZW5ndGggKyAxKTtcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwLCBsZW5ndGggPSBjaGlsZE9mZnNldHMubGVuZ3RoLCBjaGlsZE9mZnNldCA9IGNoaWxkT2Zmc2V0c1swXSA9IDA7ICsraW5kZXggPCBsZW5ndGg7KSB7XG4gICAgICAgICAgICBjaGlsZE9mZnNldHNbaW5kZXhdID0gKGNoaWxkT2Zmc2V0ICs9IGNoaWxkVmVjdG9yc1tpbmRleCAtIDFdLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoaWxkT2Zmc2V0cztcbiAgICB9XG59XG4iXX0=
