"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const type_1 = require("./type");
class Schema {
    constructor(fields, metadata, dictionaries, dictionaryFields) {
        this._fields = fields;
        this._metadata = metadata || Schema.prototype._metadata;
        if (!dictionaries || !dictionaryFields) {
            ({ dictionaries, dictionaryFields } = generateDictionaryMap(fields, dictionaries || new Map(), dictionaryFields || new Map()));
        }
        this._dictionaries = dictionaries;
        this._dictionaryFields = dictionaryFields;
    }
    /** @nocollapse */
    static from(vectors, names = []) {
        return new Schema(vectors.map((v, i) => new Field('' + (names[i] || i), v.type)));
    }
    get fields() { return this._fields; }
    get metadata() { return this._metadata; }
    get dictionaries() { return this._dictionaries; }
    get dictionaryFields() { return this._dictionaryFields; }
    select(...columnNames) {
        const names = columnNames.reduce((xs, x) => (xs[x] = true) && xs, Object.create(null));
        return new Schema(this.fields.filter((f) => names[f.name]), this.metadata);
    }
}
Schema[Symbol.toStringTag] = ((prototype) => {
    prototype._metadata = Object.freeze(new Map());
    return 'Schema';
})(Schema.prototype);
exports.Schema = Schema;
class Field {
    constructor(name, type, nullable = false, metadata) {
        this._name = name;
        this._type = type;
        this._nullable = nullable;
        this._metadata = metadata;
    }
    get type() { return this._type; }
    get name() { return this._name; }
    get typeId() { return this.type.TType; }
    get nullable() { return this._nullable; }
    get metadata() { return this._metadata; }
    get [Symbol.toStringTag]() { return 'Field'; }
    get indices() {
        return type_1.DataType.isDictionary(this.type) ? this.type.indices : this.type;
    }
    toString() { return `${this.name}: ${this.type}`; }
}
exports.Field = Field;
function generateDictionaryMap(fields, dictionaries, dictionaryFields) {
    for (let i = -1, n = fields.length; ++i < n;) {
        const field = fields[i];
        const type = field.type;
        if (type_1.DataType.isDictionary(type)) {
            if (!dictionaryFields.get(type.id)) {
                dictionaryFields.set(type.id, []);
            }
            if (!dictionaries.has(type.id)) {
                dictionaries.set(type.id, type.dictionary);
                dictionaryFields.get(type.id).push(field);
            }
            else if (dictionaries.get(type.id) !== type.dictionary) {
                throw new Error(`Cannot create Schema containing two different dictionaries with the same Id`);
            }
        }
        if (type.children) {
            generateDictionaryMap(type.children, dictionaries, dictionaryFields);
        }
    }
    return { dictionaries, dictionaryFields };
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjaGVtYS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsNkRBQTZEO0FBQzdELCtEQUErRDtBQUMvRCx3REFBd0Q7QUFDeEQsNkRBQTZEO0FBQzdELG9EQUFvRDtBQUNwRCw2REFBNkQ7QUFDN0QsNkRBQTZEO0FBQzdELEVBQUU7QUFDRiwrQ0FBK0M7QUFDL0MsRUFBRTtBQUNGLDZEQUE2RDtBQUM3RCw4REFBOEQ7QUFDOUQseURBQXlEO0FBQ3pELDREQUE0RDtBQUM1RCwwREFBMEQ7QUFDMUQscUJBQXFCOztBQUVyQixpQ0FBOEM7QUFHOUMsTUFBYSxNQUFNO0lBZ0JmLFlBQVksTUFBZSxFQUNmLFFBQThCLEVBQzlCLFlBQW9DLEVBQ3BDLGdCQUFtRDtRQUMzRCxJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztRQUN0QixJQUFJLENBQUMsU0FBUyxHQUFHLFFBQVEsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQztRQUN4RCxJQUFJLENBQUMsWUFBWSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7WUFDcEMsQ0FBQyxFQUFFLFlBQVksRUFBRSxnQkFBZ0IsRUFBRSxHQUFHLHFCQUFxQixDQUN2RCxNQUFNLEVBQUUsWUFBWSxJQUFJLElBQUksR0FBRyxFQUFFLEVBQUUsZ0JBQWdCLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FDbkUsQ0FBQyxDQUFDO1NBQ047UUFDRCxJQUFJLENBQUMsYUFBYSxHQUFHLFlBQVksQ0FBQztRQUNsQyxJQUFJLENBQUMsaUJBQWlCLEdBQUcsZ0JBQWdCLENBQUM7SUFDOUMsQ0FBQztJQTNCRCxrQkFBa0I7SUFDWCxNQUFNLENBQUMsSUFBSSxDQUE4QyxPQUE0QixFQUFFLFFBQXFCLEVBQUU7UUFDakgsT0FBTyxJQUFJLE1BQU0sQ0FBSSxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxLQUFLLENBQUMsRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekYsQ0FBQztJQU1ELElBQVcsTUFBTSxLQUFjLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDckQsSUFBVyxRQUFRLEtBQTBCLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7SUFDckUsSUFBVyxZQUFZLEtBQTRCLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7SUFDL0UsSUFBVyxnQkFBZ0IsS0FBdUMsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO0lBZ0IzRixNQUFNLENBQTBCLEdBQUcsV0FBZ0I7UUFDdEQsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDdkYsT0FBTyxJQUFJLE1BQU0sQ0FBcUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDbkcsQ0FBQzs7QUFDYSxPQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsU0FBaUIsRUFBRSxFQUFFO0lBQ3ZELFNBQWlCLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3hELE9BQU8sUUFBUSxDQUFDO0FBQ3BCLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztBQXJDekIsd0JBc0NDO0FBRUQsTUFBYSxLQUFLO0lBS2QsWUFBWSxJQUFZLEVBQUUsSUFBTyxFQUFFLFdBQXlCLEtBQUssRUFBRSxRQUFxQztRQUNwRyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQztRQUMxQixJQUFJLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQztJQUM5QixDQUFDO0lBQ0QsSUFBVyxJQUFJLEtBQUssT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUN4QyxJQUFXLElBQUksS0FBSyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ3hDLElBQVcsTUFBTSxLQUFLLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQy9DLElBQVcsUUFBUSxLQUFLLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7SUFDaEQsSUFBVyxRQUFRLEtBQUssT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUNoRCxJQUFXLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxLQUFhLE9BQU8sT0FBTyxDQUFDLENBQUMsQ0FBQztJQUM3RCxJQUFXLE9BQU87UUFDZCxPQUFPLGVBQVEsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztJQUM1RSxDQUFDO0lBQ00sUUFBUSxLQUFLLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7Q0FDN0Q7QUFyQkQsc0JBcUJDO0FBRUQsU0FBUyxxQkFBcUIsQ0FBQyxNQUFlLEVBQUUsWUFBbUMsRUFBRSxnQkFBa0Q7SUFFbkksS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUc7UUFDMUMsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFDeEIsSUFBSSxlQUFRLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzdCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFO2dCQUNoQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQzthQUNyQztZQUNELElBQUksQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRTtnQkFDNUIsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDM0MsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUUsQ0FBQyxJQUFJLENBQUMsS0FBWSxDQUFDLENBQUM7YUFDckQ7aUJBQU0sSUFBSSxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxJQUFJLENBQUMsVUFBVSxFQUFFO2dCQUN0RCxNQUFNLElBQUksS0FBSyxDQUFDLDZFQUE2RSxDQUFDLENBQUM7YUFDbEc7U0FDSjtRQUNELElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNmLHFCQUFxQixDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsWUFBWSxFQUFFLGdCQUFnQixDQUFDLENBQUM7U0FDeEU7S0FDSjtJQUVELE9BQU8sRUFBRSxZQUFZLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQztBQUM5QyxDQUFDIiwiZmlsZSI6InNjaGVtYS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBEYXRhVHlwZSwgRGljdGlvbmFyeSB9IGZyb20gJy4vdHlwZSc7XG5pbXBvcnQgeyBWZWN0b3IgYXMgVlR5cGUgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuXG5leHBvcnQgY2xhc3MgU2NoZW1hPFQgZXh0ZW5kcyB7IFtrZXk6IHN0cmluZ106IERhdGFUeXBlIH0gPSBhbnk+IHtcblxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xuICAgIHB1YmxpYyBzdGF0aWMgZnJvbTxUIGV4dGVuZHMgeyBba2V5OiBzdHJpbmddOiBEYXRhVHlwZSB9ID0gYW55Pih2ZWN0b3JzOiBWVHlwZTxUW2tleW9mIFRdPltdLCBuYW1lczogKGtleW9mIFQpW10gPSBbXSkge1xuICAgICAgICByZXR1cm4gbmV3IFNjaGVtYTxUPih2ZWN0b3JzLm1hcCgodiwgaSkgPT4gbmV3IEZpZWxkKCcnICsgKG5hbWVzW2ldIHx8IGkpLCB2LnR5cGUpKSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9maWVsZHM6IEZpZWxkW107XG4gICAgcHJvdGVjdGVkIF9tZXRhZGF0YTogTWFwPHN0cmluZywgc3RyaW5nPjtcbiAgICBwcm90ZWN0ZWQgX2RpY3Rpb25hcmllczogTWFwPG51bWJlciwgRGF0YVR5cGU+O1xuICAgIHByb3RlY3RlZCBfZGljdGlvbmFyeUZpZWxkczogTWFwPG51bWJlciwgRmllbGQ8RGljdGlvbmFyeT5bXT47XG4gICAgcHVibGljIGdldCBmaWVsZHMoKTogRmllbGRbXSB7IHJldHVybiB0aGlzLl9maWVsZHM7IH1cbiAgICBwdWJsaWMgZ2V0IG1ldGFkYXRhKCk6IE1hcDxzdHJpbmcsIHN0cmluZz4geyByZXR1cm4gdGhpcy5fbWV0YWRhdGE7IH1cbiAgICBwdWJsaWMgZ2V0IGRpY3Rpb25hcmllcygpOiBNYXA8bnVtYmVyLCBEYXRhVHlwZT4geyByZXR1cm4gdGhpcy5fZGljdGlvbmFyaWVzOyB9XG4gICAgcHVibGljIGdldCBkaWN0aW9uYXJ5RmllbGRzKCk6IE1hcDxudW1iZXIsIEZpZWxkPERpY3Rpb25hcnk+W10+IHsgcmV0dXJuIHRoaXMuX2RpY3Rpb25hcnlGaWVsZHM7IH1cblxuICAgIGNvbnN0cnVjdG9yKGZpZWxkczogRmllbGRbXSxcbiAgICAgICAgICAgICAgICBtZXRhZGF0YT86IE1hcDxzdHJpbmcsIHN0cmluZz4sXG4gICAgICAgICAgICAgICAgZGljdGlvbmFyaWVzPzogTWFwPG51bWJlciwgRGF0YVR5cGU+LFxuICAgICAgICAgICAgICAgIGRpY3Rpb25hcnlGaWVsZHM/OiBNYXA8bnVtYmVyLCBGaWVsZDxEaWN0aW9uYXJ5PltdPikge1xuICAgICAgICB0aGlzLl9maWVsZHMgPSBmaWVsZHM7XG4gICAgICAgIHRoaXMuX21ldGFkYXRhID0gbWV0YWRhdGEgfHwgU2NoZW1hLnByb3RvdHlwZS5fbWV0YWRhdGE7XG4gICAgICAgIGlmICghZGljdGlvbmFyaWVzIHx8ICFkaWN0aW9uYXJ5RmllbGRzKSB7XG4gICAgICAgICAgICAoeyBkaWN0aW9uYXJpZXMsIGRpY3Rpb25hcnlGaWVsZHMgfSA9IGdlbmVyYXRlRGljdGlvbmFyeU1hcChcbiAgICAgICAgICAgICAgICBmaWVsZHMsIGRpY3Rpb25hcmllcyB8fCBuZXcgTWFwKCksIGRpY3Rpb25hcnlGaWVsZHMgfHwgbmV3IE1hcCgpXG4gICAgICAgICAgICApKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9kaWN0aW9uYXJpZXMgPSBkaWN0aW9uYXJpZXM7XG4gICAgICAgIHRoaXMuX2RpY3Rpb25hcnlGaWVsZHMgPSBkaWN0aW9uYXJ5RmllbGRzO1xuICAgIH1cbiAgICBwdWJsaWMgc2VsZWN0PEsgZXh0ZW5kcyBrZXlvZiBUID0gYW55PiguLi5jb2x1bW5OYW1lczogS1tdKSB7XG4gICAgICAgIGNvbnN0IG5hbWVzID0gY29sdW1uTmFtZXMucmVkdWNlKCh4cywgeCkgPT4gKHhzW3hdID0gdHJ1ZSkgJiYgeHMsIE9iamVjdC5jcmVhdGUobnVsbCkpO1xuICAgICAgICByZXR1cm4gbmV3IFNjaGVtYTx7IFtQIGluIEtdOiBUW1BdIH0+KHRoaXMuZmllbGRzLmZpbHRlcigoZikgPT4gbmFtZXNbZi5uYW1lXSksIHRoaXMubWV0YWRhdGEpO1xuICAgIH1cbiAgICBwdWJsaWMgc3RhdGljIFtTeW1ib2wudG9TdHJpbmdUYWddID0gKChwcm90b3R5cGU6IFNjaGVtYSkgPT4ge1xuICAgICAgICAocHJvdG90eXBlIGFzIGFueSkuX21ldGFkYXRhID0gT2JqZWN0LmZyZWV6ZShuZXcgTWFwKCkpO1xuICAgICAgICByZXR1cm4gJ1NjaGVtYSc7XG4gICAgfSkoU2NoZW1hLnByb3RvdHlwZSk7XG59XG5cbmV4cG9ydCBjbGFzcyBGaWVsZDxUIGV4dGVuZHMgRGF0YVR5cGUgPSBEYXRhVHlwZT4ge1xuICAgIHByb3RlY3RlZCBfdHlwZTogVDtcbiAgICBwcm90ZWN0ZWQgX25hbWU6IHN0cmluZztcbiAgICBwcm90ZWN0ZWQgX251bGxhYmxlOiB0cnVlIHwgZmFsc2U7XG4gICAgcHJvdGVjdGVkIF9tZXRhZGF0YT86IE1hcDxzdHJpbmcsIHN0cmluZz4gfCBudWxsO1xuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgdHlwZTogVCwgbnVsbGFibGU6IHRydWUgfCBmYWxzZSA9IGZhbHNlLCBtZXRhZGF0YT86IE1hcDxzdHJpbmcsIHN0cmluZz4gfCBudWxsKSB7XG4gICAgICAgIHRoaXMuX25hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLl90eXBlID0gdHlwZTtcbiAgICAgICAgdGhpcy5fbnVsbGFibGUgPSBudWxsYWJsZTtcbiAgICAgICAgdGhpcy5fbWV0YWRhdGEgPSBtZXRhZGF0YTtcbiAgICB9XG4gICAgcHVibGljIGdldCB0eXBlKCkgeyByZXR1cm4gdGhpcy5fdHlwZTsgfVxuICAgIHB1YmxpYyBnZXQgbmFtZSgpIHsgcmV0dXJuIHRoaXMuX25hbWU7IH1cbiAgICBwdWJsaWMgZ2V0IHR5cGVJZCgpIHsgcmV0dXJuIHRoaXMudHlwZS5UVHlwZTsgfVxuICAgIHB1YmxpYyBnZXQgbnVsbGFibGUoKSB7IHJldHVybiB0aGlzLl9udWxsYWJsZTsgfVxuICAgIHB1YmxpYyBnZXQgbWV0YWRhdGEoKSB7IHJldHVybiB0aGlzLl9tZXRhZGF0YTsgfVxuICAgIHB1YmxpYyBnZXQgW1N5bWJvbC50b1N0cmluZ1RhZ10oKTogc3RyaW5nIHsgcmV0dXJuICdGaWVsZCc7IH1cbiAgICBwdWJsaWMgZ2V0IGluZGljZXMoKSB7XG4gICAgICAgIHJldHVybiBEYXRhVHlwZS5pc0RpY3Rpb25hcnkodGhpcy50eXBlKSA/IHRoaXMudHlwZS5pbmRpY2VzIDogdGhpcy50eXBlO1xuICAgIH1cbiAgICBwdWJsaWMgdG9TdHJpbmcoKSB7IHJldHVybiBgJHt0aGlzLm5hbWV9OiAke3RoaXMudHlwZX1gOyB9XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlRGljdGlvbmFyeU1hcChmaWVsZHM6IEZpZWxkW10sIGRpY3Rpb25hcmllczogTWFwPG51bWJlciwgRGF0YVR5cGU+LCBkaWN0aW9uYXJ5RmllbGRzOiBNYXA8bnVtYmVyLCBGaWVsZDxEaWN0aW9uYXJ5PltdPikge1xuXG4gICAgZm9yIChsZXQgaSA9IC0xLCBuID0gZmllbGRzLmxlbmd0aDsgKytpIDwgbjspIHtcbiAgICAgICAgY29uc3QgZmllbGQgPSBmaWVsZHNbaV07XG4gICAgICAgIGNvbnN0IHR5cGUgPSBmaWVsZC50eXBlO1xuICAgICAgICBpZiAoRGF0YVR5cGUuaXNEaWN0aW9uYXJ5KHR5cGUpKSB7XG4gICAgICAgICAgICBpZiAoIWRpY3Rpb25hcnlGaWVsZHMuZ2V0KHR5cGUuaWQpKSB7XG4gICAgICAgICAgICAgICAgZGljdGlvbmFyeUZpZWxkcy5zZXQodHlwZS5pZCwgW10pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFkaWN0aW9uYXJpZXMuaGFzKHR5cGUuaWQpKSB7XG4gICAgICAgICAgICAgICAgZGljdGlvbmFyaWVzLnNldCh0eXBlLmlkLCB0eXBlLmRpY3Rpb25hcnkpO1xuICAgICAgICAgICAgICAgIGRpY3Rpb25hcnlGaWVsZHMuZ2V0KHR5cGUuaWQpIS5wdXNoKGZpZWxkIGFzIGFueSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRpY3Rpb25hcmllcy5nZXQodHlwZS5pZCkgIT09IHR5cGUuZGljdGlvbmFyeSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNyZWF0ZSBTY2hlbWEgY29udGFpbmluZyB0d28gZGlmZmVyZW50IGRpY3Rpb25hcmllcyB3aXRoIHRoZSBzYW1lIElkYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGUuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIGdlbmVyYXRlRGljdGlvbmFyeU1hcCh0eXBlLmNoaWxkcmVuLCBkaWN0aW9uYXJpZXMsIGRpY3Rpb25hcnlGaWVsZHMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgZGljdGlvbmFyaWVzLCBkaWN0aW9uYXJ5RmllbGRzIH07XG59XG4iXX0=
