// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import { ChunkedData, FlatData, BoolData } from './data';
import { TypeVisitor, VectorVisitor } from './visitor';
import { Precision, DateUnit, IntervalUnit, UnionMode } from './type';
export class Vector {
    constructor(data, view) {
        this.data = data;
        this.type = data.type;
        this.length = data.length;
        let nulls;
        if ((data instanceof ChunkedData) && !(view instanceof ChunkedView)) {
            this.view = new ChunkedView(data);
        }
        else if (!(view instanceof ValidityView) && (nulls = data.nullBitmap) && nulls.length > 0 && data.nullCount > 0) {
            this.view = new ValidityView(data, view);
        }
        else {
            this.view = view;
        }
    }
    static create(data) {
        return createVector(data);
    }
    get nullCount() { return this.data.nullCount; }
    get nullBitmap() { return this.data.nullBitmap; }
    get [Symbol.toStringTag]() {
        return `Vector<${this.type[Symbol.toStringTag]}>`;
    }
    toJSON() { return this.toArray(); }
    clone(data, view = this.view.clone(data)) {
        return new this.constructor(data, view);
    }
    isValid(index) {
        return this.view.isValid(index);
    }
    get(index) {
        return this.view.get(index);
    }
    set(index, value) {
        return this.view.set(index, value);
    }
    toArray() {
        return this.view.toArray();
    }
    [Symbol.iterator]() {
        return this.view[Symbol.iterator]();
    }
    concat(...others) {
        if ((others = others.filter(Boolean)).length === 0) {
            return this;
        }
        const { view } = this;
        const vecs = !(view instanceof ChunkedView)
            ? [this, ...others]
            : [...view.chunks, ...others];
        const offsets = ChunkedData.computeOffsets(vecs);
        const chunksLength = offsets[offsets.length - 1];
        const chunkedData = new ChunkedData(this.type, chunksLength, vecs, 0, -1, offsets);
        return this.clone(chunkedData, new ChunkedView(chunkedData));
    }
    slice(begin, end) {
        let { length } = this;
        let size = this.view.size || 1;
        let total = length, from = (begin || 0) * size;
        let to = (typeof end === 'number' ? end : total) * size;
        if (to < 0) {
            to = total - (to * -1) % total;
        }
        if (from < 0) {
            from = total - (from * -1) % total;
        }
        if (to < from) {
            [from, to] = [to, from];
        }
        total = !isFinite(total = (to - from)) || total < 0 ? 0 : total;
        const slicedData = this.data.slice(from, Math.min(total, length));
        return this.clone(slicedData, this.view.clone(slicedData));
    }
    acceptTypeVisitor(visitor) {
        return TypeVisitor.visitTypeInline(visitor, this.type);
    }
    acceptVectorVisitor(visitor) {
        return VectorVisitor.visitTypeInline(visitor, this.type, this);
    }
}
export class FlatVector extends Vector {
    get values() { return this.data.values; }
    lows() { return this.asInt32(0, 2); }
    highs() { return this.asInt32(1, 2); }
    asInt32(offset = 0, stride = 2) {
        let data = this.data.clone(new Int32());
        if (offset > 0) {
            data = data.slice(offset, this.length - offset);
        }
        const int32s = new IntVector(data, new PrimitiveView(data, stride));
        int32s.length = this.length / stride | 0;
        return int32s;
    }
}
export class ListVectorBase extends Vector {
    get values() { return this.data.values; }
    get valueOffsets() { return this.data.valueOffsets; }
    getValueOffset(index) {
        return this.valueOffsets[index];
    }
    getValueLength(index) {
        return this.valueOffsets[index + 1] - this.valueOffsets[index];
    }
}
export class NestedVector extends Vector {
    get childData() {
        return this.data.childData;
    }
    getChildAt(index) {
        return this.view.getChildAt(index);
    }
}
import { Binary, Utf8, Bool, } from './type';
import { Uint8, Uint16, Uint32, Uint64, Int8, Int16, Int32, Int64, Float16, Float32, Float64 } from './type';
import { Struct, Map_ } from './type';
import { ChunkedView } from './vector/chunked';
import { DictionaryView } from './vector/dictionary';
import { ListView, FixedSizeListView, BinaryView, Utf8View } from './vector/list';
import { UnionView, DenseUnionView, StructView, MapView } from './vector/nested';
import { FlatView, NullView, BoolView, ValidityView, FixedSizeView, Float16View, DateDayView, DateMillisecondView, IntervalYearMonthView, PrimitiveView } from './vector/flat';
import { packBools } from './util/bit';
export class NullVector extends Vector {
    constructor(data, view = new NullView(data)) {
        super(data, view);
    }
}
export class BoolVector extends Vector {
    static from(data) {
        return new BoolVector(new BoolData(new Bool(), data.length, null, packBools(data)));
    }
    get values() { return this.data.values; }
    constructor(data, view = new BoolView(data)) {
        super(data, view);
    }
}
export class IntVector extends FlatVector {
    constructor(data, view = IntVector.defaultView(data)) {
        super(data, view);
    }
    static from(data, is64) {
        if (is64 === true) {
            return data instanceof Int32Array
                ? new IntVector(new FlatData(new Int64(), data.length, null, data))
                : new IntVector(new FlatData(new Uint64(), data.length, null, data));
        }
        switch (data.constructor) {
            case Int8Array: return new IntVector(new FlatData(new Int8(), data.length, null, data));
            case Int16Array: return new IntVector(new FlatData(new Int16(), data.length, null, data));
            case Int32Array: return new IntVector(new FlatData(new Int32(), data.length, null, data));
            case Uint8Array: return new IntVector(new FlatData(new Uint8(), data.length, null, data));
            case Uint16Array: return new IntVector(new FlatData(new Uint16(), data.length, null, data));
            case Uint32Array: return new IntVector(new FlatData(new Uint32(), data.length, null, data));
        }
        throw new TypeError('Unrecognized Int data');
    }
    static defaultView(data) {
        return data.type.bitWidth <= 32 ? new FlatView(data) : new FixedSizeView(data, (data.type.bitWidth / 32) | 0);
    }
}
export class FloatVector extends FlatVector {
    constructor(data, view = FloatVector.defaultView(data)) {
        super(data, view);
    }
    static from(data) {
        switch (data.constructor) {
            case Uint16Array: return new FloatVector(new FlatData(new Float16(), data.length, null, data));
            case Float32Array: return new FloatVector(new FlatData(new Float32(), data.length, null, data));
            case Float64Array: return new FloatVector(new FlatData(new Float64(), data.length, null, data));
        }
        throw new TypeError('Unrecognized Float data');
    }
    static defaultView(data) {
        return data.type.precision !== Precision.HALF ? new FlatView(data) : new Float16View(data);
    }
}
export class DateVector extends FlatVector {
    static defaultView(data) {
        return data.type.unit === DateUnit.DAY ? new DateDayView(data) : new DateMillisecondView(data, 2);
    }
    constructor(data, view = DateVector.defaultView(data)) {
        super(data, view);
    }
    lows() {
        return this.type.unit === DateUnit.DAY ? this.asInt32(0, 1) : this.asInt32(0, 2);
    }
    highs() {
        return this.type.unit === DateUnit.DAY ? this.asInt32(0, 1) : this.asInt32(1, 2);
    }
}
export class DecimalVector extends FlatVector {
    constructor(data, view = new FixedSizeView(data, 4)) {
        super(data, view);
    }
}
export class TimeVector extends FlatVector {
    static defaultView(data) {
        return data.type.bitWidth <= 32 ? new FlatView(data) : new FixedSizeView(data, (data.type.bitWidth / 32) | 0);
    }
    constructor(data, view = TimeVector.defaultView(data)) {
        super(data, view);
    }
    lows() {
        return this.type.bitWidth <= 32 ? this.asInt32(0, 1) : this.asInt32(0, 2);
    }
    highs() {
        return this.type.bitWidth <= 32 ? this.asInt32(0, 1) : this.asInt32(1, 2);
    }
}
export class TimestampVector extends FlatVector {
    constructor(data, view = new FixedSizeView(data, 2)) {
        super(data, view);
    }
}
export class IntervalVector extends FlatVector {
    static defaultView(data) {
        return data.type.unit === IntervalUnit.YEAR_MONTH ? new IntervalYearMonthView(data) : new FixedSizeView(data, 2);
    }
    constructor(data, view = IntervalVector.defaultView(data)) {
        super(data, view);
    }
    lows() {
        return this.type.unit === IntervalUnit.YEAR_MONTH ? this.asInt32(0, 1) : this.asInt32(0, 2);
    }
    highs() {
        return this.type.unit === IntervalUnit.YEAR_MONTH ? this.asInt32(0, 1) : this.asInt32(1, 2);
    }
}
export class BinaryVector extends ListVectorBase {
    constructor(data, view = new BinaryView(data)) {
        super(data, view);
    }
    asUtf8() {
        return new Utf8Vector(this.data.clone(new Utf8()));
    }
}
export class FixedSizeBinaryVector extends FlatVector {
    constructor(data, view = new FixedSizeView(data, data.type.byteWidth)) {
        super(data, view);
    }
}
export class Utf8Vector extends ListVectorBase {
    constructor(data, view = new Utf8View(data)) {
        super(data, view);
    }
    asBinary() {
        return new BinaryVector(this.data.clone(new Binary()));
    }
}
export class ListVector extends ListVectorBase {
    constructor(data, view = new ListView(data)) {
        super(data, view);
    }
}
export class FixedSizeListVector extends ListVectorBase {
    constructor(data, view = new FixedSizeListView(data)) {
        super(data, view);
    }
}
export class MapVector extends NestedVector {
    constructor(data, view = new MapView(data)) {
        super(data, view);
    }
    asStruct() {
        return new StructVector(this.data.clone(new Struct(this.type.children)));
    }
}
export class StructVector extends NestedVector {
    constructor(data, view = new StructView(data)) {
        super(data, view);
    }
    asMap(keysSorted = false) {
        return new MapVector(this.data.clone(new Map_(keysSorted, this.type.children)));
    }
}
export class UnionVector extends NestedVector {
    constructor(data, view = (data.type.mode === UnionMode.Sparse ? new UnionView(data) : new DenseUnionView(data))) {
        super(data, view);
    }
}
export class DictionaryVector extends Vector {
    constructor(data, view = new DictionaryView(data.dictionary, new IntVector(data.indicies))) {
        super(data, view);
        if (view instanceof DictionaryView) {
            this.indicies = view.indicies;
            this.dictionary = view.dictionary;
        }
        else if (view instanceof ChunkedView) {
            this.dictionary = view.chunks[0].dictionary;
            this.indicies = view.chunks.reduce((idxs, dict) => !idxs ? dict.indicies : idxs.concat(dict.indicies), null);
        }
    }
    getKey(index) { return this.indicies.get(index); }
    getValue(key) { return this.dictionary.get(key); }
}
export const createVector = ((VectorLoader) => ((data) => TypeVisitor.visitTypeInline(new VectorLoader(data), data.type)))(class VectorLoader extends TypeVisitor {
    constructor(data) {
        super();
        this.data = data;
    }
    visitNull(_type) { return new NullVector(this.data); }
    visitInt(_type) { return new IntVector(this.data); }
    visitFloat(_type) { return new FloatVector(this.data); }
    visitBinary(_type) { return new BinaryVector(this.data); }
    visitUtf8(_type) { return new Utf8Vector(this.data); }
    visitBool(_type) { return new BoolVector(this.data); }
    visitDecimal(_type) { return new DecimalVector(this.data); }
    visitDate(_type) { return new DateVector(this.data); }
    visitTime(_type) { return new TimeVector(this.data); }
    visitTimestamp(_type) { return new TimestampVector(this.data); }
    visitInterval(_type) { return new IntervalVector(this.data); }
    visitList(_type) { return new ListVector(this.data); }
    visitStruct(_type) { return new StructVector(this.data); }
    visitUnion(_type) { return new UnionVector(this.data); }
    visitFixedSizeBinary(_type) { return new FixedSizeBinaryVector(this.data); }
    visitFixedSizeList(_type) { return new FixedSizeListVector(this.data); }
    visitMap(_type) { return new MapVector(this.data); }
    visitDictionary(_type) { return new DictionaryVector(this.data); }
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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Q0FBQyxJQUFJLFNBQVMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLElBQUksRUFBRSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDeEYsS0FBSyxVQUFVLEVBQUUsTUFBTSxDQUFDLElBQUksU0FBUyxDQUFDLElBQUksUUFBUSxDQUFDLElBQUksS0FBSyxFQUFFLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUMxRixLQUFLLFVBQVUsRUFBRSxNQUFNLENBQUMsSUFBSSxTQUFTLENBQUMsSUFBSSxRQUFRLENBQUMsSUFBSSxLQUFLLEVBQUUsRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzFGLEtBQUssVUFBVSxFQUFFLE1BQU0sQ0FBQyxJQUFJLFNBQVMsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLEtBQUssRUFBRSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDMUYsS0FBSyxXQUFXLEVBQUUsTUFBTSxDQUFDLElBQUksU0FBUyxDQUFDLElBQUksUUFBUSxDQUFDLElBQUksTUFBTSxFQUFFLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUM1RixLQUFLLFdBQVcsRUFBRSxNQUFNLENBQUMsSUFBSSxTQUFTLENBQUMsSUFBSSxRQUFRLENBQUMsSUFBSSxNQUFNLEVBQUUsRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2hHLENBQUM7UUFDRCxNQUFNLElBQUksU0FBUyxDQUFDLHVCQUF1QixDQUFDLENBQUM7SUFDakQsQ0FBQztJQUNELE1BQU0sQ0FBQyxXQUFXLENBQWdCLElBQWE7UUFDM0MsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJ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Ly8gTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IERhdGEsIENodW5rZWREYXRhLCBGbGF0RGF0YSwgQm9vbERhdGEsIEZsYXRMaXN0RGF0YSwgTmVzdGVkRGF0YSB9IGZyb20gJy4vZGF0YSc7XG5pbXBvcnQgeyBWaXNpdG9yTm9kZSwgVHlwZVZpc2l0b3IsIFZlY3RvclZpc2l0b3IgfSBmcm9tICcuL3Zpc2l0b3InO1xuaW1wb3J0IHsgRGF0YVR5cGUsIExpc3RUeXBlLCBGbGF0VHlwZSwgTmVzdGVkVHlwZSwgRmxhdExpc3RUeXBlIH0gZnJvbSAnLi90eXBlJztcbmltcG9ydCB7IEl0ZXJhYmxlQXJyYXlMaWtlLCBQcmVjaXNpb24sIERhdGVVbml0LCBJbnRlcnZhbFVuaXQsIFVuaW9uTW9kZSB9IGZyb20gJy4vdHlwZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmVjdG9yTGlrZSB7IGxlbmd0aDogbnVtYmVyOyBudWxsQ291bnQ6IG51bWJlcjsgfVxuXG5leHBvcnQgaW50ZXJmYWNlIFZpZXc8VCBleHRlbmRzIERhdGFUeXBlPiB7XG4gICAgY2xvbmUoZGF0YTogRGF0YTxUPik6IHRoaXM7XG4gICAgaXNWYWxpZChpbmRleDogbnVtYmVyKTogYm9vbGVhbjtcbiAgICBnZXQoaW5kZXg6IG51bWJlcik6IFRbJ1RWYWx1ZSddIHwgbnVsbDtcbiAgICBzZXQoaW5kZXg6IG51bWJlciwgdmFsdWU6IFRbJ1RWYWx1ZSddKTogdm9pZDtcbiAgICB0b0FycmF5KCk6IEl0ZXJhYmxlQXJyYXlMaWtlPFRbJ1RWYWx1ZSddIHwgbnVsbD47XG4gICAgW1N5bWJvbC5pdGVyYXRvcl0oKTogSXRlcmFibGVJdGVyYXRvcjxUWydUVmFsdWUnXSB8IG51bGw+O1xufVxuXG5leHBvcnQgY2xhc3MgVmVjdG9yPFQgZXh0ZW5kcyBEYXRhVHlwZSA9IGFueT4gaW1wbGVtZW50cyBWZWN0b3JMaWtlLCBWaWV3PFQ+LCBWaXNpdG9yTm9kZSB7XG4gICAgcHVibGljIHN0YXRpYyBjcmVhdGU8VCBleHRlbmRzIERhdGFUeXBlPihkYXRhOiBEYXRhPFQ+KTogVmVjdG9yPFQ+IHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZVZlY3RvcihkYXRhKTtcbiAgICB9XG4gICAgcHVibGljIHR5cGU6IFQ7XG4gICAgcHVibGljIGxlbmd0aDogbnVtYmVyO1xuICAgIHB1YmxpYyByZWFkb25seSBkYXRhOiBEYXRhPFQ+O1xuICAgIHB1YmxpYyByZWFkb25seSB2aWV3OiBWaWV3PFQ+O1xuICAgIGNvbnN0cnVjdG9yKGRhdGE6IERhdGE8VD4sIHZpZXc6IFZpZXc8VD4pIHtcbiAgICAgICAgdGhpcy5kYXRhID0gZGF0YTtcbiAgICAgICAgdGhpcy50eXBlID0gZGF0YS50eXBlO1xuICAgICAgICB0aGlzLmxlbmd0aCA9IGRhdGEubGVuZ3RoO1xuICAgICAgICBsZXQgbnVsbHM6IFVpbnQ4QXJyYXk7XG4gICAgICAgIGlmICgoPGFueT4gZGF0YSBpbnN0YW5jZW9mIENodW5rZWREYXRhKSAmJiAhKHZpZXcgaW5zdGFuY2VvZiBDaHVua2VkVmlldykpIHtcbiAgICAgICAgICAgIHRoaXMudmlldyA9IG5ldyBDaHVua2VkVmlldyhkYXRhKTtcbiAgICAgICAgfSBlbHNlIGlmICghKHZpZXcgaW5zdGFuY2VvZiBWYWxpZGl0eVZpZXcpICYmIChudWxscyA9IGRhdGEubnVsbEJpdG1hcCEpICYmIG51bGxzLmxlbmd0aCA+IDAgJiYgZGF0YS5udWxsQ291bnQgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnZpZXcgPSBuZXcgVmFsaWRpdHlWaWV3KGRhdGEsIHZpZXcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy52aWV3ID0gdmlldztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgbnVsbENvdW50KCkgeyByZXR1cm4gdGhpcy5kYXRhLm51bGxDb3VudDsgfVxuICAgIHB1YmxpYyBnZXQgbnVsbEJpdG1hcCgpIHsgcmV0dXJuIHRoaXMuZGF0YS5udWxsQml0bWFwOyB9XG4gICAgcHVibGljIGdldCBbU3ltYm9sLnRvU3RyaW5nVGFnXSgpIHtcbiAgICAgICAgcmV0dXJuIGBWZWN0b3I8JHt0aGlzLnR5cGVbU3ltYm9sLnRvU3RyaW5nVGFnXX0+YDtcbiAgICB9XG4gICAgcHVibGljIHRvSlNPTigpOiBhbnkgeyByZXR1cm4gdGhpcy50b0FycmF5KCk7IH1cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIFQ+KGRhdGE6IERhdGE8Uj4sIHZpZXc6IFZpZXc8Uj4gPSB0aGlzLnZpZXcuY2xvbmUoZGF0YSkgYXMgYW55KTogdGhpcyB7XG4gICAgICAgIHJldHVybiBuZXcgKHRoaXMuY29uc3RydWN0b3IgYXMgYW55KShkYXRhLCB2aWV3KTtcbiAgICB9XG4gICAgcHVibGljIGlzVmFsaWQoaW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3LmlzVmFsaWQoaW5kZXgpO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0KGluZGV4OiBudW1iZXIpOiBUWydUVmFsdWUnXSB8IG51bGwge1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3LmdldChpbmRleCk7XG4gICAgfVxuICAgIHB1YmxpYyBzZXQoaW5kZXg6IG51bWJlciwgdmFsdWU6IFRbJ1RWYWx1ZSddKTogdm9pZCB7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXcuc2V0KGluZGV4LCB2YWx1ZSk7XG4gICAgfVxuICAgIHB1YmxpYyB0b0FycmF5KCk6IEl0ZXJhYmxlQXJyYXlMaWtlPFRbJ1RWYWx1ZSddIHwgbnVsbD4ge1xuICAgICAgICByZXR1cm4gdGhpcy52aWV3LnRvQXJyYXkoKTtcbiAgICB9XG4gICAgcHVibGljIFtTeW1ib2wuaXRlcmF0b3JdKCk6IEl0ZXJhYmxlSXRlcmF0b3I8VFsnVFZhbHVlJ10gfCBudWxsPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgIH1cbiAgICBwdWJsaWMgY29uY2F0KC4uLm90aGVyczogVmVjdG9yPFQ+W10pOiB0aGlzIHtcbiAgICAgICAgaWYgKChvdGhlcnMgPSBvdGhlcnMuZmlsdGVyKEJvb2xlYW4pKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgdmlldyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgdmVjcyA9ICEodmlldyBpbnN0YW5jZW9mIENodW5rZWRWaWV3KVxuICAgICAgICAgICAgPyBbdGhpcywgLi4ub3RoZXJzXVxuICAgICAgICAgICAgOiBbLi4udmlldy5jaHVua3MsIC4uLm90aGVyc107XG4gICAgICAgIGNvbnN0IG9mZnNldHMgPSBDaHVua2VkRGF0YS5jb21wdXRlT2Zmc2V0cyh2ZWNzKTtcbiAgICAgICAgY29uc3QgY2h1bmtzTGVuZ3RoID0gb2Zmc2V0c1tvZmZzZXRzLmxlbmd0aCAtIDFdO1xuICAgICAgICBjb25zdCBjaHVua2VkRGF0YSA9IG5ldyBDaHVua2VkRGF0YSh0aGlzLnR5cGUsIGNodW5rc0xlbmd0aCwgdmVjcywgMCwgLTEsIG9mZnNldHMpO1xuICAgICAgICByZXR1cm4gdGhpcy5jbG9uZShjaHVua2VkRGF0YSwgbmV3IENodW5rZWRWaWV3KGNodW5rZWREYXRhKSkgYXMgdGhpcztcbiAgICB9XG4gICAgcHVibGljIHNsaWNlKGJlZ2luPzogbnVtYmVyLCBlbmQ/OiBudW1iZXIpOiB0aGlzIHtcbiAgICAgICAgbGV0IHsgbGVuZ3RoIH0gPSB0aGlzO1xuICAgICAgICBsZXQgc2l6ZSA9ICh0aGlzLnZpZXcgYXMgYW55KS5zaXplIHx8IDE7XG4gICAgICAgIGxldCB0b3RhbCA9IGxlbmd0aCwgZnJvbSA9IChiZWdpbiB8fCAwKSAqIHNpemU7XG4gICAgICAgIGxldCB0byA9ICh0eXBlb2YgZW5kID09PSAnbnVtYmVyJyA/IGVuZCA6IHRvdGFsKSAqIHNpemU7XG4gICAgICAgIGlmICh0byA8IDApIHsgdG8gPSB0b3RhbCAtICh0byAqIC0xKSAlIHRvdGFsOyB9XG4gICAgICAgIGlmIChmcm9tIDwgMCkgeyBmcm9tID0gdG90YWwgLSAoZnJvbSAqIC0xKSAlIHRvdGFsOyB9XG4gICAgICAgIGlmICh0byA8IGZyb20pIHsgW2Zyb20sIHRvXSA9IFt0bywgZnJvbV07IH1cbiAgICAgICAgdG90YWwgPSAhaXNGaW5pdGUodG90YWwgPSAodG8gLSBmcm9tKSkgfHwgdG90YWwgPCAwID8gMCA6IHRvdGFsO1xuICAgICAgICBjb25zdCBzbGljZWREYXRhID0gdGhpcy5kYXRhLnNsaWNlKGZyb20sIE1hdGgubWluKHRvdGFsLCBsZW5ndGgpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2xvbmUoc2xpY2VkRGF0YSwgdGhpcy52aWV3LmNsb25lKHNsaWNlZERhdGEpKSBhcyB0aGlzO1xuICAgIH1cblxuICAgIHB1YmxpYyBhY2NlcHRUeXBlVmlzaXRvcih2aXNpdG9yOiBUeXBlVmlzaXRvcik6IGFueSB7XG4gICAgICAgIHJldHVybiBUeXBlVmlzaXRvci52aXNpdFR5cGVJbmxpbmUodmlzaXRvciwgdGhpcy50eXBlKTtcbiAgICB9XG4gICAgcHVibGljIGFjY2VwdFZlY3RvclZpc2l0b3IodmlzaXRvcjogVmVjdG9yVmlzaXRvcik6IGFueSB7XG4gICAgICAgIHJldHVybiBWZWN0b3JWaXNpdG9yLnZpc2l0VHlwZUlubGluZSh2aXNpdG9yLCB0aGlzLnR5cGUsIHRoaXMpO1xuICAgIH1cbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEZsYXRWZWN0b3I8VCBleHRlbmRzIEZsYXRUeXBlPiBleHRlbmRzIFZlY3RvcjxUPiB7XG4gICAgcHVibGljIGdldCB2YWx1ZXMoKSB7IHJldHVybiB0aGlzLmRhdGEudmFsdWVzOyB9XG4gICAgcHVibGljIGxvd3MoKTogSW50VmVjdG9yPEludDMyPiB7IHJldHVybiB0aGlzLmFzSW50MzIoMCwgMik7IH1cbiAgICBwdWJsaWMgaGlnaHMoKTogSW50VmVjdG9yPEludDMyPiB7IHJldHVybiB0aGlzLmFzSW50MzIoMSwgMik7IH1cbiAgICBwdWJsaWMgYXNJbnQzMihvZmZzZXQ6IG51bWJlciA9IDAsIHN0cmlkZTogbnVtYmVyID0gMik6IEludFZlY3RvcjxJbnQzMj4ge1xuICAgICAgICBsZXQgZGF0YSA9ICh0aGlzLmRhdGEgYXMgRmxhdERhdGE8YW55PikuY2xvbmUobmV3IEludDMyKCkpO1xuICAgICAgICBpZiAob2Zmc2V0ID4gMCkge1xuICAgICAgICAgICAgZGF0YSA9IGRhdGEuc2xpY2Uob2Zmc2V0LCB0aGlzLmxlbmd0aCAtIG9mZnNldCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW50MzJzID0gbmV3IEludFZlY3RvcihkYXRhLCBuZXcgUHJpbWl0aXZlVmlldyhkYXRhLCBzdHJpZGUpKTtcbiAgICAgICAgaW50MzJzLmxlbmd0aCA9IHRoaXMubGVuZ3RoIC8gc3RyaWRlIHwgMDtcbiAgICAgICAgcmV0dXJuIGludDMycztcbiAgICB9XG59XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBMaXN0VmVjdG9yQmFzZTxUIGV4dGVuZHMgKExpc3RUeXBlIHwgRmxhdExpc3RUeXBlKT4gZXh0ZW5kcyBWZWN0b3I8VD4ge1xuICAgIHB1YmxpYyBnZXQgdmFsdWVzKCkgeyByZXR1cm4gdGhpcy5kYXRhLnZhbHVlczsgfVxuICAgIHB1YmxpYyBnZXQgdmFsdWVPZmZzZXRzKCkgeyByZXR1cm4gdGhpcy5kYXRhLnZhbHVlT2Zmc2V0czsgfVxuICAgIHB1YmxpYyBnZXRWYWx1ZU9mZnNldChpbmRleDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlT2Zmc2V0c1tpbmRleF07XG4gICAgfVxuICAgIHB1YmxpYyBnZXRWYWx1ZUxlbmd0aChpbmRleDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlT2Zmc2V0c1tpbmRleCArIDFdIC0gdGhpcy52YWx1ZU9mZnNldHNbaW5kZXhdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIE5lc3RlZFZlY3RvcjxUIGV4dGVuZHMgTmVzdGVkVHlwZT4gZXh0ZW5kcyBWZWN0b3I8VD4gIHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgcHVibGljIHJlYWRvbmx5IHZpZXc6IE5lc3RlZFZpZXc8VD47XG4gICAgcHVibGljIGdldCBjaGlsZERhdGEoKTogRGF0YTxhbnk+W10ge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLmNoaWxkRGF0YTtcbiAgICB9XG4gICAgcHVibGljIGdldENoaWxkQXQ8UiBleHRlbmRzIERhdGFUeXBlID0gRGF0YVR5cGU+KGluZGV4OiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmlldy5nZXRDaGlsZEF0PFI+KGluZGV4KTtcbiAgICB9XG59XG5cbmltcG9ydCB7IExpc3QsIEJpbmFyeSwgVXRmOCwgQm9vbCwgfSBmcm9tICcuL3R5cGUnO1xuaW1wb3J0IHsgTnVsbCwgSW50LCBGbG9hdCwgRGVjaW1hbCwgRGF0ZV8sIFRpbWUsIFRpbWVzdGFtcCwgSW50ZXJ2YWwgfSBmcm9tICcuL3R5cGUnO1xuaW1wb3J0IHsgVWludDgsIFVpbnQxNiwgVWludDMyLCBVaW50NjQsIEludDgsIEludDE2LCBJbnQzMiwgSW50NjQsIEZsb2F0MTYsIEZsb2F0MzIsIEZsb2F0NjQgfSBmcm9tICcuL3R5cGUnO1xuaW1wb3J0IHsgU3RydWN0LCBVbmlvbiwgU3BhcnNlVW5pb24sIERlbnNlVW5pb24sIEZpeGVkU2l6ZUJpbmFyeSwgRml4ZWRTaXplTGlzdCwgTWFwXywgRGljdGlvbmFyeSB9IGZyb20gJy4vdHlwZSc7XG5cbmltcG9ydCB7IENodW5rZWRWaWV3IH0gZnJvbSAnLi92ZWN0b3IvY2h1bmtlZCc7XG5pbXBvcnQgeyBEaWN0aW9uYXJ5VmlldyB9IGZyb20gJy4vdmVjdG9yL2RpY3Rpb25hcnknO1xuaW1wb3J0IHsgTGlzdFZpZXcsIEZpeGVkU2l6ZUxpc3RWaWV3LCBCaW5hcnlWaWV3LCBVdGY4VmlldyB9IGZyb20gJy4vdmVjdG9yL2xpc3QnO1xuaW1wb3J0IHsgVW5pb25WaWV3LCBEZW5zZVVuaW9uVmlldywgTmVzdGVkVmlldywgU3RydWN0VmlldywgTWFwVmlldyB9IGZyb20gJy4vdmVjdG9yL25lc3RlZCc7XG5pbXBvcnQgeyBGbGF0VmlldywgTnVsbFZpZXcsIEJvb2xWaWV3LCBWYWxpZGl0eVZpZXcsIEZpeGVkU2l6ZVZpZXcsIEZsb2F0MTZWaWV3LCBEYXRlRGF5VmlldywgRGF0ZU1pbGxpc2Vjb25kVmlldywgSW50ZXJ2YWxZZWFyTW9udGhWaWV3LCBQcmltaXRpdmVWaWV3IH0gZnJvbSAnLi92ZWN0b3IvZmxhdCc7XG5pbXBvcnQgeyBwYWNrQm9vbHMgfSBmcm9tICcuL3V0aWwvYml0JztcblxuZXhwb3J0IGNsYXNzIE51bGxWZWN0b3IgZXh0ZW5kcyBWZWN0b3I8TnVsbD4ge1xuICAgIGNvbnN0cnVjdG9yKGRhdGE6IERhdGE8TnVsbD4sIHZpZXc6IFZpZXc8TnVsbD4gPSBuZXcgTnVsbFZpZXcoZGF0YSkpIHtcbiAgICAgICAgc3VwZXIoZGF0YSwgdmlldyk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgQm9vbFZlY3RvciBleHRlbmRzIFZlY3RvcjxCb29sPiB7XG4gICAgcHVibGljIHN0YXRpYyBmcm9tKGRhdGE6IEl0ZXJhYmxlQXJyYXlMaWtlPGJvb2xlYW4+KSB7XG4gICAgICAgIHJldHVybiBuZXcgQm9vbFZlY3RvcihuZXcgQm9vbERhdGEobmV3IEJvb2woKSwgZGF0YS5sZW5ndGgsIG51bGwsIHBhY2tCb29scyhkYXRhKSkpO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IHZhbHVlcygpIHsgcmV0dXJuIHRoaXMuZGF0YS52YWx1ZXM7IH1cbiAgICBjb25zdHJ1Y3RvcihkYXRhOiBEYXRhPEJvb2w+LCB2aWV3OiBWaWV3PEJvb2w+ID0gbmV3IEJvb2xWaWV3KGRhdGEpKSB7XG4gICAgICAgIHN1cGVyKGRhdGEsIHZpZXcpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEludFZlY3RvcjxUIGV4dGVuZHMgSW50ID0gSW50PGFueT4+IGV4dGVuZHMgRmxhdFZlY3RvcjxUPiB7XG4gICAgcHVibGljIHN0YXRpYyBmcm9tKGRhdGE6IEludDhBcnJheSk6IEludFZlY3RvcjxJbnQ4PjtcbiAgICBwdWJsaWMgc3RhdGljIGZyb20oZGF0YTogSW50MTZBcnJheSk6IEludFZlY3RvcjxJbnQxNj47XG4gICAgcHVibGljIHN0YXRpYyBmcm9tKGRhdGE6IEludDMyQXJyYXkpOiBJbnRWZWN0b3I8SW50MzI+O1xuICAgIHB1YmxpYyBzdGF0aWMgZnJvbShkYXRhOiBVaW50OEFycmF5KTogSW50VmVjdG9yPFVpbnQ4PjtcbiAgICBwdWJsaWMgc3RhdGljIGZyb20oZGF0YTogVWludDE2QXJyYXkpOiBJbnRWZWN0b3I8VWludDE2PjtcbiAgICBwdWJsaWMgc3RhdGljIGZyb20oZGF0YTogVWludDMyQXJyYXkpOiBJbnRWZWN0b3I8VWludDMyPjtcbiAgICBwdWJsaWMgc3RhdGljIGZyb20oZGF0YTogSW50MzJBcnJheSwgaXM2NDogdHJ1ZSk6IEludFZlY3RvcjxJbnQ2ND47XG4gICAgcHVibGljIHN0YXRpYyBmcm9tKGRhdGE6IFVpbnQzMkFycmF5LCBpczY0OiB0cnVlKTogSW50VmVjdG9yPFVpbnQ2ND47XG4gICAgcHVibGljIHN0YXRpYyBmcm9tKGRhdGE6IGFueSwgaXM2ND86IGJvb2xlYW4pIHtcbiAgICAgICAgaWYgKGlzNjQgPT09IHRydWUpIHtcbiAgICAgICAgICAgIHJldHVybiBkYXRhIGluc3RhbmNlb2YgSW50MzJBcnJheVxuICAgICAgICAgICAgICAgID8gbmV3IEludFZlY3RvcihuZXcgRmxhdERhdGEobmV3IEludDY0KCksIGRhdGEubGVuZ3RoLCBudWxsLCBkYXRhKSlcbiAgICAgICAgICAgICAgICA6IG5ldyBJbnRWZWN0b3IobmV3IEZsYXREYXRhKG5ldyBVaW50NjQoKSwgZGF0YS5sZW5ndGgsIG51bGwsIGRhdGEpKTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKGRhdGEuY29uc3RydWN0b3IpIHtcbiAgICAgICAgICAgIGNhc2UgSW50OEFycmF5OiByZXR1cm4gbmV3IEludFZlY3RvcihuZXcgRmxhdERhdGEobmV3IEludDgoKSwgZGF0YS5sZW5ndGgsIG51bGwsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhc2UgSW50MTZBcnJheTogcmV0dXJuIG5ldyBJbnRWZWN0b3IobmV3IEZsYXREYXRhKG5ldyBJbnQxNigpLCBkYXRhLmxlbmd0aCwgbnVsbCwgZGF0YSkpO1xuICAgICAgICAgICAgY2FzZSBJbnQzMkFycmF5OiByZXR1cm4gbmV3IEludFZlY3RvcihuZXcgRmxhdERhdGEobmV3IEludDMyKCksIGRhdGEubGVuZ3RoLCBudWxsLCBkYXRhKSk7XG4gICAgICAgICAgICBjYXNlIFVpbnQ4QXJyYXk6IHJldHVybiBuZXcgSW50VmVjdG9yKG5ldyBGbGF0RGF0YShuZXcgVWludDgoKSwgZGF0YS5sZW5ndGgsIG51bGwsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhc2UgVWludDE2QXJyYXk6IHJldHVybiBuZXcgSW50VmVjdG9yKG5ldyBGbGF0RGF0YShuZXcgVWludDE2KCksIGRhdGEubGVuZ3RoLCBudWxsLCBkYXRhKSk7XG4gICAgICAgICAgICBjYXNlIFVpbnQzMkFycmF5OiByZXR1cm4gbmV3IEludFZlY3RvcihuZXcgRmxhdERhdGEobmV3IFVpbnQzMigpLCBkYXRhLmxlbmd0aCwgbnVsbCwgZGF0YSkpO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1VucmVjb2duaXplZCBJbnQgZGF0YScpO1xuICAgIH1cbiAgICBzdGF0aWMgZGVmYXVsdFZpZXc8VCBleHRlbmRzIEludD4oZGF0YTogRGF0YTxUPikge1xuICAgICAgICByZXR1cm4gZGF0YS50eXBlLmJpdFdpZHRoIDw9IDMyID8gbmV3IEZsYXRWaWV3KGRhdGEpIDogbmV3IEZpeGVkU2l6ZVZpZXcoZGF0YSwgKGRhdGEudHlwZS5iaXRXaWR0aCAvIDMyKSB8IDApO1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihkYXRhOiBEYXRhPFQ+LCB2aWV3OiBWaWV3PFQ+ID0gSW50VmVjdG9yLmRlZmF1bHRWaWV3KGRhdGEpKSB7XG4gICAgICAgIHN1cGVyKGRhdGEsIHZpZXcpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEZsb2F0VmVjdG9yPFQgZXh0ZW5kcyBGbG9hdCA9IEZsb2F0PGFueT4+IGV4dGVuZHMgRmxhdFZlY3RvcjxUPiB7XG4gICAgcHVibGljIHN0YXRpYyBmcm9tKGRhdGE6IFVpbnQxNkFycmF5KTogRmxvYXRWZWN0b3I8RmxvYXQxNj47XG4gICAgcHVibGljIHN0YXRpYyBmcm9tKGRhdGE6IEZsb2F0MzJBcnJheSk6IEZsb2F0VmVjdG9yPEZsb2F0MzI+O1xuICAgIHB1YmxpYyBzdGF0aWMgZnJvbShkYXRhOiBGbG9hdDY0QXJyYXkpOiBGbG9hdFZlY3RvcjxGbG9hdDY0PjtcbiAgICBwdWJsaWMgc3RhdGljIGZyb20oZGF0YTogYW55KSB7XG4gICAgICAgIHN3aXRjaCAoZGF0YS5jb25zdHJ1Y3Rvcikge1xuICAgICAgICAgICAgY2FzZSBVaW50MTZBcnJheTogcmV0dXJuIG5ldyBGbG9hdFZlY3RvcihuZXcgRmxhdERhdGEobmV3IEZsb2F0MTYoKSwgZGF0YS5sZW5ndGgsIG51bGwsIGRhdGEpKTtcbiAgICAgICAgICAgIGNhc2UgRmxvYXQzMkFycmF5OiByZXR1cm4gbmV3IEZsb2F0VmVjdG9yKG5ldyBGbGF0RGF0YShuZXcgRmxvYXQzMigpLCBkYXRhLmxlbmd0aCwgbnVsbCwgZGF0YSkpO1xuICAgICAgICAgICAgY2FzZSBGbG9hdDY0QXJyYXk6IHJldHVybiBuZXcgRmxvYXRWZWN0b3IobmV3IEZsYXREYXRhKG5ldyBGbG9hdDY0KCksIGRhdGEubGVuZ3RoLCBudWxsLCBkYXRhKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignVW5yZWNvZ25pemVkIEZsb2F0IGRhdGEnKTtcbiAgICB9XG4gICAgc3RhdGljIGRlZmF1bHRWaWV3PFQgZXh0ZW5kcyBGbG9hdD4oZGF0YTogRGF0YTxUPik6IEZsYXRWaWV3PGFueT4ge1xuICAgICAgICByZXR1cm4gZGF0YS50eXBlLnByZWNpc2lvbiAhPT0gUHJlY2lzaW9uLkhBTEYgPyBuZXcgRmxhdFZpZXcoZGF0YSkgOiBuZXcgRmxvYXQxNlZpZXcoZGF0YSBhcyBEYXRhPEZsb2F0MTY+KTtcbiAgICB9XG4gICAgY29uc3RydWN0b3IoZGF0YTogRGF0YTxUPiwgdmlldzogVmlldzxUPiA9IEZsb2F0VmVjdG9yLmRlZmF1bHRWaWV3KGRhdGEpKSB7XG4gICAgICAgIHN1cGVyKGRhdGEsIHZpZXcpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIERhdGVWZWN0b3IgZXh0ZW5kcyBGbGF0VmVjdG9yPERhdGVfPiB7XG4gICAgc3RhdGljIGRlZmF1bHRWaWV3PFQgZXh0ZW5kcyBEYXRlXz4oZGF0YTogRGF0YTxUPikge1xuICAgICAgICByZXR1cm4gZGF0YS50eXBlLnVuaXQgPT09IERhdGVVbml0LkRBWSA/IG5ldyBEYXRlRGF5VmlldyhkYXRhKSA6IG5ldyBEYXRlTWlsbGlzZWNvbmRWaWV3KGRhdGEsIDIpO1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihkYXRhOiBEYXRhPERhdGVfPiwgdmlldzogVmlldzxEYXRlXz4gPSBEYXRlVmVjdG9yLmRlZmF1bHRWaWV3KGRhdGEpKSB7XG4gICAgICAgIHN1cGVyKGRhdGEsIHZpZXcpO1xuICAgIH1cbiAgICBwdWJsaWMgbG93cygpOiBJbnRWZWN0b3I8SW50MzI+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZS51bml0ID09PSBEYXRlVW5pdC5EQVkgPyB0aGlzLmFzSW50MzIoMCwgMSkgOiB0aGlzLmFzSW50MzIoMCwgMik7XG4gICAgfVxuICAgIHB1YmxpYyBoaWdocygpOiBJbnRWZWN0b3I8SW50MzI+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZS51bml0ID09PSBEYXRlVW5pdC5EQVkgPyB0aGlzLmFzSW50MzIoMCwgMSkgOiB0aGlzLmFzSW50MzIoMSwgMik7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGVjaW1hbFZlY3RvciBleHRlbmRzIEZsYXRWZWN0b3I8RGVjaW1hbD4ge1xuICAgIGNvbnN0cnVjdG9yKGRhdGE6IERhdGE8RGVjaW1hbD4sIHZpZXc6IFZpZXc8RGVjaW1hbD4gPSBuZXcgRml4ZWRTaXplVmlldyhkYXRhLCA0KSkge1xuICAgICAgICBzdXBlcihkYXRhLCB2aWV3KTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBUaW1lVmVjdG9yIGV4dGVuZHMgRmxhdFZlY3RvcjxUaW1lPiB7XG4gICAgc3RhdGljIGRlZmF1bHRWaWV3PFQgZXh0ZW5kcyBUaW1lPihkYXRhOiBEYXRhPFQ+KSB7XG4gICAgICAgIHJldHVybiBkYXRhLnR5cGUuYml0V2lkdGggPD0gMzIgPyBuZXcgRmxhdFZpZXcoZGF0YSkgOiBuZXcgRml4ZWRTaXplVmlldyhkYXRhLCAoZGF0YS50eXBlLmJpdFdpZHRoIC8gMzIpIHwgMCk7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKGRhdGE6IERhdGE8VGltZT4sIHZpZXc6IFZpZXc8VGltZT4gPSBUaW1lVmVjdG9yLmRlZmF1bHRWaWV3KGRhdGEpKSB7XG4gICAgICAgIHN1cGVyKGRhdGEsIHZpZXcpO1xuICAgIH1cbiAgICBwdWJsaWMgbG93cygpOiBJbnRWZWN0b3I8SW50MzI+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZS5iaXRXaWR0aCA8PSAzMiA/IHRoaXMuYXNJbnQzMigwLCAxKSA6IHRoaXMuYXNJbnQzMigwLCAyKTtcbiAgICB9XG4gICAgcHVibGljIGhpZ2hzKCk6IEludFZlY3RvcjxJbnQzMj4ge1xuICAgICAgICByZXR1cm4gdGhpcy50eXBlLmJpdFdpZHRoIDw9IDMyID8gdGhpcy5hc0ludDMyKDAsIDEpIDogdGhpcy5hc0ludDMyKDEsIDIpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFRpbWVzdGFtcFZlY3RvciBleHRlbmRzIEZsYXRWZWN0b3I8VGltZXN0YW1wPiB7XG4gICAgY29uc3RydWN0b3IoZGF0YTogRGF0YTxUaW1lc3RhbXA+LCB2aWV3OiBWaWV3PFRpbWVzdGFtcD4gPSBuZXcgRml4ZWRTaXplVmlldyhkYXRhLCAyKSkge1xuICAgICAgICBzdXBlcihkYXRhLCB2aWV3KTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBJbnRlcnZhbFZlY3RvciBleHRlbmRzIEZsYXRWZWN0b3I8SW50ZXJ2YWw+IHtcbiAgICBzdGF0aWMgZGVmYXVsdFZpZXc8VCBleHRlbmRzIEludGVydmFsPihkYXRhOiBEYXRhPFQ+KSB7XG4gICAgICAgIHJldHVybiBkYXRhLnR5cGUudW5pdCA9PT0gSW50ZXJ2YWxVbml0LllFQVJfTU9OVEggPyBuZXcgSW50ZXJ2YWxZZWFyTW9udGhWaWV3KGRhdGEpIDogbmV3IEZpeGVkU2l6ZVZpZXcoZGF0YSwgMik7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKGRhdGE6IERhdGE8SW50ZXJ2YWw+LCB2aWV3OiBWaWV3PEludGVydmFsPiA9IEludGVydmFsVmVjdG9yLmRlZmF1bHRWaWV3KGRhdGEpKSB7XG4gICAgICAgIHN1cGVyKGRhdGEsIHZpZXcpO1xuICAgIH1cbiAgICBwdWJsaWMgbG93cygpOiBJbnRWZWN0b3I8SW50MzI+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZS51bml0ID09PSBJbnRlcnZhbFVuaXQuWUVBUl9NT05USCA/IHRoaXMuYXNJbnQzMigwLCAxKSA6IHRoaXMuYXNJbnQzMigwLCAyKTtcbiAgICB9XG4gICAgcHVibGljIGhpZ2hzKCk6IEludFZlY3RvcjxJbnQzMj4ge1xuICAgICAgICByZXR1cm4gdGhpcy50eXBlLnVuaXQgPT09IEludGVydmFsVW5pdC5ZRUFSX01PTlRIID8gdGhpcy5hc0ludDMyKDAsIDEpIDogdGhpcy5hc0ludDMyKDEsIDIpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEJpbmFyeVZlY3RvciBleHRlbmRzIExpc3RWZWN0b3JCYXNlPEJpbmFyeT4ge1xuICAgIGNvbnN0cnVjdG9yKGRhdGE6IERhdGE8QmluYXJ5PiwgdmlldzogVmlldzxCaW5hcnk+ID0gbmV3IEJpbmFyeVZpZXcoZGF0YSkpIHtcbiAgICAgICAgc3VwZXIoZGF0YSwgdmlldyk7XG4gICAgfVxuICAgIHB1YmxpYyBhc1V0ZjgoKSB7XG4gICAgICAgIHJldHVybiBuZXcgVXRmOFZlY3RvcigodGhpcy5kYXRhIGFzIEZsYXRMaXN0RGF0YTxhbnk+KS5jbG9uZShuZXcgVXRmOCgpKSk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRml4ZWRTaXplQmluYXJ5VmVjdG9yIGV4dGVuZHMgRmxhdFZlY3RvcjxGaXhlZFNpemVCaW5hcnk+IHtcbiAgICBjb25zdHJ1Y3RvcihkYXRhOiBEYXRhPEZpeGVkU2l6ZUJpbmFyeT4sIHZpZXc6IFZpZXc8Rml4ZWRTaXplQmluYXJ5PiA9IG5ldyBGaXhlZFNpemVWaWV3KGRhdGEsIGRhdGEudHlwZS5ieXRlV2lkdGgpKSB7XG4gICAgICAgIHN1cGVyKGRhdGEsIHZpZXcpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIFV0ZjhWZWN0b3IgZXh0ZW5kcyBMaXN0VmVjdG9yQmFzZTxVdGY4PiB7XG4gICAgY29uc3RydWN0b3IoZGF0YTogRGF0YTxVdGY4PiwgdmlldzogVmlldzxVdGY4PiA9IG5ldyBVdGY4VmlldyhkYXRhKSkge1xuICAgICAgICBzdXBlcihkYXRhLCB2aWV3KTtcbiAgICB9XG4gICAgcHVibGljIGFzQmluYXJ5KCkge1xuICAgICAgICByZXR1cm4gbmV3IEJpbmFyeVZlY3RvcigodGhpcy5kYXRhIGFzIEZsYXRMaXN0RGF0YTxhbnk+KS5jbG9uZShuZXcgQmluYXJ5KCkpKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBMaXN0VmVjdG9yPFQgZXh0ZW5kcyBEYXRhVHlwZSA9IERhdGFUeXBlPiBleHRlbmRzIExpc3RWZWN0b3JCYXNlPExpc3Q8VD4+IHtcbiAgICBjb25zdHJ1Y3RvcihkYXRhOiBEYXRhPExpc3Q8VD4+LCB2aWV3OiBWaWV3PExpc3Q8VD4+ID0gbmV3IExpc3RWaWV3KGRhdGEpKSB7XG4gICAgICAgIHN1cGVyKGRhdGEsIHZpZXcpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEZpeGVkU2l6ZUxpc3RWZWN0b3IgZXh0ZW5kcyBMaXN0VmVjdG9yQmFzZTxGaXhlZFNpemVMaXN0PiB7XG4gICAgY29uc3RydWN0b3IoZGF0YTogRGF0YTxGaXhlZFNpemVMaXN0PiwgdmlldzogVmlldzxGaXhlZFNpemVMaXN0PiA9IG5ldyBGaXhlZFNpemVMaXN0VmlldyhkYXRhKSkge1xuICAgICAgICBzdXBlcihkYXRhLCB2aWV3KTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBNYXBWZWN0b3IgZXh0ZW5kcyBOZXN0ZWRWZWN0b3I8TWFwXz4ge1xuICAgIGNvbnN0cnVjdG9yKGRhdGE6IERhdGE8TWFwXz4sIHZpZXc6IFZpZXc8TWFwXz4gPSBuZXcgTWFwVmlldyhkYXRhKSkge1xuICAgICAgICBzdXBlcihkYXRhLCB2aWV3KTtcbiAgICB9XG4gICAgcHVibGljIGFzU3RydWN0KCkge1xuICAgICAgICByZXR1cm4gbmV3IFN0cnVjdFZlY3RvcigodGhpcy5kYXRhIGFzIE5lc3RlZERhdGE8YW55PikuY2xvbmUobmV3IFN0cnVjdCh0aGlzLnR5cGUuY2hpbGRyZW4pKSk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgU3RydWN0VmVjdG9yIGV4dGVuZHMgTmVzdGVkVmVjdG9yPFN0cnVjdD4ge1xuICAgIGNvbnN0cnVjdG9yKGRhdGE6IERhdGE8U3RydWN0PiwgdmlldzogVmlldzxTdHJ1Y3Q+ID0gbmV3IFN0cnVjdFZpZXcoZGF0YSkpIHtcbiAgICAgICAgc3VwZXIoZGF0YSwgdmlldyk7XG4gICAgfVxuICAgIHB1YmxpYyBhc01hcChrZXlzU29ydGVkOiBib29sZWFuID0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNYXBWZWN0b3IoKHRoaXMuZGF0YSBhcyBOZXN0ZWREYXRhPGFueT4pLmNsb25lKG5ldyBNYXBfKGtleXNTb3J0ZWQsIHRoaXMudHlwZS5jaGlsZHJlbikpKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBVbmlvblZlY3RvcjxUIGV4dGVuZHMgKFNwYXJzZVVuaW9uIHwgRGVuc2VVbmlvbikgPSBhbnk+IGV4dGVuZHMgTmVzdGVkVmVjdG9yPFQ+IHtcbiAgICBjb25zdHJ1Y3RvcihkYXRhOiBEYXRhPFQ+LCB2aWV3OiBWaWV3PFQ+ID0gPGFueT4gKGRhdGEudHlwZS5tb2RlID09PSBVbmlvbk1vZGUuU3BhcnNlID8gbmV3IFVuaW9uVmlldzxTcGFyc2VVbmlvbj4oZGF0YSBhcyBEYXRhPFNwYXJzZVVuaW9uPikgOiBuZXcgRGVuc2VVbmlvblZpZXcoZGF0YSBhcyBEYXRhPERlbnNlVW5pb24+KSkpIHtcbiAgICAgICAgc3VwZXIoZGF0YSwgdmlldyk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGljdGlvbmFyeVZlY3RvcjxUIGV4dGVuZHMgRGF0YVR5cGUgPSBEYXRhVHlwZT4gZXh0ZW5kcyBWZWN0b3I8RGljdGlvbmFyeTxUPj4ge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBwdWJsaWMgcmVhZG9ubHkgaW5kaWNpZXM6IFZlY3RvcjxJbnQ+O1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBwdWJsaWMgcmVhZG9ubHkgZGljdGlvbmFyeTogVmVjdG9yPFQ+O1xuICAgIGNvbnN0cnVjdG9yKGRhdGE6IERhdGE8RGljdGlvbmFyeTxUPj4sIHZpZXc6IFZpZXc8RGljdGlvbmFyeTxUPj4gPSBuZXcgRGljdGlvbmFyeVZpZXc8VD4oZGF0YS5kaWN0aW9uYXJ5LCBuZXcgSW50VmVjdG9yKGRhdGEuaW5kaWNpZXMpKSkge1xuICAgICAgICBzdXBlcihkYXRhIGFzIERhdGE8YW55Piwgdmlldyk7XG4gICAgICAgIGlmICh2aWV3IGluc3RhbmNlb2YgRGljdGlvbmFyeVZpZXcpIHtcbiAgICAgICAgICAgIHRoaXMuaW5kaWNpZXMgPSB2aWV3LmluZGljaWVzO1xuICAgICAgICAgICAgdGhpcy5kaWN0aW9uYXJ5ID0gdmlldy5kaWN0aW9uYXJ5O1xuICAgICAgICB9IGVsc2UgaWYgKHZpZXcgaW5zdGFuY2VvZiBDaHVua2VkVmlldykge1xuICAgICAgICAgICAgdGhpcy5kaWN0aW9uYXJ5ID0gKHZpZXcuY2h1bmtzWzBdIGFzIERpY3Rpb25hcnlWZWN0b3I8VD4pLmRpY3Rpb25hcnk7XG4gICAgICAgICAgICB0aGlzLmluZGljaWVzID0gKHZpZXcuY2h1bmtzIGFzIERpY3Rpb25hcnlWZWN0b3I8VD5bXSkucmVkdWNlPFZlY3RvcjxJbnQ+IHwgbnVsbD4oXG4gICAgICAgICAgICAgICAgKGlkeHM6IFZlY3RvcjxJbnQ+IHwgbnVsbCwgZGljdDogRGljdGlvbmFyeVZlY3RvcjxUPikgPT5cbiAgICAgICAgICAgICAgICAgICAgIWlkeHMgPyBkaWN0LmluZGljaWVzISA6IGlkeHMuY29uY2F0KGRpY3QuaW5kaWNpZXMhKSxcbiAgICAgICAgICAgICAgICBudWxsXG4gICAgICAgICAgICApITtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwdWJsaWMgZ2V0S2V5KGluZGV4OiBudW1iZXIpIHsgcmV0dXJuIHRoaXMuaW5kaWNpZXMuZ2V0KGluZGV4KTsgfVxuICAgIHB1YmxpYyBnZXRWYWx1ZShrZXk6IG51bWJlcikgeyByZXR1cm4gdGhpcy5kaWN0aW9uYXJ5LmdldChrZXkpOyB9XG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVWZWN0b3IgPSAoKFZlY3RvckxvYWRlcjogbmV3IDxUIGV4dGVuZHMgRGF0YVR5cGU+KGRhdGE6IERhdGE8VD4pID0+IFR5cGVWaXNpdG9yKSA9PiAoXG4gICAgPFQgZXh0ZW5kcyBEYXRhVHlwZT4oZGF0YTogRGF0YTxUPikgPT4gVHlwZVZpc2l0b3IudmlzaXRUeXBlSW5saW5lKG5ldyBWZWN0b3JMb2FkZXIoZGF0YSksIGRhdGEudHlwZSkgYXMgVmVjdG9yPFQ+XG4pKShjbGFzcyBWZWN0b3JMb2FkZXI8VCBleHRlbmRzIERhdGFUeXBlPiBleHRlbmRzIFR5cGVWaXNpdG9yIHtcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRhdGE6IERhdGE8VD4pIHsgc3VwZXIoKTsgfVxuICAgIHZpc2l0TnVsbCAgICAgICAgICAgKF90eXBlOiBOdWxsKSAgICAgICAgICAgIHsgcmV0dXJuIG5ldyBOdWxsVmVjdG9yKHRoaXMuZGF0YSk7ICAgICAgICAgICAgfVxuICAgIHZpc2l0SW50ICAgICAgICAgICAgKF90eXBlOiBJbnQpICAgICAgICAgICAgIHsgcmV0dXJuIG5ldyBJbnRWZWN0b3IodGhpcy5kYXRhKTsgICAgICAgICAgICAgfVxuICAgIHZpc2l0RmxvYXQgICAgICAgICAgKF90eXBlOiBGbG9hdCkgICAgICAgICAgIHsgcmV0dXJuIG5ldyBGbG9hdFZlY3Rvcih0aGlzLmRhdGEpOyAgICAgICAgICAgfVxuICAgIHZpc2l0QmluYXJ5ICAgICAgICAgKF90eXBlOiBCaW5hcnkpICAgICAgICAgIHsgcmV0dXJuIG5ldyBCaW5hcnlWZWN0b3IodGhpcy5kYXRhKTsgICAgICAgICAgfVxuICAgIHZpc2l0VXRmOCAgICAgICAgICAgKF90eXBlOiBVdGY4KSAgICAgICAgICAgIHsgcmV0dXJuIG5ldyBVdGY4VmVjdG9yKHRoaXMuZGF0YSk7ICAgICAgICAgICAgfVxuICAgIHZpc2l0Qm9vbCAgICAgICAgICAgKF90eXBlOiBCb29sKSAgICAgICAgICAgIHsgcmV0dXJuIG5ldyBCb29sVmVjdG9yKHRoaXMuZGF0YSk7ICAgICAgICAgICAgfVxuICAgIHZpc2l0RGVjaW1hbCAgICAgICAgKF90eXBlOiBEZWNpbWFsKSAgICAgICAgIHsgcmV0dXJuIG5ldyBEZWNpbWFsVmVjdG9yKHRoaXMuZGF0YSk7ICAgICAgICAgfVxuICAgIHZpc2l0RGF0ZSAgICAgICAgICAgKF90eXBlOiBEYXRlXykgICAgICAgICAgIHsgcmV0dXJuIG5ldyBEYXRlVmVjdG9yKHRoaXMuZGF0YSk7ICAgICAgICAgICAgfVxuICAgIHZpc2l0VGltZSAgICAgICAgICAgKF90eXBlOiBUaW1lKSAgICAgICAgICAgIHsgcmV0dXJuIG5ldyBUaW1lVmVjdG9yKHRoaXMuZGF0YSk7ICAgICAgICAgICAgfVxuICAgIHZpc2l0VGltZXN0YW1wICAgICAgKF90eXBlOiBUaW1lc3RhbXApICAgICAgIHsgcmV0dXJuIG5ldyBUaW1lc3RhbXBWZWN0b3IodGhpcy5kYXRhKTsgICAgICAgfVxuICAgIHZpc2l0SW50ZXJ2YWwgICAgICAgKF90eXBlOiBJbnRlcnZhbCkgICAgICAgIHsgcmV0dXJuIG5ldyBJbnRlcnZhbFZlY3Rvcih0aGlzLmRhdGEpOyAgICAgICAgfVxuICAgIHZpc2l0TGlzdCAgICAgICAgICAgKF90eXBlOiBMaXN0KSAgICAgICAgICAgIHsgcmV0dXJuIG5ldyBMaXN0VmVjdG9yKHRoaXMuZGF0YSk7ICAgICAgICAgICAgfVxuICAgIHZpc2l0U3RydWN0ICAgICAgICAgKF90eXBlOiBTdHJ1Y3QpICAgICAgICAgIHsgcmV0dXJuIG5ldyBTdHJ1Y3RWZWN0b3IodGhpcy5kYXRhKTsgICAgICAgICAgfVxuICAgIHZpc2l0VW5pb24gICAgICAgICAgKF90eXBlOiBVbmlvbikgICAgICAgICAgIHsgcmV0dXJuIG5ldyBVbmlvblZlY3Rvcih0aGlzLmRhdGEpOyAgICAgICAgICAgfVxuICAgIHZpc2l0Rml4ZWRTaXplQmluYXJ5KF90eXBlOiBGaXhlZFNpemVCaW5hcnkpIHsgcmV0dXJuIG5ldyBGaXhlZFNpemVCaW5hcnlWZWN0b3IodGhpcy5kYXRhKTsgfVxuICAgIHZpc2l0Rml4ZWRTaXplTGlzdCAgKF90eXBlOiBGaXhlZFNpemVMaXN0KSAgIHsgcmV0dXJuIG5ldyBGaXhlZFNpemVMaXN0VmVjdG9yKHRoaXMuZGF0YSk7ICAgfVxuICAgIHZpc2l0TWFwICAgICAgICAgICAgKF90eXBlOiBNYXBfKSAgICAgICAgICAgIHsgcmV0dXJuIG5ldyBNYXBWZWN0b3IodGhpcy5kYXRhKTsgICAgICAgICAgICAgfVxuICAgIHZpc2l0RGljdGlvbmFyeSAgICAgKF90eXBlOiBEaWN0aW9uYXJ5KSAgICAgIHsgcmV0dXJuIG5ldyBEaWN0aW9uYXJ5VmVjdG9yKHRoaXMuZGF0YSk7ICAgICAgfVxufSk7XG4iXX0=
