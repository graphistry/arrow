// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
import { Visitor } from '../visitor';
import { TimeUnit } from '../enum';
const sum = (x, y) => x + y;
const variableWidthColumnErrorMessage = (type) => `Cannot compute the byte width of variable-width column ${type}`;
export class ByteWidthVisitor extends Visitor {
    visitNull(____) { return 0; }
    visitInt(type) { return type.bitWidth / 8; }
    visitFloat(type) { return type.ArrayType.BYTES_PER_ELEMENT; }
    visitBinary(type) { throw new Error(variableWidthColumnErrorMessage(type)); }
    visitUtf8(type) { throw new Error(variableWidthColumnErrorMessage(type)); }
    visitBool(____) { return 1 / 8; }
    visitDecimal(____) { return 16; }
    visitDate(type) { return (type.unit + 1) * 4; }
    visitTime(type) { return type.bitWidth / 8; }
    visitTimestamp(type) { return type.unit === TimeUnit.SECOND ? 4 : 8; }
    visitInterval(type) { return (type.unit + 1) * 4; }
    visitList(type) { throw new Error(variableWidthColumnErrorMessage(type)); }
    visitStruct(type) { return this.visitFields(type.children).reduce(sum, 0); }
    visitUnion(type) { return this.visitFields(type.children).reduce(sum, 0); }
    visitFixedSizeBinary(type) { return type.byteWidth; }
    visitFixedSizeList(type) { return type.listSize * this.visitFields(type.children).reduce(sum, 0); }
    visitMap(type) { return this.visitFields(type.children).reduce(sum, 0); }
    visitDictionary(type) { return this.visit(type.indices); }
    visitFields(fields) { return (fields || []).map((field) => this.visit(field.type)); }
    visitSchema(schema) { return this.visitFields(schema.fields).reduce(sum, 0); }
}
export const instance = new ByteWidthVisitor();

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpc2l0b3IvYnl0ZXdpZHRoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDZEQUE2RDtBQUM3RCwrREFBK0Q7QUFDL0Qsd0RBQXdEO0FBQ3hELDZEQUE2RDtBQUM3RCxvREFBb0Q7QUFDcEQsNkRBQTZEO0FBQzdELDZEQUE2RDtBQUM3RCxFQUFFO0FBQ0YsK0NBQStDO0FBQy9DLEVBQUU7QUFDRiw2REFBNkQ7QUFDN0QsOERBQThEO0FBQzlELHlEQUF5RDtBQUN6RCw0REFBNEQ7QUFDNUQsMERBQTBEO0FBQzFELHFCQUFxQjtBQUdyQixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBRXJDLE9BQU8sRUFBUSxRQUFRLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFTekMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFTLEVBQUUsQ0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQzVDLE1BQU0sK0JBQStCLEdBQUcsQ0FBQyxJQUFjLEVBQUUsRUFBRSxDQUFDLDBEQUEwRCxJQUFJLEVBQUUsQ0FBQztBQVc3SCxNQUFNLE9BQU8sZ0JBQWlCLFNBQVEsT0FBTztJQUNsQyxTQUFTLENBQWEsSUFBVSxJQUFnQixPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDM0QsUUFBUSxDQUFjLElBQVMsSUFBaUIsT0FBTyxJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDM0UsVUFBVSxDQUFZLElBQVcsSUFBZSxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDO0lBQzFGLFdBQVcsQ0FBVyxJQUFZLElBQWMsTUFBTSxJQUFJLEtBQUssQ0FBQywrQkFBK0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6RyxTQUFTLENBQWEsSUFBVSxJQUFnQixNQUFNLElBQUksS0FBSyxDQUFDLCtCQUErQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3pHLFNBQVMsQ0FBYSxJQUFVLElBQWdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDL0QsWUFBWSxDQUFVLElBQWEsSUFBYSxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDNUQsU0FBUyxDQUFhLElBQVcsSUFBZSxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzdFLFNBQVMsQ0FBYSxJQUFVLElBQWdCLE9BQU8sSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzNFLGNBQWMsQ0FBUSxJQUFlLElBQVcsT0FBTyxJQUFJLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMvRixhQUFhLENBQVMsSUFBYyxJQUFZLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDN0UsU0FBUyxDQUFhLElBQVUsSUFBZ0IsTUFBTSxJQUFJLEtBQUssQ0FBQywrQkFBK0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6RyxXQUFXLENBQVcsSUFBWSxJQUFjLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDeEcsVUFBVSxDQUFZLElBQVcsSUFBZSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3hHLG9CQUFvQixDQUFFLElBQXFCLElBQUssT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUN4RSxrQkFBa0IsQ0FBSSxJQUFtQixJQUFPLE9BQU8sSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN4SCxRQUFRLENBQWMsSUFBVSxJQUFnQixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3hHLGVBQWUsQ0FBTyxJQUFnQixJQUFVLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xGLFdBQVcsQ0FBVyxNQUFlLElBQVcsT0FBTyxDQUFDLE1BQU0sSUFBSSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQy9HLFdBQVcsQ0FBVyxNQUFjLElBQVksT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztDQUNsSDtBQUVELE1BQU0sQ0FBQyxNQUFNLFFBQVEsR0FBRyxJQUFJLGdCQUFnQixFQUFFLENBQUMiLCJmaWxlIjoidmlzaXRvci9ieXRld2lkdGguanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4vLyBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbi8vIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4vLyByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4vLyB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4vLyBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Vcbi8vIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbi8vIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4vLyBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuLy8gS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4vLyBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4vLyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgRGF0YSB9IGZyb20gJy4uL2RhdGEnO1xuaW1wb3J0IHsgVmlzaXRvciB9IGZyb20gJy4uL3Zpc2l0b3InO1xuaW1wb3J0IHsgVmVjdG9yIH0gZnJvbSAnLi4vaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBUeXBlLCBUaW1lVW5pdCB9IGZyb20gJy4uL2VudW0nO1xuaW1wb3J0IHsgU2NoZW1hLCBGaWVsZCB9IGZyb20gJy4uL3NjaGVtYSc7XG5pbXBvcnQge1xuICAgIERhdGFUeXBlLCBEaWN0aW9uYXJ5LFxuICAgIEZsb2F0LCBJbnQsIERhdGVfLCBJbnRlcnZhbCwgVGltZSwgVGltZXN0YW1wLFxuICAgIEJvb2wsIE51bGwsIFV0ZjgsIEJpbmFyeSwgRGVjaW1hbCwgRml4ZWRTaXplQmluYXJ5LFxuICAgIExpc3QsIEZpeGVkU2l6ZUxpc3QsIE1hcF8sIFN0cnVjdCwgVW5pb24sXG59IGZyb20gJy4uL3R5cGUnO1xuXG5jb25zdCBzdW0gPSAoeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IHggKyB5O1xuY29uc3QgdmFyaWFibGVXaWR0aENvbHVtbkVycm9yTWVzc2FnZSA9ICh0eXBlOiBEYXRhVHlwZSkgPT4gYENhbm5vdCBjb21wdXRlIHRoZSBieXRlIHdpZHRoIG9mIHZhcmlhYmxlLXdpZHRoIGNvbHVtbiAke3R5cGV9YDtcblxuZXhwb3J0IGludGVyZmFjZSBCeXRlV2lkdGhWaXNpdG9yIGV4dGVuZHMgVmlzaXRvciB7XG4gICAgdmlzaXRNYW55IDxUIGV4dGVuZHMgRGF0YVR5cGU+KG5vZGVzOiBUW10gICAgICk6IG51bWJlcltdO1xuICAgIHZpc2l0ICAgICA8VCBleHRlbmRzIERhdGFUeXBlPihub2RlOiBUICAgICAgICApOiBudW1iZXI7XG4gICAgZ2V0VmlzaXRGbjxUIGV4dGVuZHMgVHlwZT4gICAgKG5vZGU6IFQgICAgICAgICk6ICh0eXBlOiBEYXRhVHlwZTxUPikgPT4gbnVtYmVyO1xuICAgIGdldFZpc2l0Rm48VCBleHRlbmRzIERhdGFUeXBlPihub2RlOiBWZWN0b3I8VD4pOiAodHlwZTogVCAgICAgICAgICApID0+IG51bWJlcjtcbiAgICBnZXRWaXNpdEZuPFQgZXh0ZW5kcyBEYXRhVHlwZT4obm9kZTogRGF0YTxUPiAgKTogKHR5cGU6IFQgICAgICAgICAgKSA9PiBudW1iZXI7XG4gICAgZ2V0VmlzaXRGbjxUIGV4dGVuZHMgRGF0YVR5cGU+KG5vZGU6IFQgICAgICAgICk6ICh0eXBlOiBUICAgICAgICAgICkgPT4gbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgQnl0ZVdpZHRoVmlzaXRvciBleHRlbmRzIFZpc2l0b3Ige1xuICAgIHB1YmxpYyB2aXNpdE51bGwgICAgICAgICAgICAoX19fXzogTnVsbCAgICAgICAgICAgICkgeyByZXR1cm4gMDsgfVxuICAgIHB1YmxpYyB2aXNpdEludCAgICAgICAgICAgICAodHlwZTogSW50ICAgICAgICAgICAgICkgeyByZXR1cm4gdHlwZS5iaXRXaWR0aCAvIDg7IH1cbiAgICBwdWJsaWMgdmlzaXRGbG9hdCAgICAgICAgICAgKHR5cGU6IEZsb2F0ICAgICAgICAgICApIHsgcmV0dXJuIHR5cGUuQXJyYXlUeXBlLkJZVEVTX1BFUl9FTEVNRU5UOyB9XG4gICAgcHVibGljIHZpc2l0QmluYXJ5ICAgICAgICAgICh0eXBlOiBCaW5hcnkgICAgICAgICAgKSB7IHRocm93IG5ldyBFcnJvcih2YXJpYWJsZVdpZHRoQ29sdW1uRXJyb3JNZXNzYWdlKHR5cGUpKTsgfVxuICAgIHB1YmxpYyB2aXNpdFV0ZjggICAgICAgICAgICAodHlwZTogVXRmOCAgICAgICAgICAgICkgeyB0aHJvdyBuZXcgRXJyb3IodmFyaWFibGVXaWR0aENvbHVtbkVycm9yTWVzc2FnZSh0eXBlKSk7IH1cbiAgICBwdWJsaWMgdmlzaXRCb29sICAgICAgICAgICAgKF9fX186IEJvb2wgICAgICAgICAgICApIHsgcmV0dXJuIDEgLyA4OyB9XG4gICAgcHVibGljIHZpc2l0RGVjaW1hbCAgICAgICAgIChfX19fOiBEZWNpbWFsICAgICAgICAgKSB7IHJldHVybiAxNjsgfVxuICAgIHB1YmxpYyB2aXNpdERhdGUgICAgICAgICAgICAodHlwZTogRGF0ZV8gICAgICAgICAgICkgeyByZXR1cm4gKHR5cGUudW5pdCArIDEpICogNDsgfVxuICAgIHB1YmxpYyB2aXNpdFRpbWUgICAgICAgICAgICAodHlwZTogVGltZSAgICAgICAgICAgICkgeyByZXR1cm4gdHlwZS5iaXRXaWR0aCAvIDg7IH1cbiAgICBwdWJsaWMgdmlzaXRUaW1lc3RhbXAgICAgICAgKHR5cGU6IFRpbWVzdGFtcCAgICAgICApIHsgcmV0dXJuIHR5cGUudW5pdCA9PT0gVGltZVVuaXQuU0VDT05EID8gNCA6IDg7IH1cbiAgICBwdWJsaWMgdmlzaXRJbnRlcnZhbCAgICAgICAgKHR5cGU6IEludGVydmFsICAgICAgICApIHsgcmV0dXJuICh0eXBlLnVuaXQgKyAxKSAqIDQ7IH1cbiAgICBwdWJsaWMgdmlzaXRMaXN0ICAgICAgICAgICAgKHR5cGU6IExpc3QgICAgICAgICAgICApIHsgdGhyb3cgbmV3IEVycm9yKHZhcmlhYmxlV2lkdGhDb2x1bW5FcnJvck1lc3NhZ2UodHlwZSkpOyB9XG4gICAgcHVibGljIHZpc2l0U3RydWN0ICAgICAgICAgICh0eXBlOiBTdHJ1Y3QgICAgICAgICAgKSB7IHJldHVybiB0aGlzLnZpc2l0RmllbGRzKHR5cGUuY2hpbGRyZW4pLnJlZHVjZShzdW0sIDApOyB9XG4gICAgcHVibGljIHZpc2l0VW5pb24gICAgICAgICAgICh0eXBlOiBVbmlvbiAgICAgICAgICAgKSB7IHJldHVybiB0aGlzLnZpc2l0RmllbGRzKHR5cGUuY2hpbGRyZW4pLnJlZHVjZShzdW0sIDApOyB9XG4gICAgcHVibGljIHZpc2l0Rml4ZWRTaXplQmluYXJ5ICh0eXBlOiBGaXhlZFNpemVCaW5hcnkgKSB7IHJldHVybiB0eXBlLmJ5dGVXaWR0aDsgfVxuICAgIHB1YmxpYyB2aXNpdEZpeGVkU2l6ZUxpc3QgICAodHlwZTogRml4ZWRTaXplTGlzdCAgICkgeyByZXR1cm4gdHlwZS5saXN0U2l6ZSAqIHRoaXMudmlzaXRGaWVsZHModHlwZS5jaGlsZHJlbikucmVkdWNlKHN1bSwgMCk7IH1cbiAgICBwdWJsaWMgdmlzaXRNYXAgICAgICAgICAgICAgKHR5cGU6IE1hcF8gICAgICAgICAgICApIHsgcmV0dXJuIHRoaXMudmlzaXRGaWVsZHModHlwZS5jaGlsZHJlbikucmVkdWNlKHN1bSwgMCk7IH1cbiAgICBwdWJsaWMgdmlzaXREaWN0aW9uYXJ5ICAgICAgKHR5cGU6IERpY3Rpb25hcnkgICAgICApIHsgcmV0dXJuIHRoaXMudmlzaXQodHlwZS5pbmRpY2VzKTsgfVxuICAgIHB1YmxpYyB2aXNpdEZpZWxkcyAgICAgICAgICAoZmllbGRzOiBGaWVsZFtdICAgICAgICkgeyByZXR1cm4gKGZpZWxkcyB8fCBbXSkubWFwKChmaWVsZCkgPT4gdGhpcy52aXNpdChmaWVsZC50eXBlKSk7IH1cbiAgICBwdWJsaWMgdmlzaXRTY2hlbWEgICAgICAgICAgKHNjaGVtYTogU2NoZW1hICAgICAgICApIHsgcmV0dXJuIHRoaXMudmlzaXRGaWVsZHMoc2NoZW1hLmZpZWxkcykucmVkdWNlKHN1bSwgMCk7IH1cbn1cblxuZXhwb3J0IGNvbnN0IGluc3RhbmNlID0gbmV3IEJ5dGVXaWR0aFZpc2l0b3IoKTtcbiJdfQ==
