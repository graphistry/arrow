"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const data_1 = require("./data");
const vector_1 = require("./vector");
const schema_1 = require("./schema");
const type_1 = require("./type");
const struct_1 = require("./vector/struct");
class RecordBatch extends vector_1.Vector {
    constructor(...args) {
        super();
        this._schema = args[0];
        let data;
        let children;
        if (typeof args[1] === 'number') {
            const fields = this.schema.fields;
            const [, numRows, childData] = args;
            data = data_1.Data.Struct(new type_1.Struct(fields), 0, numRows, 0, null, childData);
        }
        else {
            [, data, children] = args;
        }
        this.impl = new struct_1.StructVector(data, children);
    }
    /** @nocollapse */
    static from(vectors, names = []) {
        return new RecordBatch(schema_1.Schema.from(vectors, names), vectors.reduce((len, vec) => Math.max(len, vec.length), 0), vectors);
    }
    clone(data, children = this.impl.children) {
        return new RecordBatch(this.schema, data, children);
    }
    get schema() { return this._schema; }
    get data() { return this.impl.data; }
    get type() { return this.impl.type; }
    get typeId() { return this.impl.typeId; }
    get length() { return this.impl.length; }
    get stride() { return this.impl.stride; }
    get numCols() { return this.schema.fields.length; }
    get rowProxy() { return this.impl.rowProxy; }
    get nullCount() { return this.impl.nullCount; }
    get numChildren() { return this.impl.numChildren; }
    get ArrayType() { return this.impl.ArrayType; }
    get(index) {
        return this.impl.get(index);
    }
    set(index, value) {
        this.impl.set(index, value);
    }
    isValid(index) { return this.impl.isValid(index); }
    indexOf(value, fromIndex) { return this.impl.indexOf(value, fromIndex); }
    toArray() { return this.impl.toArray(); }
    [Symbol.iterator]() { return this.impl[Symbol.iterator](); }
    slice(begin, end) {
        const { length, childData } = this.impl.slice(begin, end).data;
        return new RecordBatch(this.schema, length, childData);
    }
    concat(...others) {
        return this.impl.concat(...others.map((x) => x instanceof RecordBatch ? x.impl : x));
    }
    getChildAt(index) { return this.impl.getChildAt(index); }
    select(...columnNames) {
        const fields = this.schema.fields;
        const schema = this.schema.select(...columnNames);
        const childNames = columnNames.reduce((xs, x) => (xs[x] = true) && xs, {});
        const childData = this.data.childData.filter((_, i) => childNames[fields[i].name]);
        const structData = data_1.Data.Struct(new type_1.Struct(schema.fields), 0, this.length, 0, null, childData);
        return new RecordBatch(schema, structData);
    }
}
exports.RecordBatch = RecordBatch;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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TSxVQUFVLEdBQUcsV0FBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLGFBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztRQUM5RixPQUFPLElBQUksV0FBVyxDQUFxQixNQUFNLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDbkUsQ0FBQztDQUNKO0FBL0VELGtDQStFQyIsImZpbGUiOiJyZWNvcmRiYXRjaC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBEYXRhIH0gZnJvbSAnLi9kYXRhJztcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gJy4vdmVjdG9yJztcbmltcG9ydCB7IFNjaGVtYSwgRmllbGQgfSBmcm9tICcuL3NjaGVtYSc7XG5pbXBvcnQgeyBEYXRhVHlwZSwgU3RydWN0IH0gZnJvbSAnLi90eXBlJztcbmltcG9ydCB7IFN0cnVjdFZlY3RvciB9IGZyb20gJy4vdmVjdG9yL3N0cnVjdCc7XG5pbXBvcnQgeyBWZWN0b3IgYXMgVlR5cGUgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuXG5leHBvcnQgY2xhc3MgUmVjb3JkQmF0Y2g8VCBleHRlbmRzIHsgW2tleTogc3RyaW5nXTogRGF0YVR5cGUgfSA9IGFueT4gZXh0ZW5kcyBWZWN0b3I8U3RydWN0PFQ+PiB7XG5cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIGZyb208VCBleHRlbmRzIHsgW2tleTogc3RyaW5nXTogRGF0YVR5cGUgfSA9IGFueT4odmVjdG9yczogVlR5cGU8VFtrZXlvZiBUXT5bXSwgbmFtZXM6IChrZXlvZiBUKVtdID0gW10pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZWNvcmRCYXRjaChcbiAgICAgICAgICAgIFNjaGVtYS5mcm9tKHZlY3RvcnMsIG5hbWVzKSxcbiAgICAgICAgICAgIHZlY3RvcnMucmVkdWNlKChsZW4sIHZlYykgPT4gTWF0aC5tYXgobGVuLCB2ZWMubGVuZ3RoKSwgMCksXG4gICAgICAgICAgICB2ZWN0b3JzXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9zY2hlbWE6IFNjaGVtYTtcbiAgICBwcml2YXRlIGltcGw6IFN0cnVjdFZlY3RvcjxUPjtcblxuICAgIGNvbnN0cnVjdG9yKHNjaGVtYTogU2NoZW1hPFQ+LCBudW1Sb3dzOiBudW1iZXIsIGNoaWxkRGF0YTogKERhdGEgfCBWZWN0b3IpW10pO1xuICAgIGNvbnN0cnVjdG9yKHNjaGVtYTogU2NoZW1hPFQ+LCBkYXRhOiBEYXRhPFN0cnVjdDxUPj4sIGNoaWxkcmVuPzogVmVjdG9yW10pO1xuICAgIGNvbnN0cnVjdG9yKC4uLmFyZ3M6IGFueVtdKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuX3NjaGVtYSA9IGFyZ3NbMF07XG4gICAgICAgIGxldCBkYXRhOiBEYXRhPFN0cnVjdDxUPj47XG4gICAgICAgIGxldCBjaGlsZHJlbjogVmVjdG9yW10gfCB1bmRlZmluZWQ7XG4gICAgICAgIGlmICh0eXBlb2YgYXJnc1sxXSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuc2NoZW1hLmZpZWxkcyBhcyBGaWVsZDxUW2tleW9mIFRdPltdO1xuICAgICAgICAgICAgY29uc3QgWywgbnVtUm93cywgY2hpbGREYXRhXSA9IGFyZ3MgYXMgW1NjaGVtYTxUPiwgbnVtYmVyLCBEYXRhW11dO1xuICAgICAgICAgICAgZGF0YSA9IERhdGEuU3RydWN0KG5ldyBTdHJ1Y3Q8VD4oZmllbGRzKSwgMCwgbnVtUm93cywgMCwgbnVsbCwgY2hpbGREYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIFssIGRhdGEsIGNoaWxkcmVuXSA9IChhcmdzIGFzIFtTY2hlbWE8VD4sIERhdGE8U3RydWN0PFQ+PiwgVmVjdG9yW10/XSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbXBsID0gbmV3IFN0cnVjdFZlY3RvcihkYXRhLCBjaGlsZHJlbik7XG4gICAgfVxuXG4gICAgcHVibGljIGNsb25lPFIgZXh0ZW5kcyB7IFtrZXk6IHN0cmluZ106IERhdGFUeXBlIH0gPSBhbnk+KGRhdGE6IERhdGE8U3RydWN0PFI+PiwgY2hpbGRyZW4gPSAodGhpcy5pbXBsIGFzIGFueSkuY2hpbGRyZW4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZWNvcmRCYXRjaDxSPih0aGlzLnNjaGVtYSwgZGF0YSwgY2hpbGRyZW4pO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgc2NoZW1hKCkgeyByZXR1cm4gdGhpcy5fc2NoZW1hOyB9XG4gICAgcHVibGljIGdldCBkYXRhKCkgeyByZXR1cm4gdGhpcy5pbXBsLmRhdGE7IH1cbiAgICBwdWJsaWMgZ2V0IHR5cGUoKSB7IHJldHVybiB0aGlzLmltcGwudHlwZTsgfVxuICAgIHB1YmxpYyBnZXQgdHlwZUlkKCkgeyByZXR1cm4gdGhpcy5pbXBsLnR5cGVJZDsgfVxuICAgIHB1YmxpYyBnZXQgbGVuZ3RoKCkgeyByZXR1cm4gdGhpcy5pbXBsLmxlbmd0aDsgfVxuICAgIHB1YmxpYyBnZXQgc3RyaWRlKCkgeyByZXR1cm4gdGhpcy5pbXBsLnN0cmlkZTsgfVxuICAgIHB1YmxpYyBnZXQgbnVtQ29scygpIHsgcmV0dXJuIHRoaXMuc2NoZW1hLmZpZWxkcy5sZW5ndGg7IH1cbiAgICBwdWJsaWMgZ2V0IHJvd1Byb3h5KCkgeyByZXR1cm4gdGhpcy5pbXBsLnJvd1Byb3h5OyB9XG4gICAgcHVibGljIGdldCBudWxsQ291bnQoKSB7IHJldHVybiB0aGlzLmltcGwubnVsbENvdW50OyB9XG4gICAgcHVibGljIGdldCBudW1DaGlsZHJlbigpIHsgcmV0dXJuIHRoaXMuaW1wbC5udW1DaGlsZHJlbjsgfVxuXG4gICAgcHVibGljIGdldCBBcnJheVR5cGUoKSB7IHJldHVybiB0aGlzLmltcGwuQXJyYXlUeXBlOyB9XG5cbiAgICBwdWJsaWMgZ2V0KGluZGV4OiBudW1iZXIpOiBTdHJ1Y3Q8VD5bJ1RWYWx1ZSddIHwgbnVsbCB7XG4gICAgICAgIHJldHVybiB0aGlzLmltcGwuZ2V0KGluZGV4KTtcbiAgICB9XG4gICAgcHVibGljIHNldChpbmRleDogbnVtYmVyLCB2YWx1ZTogU3RydWN0PFQ+WydUVmFsdWUnXSB8IG51bGwpIHtcbiAgICAgICAgdGhpcy5pbXBsLnNldChpbmRleCwgdmFsdWUpO1xuICAgIH1cbiAgICBwdWJsaWMgaXNWYWxpZChpbmRleDogbnVtYmVyKSB7IHJldHVybiB0aGlzLmltcGwuaXNWYWxpZChpbmRleCk7IH1cbiAgICBwdWJsaWMgaW5kZXhPZih2YWx1ZTogU3RydWN0PFQ+WydUVmFsdWUnXSB8IG51bGwsIGZyb21JbmRleD86IG51bWJlcikgeyByZXR1cm4gdGhpcy5pbXBsLmluZGV4T2YodmFsdWUsIGZyb21JbmRleCk7IH1cblxuICAgIHB1YmxpYyB0b0FycmF5KCkgeyByZXR1cm4gdGhpcy5pbXBsLnRvQXJyYXkoKTsgfVxuICAgIHB1YmxpYyBbU3ltYm9sLml0ZXJhdG9yXSgpIHsgcmV0dXJuIHRoaXMuaW1wbFtTeW1ib2wuaXRlcmF0b3JdKCk7IH1cblxuICAgIHB1YmxpYyBzbGljZShiZWdpbj86IG51bWJlciwgZW5kPzogbnVtYmVyKTogUmVjb3JkQmF0Y2g8VD4ge1xuICAgICAgICBjb25zdCB7IGxlbmd0aCwgY2hpbGREYXRhIH0gPSB0aGlzLmltcGwuc2xpY2UoYmVnaW4sIGVuZCkuZGF0YTtcbiAgICAgICAgcmV0dXJuIG5ldyBSZWNvcmRCYXRjaDxUPih0aGlzLnNjaGVtYSwgbGVuZ3RoLCBjaGlsZERhdGEpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjb25jYXQoLi4ub3RoZXJzOiBWZWN0b3I8U3RydWN0PFQ+PltdKTogVmVjdG9yPFN0cnVjdDxUPj4ge1xuICAgICAgICByZXR1cm4gdGhpcy5pbXBsLmNvbmNhdCguLi5vdGhlcnMubWFwKCh4KSA9PiB4IGluc3RhbmNlb2YgUmVjb3JkQmF0Y2ggPyB4LmltcGwgOiB4KSBhcyBWZWN0b3I8U3RydWN0PFQ+PltdKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0Q2hpbGRBdDxSIGV4dGVuZHMgRGF0YVR5cGUgPSBhbnk+KGluZGV4OiBudW1iZXIpIHsgcmV0dXJuIHRoaXMuaW1wbC5nZXRDaGlsZEF0PFI+KGluZGV4KTsgfVxuXG4gICAgcHVibGljIHNlbGVjdDxLIGV4dGVuZHMga2V5b2YgVCA9IGFueT4oLi4uY29sdW1uTmFtZXM6IEtbXSkge1xuICAgICAgICBjb25zdCBmaWVsZHMgPSB0aGlzLnNjaGVtYS5maWVsZHM7XG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IHRoaXMuc2NoZW1hLnNlbGVjdCguLi5jb2x1bW5OYW1lcyk7XG4gICAgICAgIGNvbnN0IGNoaWxkTmFtZXMgPSBjb2x1bW5OYW1lcy5yZWR1Y2UoKHhzLCB4KSA9PiAoeHNbeF0gPSB0cnVlKSAmJiB4cywgPGFueT4ge30pO1xuICAgICAgICBjb25zdCBjaGlsZERhdGEgPSB0aGlzLmRhdGEuY2hpbGREYXRhLmZpbHRlcigoXywgaSkgPT4gY2hpbGROYW1lc1tmaWVsZHNbaV0ubmFtZV0pO1xuICAgICAgICBjb25zdCBzdHJ1Y3REYXRhID0gRGF0YS5TdHJ1Y3QobmV3IFN0cnVjdChzY2hlbWEuZmllbGRzKSwgMCwgdGhpcy5sZW5ndGgsIDAsIG51bGwsIGNoaWxkRGF0YSk7XG4gICAgICAgIHJldHVybiBuZXcgUmVjb3JkQmF0Y2g8eyBbUCBpbiBLXTogVFtQXSB9PihzY2hlbWEsIHN0cnVjdERhdGEpO1xuICAgIH1cbn1cbiJdfQ==
