"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const data_1 = require("./data");
const table_1 = require("./table");
const schema_1 = require("./schema");
const type_1 = require("./type");
const chunked_1 = require("./vector/chunked");
const struct_1 = require("./vector/struct");
const recordbatch_1 = require("./util/recordbatch");
class RecordBatch extends struct_1.StructVector {
    constructor(...args) {
        let data;
        let schema = args[0];
        let children;
        if (args[1] instanceof data_1.Data) {
            [, data, children] = args;
        }
        else {
            const fields = schema.fields;
            const [, length, childData] = args;
            data = data_1.Data.Struct(new type_1.Struct(fields), 0, length, 0, null, childData);
        }
        super(data, children);
        this._schema = schema;
    }
    /** @nocollapse */
    static from(chunks, names = []) {
        const schema = schema_1.Schema.from(chunks, names);
        const length = chunks.reduce((l, c) => Math.max(l, c.length), 0);
        const children = chunks.map((x) => x instanceof data_1.Data ? x : x.data);
        return new RecordBatch(schema, length, recordbatch_1.alignChunkLengths(schema, children, length));
    }
    clone(data, children = this._children) {
        return new RecordBatch(this._schema, data, children);
    }
    concat(...others) {
        const schema = this._schema, chunks = chunked_1.Chunked.flatten(this, ...others);
        return new table_1.Table(schema, chunks.map(({ data }) => new RecordBatch(schema, data)));
    }
    get schema() { return this._schema; }
    get numCols() { return this._schema.fields.length; }
    select(...columnNames) {
        const fields = this._schema.fields;
        const schema = this._schema.select(...columnNames);
        const childNames = columnNames.reduce((xs, x) => (xs[x] = true) && xs, {});
        const childData = this.data.childData.filter((_, i) => childNames[fields[i].name]);
        const structData = data_1.Data.Struct(new type_1.Struct(schema.fields), 0, this.length, 0, null, childData);
        return new RecordBatch(schema, structData);
    }
    selectAt(...columnIndices) {
        const schema = this._schema.selectAt(...columnIndices);
        const children = columnIndices.map((i) => this.data.childData[i]);
        return new RecordBatch(schema, this.length, children);
    }
}
exports.RecordBatch = RecordBatch;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QyxPQUFPLENBQUMsUUFBUSxDQUFDLEdBQUcsYUFBYSxDQUFDLENBQUM7UUFDdkQsTUFBTSxRQUFRLEdBQUcsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsRSxPQUFPLElBQUksV0FBVyxDQUF1QixNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNoRixDQUFDO0NBQ0o7QUExREQsa0NBMERDIiwiZmlsZSI6InJlY29yZGJhdGNoLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IERhdGEgfSBmcm9tICcuL2RhdGEnO1xuaW1wb3J0IHsgVGFibGUgfSBmcm9tICcuL3RhYmxlJztcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gJy4vdmVjdG9yJztcbmltcG9ydCB7IFNjaGVtYSwgRmllbGQgfSBmcm9tICcuL3NjaGVtYSc7XG5pbXBvcnQgeyBEYXRhVHlwZSwgU3RydWN0IH0gZnJvbSAnLi90eXBlJztcbmltcG9ydCB7IENodW5rZWQgfSBmcm9tICcuL3ZlY3Rvci9jaHVua2VkJztcbmltcG9ydCB7IFN0cnVjdFZlY3RvciB9IGZyb20gJy4vdmVjdG9yL3N0cnVjdCc7XG5pbXBvcnQgeyBhbGlnbkNodW5rTGVuZ3RocyB9IGZyb20gJy4vdXRpbC9yZWNvcmRiYXRjaCc7XG5pbXBvcnQgeyBDbG9uYWJsZSwgU2xpY2VhYmxlLCBBcHBsaWNhdGl2ZSB9IGZyb20gJy4vdmVjdG9yJztcblxuZXhwb3J0IGludGVyZmFjZSBSZWNvcmRCYXRjaDxUIGV4dGVuZHMgeyBba2V5OiBzdHJpbmddOiBEYXRhVHlwZSB9ID0gYW55PiB7XG4gICAgY29uY2F0KC4uLm90aGVyczogVmVjdG9yPFN0cnVjdDxUPj5bXSk6IFRhYmxlPFQ+O1xuICAgIHNsaWNlKGJlZ2luPzogbnVtYmVyLCBlbmQ/OiBudW1iZXIpOiBSZWNvcmRCYXRjaDxUPjtcbiAgICBjbG9uZShkYXRhOiBEYXRhPFN0cnVjdDxUPj4sIGNoaWxkcmVuPzogVmVjdG9yW10pOiBSZWNvcmRCYXRjaDxUPjtcbn1cblxuZXhwb3J0IGNsYXNzIFJlY29yZEJhdGNoPFQgZXh0ZW5kcyB7IFtrZXk6IHN0cmluZ106IERhdGFUeXBlIH0gPSBhbnk+XG4gICAgZXh0ZW5kcyBTdHJ1Y3RWZWN0b3I8VD5cbiAgICBpbXBsZW1lbnRzIENsb25hYmxlPFJlY29yZEJhdGNoPFQ+PixcbiAgICAgICAgICAgICAgIFNsaWNlYWJsZTxSZWNvcmRCYXRjaDxUPj4sXG4gICAgICAgICAgICAgICBBcHBsaWNhdGl2ZTxTdHJ1Y3Q8VD4sIFRhYmxlPFQ+PiB7XG5cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIGZyb208VCBleHRlbmRzIHsgW2tleTogc3RyaW5nXTogRGF0YVR5cGUgfSA9IGFueT4oY2h1bmtzOiAoRGF0YTxUW2tleW9mIFRdPiB8IFZlY3RvcjxUW2tleW9mIFRdPilbXSwgbmFtZXM6IChrZXlvZiBUKVtdID0gW10pIHtcbiAgICAgICAgY29uc3Qgc2NoZW1hID0gU2NoZW1hLmZyb20oY2h1bmtzLCBuYW1lcyk7XG4gICAgICAgIGNvbnN0IGxlbmd0aCA9IGNodW5rcy5yZWR1Y2UoKGwsIGMpID0+IE1hdGgubWF4KGwsIGMubGVuZ3RoKSwgMCk7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gY2h1bmtzLm1hcCgoeCkgPT4geCBpbnN0YW5jZW9mIERhdGEgPyB4IDogeC5kYXRhKTtcbiAgICAgICAgcmV0dXJuIG5ldyBSZWNvcmRCYXRjaChzY2hlbWEsIGxlbmd0aCwgYWxpZ25DaHVua0xlbmd0aHMoc2NoZW1hLCBjaGlsZHJlbiwgbGVuZ3RoKSk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9zY2hlbWE6IFNjaGVtYTtcblxuICAgIGNvbnN0cnVjdG9yKHNjaGVtYTogU2NoZW1hPFQ+LCBsZW5ndGg6IG51bWJlciwgY2hpbGRyZW46IChEYXRhIHwgVmVjdG9yKVtdKTtcbiAgICBjb25zdHJ1Y3RvcihzY2hlbWE6IFNjaGVtYTxUPiwgZGF0YTogRGF0YTxTdHJ1Y3Q8VD4+LCBjaGlsZHJlbj86IFZlY3RvcltdKTtcbiAgICBjb25zdHJ1Y3RvciguLi5hcmdzOiBhbnlbXSkge1xuICAgICAgICBsZXQgZGF0YTogRGF0YTxTdHJ1Y3Q8VD4+O1xuICAgICAgICBsZXQgc2NoZW1hID0gYXJnc1swXSBhcyBTY2hlbWE8VD47XG4gICAgICAgIGxldCBjaGlsZHJlbjogVmVjdG9yW10gfCB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChhcmdzWzFdIGluc3RhbmNlb2YgRGF0YSkge1xuICAgICAgICAgICAgWywgZGF0YSwgY2hpbGRyZW5dID0gKGFyZ3MgYXMgW2FueSwgRGF0YTxTdHJ1Y3Q8VD4+LCBWZWN0b3I8VFtrZXlvZiBUXT5bXT9dKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IHNjaGVtYS5maWVsZHMgYXMgRmllbGQ8VFtrZXlvZiBUXT5bXTtcbiAgICAgICAgICAgIGNvbnN0IFssIGxlbmd0aCwgY2hpbGREYXRhXSA9IGFyZ3MgYXMgW2FueSwgbnVtYmVyLCBEYXRhPFRba2V5b2YgVF0+W11dO1xuICAgICAgICAgICAgZGF0YSA9IERhdGEuU3RydWN0KG5ldyBTdHJ1Y3Q8VD4oZmllbGRzKSwgMCwgbGVuZ3RoLCAwLCBudWxsLCBjaGlsZERhdGEpO1xuICAgICAgICB9XG4gICAgICAgIHN1cGVyKGRhdGEsIGNoaWxkcmVuKTtcbiAgICAgICAgdGhpcy5fc2NoZW1hID0gc2NoZW1hO1xuICAgIH1cblxuICAgIHB1YmxpYyBjbG9uZShkYXRhOiBEYXRhPFN0cnVjdDxUPj4sIGNoaWxkcmVuID0gdGhpcy5fY2hpbGRyZW4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZWNvcmRCYXRjaDxUPih0aGlzLl9zY2hlbWEsIGRhdGEsIGNoaWxkcmVuKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29uY2F0KC4uLm90aGVyczogVmVjdG9yPFN0cnVjdDxUPj5bXSk6IFRhYmxlPFQ+IHtcbiAgICAgICAgY29uc3Qgc2NoZW1hID0gdGhpcy5fc2NoZW1hLCBjaHVua3MgPSBDaHVua2VkLmZsYXR0ZW4odGhpcywgLi4ub3RoZXJzKTtcbiAgICAgICAgcmV0dXJuIG5ldyBUYWJsZShzY2hlbWEsIGNodW5rcy5tYXAoKHsgZGF0YSB9KSA9PiBuZXcgUmVjb3JkQmF0Y2goc2NoZW1hLCBkYXRhKSkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgc2NoZW1hKCkgeyByZXR1cm4gdGhpcy5fc2NoZW1hOyB9XG4gICAgcHVibGljIGdldCBudW1Db2xzKCkgeyByZXR1cm4gdGhpcy5fc2NoZW1hLmZpZWxkcy5sZW5ndGg7IH1cblxuICAgIHB1YmxpYyBzZWxlY3Q8SyBleHRlbmRzIGtleW9mIFQgPSBhbnk+KC4uLmNvbHVtbk5hbWVzOiBLW10pIHtcbiAgICAgICAgY29uc3QgZmllbGRzID0gdGhpcy5fc2NoZW1hLmZpZWxkcztcbiAgICAgICAgY29uc3Qgc2NoZW1hID0gdGhpcy5fc2NoZW1hLnNlbGVjdCguLi5jb2x1bW5OYW1lcyk7XG4gICAgICAgIGNvbnN0IGNoaWxkTmFtZXMgPSBjb2x1bW5OYW1lcy5yZWR1Y2UoKHhzLCB4KSA9PiAoeHNbeF0gPSB0cnVlKSAmJiB4cywgPGFueT4ge30pO1xuICAgICAgICBjb25zdCBjaGlsZERhdGEgPSB0aGlzLmRhdGEuY2hpbGREYXRhLmZpbHRlcigoXywgaSkgPT4gY2hpbGROYW1lc1tmaWVsZHNbaV0ubmFtZV0pO1xuICAgICAgICBjb25zdCBzdHJ1Y3REYXRhID0gRGF0YS5TdHJ1Y3QobmV3IFN0cnVjdChzY2hlbWEuZmllbGRzKSwgMCwgdGhpcy5sZW5ndGgsIDAsIG51bGwsIGNoaWxkRGF0YSk7XG4gICAgICAgIHJldHVybiBuZXcgUmVjb3JkQmF0Y2g8eyBbUCBpbiBLXTogVFtQXSB9PihzY2hlbWEsIHN0cnVjdERhdGEgYXMgRGF0YTxTdHJ1Y3Q8eyBbUCBpbiBLXTogVFtQXSB9Pj4pO1xuICAgIH1cbiAgICBwdWJsaWMgc2VsZWN0QXQ8SyBleHRlbmRzIFRba2V5b2YgVF0gPSBhbnk+KC4uLmNvbHVtbkluZGljZXM6IG51bWJlcltdKSB7XG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IHRoaXMuX3NjaGVtYS5zZWxlY3RBdCguLi5jb2x1bW5JbmRpY2VzKTtcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSBjb2x1bW5JbmRpY2VzLm1hcCgoaSkgPT4gdGhpcy5kYXRhLmNoaWxkRGF0YVtpXSk7XG4gICAgICAgIHJldHVybiBuZXcgUmVjb3JkQmF0Y2g8eyBba2V5OiBzdHJpbmddOiBLIH0+KHNjaGVtYSwgdGhpcy5sZW5ndGgsIGNoaWxkcmVuKTtcbiAgICB9XG59XG4iXX0=
