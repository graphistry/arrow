"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const data_1 = require("./data");
const vector_1 = require("./vector");
const schema_1 = require("./schema");
const type_1 = require("./type");
const struct_1 = require("./vector/struct");
class RecordBatch extends vector_1.Vector {
    constructor(...args) {
        super();
        this._schema = args[0];
        let data;
        let children;
        if (typeof args[1] === 'number') {
            const fields = this.schema.fields;
            const [, numRows, childData] = args;
            data = data_1.Data.Struct(new type_1.Struct(fields), 0, numRows, 0, null, childData);
        }
        else {
            [, data, children] = args;
        }
        this.impl = new struct_1.StructVector(data, children);
    }
    /** @nocollapse */
    static from(vectors, names = []) {
        return new RecordBatch(schema_1.Schema.from(vectors, names), vectors.reduce((len, vec) => Math.max(len, vec.length), 0), vectors);
    }
    clone(data, children = this.impl.children) {
        return new RecordBatch(this.schema, data, children);
    }
    get schema() { return this._schema; }
    get data() { return this.impl.data; }
    get type() { return this.impl.type; }
    get typeId() { return this.impl.typeId; }
    get length() { return this.impl.length; }
    get stride() { return this.impl.stride; }
    get numCols() { return this.schema.fields.length; }
    get rowProxy() { return this.impl.rowProxy; }
    get nullCount() { return this.impl.nullCount; }
    get numChildren() { return this.impl.numChildren; }
    get ArrayType() { return this.impl.ArrayType; }
    get(index) {
        return this.impl.get(index);
    }
    set(index, value) {
        this.impl.set(index, value);
    }
    isValid(index) { return this.impl.isValid(index); }
    indexOf(value, fromIndex) { return this.impl.indexOf(value, fromIndex); }
    toArray() { return this.impl.toArray(); }
    [Symbol.iterator]() { return this.impl[Symbol.iterator](); }
    slice(begin, end) {
        const { length, childData } = this.impl.slice(begin, end).data;
        return new RecordBatch(this.schema, length, childData);
    }
    concat(...others) {
        return this.impl.concat(...others.map((x) => x instanceof RecordBatch ? x.impl : x));
    }
    getChildAt(index) { return this.impl.getChildAt(index); }
    select(...columnNames) {
        const fields = this.schema.fields;
        const schema = this.schema.select(...columnNames);
        const childNames = columnNames.reduce((xs, x) => (xs[x] = true) && xs, {});
        const childData = this.data.childData.filter((_, i) => childNames[fields[i].name]);
        const structData = data_1.Data.Struct(new type_1.Struct(schema.fields), 0, this.length, 0, null, childData);
        return new RecordBatch(schema, structData);
    }
}
exports.RecordBatch = RecordBatch;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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TSxVQUFVLEdBQUcsV0FBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLGFBQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztRQUM5RixPQUFPLElBQUksV0FBVyxDQUFxQixNQUFNLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDbkUsQ0FBQztDQUNKO0FBL0VELGtDQStFQyIsImZpbGUiOiJyZWNvcmRiYXRjaC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbi8vIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuLy8gZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbi8vIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbi8vIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbi8vIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuLy8gd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4vL1xuLy8gVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuLy8gc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbi8vIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4vLyBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbi8vIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbi8vIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG5pbXBvcnQgeyBEYXRhIH0gZnJvbSAnLi9kYXRhJztcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gJy4vdmVjdG9yJztcbmltcG9ydCB7IFNjaGVtYSwgRmllbGQgfSBmcm9tICcuL3NjaGVtYSc7XG5pbXBvcnQgeyBEYXRhVHlwZSwgU3RydWN0IH0gZnJvbSAnLi90eXBlJztcbmltcG9ydCB7IFN0cnVjdFZlY3RvciB9IGZyb20gJy4vdmVjdG9yL3N0cnVjdCc7XG5pbXBvcnQgeyBWZWN0b3IgYXMgVlR5cGUgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuXG5leHBvcnQgY2xhc3MgUmVjb3JkQmF0Y2g8VCBleHRlbmRzIHsgW2tleTogc3RyaW5nXTogRGF0YVR5cGUgfSA9IGFueT4gZXh0ZW5kcyBWZWN0b3I8U3RydWN0PFQ+PiB7XG5cbiAgICAvKiogQG5vY29sbGFwc2UgKi9cbiAgICBwdWJsaWMgc3RhdGljIGZyb208VCBleHRlbmRzIHsgW2tleTogc3RyaW5nXTogRGF0YVR5cGUgfSA9IGFueT4odmVjdG9yczogVlR5cGU8VFtrZXlvZiBUXT5bXSwgbmFtZXM6IChrZXlvZiBUKVtdID0gW10pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZWNvcmRCYXRjaChcbiAgICAgICAgICAgIFNjaGVtYS5mcm9tKHZlY3RvcnMsIG5hbWVzKSxcbiAgICAgICAgICAgIHZlY3RvcnMucmVkdWNlKChsZW4sIHZlYykgPT4gTWF0aC5tYXgobGVuLCB2ZWMubGVuZ3RoKSwgMCksXG4gICAgICAgICAgICB2ZWN0b3JzXG4gICAgICAgICk7XG4gICAgfVxuICBcbiAgICBwcm90ZWN0ZWQgX3NjaGVtYTogU2NoZW1hO1xuICAgIHByaXZhdGUgaW1wbDogU3RydWN0VmVjdG9yPFQ+O1xuXG4gICAgY29uc3RydWN0b3Ioc2NoZW1hOiBTY2hlbWE8VD4sIG51bVJvd3M6IG51bWJlciwgY2hpbGREYXRhOiAoRGF0YSB8IFZlY3RvcilbXSk7XG4gICAgY29uc3RydWN0b3Ioc2NoZW1hOiBTY2hlbWE8VD4sIGRhdGE6IERhdGE8U3RydWN0PFQ+PiwgY2hpbGRyZW4/OiBWZWN0b3JbXSk7XG4gICAgY29uc3RydWN0b3IoLi4uYXJnczogYW55W10pIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fc2NoZW1hID0gYXJnc1swXTtcbiAgICAgICAgbGV0IGRhdGE6IERhdGE8U3RydWN0PFQ+PjtcbiAgICAgICAgbGV0IGNoaWxkcmVuOiBWZWN0b3JbXSB8IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzFdID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgY29uc3QgZmllbGRzID0gdGhpcy5zY2hlbWEuZmllbGRzIGFzIEZpZWxkPFRba2V5b2YgVF0+W107XG4gICAgICAgICAgICBjb25zdCBbLCBudW1Sb3dzLCBjaGlsZERhdGFdID0gYXJncyBhcyBbU2NoZW1hPFQ+LCBudW1iZXIsIERhdGFbXV07XG4gICAgICAgICAgICBkYXRhID0gRGF0YS5TdHJ1Y3QobmV3IFN0cnVjdDxUPihmaWVsZHMpLCAwLCBudW1Sb3dzLCAwLCBudWxsLCBjaGlsZERhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgWywgZGF0YSwgY2hpbGRyZW5dID0gKGFyZ3MgYXMgW1NjaGVtYTxUPiwgRGF0YTxTdHJ1Y3Q8VD4+LCBWZWN0b3JbXT9dKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmltcGwgPSBuZXcgU3RydWN0VmVjdG9yKGRhdGEsIGNoaWxkcmVuKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY2xvbmU8UiBleHRlbmRzIHsgW2tleTogc3RyaW5nXTogRGF0YVR5cGUgfSA9IGFueT4oZGF0YTogRGF0YTxTdHJ1Y3Q8Uj4+LCBjaGlsZHJlbiA9ICh0aGlzLmltcGwgYXMgYW55KS5jaGlsZHJlbikge1xuICAgICAgICByZXR1cm4gbmV3IFJlY29yZEJhdGNoPFI+KHRoaXMuc2NoZW1hLCBkYXRhLCBjaGlsZHJlbik7XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBzY2hlbWEoKSB7IHJldHVybiB0aGlzLl9zY2hlbWE7IH1cbiAgICBwdWJsaWMgZ2V0IGRhdGEoKSB7IHJldHVybiB0aGlzLmltcGwuZGF0YTsgfVxuICAgIHB1YmxpYyBnZXQgdHlwZSgpIHsgcmV0dXJuIHRoaXMuaW1wbC50eXBlOyB9XG4gICAgcHVibGljIGdldCB0eXBlSWQoKSB7IHJldHVybiB0aGlzLmltcGwudHlwZUlkOyB9XG4gICAgcHVibGljIGdldCBsZW5ndGgoKSB7IHJldHVybiB0aGlzLmltcGwubGVuZ3RoOyB9XG4gICAgcHVibGljIGdldCBzdHJpZGUoKSB7IHJldHVybiB0aGlzLmltcGwuc3RyaWRlOyB9XG4gICAgcHVibGljIGdldCBudW1Db2xzKCkgeyByZXR1cm4gdGhpcy5zY2hlbWEuZmllbGRzLmxlbmd0aDsgfVxuICAgIHB1YmxpYyBnZXQgcm93UHJveHkoKSB7IHJldHVybiB0aGlzLmltcGwucm93UHJveHk7IH1cbiAgICBwdWJsaWMgZ2V0IG51bGxDb3VudCgpIHsgcmV0dXJuIHRoaXMuaW1wbC5udWxsQ291bnQ7IH1cbiAgICBwdWJsaWMgZ2V0IG51bUNoaWxkcmVuKCkgeyByZXR1cm4gdGhpcy5pbXBsLm51bUNoaWxkcmVuOyB9XG5cbiAgICBwdWJsaWMgZ2V0IEFycmF5VHlwZSgpIHsgcmV0dXJuIHRoaXMuaW1wbC5BcnJheVR5cGU7IH1cblxuICAgIHB1YmxpYyBnZXQoaW5kZXg6IG51bWJlcik6IFN0cnVjdDxUPlsnVFZhbHVlJ10gfCBudWxsIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW1wbC5nZXQoaW5kZXgpO1xuICAgIH1cbiAgICBwdWJsaWMgc2V0KGluZGV4OiBudW1iZXIsIHZhbHVlOiBTdHJ1Y3Q8VD5bJ1RWYWx1ZSddIHwgbnVsbCkge1xuICAgICAgICB0aGlzLmltcGwuc2V0KGluZGV4LCB2YWx1ZSk7XG4gICAgfVxuICAgIHB1YmxpYyBpc1ZhbGlkKGluZGV4OiBudW1iZXIpIHsgcmV0dXJuIHRoaXMuaW1wbC5pc1ZhbGlkKGluZGV4KTsgfVxuICAgIHB1YmxpYyBpbmRleE9mKHZhbHVlOiBTdHJ1Y3Q8VD5bJ1RWYWx1ZSddIHwgbnVsbCwgZnJvbUluZGV4PzogbnVtYmVyKSB7IHJldHVybiB0aGlzLmltcGwuaW5kZXhPZih2YWx1ZSwgZnJvbUluZGV4KTsgfVxuXG4gICAgcHVibGljIHRvQXJyYXkoKSB7IHJldHVybiB0aGlzLmltcGwudG9BcnJheSgpOyB9XG4gICAgcHVibGljIFtTeW1ib2wuaXRlcmF0b3JdKCkgeyByZXR1cm4gdGhpcy5pbXBsW1N5bWJvbC5pdGVyYXRvcl0oKTsgfVxuXG4gICAgcHVibGljIHNsaWNlKGJlZ2luPzogbnVtYmVyLCBlbmQ/OiBudW1iZXIpOiBSZWNvcmRCYXRjaDxUPiB7XG4gICAgICAgIGNvbnN0IHsgbGVuZ3RoLCBjaGlsZERhdGEgfSA9IHRoaXMuaW1wbC5zbGljZShiZWdpbiwgZW5kKS5kYXRhO1xuICAgICAgICByZXR1cm4gbmV3IFJlY29yZEJhdGNoPFQ+KHRoaXMuc2NoZW1hLCBsZW5ndGgsIGNoaWxkRGF0YSk7XG4gICAgfVxuXG4gICAgcHVibGljIGNvbmNhdCguLi5vdGhlcnM6IFZlY3RvcjxTdHJ1Y3Q8VD4+W10pOiBWZWN0b3I8U3RydWN0PFQ+PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmltcGwuY29uY2F0KC4uLm90aGVycy5tYXAoKHgpID0+IHggaW5zdGFuY2VvZiBSZWNvcmRCYXRjaCA/IHguaW1wbCA6IHgpIGFzIFZlY3RvcjxTdHJ1Y3Q8VD4+W10pO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRDaGlsZEF0PFIgZXh0ZW5kcyBEYXRhVHlwZSA9IGFueT4oaW5kZXg6IG51bWJlcikgeyByZXR1cm4gdGhpcy5pbXBsLmdldENoaWxkQXQ8Uj4oaW5kZXgpOyB9XG5cbiAgICBwdWJsaWMgc2VsZWN0PEsgZXh0ZW5kcyBrZXlvZiBUID0gYW55PiguLi5jb2x1bW5OYW1lczogS1tdKSB7XG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuc2NoZW1hLmZpZWxkcztcbiAgICAgICAgY29uc3Qgc2NoZW1hID0gdGhpcy5zY2hlbWEuc2VsZWN0KC4uLmNvbHVtbk5hbWVzKTtcbiAgICAgICAgY29uc3QgY2hpbGROYW1lcyA9IGNvbHVtbk5hbWVzLnJlZHVjZSgoeHMsIHgpID0+ICh4c1t4XSA9IHRydWUpICYmIHhzLCA8YW55PiB7fSk7XG4gICAgICAgIGNvbnN0IGNoaWxkRGF0YSA9IHRoaXMuZGF0YS5jaGlsZERhdGEuZmlsdGVyKChfLCBpKSA9PiBjaGlsZE5hbWVzW2ZpZWxkc1tpXS5uYW1lXSk7XG4gICAgICAgIGNvbnN0IHN0cnVjdERhdGEgPSBEYXRhLlN0cnVjdChuZXcgU3RydWN0KHNjaGVtYS5maWVsZHMpLCAwLCB0aGlzLmxlbmd0aCwgMCwgbnVsbCwgY2hpbGREYXRhKTtcbiAgICAgICAgcmV0dXJuIG5ldyBSZWNvcmRCYXRjaDx7IFtQIGluIEtdOiBUW1BdIH0+KHNjaGVtYSwgc3RydWN0RGF0YSk7XG4gICAgfVxufVxuIl19
