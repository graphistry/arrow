"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const type_1 = require("./type");
const vector_1 = require("./vector");
const data_1 = require("./data");
class RecordBatch extends vector_1.StructVector {
    static from(vectors) {
        return new RecordBatch(type_1.Schema.from(vectors), Math.max(...vectors.map((v) => v.length)), vectors);
    }
    constructor(...args) {
        if (typeof args[1] !== 'number') {
            const data = args[1];
            super(data, args[2]);
            this.schema = args[0];
            this.length = data.length;
            this.numCols = this.schema.fields.length;
            this.columns = data instanceof data_1.ChunkedData
                ? data.childVectors
                : data.childData.map((col) => vector_1.Vector.create(col));
        }
        else {
            const [schema, numRows, cols] = args;
            const columns = new Array(cols.length);
            const columnsData = new Array(cols.length);
            for (let index = -1, length = cols.length; ++index < length;) {
                const col = cols[index];
                if (col instanceof vector_1.Vector) {
                    columnsData[index] = (columns[index] = col).data;
                }
                else {
                    columns[index] = vector_1.Vector.create(columnsData[index] = col);
                }
            }
            super(new data_1.NestedData(new type_1.Struct(schema.fields), numRows, null, columnsData));
            this.schema = schema;
            this.columns = columns;
            this.length = numRows;
            this.numCols = schema.fields.length;
        }
    }
    clone(data, view = this.view.clone(data)) {
        return new RecordBatch(this.schema, data, view);
    }
    select(...columnNames) {
        const fields = this.schema.fields;
        const namesToKeep = columnNames.reduce((xs, x) => (xs[x] = true) && xs, Object.create(null));
        return new RecordBatch(this.schema.select(...columnNames), this.length, this.columns.filter((_, index) => namesToKeep[fields[index].name]));
    }
}
exports.RecordBatch = RecordBatch;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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Q0FDSjtBQXJERCxrQ0FxREMiLCJmaWxlIjoicmVjb3JkYmF0Y2guanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4vLyBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbi8vIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4vLyByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4vLyB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4vLyBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Vcbi8vIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbi8vXG4vLyAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbi8vIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4vLyBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuLy8gS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4vLyBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4vLyB1bmRlciB0aGUgTGljZW5zZS5cblxuaW1wb3J0IHsgU2NoZW1hLCBTdHJ1Y3QgfSBmcm9tICcuL3R5cGUnO1xuaW1wb3J0IHsgZmxhdGJ1ZmZlcnMgfSBmcm9tICdmbGF0YnVmZmVycyc7XG5pbXBvcnQgeyBWaWV3LCBWZWN0b3IsIFN0cnVjdFZlY3RvciB9IGZyb20gJy4vdmVjdG9yJztcbmltcG9ydCB7IERhdGEsIE5lc3RlZERhdGEsIENodW5rZWREYXRhIH0gZnJvbSAnLi9kYXRhJztcblxuaW1wb3J0IExvbmcgPSBmbGF0YnVmZmVycy5Mb25nO1xuXG5leHBvcnQgY2xhc3MgUmVjb3JkQmF0Y2ggZXh0ZW5kcyBTdHJ1Y3RWZWN0b3Ige1xuICAgIHB1YmxpYyBzdGF0aWMgZnJvbSh2ZWN0b3JzOiBWZWN0b3JbXSkge1xuICAgICAgICByZXR1cm4gbmV3IFJlY29yZEJhdGNoKFNjaGVtYS5mcm9tKHZlY3RvcnMpLFxuICAgICAgICAgICAgTWF0aC5tYXgoLi4udmVjdG9ycy5tYXAoKHYpID0+IHYubGVuZ3RoKSksXG4gICAgICAgICAgICB2ZWN0b3JzXG4gICAgICAgICk7XG4gICAgfVxuICAgIHB1YmxpYyByZWFkb25seSBzY2hlbWE6IFNjaGVtYTtcbiAgICBwdWJsaWMgcmVhZG9ubHkgbGVuZ3RoOiBudW1iZXI7XG4gICAgcHVibGljIHJlYWRvbmx5IG51bUNvbHM6IG51bWJlcjtcbiAgICBwdWJsaWMgcmVhZG9ubHkgY29sdW1uczogVmVjdG9yPGFueT5bXTtcbiAgICBjb25zdHJ1Y3RvcihzY2hlbWE6IFNjaGVtYSwgZGF0YTogRGF0YTxTdHJ1Y3Q+LCB2aWV3OiBWaWV3PFN0cnVjdD4pO1xuICAgIGNvbnN0cnVjdG9yKHNjaGVtYTogU2NoZW1hLCBudW1Sb3dzOiBMb25nIHwgbnVtYmVyLCBjb2xzOiBEYXRhPGFueT4gfCBWZWN0b3JbXSk7XG4gICAgY29uc3RydWN0b3IoLi4uYXJnczogYW55W10pIHtcbiAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzFdICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgY29uc3QgZGF0YSA9IGFyZ3NbMV0gYXMgRGF0YTxTdHJ1Y3Q+O1xuICAgICAgICAgICAgc3VwZXIoZGF0YSwgYXJnc1syXSk7XG4gICAgICAgICAgICB0aGlzLnNjaGVtYSA9IGFyZ3NbMF07XG4gICAgICAgICAgICB0aGlzLmxlbmd0aCA9IGRhdGEubGVuZ3RoO1xuICAgICAgICAgICAgdGhpcy5udW1Db2xzID0gdGhpcy5zY2hlbWEuZmllbGRzLmxlbmd0aDtcbiAgICAgICAgICAgIHRoaXMuY29sdW1ucyA9IGRhdGEgaW5zdGFuY2VvZiBDaHVua2VkRGF0YVxuICAgICAgICAgICAgICAgID8gZGF0YS5jaGlsZFZlY3RvcnNcbiAgICAgICAgICAgICAgICA6IGRhdGEuY2hpbGREYXRhLm1hcCgoY29sKSA9PiBWZWN0b3IuY3JlYXRlKGNvbCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgW3NjaGVtYSwgbnVtUm93cywgY29sc10gPSBhcmdzO1xuICAgICAgICAgICAgY29uc3QgY29sdW1uczogVmVjdG9yPGFueT5bXSA9IG5ldyBBcnJheShjb2xzLmxlbmd0aCk7XG4gICAgICAgICAgICBjb25zdCBjb2x1bW5zRGF0YTogRGF0YTxhbnk+W10gPSBuZXcgQXJyYXkoY29scy5sZW5ndGgpO1xuICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAtMSwgbGVuZ3RoID0gY29scy5sZW5ndGg7ICsraW5kZXggPCBsZW5ndGg7KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29sOiBEYXRhPGFueT4gfCBWZWN0b3IgPSBjb2xzW2luZGV4XTtcbiAgICAgICAgICAgICAgICBpZiAoY29sIGluc3RhbmNlb2YgVmVjdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbnNEYXRhW2luZGV4XSA9IChjb2x1bW5zW2luZGV4XSA9IGNvbCBhcyBWZWN0b3IpLmRhdGE7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uc1tpbmRleF0gPSBWZWN0b3IuY3JlYXRlKGNvbHVtbnNEYXRhW2luZGV4XSA9IGNvbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3VwZXIobmV3IE5lc3RlZERhdGEobmV3IFN0cnVjdChzY2hlbWEuZmllbGRzKSwgbnVtUm93cywgbnVsbCwgY29sdW1uc0RhdGEpKTtcbiAgICAgICAgICAgIHRoaXMuc2NoZW1hID0gc2NoZW1hO1xuICAgICAgICAgICAgdGhpcy5jb2x1bW5zID0gY29sdW1ucztcbiAgICAgICAgICAgIHRoaXMubGVuZ3RoID0gbnVtUm93cztcbiAgICAgICAgICAgIHRoaXMubnVtQ29scyA9IHNjaGVtYS5maWVsZHMubGVuZ3RoO1xuICAgICAgICB9XG4gICAgfVxuICAgIHB1YmxpYyBjbG9uZTxSIGV4dGVuZHMgU3RydWN0PihkYXRhOiBEYXRhPFI+LCB2aWV3OiBWaWV3PFI+ID0gdGhpcy52aWV3LmNsb25lKGRhdGEpKTogdGhpcyB7XG4gICAgICAgIHJldHVybiBuZXcgUmVjb3JkQmF0Y2godGhpcy5zY2hlbWEsIGRhdGEgYXMgYW55LCB2aWV3KSBhcyBhbnk7XG4gICAgfVxuICAgIHB1YmxpYyBzZWxlY3QoLi4uY29sdW1uTmFtZXM6IHN0cmluZ1tdKSB7XG4gICAgICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuc2NoZW1hLmZpZWxkcztcbiAgICAgICAgY29uc3QgbmFtZXNUb0tlZXAgPSBjb2x1bW5OYW1lcy5yZWR1Y2UoKHhzLCB4KSA9PiAoeHNbeF0gPSB0cnVlKSAmJiB4cywgT2JqZWN0LmNyZWF0ZShudWxsKSk7XG4gICAgICAgIHJldHVybiBuZXcgUmVjb3JkQmF0Y2goXG4gICAgICAgICAgICB0aGlzLnNjaGVtYS5zZWxlY3QoLi4uY29sdW1uTmFtZXMpLCB0aGlzLmxlbmd0aCxcbiAgICAgICAgICAgIHRoaXMuY29sdW1ucy5maWx0ZXIoKF8sIGluZGV4KSA9PiBuYW1lc1RvS2VlcFtmaWVsZHNbaW5kZXhdLm5hbWVdKVxuICAgICAgICApO1xuICAgIH1cbn1cbiJdfQ==
