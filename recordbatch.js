"use strict";
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy of the License at
//
//   http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
Object.defineProperty(exports, "__esModule", { value: true });
const data_1 = require("./data");
const table_1 = require("./table");
const schema_1 = require("./schema");
const type_1 = require("./type");
const struct_1 = require("./vector/struct");
const chunked_1 = require("./vector/chunked");
class RecordBatch extends struct_1.StructVector {
    constructor(...args) {
        let schema = args[0];
        let data;
        let children;
        if (typeof args[1] === 'number') {
            const fields = schema.fields;
            const [, numRows, childData] = args;
            data = data_1.Data.Struct(new type_1.Struct(fields), 0, numRows, 0, null, childData);
        }
        else {
            [, data, children] = args;
        }
        super(data, children);
        this._schema = schema;
    }
    /** @nocollapse */
    static from(vectors, names = []) {
        return new RecordBatch(schema_1.Schema.from(vectors, names), vectors.reduce((len, vec) => Math.max(len, vec.length), 0), vectors);
    }
    clone(data, children = this._children) {
        return new RecordBatch(this._schema, data, children);
    }
    concat(...others) {
        const schema = this._schema, chunks = chunked_1.Chunked.flatten(this, ...others);
        return new table_1.Table(schema, chunks.map(({ data }) => new RecordBatch(schema, data)));
    }
    get schema() { return this._schema; }
    get numCols() { return this._schema.fields.length; }
    select(...columnNames) {
        const fields = this._schema.fields;
        const schema = this._schema.select(...columnNames);
        const childNames = columnNames.reduce((xs, x) => (xs[x] = true) && xs, {});
        const childData = this.data.childData.filter((_, i) => childNames[fields[i].name]);
        const structData = data_1.Data.Struct(new type_1.Struct(schema.fields), 0, this.length, 0, null, childData);
        return new RecordBatch(schema, structData);
    }
}
exports.RecordBatch = RecordBatch;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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T0FBTyxDQUFDLE1BQU0sQ0FBQztRQUNuQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLFdBQVcsQ0FBQyxDQUFDO1FBQ25ELE1BQU0sVUFBVSxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLEVBQVEsRUFBRSxDQUFDLENBQUM7UUFDakYsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ25GLE1BQU0sVUFBVSxHQUFHLFdBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxhQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDOUYsT0FBTyxJQUFJLFdBQVcsQ0FBcUIsTUFBTSxFQUFFLFVBQThDLENBQUMsQ0FBQztJQUN2RyxDQUFDO0NBQ0o7QUF0REQsa0NBc0RDIiwiZmlsZSI6InJlY29yZGJhdGNoLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuLy8gb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4vLyBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuLy8gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuLy8gdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuLy8gXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4vLyB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4vL1xuLy8gICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbi8vXG4vLyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4vLyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuLy8gXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbi8vIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuLy8gc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuLy8gdW5kZXIgdGhlIExpY2Vuc2UuXG5cbmltcG9ydCB7IERhdGEgfSBmcm9tICcuL2RhdGEnO1xuaW1wb3J0IHsgVGFibGUgfSBmcm9tICcuL3RhYmxlJztcbmltcG9ydCB7IFZlY3RvciB9IGZyb20gJy4vdmVjdG9yJztcbmltcG9ydCB7IFNjaGVtYSwgRmllbGQgfSBmcm9tICcuL3NjaGVtYSc7XG5pbXBvcnQgeyBEYXRhVHlwZSwgU3RydWN0IH0gZnJvbSAnLi90eXBlJztcbmltcG9ydCB7IFN0cnVjdFZlY3RvciB9IGZyb20gJy4vdmVjdG9yL3N0cnVjdCc7XG5pbXBvcnQgeyBWZWN0b3IgYXMgVlR5cGUgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgQ2h1bmtlZCB9IGZyb20gJy4vdmVjdG9yL2NodW5rZWQnO1xuaW1wb3J0IHsgQ2xvbmFibGUsIFNsaWNlYWJsZSwgQXBwbGljYXRpdmUgfSBmcm9tICcuL3ZlY3Rvcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjb3JkQmF0Y2g8VCBleHRlbmRzIHsgW2tleTogc3RyaW5nXTogRGF0YVR5cGUgfSA9IGFueT4ge1xuICAgIGNvbmNhdCguLi5vdGhlcnM6IFZlY3RvcjxTdHJ1Y3Q8VD4+W10pOiBUYWJsZTxUPjtcbiAgICBzbGljZShiZWdpbj86IG51bWJlciwgZW5kPzogbnVtYmVyKTogUmVjb3JkQmF0Y2g8VD47XG4gICAgY2xvbmUoZGF0YTogRGF0YTxTdHJ1Y3Q8VD4+LCBjaGlsZHJlbj86IFZlY3RvcltdKTogUmVjb3JkQmF0Y2g8VD47XG59XG5cbmV4cG9ydCBjbGFzcyBSZWNvcmRCYXRjaDxUIGV4dGVuZHMgeyBba2V5OiBzdHJpbmddOiBEYXRhVHlwZSB9ID0gYW55PlxuICAgIGV4dGVuZHMgU3RydWN0VmVjdG9yPFQ+XG4gICAgaW1wbGVtZW50cyBDbG9uYWJsZTxSZWNvcmRCYXRjaDxUPj4sXG4gICAgICAgICAgICAgICBTbGljZWFibGU8UmVjb3JkQmF0Y2g8VD4+LFxuICAgICAgICAgICAgICAgQXBwbGljYXRpdmU8U3RydWN0PFQ+LCBUYWJsZTxUPj4ge1xuXG4gICAgLyoqIEBub2NvbGxhcHNlICovXG4gICAgcHVibGljIHN0YXRpYyBmcm9tPFQgZXh0ZW5kcyB7IFtrZXk6IHN0cmluZ106IERhdGFUeXBlIH0gPSBhbnk+KHZlY3RvcnM6IFZUeXBlPFRba2V5b2YgVF0+W10sIG5hbWVzOiAoa2V5b2YgVClbXSA9IFtdKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVjb3JkQmF0Y2goXG4gICAgICAgICAgICBTY2hlbWEuZnJvbSh2ZWN0b3JzLCBuYW1lcyksXG4gICAgICAgICAgICB2ZWN0b3JzLnJlZHVjZSgobGVuLCB2ZWMpID0+IE1hdGgubWF4KGxlbiwgdmVjLmxlbmd0aCksIDApLFxuICAgICAgICAgICAgdmVjdG9yc1xuICAgICAgICApO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfc2NoZW1hOiBTY2hlbWE7XG5cbiAgICBjb25zdHJ1Y3RvcihzY2hlbWE6IFNjaGVtYTxUPiwgbnVtUm93czogbnVtYmVyLCBjaGlsZERhdGE6IChEYXRhIHwgVmVjdG9yKVtdKTtcbiAgICBjb25zdHJ1Y3RvcihzY2hlbWE6IFNjaGVtYTxUPiwgZGF0YTogRGF0YTxTdHJ1Y3Q8VD4+LCBjaGlsZHJlbj86IFZlY3RvcltdKTtcbiAgICBjb25zdHJ1Y3RvciguLi5hcmdzOiBhbnlbXSkge1xuICAgICAgICBsZXQgc2NoZW1hID0gYXJnc1swXTtcbiAgICAgICAgbGV0IGRhdGE6IERhdGE8U3RydWN0PFQ+PjtcbiAgICAgICAgbGV0IGNoaWxkcmVuOiBWZWN0b3JbXSB8IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzFdID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgY29uc3QgZmllbGRzID0gc2NoZW1hLmZpZWxkcyBhcyBGaWVsZDxUW2tleW9mIFRdPltdO1xuICAgICAgICAgICAgY29uc3QgWywgbnVtUm93cywgY2hpbGREYXRhXSA9IGFyZ3MgYXMgW1NjaGVtYTxUPiwgbnVtYmVyLCBEYXRhW11dO1xuICAgICAgICAgICAgZGF0YSA9IERhdGEuU3RydWN0KG5ldyBTdHJ1Y3Q8VD4oZmllbGRzKSwgMCwgbnVtUm93cywgMCwgbnVsbCwgY2hpbGREYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIFssIGRhdGEsIGNoaWxkcmVuXSA9IChhcmdzIGFzIFtTY2hlbWE8VD4sIERhdGE8U3RydWN0PFQ+PiwgVmVjdG9yW10/XSk7XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIoZGF0YSwgY2hpbGRyZW4pO1xuICAgICAgICB0aGlzLl9zY2hlbWEgPSBzY2hlbWE7XG4gICAgfVxuXG4gICAgcHVibGljIGNsb25lKGRhdGE6IERhdGE8U3RydWN0PFQ+PiwgY2hpbGRyZW4gPSB0aGlzLl9jaGlsZHJlbikge1xuICAgICAgICByZXR1cm4gbmV3IFJlY29yZEJhdGNoPFQ+KHRoaXMuX3NjaGVtYSwgZGF0YSwgY2hpbGRyZW4pO1xuICAgIH1cblxuICAgIHB1YmxpYyBjb25jYXQoLi4ub3RoZXJzOiBWZWN0b3I8U3RydWN0PFQ+PltdKTogVGFibGU8VD4ge1xuICAgICAgICBjb25zdCBzY2hlbWEgPSB0aGlzLl9zY2hlbWEsIGNodW5rcyA9IENodW5rZWQuZmxhdHRlbih0aGlzLCAuLi5vdGhlcnMpO1xuICAgICAgICByZXR1cm4gbmV3IFRhYmxlKHNjaGVtYSwgY2h1bmtzLm1hcCgoeyBkYXRhIH0pID0+IG5ldyBSZWNvcmRCYXRjaChzY2hlbWEsIGRhdGEpKSk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBzY2hlbWEoKSB7IHJldHVybiB0aGlzLl9zY2hlbWE7IH1cbiAgICBwdWJsaWMgZ2V0IG51bUNvbHMoKSB7IHJldHVybiB0aGlzLl9zY2hlbWEuZmllbGRzLmxlbmd0aDsgfVxuXG4gICAgcHVibGljIHNlbGVjdDxLIGV4dGVuZHMga2V5b2YgVCA9IGFueT4oLi4uY29sdW1uTmFtZXM6IEtbXSkge1xuICAgICAgICBjb25zdCBmaWVsZHMgPSB0aGlzLl9zY2hlbWEuZmllbGRzO1xuICAgICAgICBjb25zdCBzY2hlbWEgPSB0aGlzLl9zY2hlbWEuc2VsZWN0KC4uLmNvbHVtbk5hbWVzKTtcbiAgICAgICAgY29uc3QgY2hpbGROYW1lcyA9IGNvbHVtbk5hbWVzLnJlZHVjZSgoeHMsIHgpID0+ICh4c1t4XSA9IHRydWUpICYmIHhzLCA8YW55PiB7fSk7XG4gICAgICAgIGNvbnN0IGNoaWxkRGF0YSA9IHRoaXMuZGF0YS5jaGlsZERhdGEuZmlsdGVyKChfLCBpKSA9PiBjaGlsZE5hbWVzW2ZpZWxkc1tpXS5uYW1lXSk7XG4gICAgICAgIGNvbnN0IHN0cnVjdERhdGEgPSBEYXRhLlN0cnVjdChuZXcgU3RydWN0KHNjaGVtYS5maWVsZHMpLCAwLCB0aGlzLmxlbmd0aCwgMCwgbnVsbCwgY2hpbGREYXRhKTtcbiAgICAgICAgcmV0dXJuIG5ldyBSZWNvcmRCYXRjaDx7IFtQIGluIEtdOiBUW1BdIH0+KHNjaGVtYSwgc3RydWN0RGF0YSBhcyBEYXRhPFN0cnVjdDx7IFtQIGluIEtdOiBUW1BdIH0+Pik7XG4gICAgfVxufVxuIl19
